import{a as r,j as e,E as q,q as D,l as T}from"./react-core-BwXmAyYw.js";import{a as P,t as C}from"./forms-CNlQlKiB.js";import{u as I,N as g,F as p,L as f,a as B,q as A}from"./index-BnUt9mq7.js";import{u as M,h as V,B as b,I as H}from"./ui-components-CnPFRHmO.js";import{F as j}from"./form-input-C9AXxxcz.js";import{S as R}from"./social-login-QM727KyE.js";import{u as W,i as v}from"./i18n-DfkNketv.js";import{o as z,s as w}from"./validation-D376FIhw.js";import"./react-dom-lwpWoMhj.js";import"./pdf-DU6qdRYg.js";import"./tanstack-Bcy__teF.js";import"./radix-ui-BLFq0uWR.js";const K=t=>z({email:w().email(t("validation.invalidEmail")),password:w().min(1,t("validation.required"))});function ae(){const{t}=W(),[,N]=I(),[m,u]=r.useState(!1),[o,y]=r.useState(!1),[n,c]=r.useState(null),[x,k]=r.useState(!1),[h,S]=r.useState(""),[L,E]=r.useState(!1),{toast:d}=M(),F=r.useMemo(()=>K(t),[t]),l=P({resolver:C(F),defaultValues:{email:"",password:""}});r.useEffect(()=>{if(n){const i=setTimeout(()=>c(null),5e3);return()=>clearTimeout(i)}},[n]);const O=async i=>{u(!0),c(null);try{const s=await(await B("POST","/api/auth/login",{...i,securityOtp:x?h:void 0})).json();if(s.requiresSecurityOtp){k(!0),d({title:t("auth.login.securityOtpSent"),description:t("auth.login.securityOtpDesc")});return}s.success&&(s.user?.preferredLanguage&&s.user.preferredLanguage!==v.language&&(await v.changeLanguage(s.user.preferredLanguage),localStorage.setItem("i18nextLng",s.user.preferredLanguage)),await A.refetchQueries({queryKey:["/api/auth/user"]}),d({title:t("auth.login.welcomeBack"),description:t("auth.login.welcomeBackDesc")}),N("/dashboard"))}catch(a){if(a.message?.includes("desactivada")||a.message?.includes("deactivated")||a.message?.includes("403")){E(!0);return}let s=t("auth.login.genericError");a.message?.includes("401")?s=t("auth.login.invalidCredentials"):a.message?.includes("404")?s=t("auth.login.userNotFound"):a.message&&(s=a.message),c(s),d({title:t("auth.login.errorTitle"),description:t("auth.login.errorDesc"),variant:"destructive"})}finally{u(!1)}};return L?e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(g,{}),e.jsx("main",{className:"pt-20 md:pt-24 pb-12 md:pb-16 px-4 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsx("div",{className:"w-full max-w-md text-center",children:e.jsxs("div",{className:"mb-8",children:[e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mx-auto mb-6",children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"#FEE2E2",stroke:"#EF4444",strokeWidth:"4"}),e.jsx("path",{d:"M60 35V65",stroke:"#EF4444",strokeWidth:"6",strokeLinecap:"round"}),e.jsx("circle",{cx:"60",cy:"80",r:"5",fill:"#EF4444"})]}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-foreground tracking-tight",children:t("auth.accountDeactivated.title")}),e.jsx("p",{className:"text-muted-foreground mt-4 text-sm sm:text-base",children:t("auth.accountDeactivated.description")})]})})}),e.jsx(p,{})]}):e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(g,{}),e.jsx("main",{className:"pt-20 md:pt-24 pb-12 md:pb-16 px-4 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"w-full max-w-sm md:max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 flex flex-col items-center justify-center w-full",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-black tracking-tight text-center w-full",children:[e.jsx("span",{className:"text-foreground",children:t("auth.login.title")})," ",e.jsx("span",{className:"text-accent",children:t("auth.login.titleHighlight")})]}),e.jsx("p",{className:"text-muted-foreground mt-2 text-sm md:text-base text-center max-w-xs md:max-w-sm",children:t("auth.login.subtitle")})]}),n&&e.jsx("div",{className:"mb-4 md:mb-6 p-3 md:p-4 bg-destructive/10 border border-destructive/20 rounded-xl text-center",children:e.jsx("p",{className:"text-destructive font-medium text-xs md:text-sm",children:n})}),e.jsxs("div",{className:"bg-white dark:bg-card rounded-2xl md:rounded-3xl p-5 md:p-8 border border-border shadow-sm",children:[e.jsx(V,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(O),className:"space-y-4 md:space-y-5",children:[e.jsx(j,{control:l.control,name:"email",label:t("auth.login.email"),placeholder:t("auth.login.emailPlaceholder"),type:"email",inputMode:"email"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{control:l.control,name:"password",label:t("auth.login.password"),placeholder:t("auth.login.passwordPlaceholder"),type:o?"text":"password"}),e.jsx(b,{type:"button",variant:"ghost",size:"icon",onClick:()=>y(!o),className:"absolute right-3 bottom-[6px] h-8 w-8 text-muted-foreground hover:text-foreground","aria-label":t(o?"common.close":"common.search"),"data-testid":"button-toggle-password",children:o?e.jsx(q,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-accent/10 border border-accent/30 rounded-xl p-4 text-center mb-4",children:[e.jsx("p",{className:"text-sm font-bold text-foreground mb-1",children:t("auth.login.securityVerification")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("auth.login.securityVerificationDesc")})]}),e.jsx("label",{className:"text-xs font-bold text-foreground tracking-wide block",children:t("auth.login.securityCode")}),e.jsx(H,{type:"text",value:h,onChange:i=>S(i.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,className:"h-12 text-center text-xl tracking-[0.5em] font-bold rounded-full","data-testid":"input-security-otp"})]}),e.jsx("div",{className:"text-center",children:e.jsx(f,{href:"/auth/forgot-password",children:e.jsxs("div",{className:"text-accent hover:underline cursor-pointer","data-testid":"link-forgot-password",children:[e.jsx("p",{className:"text-xs md:text-sm font-bold",children:t("auth.login.forgotPassword")}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:t("auth.login.forgotPasswordHelp")})]})})}),e.jsx(b,{type:"submit",disabled:m,className:"w-full bg-accent text-accent-foreground font-black rounded-full h-11 md:h-12 text-sm md:text-base shadow-lg shadow-accent/20","data-testid":"button-login",children:m?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2 w-4 h-4"}),t("auth.login.submitting")]}):t("auth.login.submit")})]})}),e.jsx("div",{className:"mt-6 pt-5 border-t border-border",children:e.jsx(R,{mode:"login"})}),e.jsx("div",{className:"mt-6 pt-5 border-t border-border text-center",children:e.jsx(f,{href:"/auth/register",children:e.jsxs("div",{className:"hover:underline cursor-pointer","data-testid":"link-register",children:[e.jsx("p",{className:"text-foreground text-xs md:text-sm font-bold",children:t("auth.login.noAccount")}),e.jsx("p",{className:"text-accent text-[10px] md:text-xs",children:t("auth.login.noAccountHelp")})]})})})]})]})}),e.jsx(p,{})]})}export{ae as default};
