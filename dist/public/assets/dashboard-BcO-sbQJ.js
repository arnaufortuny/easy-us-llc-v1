import{j as e}from"./vendor-COEzyDgE.js";import{e as g,g as Ee,d as Se,b as ke,a as W,l as X,N as _e,C as A,i as P,j as D,h as E,B as I,F as Pe,q as Z,c as ee}from"./index-CBcJsqzW.js";import{a as n,c as se,d as De,ak as ae,P as R,g as j,u as Le,al as te,e as re,h as Me,f as Ge,z as Ke,aj as Ue,am as Ve,af as $e,s as Be,an as Oe,ao as ze,a8 as qe}from"./ui--rYLpEME.js";const $=n.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:g("w-full caption-bottom text-sm",s),...a})}));$.displayName="Table";const B=n.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:g("[&_tr]:border-b",s),...a}));B.displayName="TableHeader";const O=n.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:g("[&_tr:last-child]:border-0",s),...a}));O.displayName="TableBody";const He=n.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:g("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));He.displayName="TableFooter";const S=n.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:g("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));S.displayName="TableRow";const b=n.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:g("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a}));b.displayName="TableHead";const h=n.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:g("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a}));h.displayName="TableCell";const Qe=n.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:g("mt-4 text-sm text-muted-foreground",s),...a}));Qe.displayName="TableCaption";const Ye=Ee("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function U({className:s,variant:a,...t}){return e.jsx("div",{className:g(Ye({variant:a}),s),...t})}var V="rovingFocusGroup.onEntryFocus",Je={bubbles:!1,cancelable:!0},k="RovingFocusGroup",[z,oe,We]=De(k),[Xe,ne]=se(k,[We]),[Ze,es]=Xe(k),ie=n.forwardRef((s,a)=>e.jsx(z.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(z.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx(ss,{...s,ref:a})})}));ie.displayName=k;var ss=n.forwardRef((s,a)=>{const{__scopeRovingFocusGroup:t,orientation:o,loop:d=!1,dir:m,currentTabStopId:i,defaultCurrentTabStopId:x,onCurrentTabStopIdChange:v,onEntryFocus:f,preventScrollOnEntryFocus:c=!1,...l}=s,r=n.useRef(null),w=Le(a,r),F=te(m),[_,u]=re({prop:i,defaultProp:x??null,onChange:v,caller:k}),[y,M]=n.useState(!1),N=Me(f),T=oe(t),G=n.useRef(!1),[Ce,Y]=n.useState(0);return n.useEffect(()=>{const p=r.current;if(p)return p.addEventListener(V,N),()=>p.removeEventListener(V,N)},[N]),e.jsx(Ze,{scope:t,orientation:o,dir:F,loop:d,currentTabStopId:_,onItemFocus:n.useCallback(p=>u(p),[u]),onItemShiftTab:n.useCallback(()=>M(!0),[]),onFocusableItemAdd:n.useCallback(()=>Y(p=>p+1),[]),onFocusableItemRemove:n.useCallback(()=>Y(p=>p-1),[]),children:e.jsx(R.div,{tabIndex:y||Ce===0?-1:0,"data-orientation":o,...l,ref:w,style:{outline:"none",...s.style},onMouseDown:j(s.onMouseDown,()=>{G.current=!0}),onFocus:j(s.onFocus,p=>{const Ie=!G.current;if(p.target===p.currentTarget&&Ie&&!y){const J=new CustomEvent(V,Je);if(p.currentTarget.dispatchEvent(J),!J.defaultPrevented){const K=T().filter(C=>C.focusable),Re=K.find(C=>C.active),Fe=K.find(C=>C.id===_),Ae=[Re,Fe,...K].filter(Boolean).map(C=>C.ref.current);de(Ae,c)}}G.current=!1}),onBlur:j(s.onBlur,()=>M(!1))})})}),ce="RovingFocusGroupItem",le=n.forwardRef((s,a)=>{const{__scopeRovingFocusGroup:t,focusable:o=!0,active:d=!1,tabStopId:m,children:i,...x}=s,v=ae(),f=m||v,c=es(ce,t),l=c.currentTabStopId===f,r=oe(t),{onFocusableItemAdd:w,onFocusableItemRemove:F,currentTabStopId:_}=c;return n.useEffect(()=>{if(o)return w(),()=>F()},[o,w,F]),e.jsx(z.ItemSlot,{scope:t,id:f,focusable:o,active:d,children:e.jsx(R.span,{tabIndex:l?0:-1,"data-orientation":c.orientation,...x,ref:a,onMouseDown:j(s.onMouseDown,u=>{o?c.onItemFocus(f):u.preventDefault()}),onFocus:j(s.onFocus,()=>c.onItemFocus(f)),onKeyDown:j(s.onKeyDown,u=>{if(u.key==="Tab"&&u.shiftKey){c.onItemShiftTab();return}if(u.target!==u.currentTarget)return;const y=rs(u,c.orientation,c.dir);if(y!==void 0){if(u.metaKey||u.ctrlKey||u.altKey||u.shiftKey)return;u.preventDefault();let N=r().filter(T=>T.focusable).map(T=>T.ref.current);if(y==="last")N.reverse();else if(y==="prev"||y==="next"){y==="prev"&&N.reverse();const T=N.indexOf(u.currentTarget);N=c.loop?os(N,T+1):N.slice(T+1)}setTimeout(()=>de(N))}}),children:typeof i=="function"?i({isCurrentTabStop:l,hasTabStop:_!=null}):i})})});le.displayName=ce;var as={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ts(s,a){return a!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function rs(s,a,t){const o=ts(s.key,t);if(!(a==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(a==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return as[o]}function de(s,a=!1){const t=document.activeElement;for(const o of s)if(o===t||(o.focus({preventScroll:a}),document.activeElement!==t))return}function os(s,a){return s.map((t,o)=>s[(a+o)%s.length])}var ns=ie,is=le,L="Tabs",[cs]=se(L,[ne]),ue=ne(),[ls,Q]=cs(L),me=n.forwardRef((s,a)=>{const{__scopeTabs:t,value:o,onValueChange:d,defaultValue:m,orientation:i="horizontal",dir:x,activationMode:v="automatic",...f}=s,c=te(x),[l,r]=re({prop:o,onChange:d,defaultProp:m??"",caller:L});return e.jsx(ls,{scope:t,baseId:ae(),value:l,onValueChange:r,orientation:i,dir:c,activationMode:v,children:e.jsx(R.div,{dir:c,"data-orientation":i,...f,ref:a})})});me.displayName=L;var xe="TabsList",fe=n.forwardRef((s,a)=>{const{__scopeTabs:t,loop:o=!0,...d}=s,m=Q(xe,t),i=ue(t);return e.jsx(ns,{asChild:!0,...i,orientation:m.orientation,dir:m.dir,loop:o,children:e.jsx(R.div,{role:"tablist","aria-orientation":m.orientation,...d,ref:a})})});fe.displayName=xe;var pe="TabsTrigger",be=n.forwardRef((s,a)=>{const{__scopeTabs:t,value:o,disabled:d=!1,...m}=s,i=Q(pe,t),x=ue(t),v=ve(i.baseId,o),f=Ne(i.baseId,o),c=o===i.value;return e.jsx(is,{asChild:!0,...x,focusable:!d,active:c,children:e.jsx(R.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":f,"data-state":c?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:v,...m,ref:a,onMouseDown:j(s.onMouseDown,l=>{!d&&l.button===0&&l.ctrlKey===!1?i.onValueChange(o):l.preventDefault()}),onKeyDown:j(s.onKeyDown,l=>{[" ","Enter"].includes(l.key)&&i.onValueChange(o)}),onFocus:j(s.onFocus,()=>{const l=i.activationMode!=="manual";!c&&!d&&l&&i.onValueChange(o)})})})});be.displayName=pe;var he="TabsContent",ge=n.forwardRef((s,a)=>{const{__scopeTabs:t,value:o,forceMount:d,children:m,...i}=s,x=Q(he,t),v=ve(x.baseId,o),f=Ne(x.baseId,o),c=o===x.value,l=n.useRef(c);return n.useEffect(()=>{const r=requestAnimationFrame(()=>l.current=!1);return()=>cancelAnimationFrame(r)},[]),e.jsx(Ge,{present:d||c,children:({present:r})=>e.jsx(R.div,{"data-state":c?"active":"inactive","data-orientation":x.orientation,role:"tabpanel","aria-labelledby":v,hidden:!r,id:f,tabIndex:0,...i,ref:a,style:{...s.style,animationDuration:l.current?"0s":void 0},children:r&&m})})});ge.displayName=he;function ve(s,a){return`${s}-trigger-${a}`}function Ne(s,a){return`${s}-content-${a}`}var ds=me,je=fe,we=be,ye=ge;const us=ds,Te=n.forwardRef(({className:s,...a},t)=>e.jsx(je,{ref:t,className:g("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a}));Te.displayName=je.displayName;const q=n.forwardRef(({className:s,...a},t)=>e.jsx(we,{ref:t,className:g("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a}));q.displayName=we.displayName;const H=n.forwardRef(({className:s,...a},t)=>e.jsx(ye,{ref:t,className:g("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));H.displayName=ye.displayName;function bs(){const{user:s,isAuthenticated:a,isLoading:t}=Se(),{toast:o}=ke(),[d,m]=n.useState("orders");n.useEffect(()=>{!t&&(!a||!s?.isAdmin)&&(window.location.href="/")},[a,s,t]);const{data:i,isLoading:x}=W({queryKey:["/api/admin/orders"],enabled:!!s?.isAdmin}),{data:v,isLoading:f}=W({queryKey:["/api/admin/users"],enabled:!!s?.isAdmin}),c=X({mutationFn:async({id:r,status:w})=>(await ee("PATCH",`/api/admin/orders/${r}/status`,{status:w})).json(),onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/admin/orders"]}),o({title:"Estado actualizado",description:"El pedido ha sido actualizado correctamente."})}}),l=X({mutationFn:async r=>{await ee("DELETE",`/api/admin/users/${r}`)},onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/admin/users"]}),o({title:"Usuario eliminado",variant:"destructive"})}});return t||!s?.isAdmin?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Ke,{className:"w-8 h-8 animate-spin text-accent"})}):e.jsxs("div",{className:"min-h-screen bg-[#F7F7F5]",children:[e.jsx(_e,{}),e.jsxs("main",{className:"pt-24 pb-16 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h1",{className:"text-4xl font-black text-primary uppercase tracking-tighter",children:"Panel de Administración"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestión centralizada de pedidos, clientes y facturación."})]}),e.jsxs(us,{defaultValue:"orders",onValueChange:m,className:"space-y-8",children:[e.jsxs(Te,{className:"bg-white p-1 rounded-full border border-gray-100 shadow-sm",children:[e.jsxs(q,{value:"orders",className:"rounded-full px-8 py-2 data-[state=active]:bg-accent data-[state=active]:text-primary font-bold uppercase text-xs",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Pedidos"]}),e.jsxs(q,{value:"users",className:"rounded-full px-8 py-2 data-[state=active]:bg-accent data-[state=active]:text-primary font-bold uppercase text-xs",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"})," Usuarios"]})]}),e.jsxs(H,{value:"orders",className:"space-y-8 mt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(A,{className:"rounded-3xl border-0 shadow-sm",children:[e.jsx(P,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-bold uppercase text-muted-foreground",children:"Ventas Totales"})}),e.jsx(E,{children:e.jsx("p",{className:"text-3xl font-black text-primary",children:i?.reduce((r,w)=>r+w.amount,0).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})})]}),e.jsxs(A,{className:"rounded-3xl border-0 shadow-sm",children:[e.jsx(P,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-bold uppercase text-muted-foreground",children:"Pedidos Pendientes"})}),e.jsx(E,{children:e.jsx("p",{className:"text-3xl font-black text-yellow-600",children:i?.filter(r=>r.status==="pending").length})})]}),e.jsxs(A,{className:"rounded-3xl border-0 shadow-sm",children:[e.jsx(P,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-bold uppercase text-muted-foreground",children:"Clientes Activos"})}),e.jsx(E,{children:e.jsx("p",{className:"text-3xl font-black text-accent",children:new Set(i?.map(r=>r.userId)).size})})]})]}),e.jsxs(A,{className:"rounded-3xl border-0 shadow-sm overflow-hidden",children:[e.jsx(P,{className:"bg-white border-b border-gray-100 p-6",children:e.jsx(D,{className:"text-xl font-black uppercase",children:"Listado de Pedidos"})}),e.jsx(E,{className:"p-0",children:e.jsxs($,{children:[e.jsx(B,{children:e.jsxs(S,{className:"hover:bg-transparent border-gray-100",children:[e.jsx(b,{className:"font-bold uppercase text-xs px-6",children:"ID / Fecha"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Cliente"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Servicio"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Importe"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Estado"}),e.jsx(b,{className:"font-bold uppercase text-xs text-right px-6",children:"Acciones"})]})}),e.jsx(O,{children:i?.map(r=>e.jsxs(S,{className:"border-gray-50 hover:bg-gray-50/50",children:[e.jsxs(h,{className:"px-6",children:[e.jsxs("p",{className:"font-bold",children:["#",r.id]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(r.createdAt).toLocaleDateString()})]}),e.jsxs(h,{children:[e.jsxs("p",{className:"font-medium",children:[r.user?.firstName," ",r.user?.lastName]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.user?.email})]}),e.jsx(h,{children:e.jsx(U,{variant:"outline",className:"font-bold uppercase text-[10px] tracking-widest bg-gray-50",children:r.product?.name})}),e.jsxs(h,{className:"font-bold",children:[(r.amount/100).toFixed(2),"€"]}),e.jsx(h,{children:e.jsx(U,{className:`font-black uppercase text-[10px] tracking-tighter ${r.status==="paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r.status})}),e.jsxs(h,{className:"text-right px-6 space-x-2",children:[e.jsx(I,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",title:"Ver Factura",onClick:()=>window.open(`/api/admin/invoice/${r.id}`,"_blank"),children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx(I,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",title:"Ver Recibo",onClick:()=>window.open(`/api/orders/${r.id}/receipt`,"_blank"),children:e.jsx(Be,{className:"w-4 h-4"})}),e.jsx(I,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 text-green-600",title:"Marcar como pagado",onClick:()=>c.mutate({id:r.id,status:"paid"}),disabled:r.status==="paid",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]},r.id))})]})})]})]}),e.jsxs(H,{value:"users",className:"space-y-8 mt-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-black uppercase text-primary",children:"Gestión de Usuarios"}),e.jsx(I,{className:"bg-primary text-white font-bold rounded-full px-6",onClick:()=>o({title:"Próximamente",description:"La creación de usuarios estará disponible pronto."}),children:"Crear Usuario"})]}),e.jsx(A,{className:"rounded-3xl border-0 shadow-sm overflow-hidden",children:e.jsx(E,{className:"p-0",children:e.jsxs($,{children:[e.jsx(B,{children:e.jsxs(S,{className:"hover:bg-transparent border-gray-100",children:[e.jsx(b,{className:"font-bold uppercase text-xs px-6",children:"ID / Nombre"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Email"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Teléfono"}),e.jsx(b,{className:"font-bold uppercase text-xs",children:"Rol"}),e.jsx(b,{className:"font-bold uppercase text-xs text-right px-6",children:"Acciones"})]})}),e.jsx(O,{children:v?.map(r=>e.jsxs(S,{className:"border-gray-50 hover:bg-gray-50/50",children:[e.jsxs(h,{className:"px-6",children:[e.jsxs("p",{className:"font-bold",children:[r.firstName," ",r.lastName]}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-mono",children:r.id})]}),e.jsx(h,{className:"font-medium",children:r.email}),e.jsx(h,{className:"text-sm font-medium",children:r.phone||"N/A"}),e.jsx(h,{children:e.jsx(U,{className:`font-black uppercase text-[10px] ${r.isAdmin?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:r.isAdmin?"Admin":"Cliente"})}),e.jsxs(h,{className:"text-right px-6 space-x-2",children:[e.jsx(I,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",title:"Cambiar Contraseña",onClick:()=>window.open("/api/login?prompt=login","_blank"),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(I,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 text-red-600",title:"Eliminar Usuario",onClick:()=>confirm("¿Seguro que quieres eliminar este usuario?")&&l.mutate(r.id),children:e.jsx(qe,{className:"w-4 h-4"})})]})]},r.id))})]})})})]})]})]}),e.jsx(Pe,{})]})}export{bs as default};
