import{m as He,n as ie,o as je,F as W,W as At,B as Ge,j as e,d as Bt,a as i,P as La,p as Nt,q as Ia,s as be,U as Wt,t as Jt,u as vt,v as yt,X as Xt,w as Fa,x as fe,k as wt,T as kt,y as Yt,N as Zt,z as Ct,A as St,G as Dt,H as es,I as as,J as ts,K as ss,O as $a,l as zt,i as H,Q as rs,V as ns}from"./react-core-54SqWT2K.js";import{u as ds,a as is,N as Et,b as g,F as Pt,L as Qe,q as b}from"./index-C81WdIoV.js";import{b as w,a as I}from"./tanstack-CUfP7ExH.js";import{C as o,n as qa,o as Oa,a as de,P as ls,u as Tt,B as s,p as C,l as G,q as n,I as c,N as z,m as l,D as P,r as A,s as T,t as L,v as K,w as $,x as Lt}from"./ui-components-BzwTxqqF.js";import{S as cs}from"./social-login-Cu7cdrXU.js";import{u as os}from"./i18n-Bf4lNAtK.js";import"./react-dom-D4OF1DIl.js";import"./radix-ui-jmxRKFrg.js";import"./forms-Dh1yQC2J.js";const ms=x=>[{id:"pending",label:x("progress.orderReceived"),icon:He,description:x("progress.orderRegistered")},{id:"paid",label:x("progress.paymentConfirmed"),icon:ie,description:x("progress.paymentProcessed")},{id:"processing",label:x("progress.processing"),icon:je,description:x("progress.preparingDocs")},{id:"filed",label:x("progress.filed"),icon:W,description:x("progress.docsSent")},{id:"completed",label:x("progress.llcActive"),icon:Ge,description:x("progress.llcOperational")}],xs=x=>[{id:"pending",label:x("progress.requestReceived"),icon:He,description:x("progress.requestRegistered")},{id:"paid",label:x("progress.paymentConfirmed"),icon:ie,description:x("progress.paymentProcessed")},{id:"processing",label:x("progress.inProcess"),icon:je,description:x("progress.managingRenewal")},{id:"filed",label:x("progress.filed"),icon:W,description:x("progress.docsUpdated")},{id:"completed",label:x("progress.completed"),icon:At,description:x("progress.maintenanceComplete")}],us=["pending","paid","processing","filed","documents_ready","completed"];function ps({status:x,serviceName:r,state:F,requestCode:R,isMaintenance:v=!1}){const{t:q}=os(),k=v?xs(q):ms(q),O=us.indexOf(x),u=O>=0?Math.min((O+1)/k.length*100,100):0,S=p=>x==="cancelled"?"cancelled":O<0?"pending":p<O||p===O&&x==="completed"?"completed":p===O?"current":"pending",d={new_mexico:"New Mexico",wyoming:"Wyoming",delaware:"Delaware","New Mexico":"New Mexico",Wyoming:"Wyoming",Delaware:"Delaware"};return x==="cancelled"?e.jsxs(o,{className:"border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900","data-testid":"widget-cancelled",children:[e.jsx(qa,{className:"pb-2 p-3 md:p-4",children:e.jsxs(Oa,{className:"text-sm md:text-base flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(Bt,{className:"h-4 w-4"}),q("progress.cancelled")]})}),e.jsx(de,{className:"p-3 pt-0 md:p-4 md:pt-0",children:e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:q("progress.cancelledMessage")})})]}):e.jsxs(o,{className:"overflow-hidden","data-testid":`widget-progress-${v?"maintenance":"llc"}`,children:[e.jsxs(qa,{className:"pb-2 md:pb-3 p-3 md:p-4 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs(Oa,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[v?e.jsx(At,{className:"h-4 w-4 md:h-5 md:w-5 text-accent"}):e.jsx(Ge,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{className:"truncate max-w-[180px] md:max-w-none",children:r||q(v?"progress.maintenance":"progress.yourLLC")})]}),F&&e.jsx("span",{className:"text-[10px] md:text-xs bg-muted px-2 py-0.5 md:py-1 rounded-md font-medium shrink-0",children:d[F]||F})]}),R&&e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:[q("progress.reference"),": ",R]})]}),e.jsxs(de,{className:"p-3 md:p-4 space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 md:space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] md:text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:q("progress.progressLabel")}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(u),"%"]})]}),e.jsx(ls,{value:u,className:"h-1.5 md:h-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[9px] md:left-[11px] top-5 md:top-6 bottom-5 md:bottom-6 w-0.5 bg-border"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:k.map((p,m)=>{const f=S(m),Ua=p.icon;return e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 relative",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-5 h-5 md:w-6 md:h-6 rounded-full border-2 transition-colors shrink-0
                    ${f==="completed"?"bg-primary border-primary text-primary-foreground":f==="current"?"bg-primary/10 border-primary text-primary animate-pulse":"bg-background border-muted-foreground/30 text-muted-foreground"}
                  `,children:f==="completed"?e.jsx(ie,{className:"h-2.5 w-2.5 md:h-3.5 md:w-3.5"}):e.jsx(Ua,{className:"h-2.5 w-2.5 md:h-3 md:w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0 pb-1 md:pb-2",children:[e.jsx("p",{className:`text-xs md:text-sm font-medium leading-tight ${f==="completed"?"text-foreground":f==="current"?"text-primary font-bold":"text-muted-foreground"}`,children:p.label}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5 leading-tight hidden sm:block",children:p.description})]})]},p.id)})})]})]})]})}function _e(x){return{pending:{label:"Pendiente",className:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300"},paid:{label:"Pagado",className:"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300"},processing:{label:"En Proceso",className:"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"},documents_ready:{label:"Docs. Listos",className:"bg-cyan-100 dark:bg-cyan-900/50 text-cyan-800 dark:text-cyan-300"},completed:{label:"Completado",className:"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"},cancelled:{label:"Cancelado",className:"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-400 font-black"},filed:{label:"Presentado",className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300"},draft:{label:"Borrador",className:"bg-gray-100 dark:bg-zinc-700 text-gray-600 dark:text-gray-300"}}[x]||{label:x,className:"bg-gray-100 dark:bg-zinc-700 text-gray-600 dark:text-gray-300"}}function hs(){const{toast:x}=Tt(),{data:r,isLoading:F}=I({queryKey:["/api/newsletter/status"]}),R=w({mutationFn:async v=>{await g("POST",v?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",v?{email:void 0}:void 0)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/newsletter/status"]}),x({title:"Preferencias actualizadas",description:"Gracias por quedarte con nosotros"})}});return F?e.jsx("div",{className:"w-10 h-6 bg-gray-100 dark:bg-zinc-700 animate-pulse rounded-full"}):e.jsx(Lt,{checked:r?.isSubscribed,onCheckedChange:v=>R.mutate(v),disabled:R.isPending})}function Fs(){const[,x]=ds(),{user:r,isAuthenticated:F,isLoading:R}=is(),[v,q]=i.useState("services"),[k,O]=i.useState(!1),[u,S]=i.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:d}=Tt(),p=r?.accountStatus==="active"||r?.accountStatus==="vip",[m,f]=i.useState(null),[Ua,gs]=i.useState({open:!1,user:null}),[bs,fs]=i.useState(""),[js,Ns]=i.useState(""),[vs,ys]=i.useState(""),[le,Ne]=i.useState({open:!1,user:null}),[ve,Ma]=i.useState(""),[Ra,Va]=i.useState(""),[ye,we]=i.useState({open:!1,user:null}),[Be,Ka]=i.useState(""),[We,Qa]=i.useState(""),[It,ws]=i.useState("info"),[J,ke]=i.useState({open:!1,user:null}),[Je,_a]=i.useState(""),[Xe,Ha]=i.useState(""),[Ga,Ba]=i.useState("EUR"),[U,Ft]=i.useState("dashboard"),[$t,Ce]=i.useState(!1),[Q,X]=i.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[qt,Se]=i.useState(!1),[Y,De]=i.useState({userId:"",productId:"1",amount:"",state:"New Mexico"}),[Z,ze]=i.useState({open:!1,user:null}),[Ot,Ye]=i.useState(!1),[ee,Ee]=i.useState({open:!1,file:null}),[ce,Wa]=i.useState("passport"),[Pe,Ja]=i.useState(""),[Xa,Ze]=i.useState(!1),[Ya,ea]=i.useState("form"),[aa,ta]=i.useState(""),[B,sa]=i.useState(""),[Ae,ra]=i.useState(""),[na,da]=i.useState(""),[_,oe]=i.useState({open:!1,code:null}),[ae,Te]=i.useState({open:!1,user:null}),[Le,ia]=i.useState(""),[me,la]=i.useState(""),[Za,ca]=i.useState(""),[et,at]=i.useState(!1),[Ut,oa]=i.useState(!1),[xe,ma]=i.useState(""),[tt,st]=i.useState(!1),[rt,nt]=i.useState(!1),[N,M]=i.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});i.useEffect(()=>{r&&S({firstName:r.firstName||"",lastName:r.lastName||"",phone:r.phone||"",businessActivity:r.businessActivity||"",address:r.address||"",streetType:r.streetType||"",city:r.city||"",province:r.province||"",postalCode:r.postalCode||"",country:r.country||"",idNumber:r.idNumber||"",idType:r.idType||"",birthDate:r.birthDate||""})},[r]);const dt=w({mutationFn:async a=>{if(!p)throw new Error("No puedes modificar tus datos en el estado actual de tu cuenta.");await g("PATCH","/api/user/profile",a)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/auth/user"]}),O(!1),d({title:"Cambios guardados",description:"Tu información se ha actualizado correctamente"})},onError:a=>{d({title:"Error",description:a.message,variant:"destructive"})}});i.useEffect(()=>{!R&&!F&&x("/auth/login")},[F,R,x]);const{data:h,isLoading:ks}=I({queryKey:["/api/orders"],enabled:F,refetchInterval:3e4,staleTime:1e4}),{data:xa,isLoading:Cs}=I({queryKey:["/api/messages"],enabled:F,refetchInterval:6e4,staleTime:3e4}),[Ie,ua]=i.useState(null),[ue,pa]=i.useState(""),it=h?.[0]?.id,{data:Fe}=I({queryKey:["/api/orders",it,"events"],enabled:!!it,refetchInterval:3e4,staleTime:1e4}),pe=w({mutationFn:async a=>{await g("POST",`/api/messages/${a}/reply`,{content:ue})},onSuccess:()=>{pa(""),ua(null),b.invalidateQueries({queryKey:["/api/messages"]}),b.invalidateQueries({queryKey:["/api/admin/messages"]}),d({title:r?.isAdmin?"Respuesta enviada":"Mensaje enviado",description:r?.isAdmin?"El cliente recibirá un email con la información":"Te responderemos personalmente lo antes posible"})}}),{data:ha,isLoading:Mt}=I({queryKey:["/api/user/notifications"],enabled:F,refetchInterval:6e4,staleTime:3e4}),Rt=w({mutationFn:async a=>{await g("PATCH",`/api/user/notifications/${a}/read`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/notifications"]})}}),lt=w({mutationFn:async a=>{await g("DELETE",`/api/user/notifications/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/notifications"]})}}),{data:$e}=I({queryKey:["/api/admin/orders"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:ct}=I({queryKey:["/api/admin/users"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:he}=I({queryKey:["/api/admin/newsletter"],enabled:!!r?.isAdmin}),{data:qe}=I({queryKey:["/api/admin/documents"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:ot}=I({queryKey:["/api/admin/invoices"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:D}=I({queryKey:["/api/admin/system-stats"],enabled:!!r?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:ga}=I({queryKey:["/api/admin/messages"],enabled:!!r?.isAdmin}),{data:ba,refetch:mt}=I({queryKey:["/api/admin/discount-codes"],enabled:!!r?.isAdmin}),[fa,xt]=i.useState(""),[ja,ut]=i.useState(""),Na=w({mutationFn:async({subject:a,message:t})=>{await g("POST","/api/admin/newsletter/broadcast",{subject:a,message:t})},onSuccess:()=>{d({title:"Emails enviados",description:"Se ha enviado a todos los suscriptores del newsletter"}),xt(""),ut("")},onError:()=>{d({title:"Error",description:"No se pudieron enviar los emails",variant:"destructive"})}}),{data:Vt}=I({queryKey:["/api/user/documents"],enabled:F});w({mutationFn:async a=>(await g("POST","/api/admin/documents",a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/documents"]}),d({title:"Documento subido",description:"El cliente ya puede verlo en su panel."})}});const Kt=w({mutationFn:async({id:a,status:t})=>(await g("PATCH",`/api/admin/orders/${a}/status`,{status:t})).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),d({title:"Estado actualizado"})}}),ge=w({mutationFn:async({appId:a,field:t,value:j})=>{await g("PATCH",`/api/admin/llc/${a}/dates`,{field:t,value:j})},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/orders"]}),d({title:"Fecha actualizada"})},onError:()=>{d({title:"Error",description:"No se pudo actualizar la fecha",variant:"destructive"})}}),te=w({mutationFn:async({userId:a,title:t,message:j,type:y})=>{await g("POST","/api/admin/send-note",{userId:a,title:t,message:j,type:y})},onSuccess:()=>{d({title:"Nota enviada",description:"El cliente recibirá notificación y email"}),we({open:!1,user:null}),Ka(""),Qa("")}}),Oe=w({mutationFn:async a=>{const{id:t,...j}=a;await g("PATCH",`/api/admin/users/${t}`,j)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),d({title:"Usuario actualizado"}),f(null)},onError:a=>{d({title:"Error",description:a.message,variant:"destructive"})}}),va=w({mutationFn:async a=>{await g("DELETE",`/api/admin/users/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),d({title:"Usuario eliminado"}),ze({open:!1,user:null})},onError:()=>{d({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),[V,Ue]=i.useState({open:!1,order:null}),[se,Me]=i.useState({open:!1,order:null}),[re,pt]=i.useState(""),[ya,ht]=i.useState("EUR"),wa=w({mutationFn:async a=>{await g("DELETE",`/api/admin/orders/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/orders"]}),b.invalidateQueries({queryKey:["/api/notifications"]}),b.invalidateQueries({queryKey:["/api/user/documents"]}),d({title:"Pedido eliminado",description:"El pedido y sus datos asociados han sido eliminados."}),Ue({open:!1,order:null})},onError:()=>{d({title:"Error",description:"No se pudo eliminar el pedido",variant:"destructive"})}}),ka=w({mutationFn:async({userId:a,concept:t,amount:j,currency:y})=>{await g("POST","/api/admin/invoices/create",{userId:a,concept:t,amount:j,currency:y})},onSuccess:()=>{d({title:"Factura creada",description:"La factura se ha añadido al centro de documentos del cliente"}),ke({open:!1,user:null}),_a(""),Ha(""),Ba("EUR")},onError:()=>{d({title:"Error",description:"No se pudo crear la factura",variant:"destructive"})}}),Ca=w({mutationFn:async a=>(await g("POST","/api/admin/users/create",a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),d({title:"Usuario creado",description:"El usuario ha sido registrado correctamente"}),Ce(!1),X({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{d({title:"Error",description:"No se pudo crear el usuario",variant:"destructive"})}}),Sa=w({mutationFn:async a=>(await g("POST","/api/admin/orders/create",a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),d({title:"Pedido creado",description:"El pedido ha sido registrado correctamente"}),Se(!1),De({userId:"",productId:"1",amount:"",state:"New Mexico"})},onError:()=>{d({title:"Error",description:"No se pudo crear el pedido",variant:"destructive"})}}),gt=w({mutationFn:async a=>{await g("DELETE",`/api/user/documents/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/documents"]}),d({title:"Documento eliminado"})},onError:a=>{d({title:"Error",description:a?.message||"No se pudo eliminar el documento",variant:"destructive"})}}),Da=w({mutationFn:async()=>{await g("DELETE","/api/user/account")},onSuccess:()=>{d({title:"Cuenta eliminada",description:"Tu cuenta ha sido eliminada correctamente."}),window.location.href="/"},onError:()=>{d({title:"Error",description:"No se pudo eliminar la cuenta",variant:"destructive"})}}),za=w({mutationFn:async()=>{await g("POST","/api/user/request-password-otp")},onSuccess:()=>{d({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación."}),ea("otp")},onError:a=>{d({title:"Error",description:a.message||"No se pudo enviar el código",variant:"destructive"})}}),Ea=w({mutationFn:async a=>{await g("POST","/api/user/change-password",a)},onSuccess:()=>{d({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente."}),Ze(!1),ea("form"),ta(""),sa(""),ra(""),da("")},onError:a=>{d({title:"Error",description:a.message||"No se pudo cambiar la contraseña",variant:"destructive"})}});if(R||!F)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(r?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-muted font-sans flex flex-col",children:[e.jsx(Et,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-8 sm:py-12",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(o,{className:"rounded-2xl sm:rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-zinc-900",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(de,{className:"p-6 sm:p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-50 dark:bg-red-950/30 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-black text-red-500",children:"!"})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight mb-3 sm:mb-4",children:"Tu cuenta ha sido desactivada"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground font-medium leading-relaxed mb-6 sm:mb-8",children:"Revisa tu email, deberías haber recibido una nota de nuestro equipo con más información."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-950/30 p-3 rounded-xl",children:"No puedes realizar acciones ni contactar hasta que se resuelva tu situación."}),e.jsx(s,{variant:"outline",className:"w-full font-black text-foreground h-12 rounded-full border-2",onClick:()=>g("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-logout",children:"Cerrar Sesión"})]})]})]})})}),e.jsx(Pt,{})]});const Qt=[{id:"services",label:"Estado de mis trámites",icon:La,mobileLabel:"Trámites"},{id:"notifications",label:"Seguimiento",icon:Nt,mobileLabel:"Seguim."},{id:"messages",label:"Soporte",icon:Ia,mobileLabel:"Soporte"},{id:"documents",label:"Documentos",icon:W,mobileLabel:"Docs"},{id:"payments",label:"Pagos",icon:He,mobileLabel:"Pagos"},{id:"calendar",label:"Calendario",icon:be,mobileLabel:"Fechas"},{id:"profile",label:"Mi Perfil",icon:Wt,mobileLabel:"Perfil"},...r?.isAdmin?[{id:"admin",label:"Admin",icon:Jt,mobileLabel:"Admin"}]:[]];return e.jsxs("div",{className:"min-h-screen bg-muted bg-green-gradient font-sans",children:[e.jsx(Et,{}),e.jsxs("main",{className:"pt-16 sm:pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsx("header",{className:"mb-4 sm:mb-6 md:mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-black tracking-widest text-[10px] md:text-xs mb-0.5 md:mb-1 uppercase",children:"Área de Clientes"}),e.jsxs("h1",{className:"text-3xl md:text-4xl font-black text-primary tracking-tighter leading-tight",children:["Bienvenido, ",(r?.firstName||"Cliente").charAt(0).toUpperCase()+(r?.firstName||"Cliente").slice(1).toLowerCase()]}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-sm mt-0.5 md:mt-1 font-medium",children:"Aquí gestionas todo lo relacionado con tu LLC, de forma simple y clara."})]}),e.jsx(Qe,{href:"/servicios#pricing",children:e.jsxs(s,{className:"w-full md:w-auto bg-accent hover:bg-accent/90 text-black font-bold rounded-full px-8 h-12 transition-all flex items-center justify-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"})," Constituir una nueva LLC"]})})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-3 mb-6 gap-1.5 no-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:gap-2 md:pb-4 md:mb-8",children:Qt.map(a=>e.jsxs(s,{variant:v===a.id?"default":"outline",onClick:()=>q(a.id),size:"sm",className:`flex items-center gap-1 sm:gap-2 rounded-full font-bold text-[10px] sm:text-[11px] md:text-xs tracking-tight whitespace-nowrap shrink-0 ${v===a.id?"bg-accent text-primary shadow-lg shadow-accent/20":"bg-white dark:bg-zinc-900 text-muted-foreground border-0"}`,"data-testid":`button-tab-${a.id}`,children:[e.jsx(a.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:a.label}),e.jsx("span",{className:"md:hidden",children:a.mobileLabel})]},a.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 order-1",children:[v==="services"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Estado de mis trámites"}),e.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground font-medium",children:"Gestiona tus trámites activos"})]}),!h||h.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(La,{className:"w-8 h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-primary mb-2",children:"Aún no tienes servicios activos"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Empieza hoy y constituye tu LLC en EE. UU. en pocos pasos."})]}),e.jsx(Qe,{href:"/servicios#pricing",children:e.jsx(s,{className:"bg-accent text-primary font-black rounded-full px-8 py-3","data-testid":"button-view-packs",children:"Ver planes disponibles"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:h.filter(a=>a.status!=="cancelled"&&a.status!=="completed").slice(0,4).map(a=>e.jsx(ps,{status:a.status,serviceName:a.maintenanceApplication?`Mant. ${a.maintenanceApplication.state||a.product?.name?.replace(" LLC","")||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"Tu LLC",state:a.application?.state||a.maintenanceApplication?.state,requestCode:a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber,isMaintenance:!!a.maintenanceApplication},`progress-${a.id}`))}),h.length>0&&e.jsxs("div",{className:"mt-4 md:mt-6",children:[e.jsx("h3",{className:"text-xs md:text-sm font-bold text-muted-foreground mb-2 md:mb-3",children:"Todos los Pedidos"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:h.map(a=>e.jsx(o,{className:"rounded-lg md:rounded-xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-zinc-900 overflow-hidden","data-testid":`card-order-${a.id}`,children:e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("p",{className:"text-[9px] md:text-[10px] font-bold text-accent uppercase tracking-wider",children:a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber||`#${a.id}`}),e.jsx(C,{className:`${_e(a.status).className} font-bold uppercase text-[8px] md:text-[9px] px-1.5 py-0`,"data-testid":`badge-order-status-${a.id}`,children:_e(a.status).label})]}),e.jsx("p",{className:"text-sm md:text-base font-bold text-primary truncate",children:a.maintenanceApplication?`Mantenimiento ${a.maintenanceApplication.state||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"LLC pendiente"}),e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:[a.application?.state||a.maintenanceApplication?.state||"",a.createdAt&&` · ${new Date(a.createdAt).toLocaleDateString("es-ES")}`]})]}),a.status==="pending"&&a.application&&e.jsx(s,{variant:"outline",size:"sm",className:"text-[9px] md:text-[10px] h-7 md:h-8 px-2 md:px-3 rounded-full font-bold shrink-0",onClick:()=>window.location.href=`/llc/formation?edit=${a.application.id}`,"data-testid":`button-modify-order-${a.id}`,children:"Modificar"})]})},a.id))})]})]})]},"services"),v==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Notificaciones"}),Mt?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(a=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},a))}):ha?.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(de,{className:"p-8 text-center",children:[e.jsx(Nt,{className:"w-12 h-12 mx-auto text-gray-300 dark:text-zinc-600 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes notificaciones"})]})}):e.jsx("div",{className:"space-y-3",children:ha?.map(a=>e.jsx(o,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${a.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(de,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[a.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:["Pedido: ",a.orderCode]}),a.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:"ACCIÓN REQUERIDA"}),a.type==="update"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:"ACTUALIZACIÓN"}),a.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-zinc-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full font-black",children:"INFORMACIÓN"}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.message}),a.type==="action_required"&&p&&e.jsxs(s,{className:"mt-3 bg-accent text-primary font-black rounded-full text-xs px-4 gap-2",onClick:()=>{Rt.mutate(a.id),q("documents")},"data-testid":`button-upload-document-${a.id}`,children:[e.jsx(yt,{className:"w-3 h-3"}),"Subir Documento"]})]}),e.jsx(s,{variant:"ghost",size:"icon",className:"flex-shrink-0 h-8 w-8 text-muted-foreground hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full",onClick:()=>lt.mutate(a.id),disabled:lt.isPending,"data-testid":`button-delete-notification-${a.id}`,children:e.jsx(Xt,{className:"w-4 h-4"})})]})})},a.id))})]},"notifications"),v==="messages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Mis Consultas"}),e.jsx(Qe,{href:"/contacto",children:e.jsx(s,{className:"bg-accent text-primary font-black rounded-full text-xs",children:"Nueva Consulta"})})]}),e.jsx("div",{className:"space-y-4",children:!xa||xa.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(Fa,{className:"w-12 h-12 text-gray-300 dark:text-zinc-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Aún no has contactado con soporte"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Escríbenos cuando quieras. Te responderá una persona, no un bot."}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",className:"mt-4 inline-block",children:e.jsx(s,{className:"bg-accent text-primary font-black rounded-full px-6 py-2",children:"Hablar con soporte"})})]}):xa.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-zinc-900 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ua(Ie?.id===a.id?null:a),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-black text-primary",children:a.subject||"Sin asunto"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.messageId||a.id})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:a.content}),Ie?.id===a.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-4",children:[e.jsx(G,{value:ue,onChange:t=>pa(t.target.value),placeholder:"Escribe tu respuesta...",className:"rounded-xl min-h-[80px] text-sm"}),e.jsx(s,{onClick:t=>{t.stopPropagation(),pe.mutate(a.id)},disabled:!ue.trim()||pe.isPending,className:"bg-accent text-primary font-black rounded-full px-6",children:"Enviar Respuesta"})]})]},a.id))})]},"messages"),v==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight mb-6",children:"Centro de Documentación"}),ha?.some(a=>a.type==="action_required"&&!a.isRead)&&e.jsx(o,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 text-sm",children:"Documentos Solicitados"}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Tienes solicitudes de documentos pendientes. Por favor, sube los documentos requeridos."}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async a=>{const t=a.target.files?.[0];if(!t)return;const j=new FormData;j.append("file",t);try{(await fetch("/api/user/documents/upload",{method:"POST",body:j,credentials:"include"})).ok?(d({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),b.invalidateQueries({queryKey:["/api/user/documents"]})):d({title:"Error",description:"No se pudo subir el documento",variant:"destructive"})}catch{d({title:"Error",description:"Error de conexión",variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(s,{variant:"outline",className:"rounded-full text-xs border-orange-300 text-orange-700",asChild:!0,children:e.jsxs("span",{children:[e.jsx(fe,{className:"w-3 h-3 mr-1"})," Subir Documento"]})})]})})]})]})}),e.jsx(o,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:a=>{const t=a.target.files?.[0];t&&(Ee({open:!0,file:t}),Wa("passport"),Ja(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(yt,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-black text-primary text-base md:text-lg",children:"Subir Documento"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"PDF, JPG o PNG (máx. 10MB)"})]}),e.jsxs(s,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",children:[e.jsx(fe,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"SUBIR"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Vt?.map(a=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-zinc-900",children:[e.jsx(fe,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:a.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground mb-3",children:new Date(a.createdAt||a.uploadedAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`button-download-doc-${a.id}`,children:[e.jsx(wt,{className:"w-3 h-3 mr-1"})," Descargar"]}),p&&e.jsx(s,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>gt.mutate(a.id),disabled:gt.isPending,"data-testid":`button-delete-doc-${a.id}`,children:e.jsx(kt,{className:"w-3 h-3"})})]})]},a.id))})]},"documents"),v==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Historial de Pagos"}),e.jsx("div",{className:"space-y-4",children:!h||h.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(He,{className:"w-12 h-12 text-gray-300 dark:text-zinc-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Sin pagos registrados"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Cuando contrates un servicio, aquí tendrás todas tus facturas y recibos."})]}):h.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-zinc-900",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/invoice`,"_blank"),children:"Factura"}),e.jsx(s,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/receipt`,"_blank"),children:"Recibo"})]})]},a.id))})]},"payments"),v==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Calendario Fiscal"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium",children:"Fechas importantes y vencimientos de tu LLC"})]})}),h&&h.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:h.map(a=>{const t=a.application;if(!t)return null;const j=a.status==="cancelled",y=["pending","paid","processing"].includes(a.status),bt=["Wyoming","Delaware","WY","DE"].includes(t.state),Re=[{label:"Creación",fullLabel:"Creación de LLC",date:t.llcCreatedDate,icon:Ge,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:"Agente",fullLabel:"Renovación Agente Registrado",date:t.agentRenewalDate,icon:Yt,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:"Formulario IRS 1120",date:t.irs1120DueDate,icon:W,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:"Formulario IRS 5472",date:t.irs5472DueDate,icon:W,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...bt?[{label:"Anual",fullLabel:`Reporte Anual ${t.state}`,date:t.annualReportDueDate,icon:Zt,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],Pa=Re.some(E=>E.date),ft=Re.filter(E=>E.date).sort((E,Aa)=>new Date(E.date).getTime()-new Date(Aa.date).getTime()),Ve=ft.find(E=>new Date(E.date)>new Date);return e.jsxs(o,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-zinc-900 overflow-hidden ${j?"opacity-50":""}`,children:[e.jsx(qa,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(Oa,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(Ge,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:t.companyName||"LLC en proceso"}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:t.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[j&&e.jsx(C,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:"Cancelada"}),y&&e.jsx(C,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"En revisión"}),!j&&!y&&Ve&&e.jsxs(C,{className:`text-[9px] md:text-[10px] ${Ve.bgColor} ${Ve.textColor}`,children:["Próximo: ",Ve.label]})]})]})}),e.jsx(de,{className:"p-3 md:p-4",children:j?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ct,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Esta LLC fue cancelada"})]}):y?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(je,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Tu LLC está en proceso"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:"Las fechas aparecerán cuando esté activa"})]}):Pa?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:ft.map((E,Aa)=>{const Ke=new Date(E.date),jt=new Date,ne=Math.ceil((Ke.getTime()-jt.getTime())/(1e3*60*60*24)),Ta=Ke<jt,_t=!Ta&&ne<=30,Ht=!Ta&&ne<=60&&ne>30,Gt=E.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${E.borderColor} ${E.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${E.textColor}`,children:[e.jsx(Gt,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:E.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:Ke.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:Ke.getFullYear()}),Ta?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(St,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:"Completado"})]}):_t?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Dt,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[ne," días"]})]}):Ht?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[ne," días"]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[ne," días"]})})]},Aa)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(be,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Fechas pendientes de configuración"})]})})]},a.id)})}):e.jsxs(o,{className:"rounded-xl md:rounded-2xl border shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(be,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-3 md:mb-4"}),e.jsx("h3",{className:"text-base md:text-lg font-black text-primary mb-2",children:"No hay fechas fiscales programadas"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4",children:"Al constituir tu LLC, verás aquí todos los vencimientos importantes."}),e.jsx(Qe,{href:"/servicios#pricing",children:e.jsxs(s,{className:"bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",children:[e.jsx(vt,{className:"w-4 h-4 mr-2"})," Constituir mi LLC"]})})]})]},"calendar"),v==="profile"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(o,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-black",children:"Perfil Personal"}),p&&e.jsx(s,{variant:"ghost",size:"sm",onClick:()=>O(!k),"data-testid":"button-toggle-edit",children:k?"Cancelar":"Editar"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Esta información nos permite acompañarte mejor y cumplir con los requisitos legales cuando sea necesario."}),!p&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${r?.accountStatus==="pending"?"bg-orange-50 border border-orange-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${r?.accountStatus==="pending"?"text-orange-700":"text-red-700"}`,children:r?.accountStatus==="pending"?"Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada.":"Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"ID Cliente"}),e.jsx("p",{className:"text-lg font-black font-mono",children:r?.clientId||r?.id?.slice(0,8).toUpperCase()})]}),e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"Estado"}),e.jsx("p",{className:`text-lg font-black ${r?.accountStatus==="active"?"text-green-600":r?.accountStatus==="pending"?"text-orange-500":r?.accountStatus==="deactivated"?"text-red-600":r?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:r?.accountStatus==="active"?"Verificado":r?.accountStatus==="pending"?"En revisión":r?.accountStatus==="deactivated"?"Desactivada":r?.accountStatus==="vip"?"VIP":"Verificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Nombre"}),k&&p?e.jsx(c,{value:u.firstName,onChange:a=>S({...u,firstName:a.target.value}),placeholder:"Tu nombre real",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-firstname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Apellidos"}),k&&p?e.jsx(c,{value:u.lastName,onChange:a=>S({...u,lastName:a.target.value}),placeholder:"Tal y como aparecen en tu documento",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-lastname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.lastName||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Email"}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{children:r?.email}),r?.emailVerified?e.jsx(ie,{className:"w-4 h-4 text-green-500"}):e.jsx(s,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black",onClick:()=>oa(!0),"data-testid":"button-verify-email",children:"Verificar email"})]}),!r?.emailVerified&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Tu cuenta está en revisión hasta que verifiques tu email."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Teléfono"}),k&&p?e.jsx(c,{value:u.phone,onChange:a=>S({...u,phone:a.target.value}),placeholder:"Para contactarte si es necesario",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-phone"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.phone||"No proporcionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de documento"}),k&&p?e.jsxs(z,{value:u.idType,onValueChange:a=>S({...u,idType:a}),placeholder:"DNI · NIE · Pasaporte",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-idtype",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.idType==="dni"?"DNI":r?.idType==="nie"?"NIE":r?.idType==="passport"?"Pasaporte":"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Número de documento"}),k&&p?e.jsx(c,{value:u.idNumber,onChange:a=>S({...u,idNumber:a.target.value}),placeholder:"Documento de identificación",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-idnumber"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.idNumber||"No proporcionado"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Fecha de nacimiento"}),k&&p?e.jsx(c,{type:"date",value:u.birthDate,onChange:a=>S({...u,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-birthdate"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.birthDate||"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Actividad profesional"}),k&&p?e.jsxs(z,{value:u.businessActivity,onValueChange:a=>S({...u,businessActivity:a}),placeholder:"A qué te dedicas",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-activity",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.businessActivity||"No proporcionado"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-bold text-sm mb-3",children:"Dirección de residencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de vía"}),k&&p?e.jsxs(z,{value:u.streetType,onValueChange:a=>S({...u,streetType:a}),placeholder:"Calle · Avenida · Paseo · Plaza",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-street-type",children:[e.jsx(l,{value:"calle",children:"Calle"}),e.jsx(l,{value:"avenida",children:"Avenida"}),e.jsx(l,{value:"paseo",children:"Paseo"}),e.jsx(l,{value:"plaza",children:"Plaza"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Dirección"}),k&&p?e.jsx(c,{value:u.address,onChange:a=>S({...u,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Ciudad"}),k&&p?e.jsx(c,{value:u.city,onChange:a=>S({...u,city:a.target.value}),placeholder:"Ciudad de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"Provincia"}),k&&p?e.jsx(c,{value:u.province,onChange:a=>S({...u,province:a.target.value}),placeholder:"Provincia o región",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"C.P."}),k&&p?e.jsx(c,{value:u.postalCode,onChange:a=>S({...u,postalCode:a.target.value}),placeholder:"Código postal",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs font-bold text-muted-foreground",children:"País"}),k&&p?e.jsx(c,{value:u.country,onChange:a=>S({...u,country:a.target.value}),placeholder:"País de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.country||"-"})]})]})]}),k&&p&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(s,{onClick:()=>{dt.mutate(u),O(!1)},className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",disabled:dt.isPending,"data-testid":"button-save-profile",children:"Guardar cambios"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Nuestro equipo revisará cualquier cambio antes de avanzar para asegurarnos de que todo esté correcto."})]})]}),e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Suscripción Newsletter"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recibe noticias y consejos para tu LLC."})]}),e.jsx(hs,{})]})}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contraseña de acceso."})]}),!Xa&&e.jsx(s,{variant:"outline",className:"rounded-full",onClick:()=>Ze(!0),"data-testid":"button-show-password-form",children:"Cambiar"})]}),Xa&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-zinc-800 rounded-xl",children:[Ya==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Contraseña actual"}),e.jsx(c,{type:"password",value:aa,onChange:a=>ta(a.target.value),"data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Nueva contraseña"}),e.jsx(c,{type:"password",value:B,onChange:a=>sa(a.target.value),"data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Confirmar nueva contraseña"}),e.jsx(c,{type:"password",value:Ae,onChange:a=>ra(a.target.value),"data-testid":"input-confirm-password"})]}),B&&Ae&&B!==Ae&&e.jsx("p",{className:"text-xs text-red-500",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(s,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{Ze(!1),ta(""),sa(""),ra("")},children:"Cancelar"}),e.jsx(s,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>za.mutate(),disabled:!aa||!B||B!==Ae||B.length<8||za.isPending,"data-testid":"button-request-otp",children:za.isPending?"Enviando...":"Enviar código"})]})]}),Ya==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(Ia,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ingresa el código de 6 dígitos enviado a tu email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Código de verificación"}),e.jsx(c,{type:"text",value:na,onChange:a=>da(a.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(s,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{ea("form"),da("")},children:"Volver"}),e.jsx(s,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Ea.mutate({currentPassword:aa,newPassword:B,otp:na}),disabled:na.length!==6||Ea.isPending,"data-testid":"button-save-password",children:Ea.isPending?"Guardando...":"Confirmar"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cuentas Conectadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vincula tus cuentas sociales para iniciar sesion mas rapido."})]})}),e.jsx(cs,{mode:"connect",googleConnected:!!r?.googleId,onSuccess:()=>b.refetchQueries({queryKey:["/api/auth/user"]})})]}),p&&e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 text-sm",children:"Eliminar Cuenta"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Esta acción es irreversible. Se eliminarán todos tus datos."})]}),e.jsxs(s,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 rounded-full shrink-0",onClick:()=>Ye(!0),"data-testid":"button-delete-own-account",children:[e.jsx(kt,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})})]})},"profile"),v==="admin"&&r?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5 md:gap-2 mb-4 md:mb-6",children:["dashboard","orders","users","facturas","calendar","docs","newsletter","inbox","descuentos"].map(a=>e.jsxs(s,{variant:U===a?"default":"outline",onClick:()=>Ft(a),className:"rounded-full text-[10px] md:text-xs font-black capitalize px-2 md:px-3","data-testid":`button-admin-tab-${a}`,children:[e.jsx("span",{className:"hidden sm:inline",children:a==="dashboard"?"Métricas":a==="calendar"?"Fechas":a==="orders"?"Pedidos":a==="users"?"Clientes":a==="docs"?"Documentos":a==="descuentos"?"Descuentos":a==="facturas"?"Facturas":a}),e.jsx("span",{className:"sm:hidden flex items-center justify-center",children:a==="dashboard"?e.jsx(es,{className:"w-5 h-5"}):a==="calendar"?e.jsx(be,{className:"w-5 h-5"}):a==="orders"?e.jsx(La,{className:"w-5 h-5"}):a==="users"?e.jsx(as,{className:"w-5 h-5"}):a==="docs"?e.jsx(W,{className:"w-5 h-5"}):a==="newsletter"?e.jsx(Ia,{className:"w-5 h-5"}):a==="descuentos"?e.jsx(ts,{className:"w-5 h-5"}):a==="facturas"?e.jsx(ss,{className:"w-5 h-5"}):e.jsx(Fa,{className:"w-5 h-5"})})]},a))}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>Ce(!0),"data-testid":"button-create-user",children:[e.jsx($a,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Cliente"}),e.jsx("span",{className:"sm:hidden",children:"Cliente"})]}),e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>Se(!0),"data-testid":"button-create-order",children:[e.jsx($a,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),U==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((D?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((D?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:D?.orderCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[D?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:D?.pendingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:D?.processingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:D?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:D?.userCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:D?.activeAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:D?.vipAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:D?.pendingAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:D?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:D?.subscriberCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:D?.totalMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:D?.pendingMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:D?.pendingDocs||0})]})]})]})]}),U==="orders"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:$e?.map(a=>{const t=a.application||a.maintenanceApplication,j=!!a.maintenanceApplication&&!a.application,y=t?.requestCode||a.invoiceNumber,Re=t?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:y}),e.jsx(C,{className:`text-[9px] ${j?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:j?"MANTENIMIENTO":"LLC"}),!Re&&e.jsx(C,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:t?.ownerFullName||`${a.user?.firstName||""} ${a.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?.ownerEmail||a.user?.email}),t?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",t?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",t?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",a.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(a.amount/100).toFixed(2),"€",a.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",a.discountCode," -",(a.discountAmount/100).toFixed(2),"€)"]})]}),t?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",t.businessCategory]}),j&&t?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",t.ein]})]}),e.jsxs(z,{value:a.status,onValueChange:Pa=>Kt.mutate({id:a.id,status:Pa}),className:"w-28 h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border px-3",children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"paid",children:"Pagado"}),e.jsx(l,{value:"filed",children:"Presentado"}),e.jsx(l,{value:"cancelled",children:"Cancelado"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>window.open(`/api/admin/invoice/${a.id}`,"_blank"),"data-testid":`btn-view-invoice-${a.id}`,children:"Ver Factura"}),e.jsx(s,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>{pt(((a.amount||0)/100).toFixed(2)),ht("EUR"),Me({open:!0,order:a})},"data-testid":`btn-generate-invoice-${a.id}`,children:"Generar Factura"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Ue({open:!0,order:a}),"data-testid":`btn-delete-order-${a.id}`,children:"Eliminar"})]})]},a.id)})})}),U==="users"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:ct?.map(a=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsx(C,{variant:a.accountStatus==="active"||a.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${a.accountStatus==="deactivated"?"bg-red-100 text-red-700":a.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":a.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:a.accountStatus==="active"?"VERIFICADO":a.accountStatus==="pending"?"EN REVISIÓN":a.accountStatus==="deactivated"?"DESACTIVADA":a.accountStatus==="vip"?"VIP":"VERIFICADO"}),a.isAdmin&&e.jsx(C,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.phone&&e.jsx("span",{className:"mr-2",children:a.phone}),a.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",a.businessActivity]}),a.city&&e.jsxs("span",{children:["• ",a.city]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(z,{value:a.accountStatus||"active",onValueChange:t=>a.id&&Oe.mutate({id:a.id,accountStatus:t}),className:"w-full h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border shadow-sm px-3",children:[e.jsx(l,{value:"active",children:"Verificado"}),e.jsx(l,{value:"pending",children:"En revisión"}),e.jsx(l,{value:"deactivated",children:"Desactivada"}),e.jsx(l,{value:"vip",children:"VIP"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>f(a),"data-testid":`button-edit-user-${a.id}`,children:"Editar"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>we({open:!0,user:a}),"data-testid":`button-note-user-${a.id}`,children:"Mensaje"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>Ne({open:!0,user:a}),"data-testid":`button-doc-user-${a.id}`,children:"Docs"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>ke({open:!0,user:a}),"data-testid":`button-invoice-user-${a.id}`,children:"Factura"}),e.jsx(s,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>Te({open:!0,user:a}),"data-testid":`button-payment-link-${a.id}`,children:"Pago"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>ze({open:!0,user:a}),"data-testid":`button-delete-user-${a.id}`,children:"Eliminar"})]})]},a.id))})}),U==="calendar"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsxs("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 md:w-8 md:h-8 rounded-xl bg-accent/20 flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 md:w-4 md:h-4 text-accent"})}),e.jsx("span",{children:"Gestión de Fechas Fiscales"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[$e?.map(a=>{const t=a.application;if(!t)return null;const j=t?.requestCode||a.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:t.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",t.state]})]}),e.jsx(C,{variant:"outline",className:"text-xs w-fit",children:j})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.llcCreatedDate?new Date(t.llcCreatedDate).toISOString().split("T")[0]:"",onChange:y=>ge.mutate({appId:t.id,field:"llcCreatedDate",value:y.target.value}),"data-testid":`input-llc-created-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.agentRenewalDate?new Date(t.agentRenewalDate).toISOString().split("T")[0]:"",onChange:y=>ge.mutate({appId:t.id,field:"agentRenewalDate",value:y.target.value}),"data-testid":`input-agent-renewal-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.irs1120DueDate?new Date(t.irs1120DueDate).toISOString().split("T")[0]:"",onChange:y=>ge.mutate({appId:t.id,field:"irs1120DueDate",value:y.target.value}),"data-testid":`input-irs1120-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.irs5472DueDate?new Date(t.irs5472DueDate).toISOString().split("T")[0]:"",onChange:y=>ge.mutate({appId:t.id,field:"irs5472DueDate",value:y.target.value}),"data-testid":`input-irs5472-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.annualReportDueDate?new Date(t.annualReportDueDate).toISOString().split("T")[0]:"",onChange:y=>ge.mutate({appId:t.id,field:"annualReportDueDate",value:y.target.value}),"data-testid":`input-annual-report-${t.id}`})]})]})]},a.id)}),(!$e||$e.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),U==="docs"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-black text-lg",children:"Documentos de Clientes"}),e.jsxs(C,{className:"bg-accent/20 text-accent",children:[qe?.length||0," docs"]})]}),e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[qe?.map(a=>e.jsxs("div",{className:"py-3 flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-bold text-sm truncate",children:a.fileName}),e.jsx(C,{variant:"outline",className:`text-[9px] ${a.reviewStatus==="approved"?"bg-green-100 text-green-700":a.reviewStatus==="rejected"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:a.reviewStatus==="approved"?"Aprobado":a.reviewStatus==="rejected"?"Rechazado":"Pendiente"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",a.user?.email]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.application?.companyName&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"LLC:"})," ",a.application.companyName," • "]}),e.jsx("strong",{children:"Tipo:"})," ",a.documentType||"Documento"," •",e.jsx("strong",{children:" Fecha:"})," ",a.uploadedAt?new Date(a.uploadedAt).toLocaleDateString("es-ES"):"-"]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[a.fileUrl&&e.jsx(s,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`btn-view-doc-${a.id}`,children:e.jsx(zt,{className:"w-4 h-4"})}),e.jsxs(z,{value:a.reviewStatus||"pending",onValueChange:async t=>{try{await g("PATCH",`/api/admin/documents/${a.id}/review`,{reviewStatus:t}),b.invalidateQueries({queryKey:["/api/admin/documents"]}),d({title:"Estado actualizado"})}catch{d({title:"Error",variant:"destructive"})}},className:"h-8 w-24 text-[10px] rounded-full px-2",children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"approved",children:"Aprobar"}),e.jsx(l,{value:"rejected",children:"Rechazar"})]})]})]},a.id)),(!qe||qe.length===0)&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/30"}),"No hay documentos subidos por clientes"]})]})]}),U==="newsletter"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-border",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Enviar a todos los suscriptores (",he?.length||0,")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{value:fa,onChange:a=>xt(a.target.value),placeholder:"Asunto del email",className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-subject"}),e.jsx(G,{value:ja,onChange:a=>ut(a.target.value),placeholder:"Contenido del mensaje",rows:4,className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-message"}),e.jsx(s,{onClick:()=>Na.mutate({subject:fa,message:ja}),disabled:!fa||!ja||Na.isPending,className:"w-full rounded-full","data-testid":"button-send-broadcast",children:Na.isPending?"Enviando...":`Enviar a ${he?.length||0} suscriptores`})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-sm mb-3",children:"Lista de Suscriptores"}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[he?.map(a=>e.jsxs("div",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:a.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.subscribedAt?new Date(a.subscribedAt).toLocaleDateString("es-ES"):""})]},a.id)),(!he||he.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})]})}),U==="inbox"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[ga?.map(a=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>ua(Ie?.id===a.id?null:a),"data-testid":`inbox-message-${a.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.email," ",a.phone&&`• ${a.phone}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",className:"text-[10px]",children:a.messageId||a.id}),e.jsx(C,{variant:"secondary",className:"text-[10px]",children:a.status||"pendiente"})]})]}),e.jsx("p",{className:"text-xs font-medium",children:a.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.message}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:a.replies.map(t=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${t.isAdmin?"text-accent":"text-muted-foreground"}`,children:[t.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:t.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:t.createdAt&&new Date(t.createdAt).toLocaleString("es-ES")})]},t.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.createdAt?new Date(a.createdAt).toLocaleString("es-ES"):""}),Ie?.id===a.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:t=>t.stopPropagation(),children:[e.jsx(G,{value:ue,onChange:t=>pa(t.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(s,{onClick:()=>pe.mutate(a.id),disabled:!ue.trim()||pe.isPending,className:"bg-accent text-primary font-black rounded-full px-6","data-testid":"button-send-admin-reply",children:[pe.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},a.id)),(!ga||ga.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),U==="facturas"&&e.jsxs("div",{className:"space-y-4","data-testid":"admin-facturas-section",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{className:"text-sm font-bold",children:"Facturas para Contabilidad"})}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[ot?.length===0&&e.jsx("p",{className:"p-4 text-sm text-muted-foreground text-center",children:"No hay facturas generadas"}),ot?.map(a=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`invoice-row-${a.id}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:a.fileName||`Factura ${a.order?.invoiceNumber}`}),e.jsx(C,{variant:a.order?.status==="paid"||a.order?.status==="completed"?"default":"secondary",className:"text-[10px]",children:a.order?.status==="paid"?"Pagada":a.order?.status==="completed"?"Completada":a.order?.status==="pending"?"Pendiente":a.order?.status||"N/A"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," (",a.user?.email,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Importe: ",a.order?.amount?(a.order.amount/100).toFixed(2)+(a.order.currency==="USD"?" $":" €"):"N/A"," | Fecha: ",a.createdAt?new Date(a.createdAt).toLocaleDateString("es-ES"):"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>window.open(a.fileUrl||`/api/orders/${a.orderId}/invoice`,"_blank"),"data-testid":`button-view-invoice-${a.id}`,children:[e.jsx(zt,{className:"w-3 h-3 mr-1"})," Ver"]}),e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{const t=document.createElement("a");t.href=a.fileUrl||`/api/orders/${a.orderId}/invoice`,t.download=`Factura-${a.order?.invoiceNumber||a.id}.pdf`,t.click()},"data-testid":`button-download-invoice-${a.id}`,children:[e.jsx(wt,{className:"w-3 h-3 mr-1"})," Descargar"]})]})]},a.id))]})})]}),U==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{M({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),oe({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx($a,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[ba?.map(a=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${a.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:a.code}),e.jsx(C,{variant:a.isActive?"default":"secondary",className:"text-[10px]",children:a.isActive?"Activo":"Inactivo"}),e.jsx(C,{variant:"outline",className:"text-[10px]",children:a.discountType==="percentage"?`${a.discountValue}%`:`${(a.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",a.usedCount,a.maxUses?`/${a.maxUses}`:""," veces",a.minOrderAmount&&` | Min: ${(a.minOrderAmount/100).toFixed(2)}€`]}),(a.validFrom||a.validUntil)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.validFrom&&`Desde: ${new Date(a.validFrom).toLocaleDateString("es-ES")}`,a.validFrom&&a.validUntil&&" - ",a.validUntil&&`Hasta: ${new Date(a.validUntil).toLocaleDateString("es-ES")}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{M({code:a.code,discountType:a.discountType,discountValue:a.discountValue.toString(),minOrderAmount:a.minOrderAmount?(a.minOrderAmount/100).toString():"",maxUses:a.maxUses?.toString()||"",validFrom:a.validFrom?a.validFrom.split("T")[0]:"",validUntil:a.validUntil?a.validUntil.split("T")[0]:"",isActive:a.isActive}),oe({open:!0,code:a})},"data-testid":`button-edit-discount-${a.code}`,children:e.jsx(ns,{className:"w-3 h-3"})}),e.jsx(s,{variant:"outline",size:"sm",className:`rounded-full text-xs ${a.isActive?"text-red-600":"text-green-600"}`,onClick:async()=>{try{await g("PATCH",`/api/admin/discount-codes/${a.id}`,{isActive:!a.isActive}),mt(),d({title:a.isActive?"Código desactivado":"Código activado"})}catch{d({title:"Error",variant:"destructive"})}},"data-testid":`button-toggle-discount-${a.code}`,children:a.isActive?e.jsx(Ct,{className:"w-3 h-3"}):e.jsx(St,{className:"w-3 h-3"})})]})]},a.id)),(!ba||ba.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[e.jsxs("section",{className:"bg-white dark:bg-zinc-900 p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-accent"})," Seguimiento"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"El progreso de tu LLC, paso a paso"})]}),e.jsx("div",{className:"space-y-5",children:h&&h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-zinc-800 rounded-xl p-3 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] font-bold text-accent uppercase tracking-wider mb-0.5",children:["Pedido: ",h[0]?.application?.requestCode||h[0]?.maintenanceApplication?.requestCode||h[0]?.invoiceNumber||h[0]?.id]}),e.jsx("p",{className:"text-sm font-black text-primary truncate",children:h[0]?.maintenanceApplication?`Mantenimiento ${h[0]?.maintenanceApplication?.state||""}`:h[0]?.application?.companyName?`${h[0]?.application?.companyName} LLC`:h[0]?.product?.name||"LLC"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:h[0]?.application?.state||h[0]?.maintenanceApplication?.state||""})]}),e.jsx(C,{className:`${_e(h[0]?.status).className} font-bold text-[9px] shrink-0`,children:_e(h[0]?.status).label})]}),e.jsxs("p",{className:"text-[9px] text-muted-foreground mt-2",children:["Creado: ",h[0]?.createdAt?new Date(h[0].createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-"]})]}),Fe&&Fe.length>0?Fe.map((a,t)=>e.jsxs("div",{className:"flex gap-4 relative",children:[t<Fe.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx(ie,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-black text-primary truncate",children:a.eventType}),a.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(a.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.description})]})]},a.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx(ie,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:"Pedido Recibido"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Verificación de Datos"})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Dt,{className:"w-8 h-8 text-gray-200 dark:text-zinc-600 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No hay trámites en curso"}),e.jsx("p",{className:"text-[10px] text-muted-foreground/70 mt-1",children:"Cuando contrates un servicio, aquí podrás seguir todo el proceso."})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20",children:[e.jsx("h3",{className:"text-base font-black text-primary mb-3",children:"¿Hablamos?"}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:"Nuestro equipo está disponible para ayudarte en cualquier momento."}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",children:e.jsx(s,{className:"w-full bg-accent text-primary font-black rounded-full py-5",children:"Hablar con soporte"})})]})]})]})]}),r?.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(P,{open:ye.open,onOpenChange:a=>we({open:a,user:a?ye.user:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Enviar Mensaje al Cliente"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Título"}),e.jsx(c,{value:Be,onChange:a=>Ka(a.target.value),placeholder:"Título del mensaje",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(G,{value:We,onChange:a=>Qa(a.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-note-message"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>we({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>ye.user?.id&&te.mutate({userId:ye.user.id,title:Be,message:We,type:It}),disabled:!Be||!We||te.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-note",children:te.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"})]})]})}),e.jsx(P,{open:!!m,onOpenChange:a=>!a&&f(null),children:e.jsxs(A,{className:"sm:max-w-lg bg-white dark:bg-zinc-900 rounded-2xl max-h-[85vh]",children:[e.jsxs(T,{className:"flex-shrink-0",children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Editar Usuario"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),m&&e.jsxs("div",{className:"space-y-3 pt-2 overflow-y-auto flex-1 pr-1",style:{maxHeight:"calc(85vh - 180px)"},children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:m.firstName||"",onChange:a=>f({...m,firstName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:m.lastName||"",onChange:a=>f({...m,lastName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{value:m.email||"",onChange:a=>f({...m,email:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:m.phone||"",onChange:a=>f({...m,phone:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo ID"}),e.jsxs(z,{value:m.idType||"",onValueChange:a=>f({...m,idType:a}),placeholder:"Seleccionar",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Número ID"}),e.jsx(c,{value:m.idNumber||"",onChange:a=>f({...m,idNumber:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Fecha Nacimiento"}),e.jsx(c,{type:"date",value:m.birthDate||"",onChange:a=>f({...m,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Actividad de Negocio"}),e.jsxs(z,{value:m.businessActivity||"",onValueChange:a=>f({...m,businessActivity:a}),placeholder:"Seleccionar actividad",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-edit-activity",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Dirección"}),e.jsx(c,{value:m.address||"",onChange:a=>f({...m,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Ciudad"}),e.jsx(c,{value:m.city||"",onChange:a=>f({...m,city:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Código Postal"}),e.jsx(c,{value:m.postalCode||"",onChange:a=>f({...m,postalCode:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Provincia"}),e.jsx(c,{value:m.province||"",onChange:a=>f({...m,province:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"País"}),e.jsx(c,{value:m.country||"",onChange:a=>f({...m,country:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Notas Internas (solo admin)"}),e.jsx(G,{value:m.internalNotes||"",onChange:a=>f({...m,internalNotes:a.target.value}),rows:2,className:"rounded-xl border-gray-200 focus:border-accent","data-testid":"input-edit-notes"})]})]}),m&&e.jsxs($,{className:"flex-col sm:flex-row gap-3 pt-4 border-t border-border flex-shrink-0",children:[e.jsx(s,{variant:"outline",onClick:()=>f(null),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>m.id&&Oe.mutate({id:m.id,...m}),disabled:Oe.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-user",children:Oe.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"})]})]})}),e.jsx(P,{open:Z.open,onOpenChange:a=>ze({open:a,user:a?Z.user:null}),children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Usuario"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[Z.user?.firstName," ",Z.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>ze({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{variant:"destructive",onClick:()=>Z.user?.id&&va.mutate(Z.user.id),disabled:va.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete",children:va.isPending?"Eliminando...":"Eliminar"})]})]})}),e.jsx(P,{open:V.open,onOpenChange:a=>Ue({open:a,order:a?V.order:null}),children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:V.order?.application?.requestCode||V.order?.maintenanceApplication?.requestCode||V.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",V.order?.user?.firstName," ",V.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Ue({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{variant:"destructive",onClick:()=>V.order?.id&&wa.mutate(V.order.id),disabled:wa.isPending,className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-confirm-delete-order",children:wa.isPending?"Eliminando...":"Eliminar Pedido"})]})]})}),e.jsx(P,{open:se.open,onOpenChange:a=>Me({open:a,order:a?se.order:null}),children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-primary",children:"Generar Factura"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",e.jsx("strong",{children:se.order?.application?.requestCode||se.order?.maintenanceApplication?.requestCode||se.order?.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",step:"0.01",value:re,onChange:a=>pt(a.target.value),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Divisa"}),e.jsxs(z,{value:ya,onValueChange:ht,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(l,{value:"EUR",children:"EUR (€)"}),e.jsx(l,{value:"USD",children:"USD ($)"})]})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>Me({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full",disabled:!re||isNaN(parseFloat(re))||parseFloat(re)<=0,onClick:async()=>{try{const a=Math.round(parseFloat(re)*100);if(a<=0){d({title:"Error",description:"El importe debe ser mayor que 0",variant:"destructive"});return}await g("POST",`/api/admin/orders/${se.order?.id}/generate-invoice`,{amount:a,currency:ya}),d({title:"Factura generada",description:`Factura creada por ${re} ${ya}`}),b.invalidateQueries({queryKey:["/api/admin/orders"]}),Me({open:!1,order:null})}catch{d({title:"Error",description:"No se pudo generar la factura",variant:"destructive"})}},"data-testid":"button-confirm-generate-invoice",children:"Generar Factura"})]})]})}),e.jsx(P,{open:le.open,onOpenChange:a=>Ne({open:a,user:a?le.user:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Solicitar Documentos"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(z,{value:ve,onValueChange:Ma,placeholder:"Seleccionar tipo...",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(G,{value:Ra,onChange:a=>Va(a.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-doc-message"})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>Ne({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>{if(le.user?.id&&le.user?.email){const t={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[ve]||ve;te.mutate({userId:le.user.id,title:`Solicitud de Documento: ${t}`,message:Ra||`Por favor, sube tu ${t} a tu panel de cliente.`,type:"action_required"}),Ne({open:!1,user:null}),Ma(""),Va("")}},disabled:!ve||te.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-request-doc",children:te.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"})]})]})}),e.jsx(P,{open:J.open,onOpenChange:a=>ke({open:a,user:a?J.user:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Factura"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Genera una factura para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl",children:["Cliente: ",e.jsxs("strong",{children:[J.user?.firstName," ",J.user?.lastName]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Concepto"}),e.jsx(c,{value:Je,onChange:a=>_a(a.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",value:Xe,onChange:a=>Ha(a.target.value),placeholder:"739",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Moneda"}),e.jsxs(z,{value:Ga,onValueChange:Ba,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-invoice-currency",children:[e.jsx(l,{value:"EUR",children:"EUR"}),e.jsx(l,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>ke({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>J.user?.id&&ka.mutate({userId:J.user.id,concept:Je,amount:Math.round(parseFloat(Xe)*100),currency:Ga}),disabled:!Je||!Xe||ka.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-create-invoice",children:ka.isPending?"Creando...":"Crear Factura"})]})]})})]}),e.jsx(P,{open:Ot,onOpenChange:Ye,children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Mi Cuenta"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"¿Estás seguro de que deseas eliminar tu cuenta permanentemente?"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer. Todos tus datos serán eliminados."})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Ye(!1),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{variant:"destructive",onClick:()=>Da.mutate(),disabled:Da.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete-account",children:Da.isPending?"Eliminando...":"Eliminar Mi Cuenta"})]})]})}),e.jsx(P,{open:ee.open,onOpenChange:a=>{a||Ee({open:!1,file:null})},children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-lg sm:text-xl font-black text-primary",children:"Subir Documento"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[ee.file&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex items-center gap-3",children:[e.jsx(fe,{className:"w-7 h-7 sm:w-8 sm:h-8 text-accent shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm truncate",children:ee.file.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:[(ee.file.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs sm:text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(z,{value:ce,onValueChange:Wa,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-upload-doc-type",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]}),ce==="other"&&e.jsxs("div",{children:[e.jsx(n,{className:"text-xs sm:text-sm font-black text-primary mb-2 block",children:"Descripción del documento"}),e.jsx(G,{value:Pe,onChange:a=>Ja(a.target.value),placeholder:"Describe el tipo de documento que estás subiendo...",className:"min-h-[80px] rounded-xl border-gray-200 focus:border-accent text-base",style:{fontSize:"16px"},"data-testid":"input-upload-notes"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Ee({open:!1,file:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:async()=>{if(!ee.file)return;const a=new FormData;a.append("file",ee.file),a.append("documentType",ce),ce==="other"&&Pe&&a.append("notes",Pe);try{const t=await fetch("/api/user/documents/upload",{method:"POST",body:a,credentials:"include"});if(t.ok)d({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),b.invalidateQueries({queryKey:["/api/user/documents"]}),Ee({open:!1,file:null});else{const j=await t.json();d({title:"Error",description:j.message||"No se pudo subir el documento",variant:"destructive"})}}catch{d({title:"Error",description:"Error de conexión",variant:"destructive"})}},disabled:ce==="other"&&!Pe.trim(),className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-upload",children:"Subir Documento"})]})]})}),e.jsx(P,{open:$t,onOpenChange:Ce,children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Nuevo Cliente"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Completa los datos del nuevo cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:Q.firstName,onChange:a=>X(t=>({...t,firstName:a.target.value})),placeholder:"Nombre",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:Q.lastName,onChange:a=>X(t=>({...t,lastName:a.target.value})),placeholder:"Apellidos",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{type:"email",value:Q.email,onChange:a=>X(t=>({...t,email:a.target.value})),placeholder:"email@ejemplo.com",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:Q.phone,onChange:a=>X(t=>({...t,phone:a.target.value})),placeholder:"+34 600 000 000",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Contraseña"}),e.jsx(c,{type:"password",value:Q.password,onChange:a=>X(t=>({...t,password:a.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-password"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Ce(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-user",children:"Cancelar"}),e.jsx(s,{onClick:()=>Ca.mutate(Q),disabled:Ca.isPending||!Q.email||!Q.password,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-user",children:Ca.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Crear Cliente"})]})]})}),e.jsx(P,{open:qt,onOpenChange:Se,children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Nuevo Pedido"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Configura el pedido para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Cliente"}),e.jsx(z,{value:Y.userId,onValueChange:a=>De(t=>({...t,userId:a})),placeholder:"Seleccionar cliente...",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-user",children:ct?.map(a=>e.jsxs(l,{value:a.id,children:[a.firstName," ",a.lastName," (",a.email,")"]},a.id))})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Estado (LLC)"}),e.jsxs(z,{value:Y.state,onValueChange:a=>De(t=>({...t,state:a})),placeholder:"Seleccionar estado",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-state",children:[e.jsx(l,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(l,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(l,{value:"Delaware",children:"Delaware - 1199€"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Importe (€)"}),e.jsx(c,{type:"number",value:Y.amount,onChange:a=>De(t=>({...t,amount:a.target.value})),placeholder:"739",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-order-amount"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Se(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-order",children:"Cancelar"}),e.jsx(s,{onClick:()=>Sa.mutate(Y),disabled:Sa.isPending||!Y.userId||!Y.amount,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-order",children:Sa.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Crear Pedido"})]})]})}),e.jsx(P,{open:_.open,onOpenChange:a=>oe({open:a,code:a?_.code:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:_.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:_.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Código"}),e.jsx(c,{value:N.code,onChange:a=>M(t=>({...t,code:a.target.value.toUpperCase()})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base uppercase",disabled:!!_.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo"}),e.jsxs(z,{value:N.discountType,onValueChange:a=>M(t=>({...t,discountType:a})),className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-discount-type",children:[e.jsx(l,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(l,{value:"fixed",children:"Fijo (centimos)"})]})]}),e.jsxs("div",{children:[e.jsxs(n,{className:"text-sm font-black text-primary mb-2 block",children:["Valor ",N.discountType==="percentage"?"(%)":"(centimos)"]}),e.jsx(c,{type:"number",value:N.discountValue,onChange:a=>M(t=>({...t,discountValue:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Pedido min. (EUR)"}),e.jsx(c,{type:"number",value:N.minOrderAmount,onChange:a=>M(t=>({...t,minOrderAmount:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Usos max."}),e.jsx(c,{type:"number",value:N.maxUses,onChange:a=>M(t=>({...t,maxUses:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Válido desde"}),e.jsx(c,{type:"date",value:N.validFrom,onChange:a=>M(t=>({...t,validFrom:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Válido hasta"}),e.jsx(c,{type:"date",value:N.validUntil,onChange:a=>M(t=>({...t,validUntil:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Lt,{checked:N.isActive,onCheckedChange:a=>M(t=>({...t,isActive:a})),"data-testid":"switch-discount-active"}),e.jsx(n,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>oe({open:!1,code:null}),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-discount",children:"Cancelar"}),e.jsx(s,{onClick:async()=>{try{const a={code:N.code,discountType:N.discountType,discountValue:parseInt(N.discountValue),minOrderAmount:N.minOrderAmount?parseInt(N.minOrderAmount)*100:null,maxUses:N.maxUses?parseInt(N.maxUses):null,validFrom:N.validFrom||null,validUntil:N.validUntil||null,isActive:N.isActive};_.code?(await g("PATCH",`/api/admin/discount-codes/${_.code.id}`,a),d({title:"Código actualizado"})):(await g("POST","/api/admin/discount-codes",a),d({title:"Código creado"})),mt(),oe({open:!1,code:null})}catch(a){d({title:"Error",description:a.message||"No se pudo guardar el código",variant:"destructive"})}},disabled:!N.code||!N.discountValue,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-discount",children:_.code?"Guardar Cambios":"Crear Código"})]})]})}),e.jsx(P,{open:Ut,onOpenChange:a=>{oa(a),a||ma("")},children:e.jsxs(A,{className:"rounded-2xl sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black",children:"Verifica tu correo electrónico"}),e.jsx(K,{children:"Te hemos enviado un código de verificación para confirmar tu email"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Código de verificación"}),e.jsx(c,{value:xe,onChange:a=>ma(a.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-2xl font-black border-gray-200 focus:border-accent tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code","data-testid":"input-email-verification-code"})]}),e.jsx(s,{onClick:async()=>{if(!xe||xe.length<6){d({title:"Introduce el código de 6 dígitos",variant:"destructive"});return}st(!0);try{(await(await g("POST","/api/auth/verify-email",{code:xe})).json()).success&&(await b.refetchQueries({queryKey:["/api/auth/user"]}),d({title:"Email verificado correctamente"}),oa(!1),ma(""))}catch(a){d({title:"Código incorrecto",description:a.message||"Inténtalo de nuevo o solicita un nuevo código",variant:"destructive"})}finally{st(!1)}},disabled:tt||xe.length<6,size:"lg",className:"w-full bg-accent text-primary font-black rounded-full","data-testid":"button-verify-email-code",children:tt?e.jsx(H,{className:"animate-spin"}):"Verificar mi email"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"¿No has recibido el código?"}),e.jsx(s,{variant:"link",onClick:async()=>{nt(!0);try{await g("POST","/api/auth/resend-verification"),d({title:"Código enviado",description:"Revisa tu email"})}catch{d({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{nt(!1)}},disabled:rt,className:"text-accent p-0 h-auto","data-testid":"button-resend-verification-code",children:rt?"Enviando...":"Reenviar código"})]})]})]})}),e.jsx(P,{open:ae.open,onOpenChange:a=>{Te({open:a,user:a?ae.user:null}),a||(ia(""),la(""),ca(""))},children:e.jsxs(A,{className:"rounded-2xl sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black",children:"Enviar Link de Pago"}),e.jsxs(K,{children:["Envía un enlace de pago a ",ae.user?.firstName," ",ae.user?.lastName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Link de pago (URL)"}),e.jsx(c,{value:Le,onChange:a=>ia(a.target.value),placeholder:"https://...",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Importe"}),e.jsx(c,{value:me,onChange:a=>la(a.target.value),placeholder:"Ej: 739€",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Mensaje (opcional)"}),e.jsx(G,{value:Za,onChange:a=>ca(a.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-gray-200 focus:border-accent resize-none",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Te({open:!1,user:null}),className:"w-full sm:w-auto rounded-full",children:"Cancelar"}),e.jsx(s,{onClick:async()=>{if(!Le||!me){d({title:"Completa todos los campos requeridos",variant:"destructive"});return}at(!0);try{await g("POST","/api/admin/send-payment-link",{userId:ae.user?.id,paymentLink:Le,amount:me,message:Za||`Por favor, completa el pago de ${me} a través del siguiente enlace.`}),d({title:"Link de pago enviado",description:`Se ha enviado el link a ${ae.user?.email}`}),Te({open:!1,user:null}),ia(""),la(""),ca("")}catch(a){d({title:"Error",description:a.message||"No se pudo enviar el link",variant:"destructive"})}finally{at(!1)}},disabled:et||!Le||!me,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-payment-link",children:et?e.jsx(H,{className:"animate-spin"}):"Enviar Link de Pago"})]})]})}),e.jsx(Pt,{})]})}export{Fs as default};
