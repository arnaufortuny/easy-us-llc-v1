import{_ as ve}from"./pdf-DU6qdRYg.js";import{a as n,j as e,am as pe,a2 as ge,Z as je,an as Ne}from"./react-core-BwXmAyYw.js";import{B as p,q as g,s as j,t as N,v as f,y as r,I as d,o as q,N as M}from"./ui-components-CnPFRHmO.js";import{u as fe,b as be,N as Fe,L as Ce,F as Se}from"./index-BnUt9mq7.js";import{u as ye}from"./i18n-DfkNketv.js";import"./radix-ui-BLFq0uWR.js";import"./react-dom-lwpWoMhj.js";import"./forms-CNlQlKiB.js";import"./tanstack-Bcy__teF.js";function H(){return Math.random().toString(36).substr(2,9)}function $e(){const[,W]=fe(),{t:a}=ye(),[C,Y]=n.useState(""),[S,Z]=n.useState(""),[y,J]=n.useState(""),[T,K]=n.useState(""),[G,Q]=n.useState(""),[I,X]=n.useState(""),[E,ee]=n.useState(""),[z,te]=n.useState(""),[D,se]=n.useState(""),[O,ae]=n.useState(new Date().toISOString().split("T")[0]),[b,oe]=n.useState(""),[w,ie]=n.useState("EUR"),[P,le]=n.useState(""),[m,ne]=n.useState(0),[c,R]=n.useState([{id:H(),description:"",quantity:1,price:0}]),[U,A]=n.useState(!1),{user:re,isAuthenticated:de,isLoading:ce}=be();if(ce)return e.jsx("div",{className:"min-h-screen bg-background"});if(!de||!re)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:a("tools.invoiceGenerator.loginRequired")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:a("tools.invoiceGenerator.loginDescription")}),e.jsx(p,{onClick:()=>W("/auth/login"),className:"bg-accent text-accent-foreground rounded-full px-6",children:a("auth.login.submit")})]})});const xe=()=>{R([...c,{id:H(),description:"",quantity:1,price:0}])},me=s=>{c.length>1&&R(c.filter(t=>t.id!==s))},$=(s,t,i)=>{R(c.map(u=>u.id===s?{...u,[t]:i}:u))},F=c.reduce((s,t)=>s+t.quantity*t.price,0),L=F*(m/100),_=F+L,x=w==="EUR"?"€":w==="USD"?"$":"£",B=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"",ue=async()=>{if(!C||!G||c.some(s=>!s.description)){alert(a("tools.invoiceGenerator.validationError"));return}A(!0);try{const{default:s}=await ve(async()=>{const{default:l}=await import("./pdf-DU6qdRYg.js").then(k=>k.j);return{default:l}},[]),t=new s,i=t.internal.pageSize.getWidth(),u=t.internal.pageSize.getHeight();t.setFillColor(110,220,138),t.rect(0,0,i,8,"F"),t.setTextColor(14,18,21),t.setFontSize(32),t.setFont("helvetica","bold"),t.text("FACTURA",20,35),t.setFillColor(248,250,252),t.roundedRect(i-75,18,55,28,3,3,"F"),t.setTextColor(107,114,128),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Nº Factura",i-70,26),t.text("Fecha",i-70,34),b&&t.text("Vencimiento",i-70,42),t.setTextColor(14,18,21),t.setFont("helvetica","bold"),t.text(D||"-",i-25,26,{align:"right"}),t.text(B(O),i-25,34,{align:"right"}),b&&t.text(B(b),i-25,42,{align:"right"});let o=60;t.setFillColor(248,250,252),t.roundedRect(15,o-5,82,45,3,3,"F"),t.setTextColor(110,220,138),t.setFontSize(8),t.setFont("helvetica","bold"),t.text("EMISOR",20,o+2),t.setTextColor(14,18,21),t.setFontSize(11),t.text(C,20,o+12),t.setTextColor(107,114,128),t.setFontSize(9),t.setFont("helvetica","normal");let h=o+20;if(S){const l=t.splitTextToSize(S,75);t.text(l,20,h),h+=l.length*4}y&&(t.text(y,20,h),h+=4),T&&t.text(`NIF/CIF: ${T}`,20,h),t.setFillColor(248,250,252),t.roundedRect(103,o-5,82,45,3,3,"F"),t.setTextColor(110,220,138),t.setFontSize(8),t.setFont("helvetica","bold"),t.text("CLIENTE",108,o+2),t.setTextColor(14,18,21),t.setFontSize(11),t.text(G,108,o+12),t.setTextColor(107,114,128),t.setFontSize(9),t.setFont("helvetica","normal");let v=o+20;if(I){const l=t.splitTextToSize(I,75);t.text(l,108,v),v+=l.length*4}if(E&&(t.text(E,108,v),v+=4),z&&t.text(`NIF/CIF: ${z}`,108,v),o=115,t.setFillColor(110,220,138),t.roundedRect(15,o,i-30,12,2,2,"F"),t.setTextColor(255,255,255),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("CONCEPTO",20,o+8),t.text("UDS",125,o+8),t.text("PRECIO",145,o+8),t.text("IMPORTE",175,o+8),o+=18,t.setTextColor(14,18,21),t.setFontSize(10),t.setFont("helvetica","normal"),c.forEach((l,k)=>{k%2===0&&(t.setFillColor(252,252,253),t.rect(15,o-5,i-30,10,"F"));const Te=l.quantity*l.price,V=t.splitTextToSize(l.description,95);t.text(V,20,o),t.text(String(l.quantity),128,o);const he=l.quantity*l.price;t.text(`${l.price.toFixed(2)} ${x}`,160,o,{align:"right"}),t.text(`${he.toFixed(2)} ${x}`,188,o,{align:"right"}),o+=Math.max(V.length*6,10)}),o+=8,t.setTextColor(107,114,128),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("Subtotal:",140,o),t.setTextColor(14,18,21),t.text(`${F.toFixed(2)} ${x}`,183,o,{align:"right"}),m>0&&(o+=8,t.setTextColor(107,114,128),t.text(`IVA (${m}%):`,140,o),t.setTextColor(14,18,21),t.text(`${L.toFixed(2)} ${x}`,183,o,{align:"right"})),o+=10,t.setFillColor(14,18,21),t.roundedRect(120,o,70,18,3,3,"F"),t.setTextColor(255,255,255),t.setFontSize(11),t.setFont("helvetica","bold"),t.text("TOTAL",128,o+12),t.setFontSize(14),t.text(`${_.toFixed(2)} ${x}`,183,o+12,{align:"right"}),P){o+=35,t.setFillColor(255,251,235),t.roundedRect(15,o-5,i-30,25,3,3,"F"),t.setTextColor(146,64,14),t.setFontSize(8),t.setFont("helvetica","bold"),t.text("OBSERVACIONES",20,o+2),t.setTextColor(107,114,128),t.setFont("helvetica","normal");const l=t.splitTextToSize(P,165);t.text(l,20,o+10)}t.setFillColor(110,220,138),t.rect(0,u-15,i,2,"F"),t.setTextColor(156,163,175),t.setFontSize(8),t.text("Factura generada con Easy US LLC | easyusllc.com",i/2,u-8,{align:"center"}),t.save(`factura-${D||Date.now()}.pdf`),A(!1)}catch(s){console.error("Error generating PDF:",s),A(!1),alert(a("tools.invoiceGenerator.generationError"))}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(Fe,{}),e.jsxs("main",{className:"flex-1 w-full max-w-4xl mx-auto px-4 py-6 md:py-10 pb-20",children:[e.jsxs("div",{className:"mb-6 md:mb-8",children:[e.jsx(Ce,{href:"/dashboard?tab=tools",children:e.jsxs(p,{variant:"ghost",size:"sm",className:"rounded-full text-muted-foreground hover:text-foreground mb-4 -ml-2","data-testid":"button-back-tools",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),a("tools.backToTools")]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight",children:a("tools.invoiceGenerator.title")}),e.jsx("p",{className:"text-muted-foreground text-xs sm:text-sm mt-1",children:a("tools.invoiceGenerator.subtitle")})]})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(g,{className:"border-0 shadow-md rounded-2xl",children:[e.jsx(j,{className:"pb-3 md:pb-4",children:e.jsx(N,{className:"text-sm md:text-base font-semibold text-accent",children:a("tools.invoiceGenerator.issuer")})}),e.jsxs(f,{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"issuerName",className:"text-xs md:text-sm",children:[a("tools.invoiceGenerator.nameCompany")," *"]}),e.jsx(d,{id:"issuerName",value:C,onChange:s=>Y(s.target.value),placeholder:a("tools.invoiceGenerator.namePlaceholder"),className:"mt-1 rounded-full","data-testid":"input-issuer-name"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"issuerAddress",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.address")}),e.jsx(q,{id:"issuerAddress",value:S,onChange:s=>Z(s.target.value),placeholder:a("tools.invoiceGenerator.addressPlaceholder"),rows:2,className:"mt-1 resize-none rounded-lg","data-testid":"input-issuer-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"issuerEmail",className:"text-xs md:text-sm",children:"Email"}),e.jsx(d,{id:"issuerEmail",type:"email",value:y,onChange:s=>J(s.target.value),placeholder:a("tools.invoiceGenerator.emailPlaceholder"),className:"mt-1 rounded-full","data-testid":"input-issuer-email"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"issuerTaxId",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.taxId")}),e.jsx(d,{id:"issuerTaxId",value:T,onChange:s=>K(s.target.value),placeholder:a("tools.invoiceGenerator.taxIdPlaceholder"),className:"mt-1 rounded-full","data-testid":"input-issuer-tax-id"})]})]})]})]}),e.jsxs(g,{className:"border-0 shadow-sm rounded-2xl",children:[e.jsx(j,{className:"pb-3 md:pb-4",children:e.jsx(N,{className:"text-sm md:text-base font-semibold text-accent",children:a("tools.invoiceGenerator.client")})}),e.jsxs(f,{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"clientName",className:"text-xs md:text-sm",children:[a("tools.invoiceGenerator.nameCompany")," *"]}),e.jsx(d,{id:"clientName",value:G,onChange:s=>Q(s.target.value),placeholder:a("tools.invoiceGenerator.clientNamePlaceholder"),className:"mt-1 rounded-full","data-testid":"input-client-name"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"clientAddress",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.address")}),e.jsx(q,{id:"clientAddress",value:I,onChange:s=>X(s.target.value),placeholder:a("tools.invoiceGenerator.addressPlaceholder"),rows:2,className:"mt-1 resize-none rounded-lg","data-testid":"input-client-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"clientEmail",className:"text-xs md:text-sm",children:"Email"}),e.jsx(d,{id:"clientEmail",type:"email",value:E,onChange:s=>ee(s.target.value),placeholder:a("tools.invoiceGenerator.emailPlaceholder"),className:"mt-1 rounded-full","data-testid":"input-client-email"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"clientTaxId",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.taxId")}),e.jsx(d,{id:"clientTaxId",value:z,onChange:s=>te(s.target.value),placeholder:a("tools.invoiceGenerator.taxIdPlaceholder"),className:"mt-1 rounded-full","data-testid":"input-client-tax-id"})]})]})]})]})]}),e.jsxs(g,{className:"border-0 shadow-sm rounded-2xl",children:[e.jsx(j,{className:"pb-3 md:pb-4",children:e.jsx(N,{className:"text-sm md:text-base font-semibold text-accent",children:a("tools.invoiceGenerator.invoiceDetails")})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"invoiceNumber",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.invoiceNumber")}),e.jsx(d,{id:"invoiceNumber",value:D,onChange:s=>se(s.target.value),placeholder:"2024-001",className:"mt-1 rounded-full","data-testid":"input-invoice-number"})]}),e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"invoiceDate",className:"text-xs md:text-sm",children:[a("tools.invoiceGenerator.invoiceDate")," *"]}),e.jsx(d,{id:"invoiceDate",type:"date",value:O,onChange:s=>ae(s.target.value),className:"mt-1 rounded-full","data-testid":"input-invoice-date"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"dueDate",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.dueDate")}),e.jsx(d,{id:"dueDate",type:"date",value:b,onChange:s=>oe(s.target.value),className:"mt-1 rounded-full","data-testid":"input-due-date"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"currency",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.currency")}),e.jsxs(M,{value:w,onChange:s=>ie(s.target.value),className:"mt-1 rounded-full","data-testid":"select-currency",children:[e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"taxRate",className:"text-xs md:text-sm",children:a("tools.invoiceGenerator.taxRate")}),e.jsxs(M,{value:String(m),onChange:s=>ne(Number(s.target.value)),className:"mt-1 rounded-full","data-testid":"select-tax-rate",children:[e.jsx("option",{value:"0",children:"Sin IVA (0%)"}),e.jsx("option",{value:"4",children:"4%"}),e.jsx("option",{value:"10",children:"10%"}),e.jsx("option",{value:"21",children:"21%"})]})]})]})})]}),e.jsxs(g,{className:"border-0 shadow-sm rounded-2xl",children:[e.jsxs(j,{className:"pb-3 md:pb-4 flex flex-row items-center justify-between gap-2",children:[e.jsx(N,{className:"text-sm md:text-base font-semibold text-accent",children:a("tools.invoiceGenerator.items")}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:xe,className:"h-8 text-xs rounded-full","data-testid":"button-add-item",children:[e.jsx(ge,{className:"w-3.5 h-3.5 mr-1"}),a("tools.invoiceGenerator.addItem")]})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-3 text-xs text-muted-foreground font-medium px-1",children:[e.jsxs("div",{className:"col-span-6",children:[a("tools.invoiceGenerator.description")," *"]}),e.jsx("div",{className:"col-span-2",children:a("tools.invoiceGenerator.quantity")}),e.jsxs("div",{className:"col-span-3",children:[a("tools.invoiceGenerator.price")," (",x,")"]}),e.jsx("div",{className:"col-span-1"})]}),c.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 md:gap-3 items-center",children:[e.jsx("div",{className:"col-span-12 md:col-span-6",children:e.jsx(d,{value:s.description,onChange:i=>$(s.id,"description",i.target.value),placeholder:a("tools.invoiceGenerator.descriptionPlaceholder"),className:"rounded-full","data-testid":`input-item-description-${t}`})}),e.jsx("div",{className:"col-span-4 md:col-span-2",children:e.jsx(d,{type:"number",min:"1",value:s.quantity,onChange:i=>$(s.id,"quantity",parseInt(i.target.value)||1),className:"rounded-full","data-testid":`input-item-quantity-${t}`})}),e.jsx("div",{className:"col-span-6 md:col-span-3",children:e.jsx(d,{type:"number",min:"0",step:"0.01",value:s.price,onChange:i=>$(s.id,"price",parseFloat(i.target.value)||0),className:"rounded-full","data-testid":`input-item-price-${t}`})}),e.jsx("div",{className:"col-span-2 md:col-span-1 flex justify-center",children:e.jsx(p,{type:"button",variant:"ghost",size:"icon",onClick:()=>me(s.id),disabled:c.length===1,className:"h-9 w-9 text-muted-foreground hover:text-destructive rounded-full","data-testid":`button-remove-item-${t}`,children:e.jsx(je,{className:"w-4 h-4"})})})]},s.id))]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-border flex justify-end",children:e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"flex justify-end gap-4 text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{children:[a("tools.invoiceGenerator.subtotal"),":"]}),e.jsxs("span",{children:[F.toFixed(2)," ",x]})]}),m>0&&e.jsxs("div",{className:"flex justify-end gap-4 text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{children:[a("tools.invoiceGenerator.tax")," (",m,"%):"]}),e.jsxs("span",{children:[L.toFixed(2)," ",x]})]}),e.jsxs("p",{className:"text-xl md:text-2xl font-bold text-foreground","data-testid":"text-total",children:[_.toFixed(2)," ",x]})]})})]})]}),e.jsxs(g,{className:"border-0 shadow-sm rounded-2xl",children:[e.jsx(j,{className:"pb-3 md:pb-4",children:e.jsx(N,{className:"text-sm md:text-base font-semibold text-accent",children:a("tools.invoiceGenerator.notes")})}),e.jsx(f,{children:e.jsx(q,{value:P,onChange:s=>le(s.target.value),placeholder:a("tools.invoiceGenerator.notesPlaceholder"),rows:2,className:"resize-none rounded-lg","data-testid":"input-notes"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 pt-4",children:[e.jsxs(p,{size:"lg",onClick:ue,disabled:U,className:"bg-accent hover:bg-accent/90 text-accent-foreground font-black rounded-full px-6","data-testid":"button-generate-pdf",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),a(U?"tools.invoiceGenerator.generating":"tools.invoiceGenerator.generatePdf")]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:a("tools.invoiceGenerator.privacyNote")})]})]})]}),e.jsx(Se,{})]})}export{$e as default};
