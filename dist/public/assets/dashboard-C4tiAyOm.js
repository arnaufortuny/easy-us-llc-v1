import{j as e}from"./vendor-CrJWq8MZ.js";import{g,h as Ee,d as Se,b as _e,a as H,i as se,N as Pe,C as I,j as S,k as _,e as F,B as R,c as Q,q as Y,F as De}from"./index-BTKepvA3.js";import{a as o,c as ae,d as Le,a5 as te,P as A,g as y,u as Me,a6 as re,e as ne,h as Ge,f as Ke,z as Ve,a4 as $e,a7 as Ue,M as Be,$ as Oe,s as qe,a8 as ze,T as He,a9 as Qe}from"./ui-C32c8noR.js";import{S as Ye,a as Je,b as We,c as Xe,d as L}from"./select-OoWcu2mR.js";const G=o.forwardRef(({className:s,...t},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:g("w-full caption-bottom text-sm",s),...t})}));G.displayName="Table";const K=o.forwardRef(({className:s,...t},r)=>e.jsx("thead",{ref:r,className:g("[&_tr]:border-b",s),...t}));K.displayName="TableHeader";const V=o.forwardRef(({className:s,...t},r)=>e.jsx("tbody",{ref:r,className:g("[&_tr:last-child]:border-0",s),...t}));V.displayName="TableBody";const Ze=o.forwardRef(({className:s,...t},r)=>e.jsx("tfoot",{ref:r,className:g("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Ze.displayName="TableFooter";const k=o.forwardRef(({className:s,...t},r)=>e.jsx("tr",{ref:r,className:g("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));k.displayName="TableRow";const d=o.forwardRef(({className:s,...t},r)=>e.jsx("th",{ref:r,className:g("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...t}));d.displayName="TableHead";const u=o.forwardRef(({className:s,...t},r)=>e.jsx("td",{ref:r,className:g("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...t}));u.displayName="TableCell";const es=o.forwardRef(({className:s,...t},r)=>e.jsx("caption",{ref:r,className:g("mt-4 text-sm text-muted-foreground",s),...t}));es.displayName="TableCaption";const ss=Ee("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-accent text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function M({className:s,variant:t,...r}){return e.jsx("div",{className:g(ss({variant:t}),s),...r})}var J="rovingFocusGroup.onEntryFocus",as={bubbles:!1,cancelable:!0},P="RovingFocusGroup",[W,oe,ts]=Le(P),[rs,ie]=ae(P,[ts]),[ns,os]=rs(P),ce=o.forwardRef((s,t)=>e.jsx(W.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(W.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx(is,{...s,ref:t})})}));ce.displayName=P;var is=o.forwardRef((s,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:x=!1,dir:f,currentTabStopId:i,defaultCurrentTabStopId:b,onCurrentTabStopIdChange:j,onEntryFocus:h,preventScrollOnEntryFocus:c=!1,...l}=s,a=o.useRef(null),N=Me(t,a),E=re(f),[D,m]=ne({prop:i,defaultProp:b??null,onChange:j,caller:P}),[w,O]=o.useState(!1),v=Ge(h),T=oe(r),q=o.useRef(!1),[ke,Z]=o.useState(0);return o.useEffect(()=>{const p=a.current;if(p)return p.addEventListener(J,v),()=>p.removeEventListener(J,v)},[v]),e.jsx(ns,{scope:r,orientation:n,dir:E,loop:x,currentTabStopId:D,onItemFocus:o.useCallback(p=>m(p),[m]),onItemShiftTab:o.useCallback(()=>O(!0),[]),onFocusableItemAdd:o.useCallback(()=>Z(p=>p+1),[]),onFocusableItemRemove:o.useCallback(()=>Z(p=>p-1),[]),children:e.jsx(A.div,{tabIndex:w||ke===0?-1:0,"data-orientation":n,...l,ref:N,style:{outline:"none",...s.style},onMouseDown:y(s.onMouseDown,()=>{q.current=!0}),onFocus:y(s.onFocus,p=>{const Ie=!q.current;if(p.target===p.currentTarget&&Ie&&!w){const ee=new CustomEvent(J,as);if(p.currentTarget.dispatchEvent(ee),!ee.defaultPrevented){const z=T().filter(C=>C.focusable),Fe=z.find(C=>C.active),Re=z.find(C=>C.id===D),Ae=[Fe,Re,...z].filter(Boolean).map(C=>C.ref.current);ue(Ae,c)}}q.current=!1}),onBlur:y(s.onBlur,()=>O(!1))})})}),le="RovingFocusGroupItem",de=o.forwardRef((s,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:x=!1,tabStopId:f,children:i,...b}=s,j=te(),h=f||j,c=os(le,r),l=c.currentTabStopId===h,a=oe(r),{onFocusableItemAdd:N,onFocusableItemRemove:E,currentTabStopId:D}=c;return o.useEffect(()=>{if(n)return N(),()=>E()},[n,N,E]),e.jsx(W.ItemSlot,{scope:r,id:h,focusable:n,active:x,children:e.jsx(A.span,{tabIndex:l?0:-1,"data-orientation":c.orientation,...b,ref:t,onMouseDown:y(s.onMouseDown,m=>{n?c.onItemFocus(h):m.preventDefault()}),onFocus:y(s.onFocus,()=>c.onItemFocus(h)),onKeyDown:y(s.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){c.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const w=ds(m,c.orientation,c.dir);if(w!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let v=a().filter(T=>T.focusable).map(T=>T.ref.current);if(w==="last")v.reverse();else if(w==="prev"||w==="next"){w==="prev"&&v.reverse();const T=v.indexOf(m.currentTarget);v=c.loop?us(v,T+1):v.slice(T+1)}setTimeout(()=>ue(v))}}),children:typeof i=="function"?i({isCurrentTabStop:l,hasTabStop:D!=null}):i})})});de.displayName=le;var cs={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ls(s,t){return t!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function ds(s,t,r){const n=ls(s.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return cs[n]}function ue(s,t=!1){const r=document.activeElement;for(const n of s)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function us(s,t){return s.map((r,n)=>s[(t+n)%s.length])}var xs=ce,ms=de,B="Tabs",[fs]=ae(B,[ie]),xe=ie(),[bs,X]=fs(B),me=o.forwardRef((s,t)=>{const{__scopeTabs:r,value:n,onValueChange:x,defaultValue:f,orientation:i="horizontal",dir:b,activationMode:j="automatic",...h}=s,c=re(b),[l,a]=ne({prop:n,onChange:x,defaultProp:f??"",caller:B});return e.jsx(bs,{scope:r,baseId:te(),value:l,onValueChange:a,orientation:i,dir:c,activationMode:j,children:e.jsx(A.div,{dir:c,"data-orientation":i,...h,ref:t})})});me.displayName=B;var fe="TabsList",be=o.forwardRef((s,t)=>{const{__scopeTabs:r,loop:n=!0,...x}=s,f=X(fe,r),i=xe(r);return e.jsx(xs,{asChild:!0,...i,orientation:f.orientation,dir:f.dir,loop:n,children:e.jsx(A.div,{role:"tablist","aria-orientation":f.orientation,...x,ref:t})})});be.displayName=fe;var he="TabsTrigger",pe=o.forwardRef((s,t)=>{const{__scopeTabs:r,value:n,disabled:x=!1,...f}=s,i=X(he,r),b=xe(r),j=ve(i.baseId,n),h=Ne(i.baseId,n),c=n===i.value;return e.jsx(ms,{asChild:!0,...b,focusable:!x,active:c,children:e.jsx(A.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":h,"data-state":c?"active":"inactive","data-disabled":x?"":void 0,disabled:x,id:j,...f,ref:t,onMouseDown:y(s.onMouseDown,l=>{!x&&l.button===0&&l.ctrlKey===!1?i.onValueChange(n):l.preventDefault()}),onKeyDown:y(s.onKeyDown,l=>{[" ","Enter"].includes(l.key)&&i.onValueChange(n)}),onFocus:y(s.onFocus,()=>{const l=i.activationMode!=="manual";!c&&!x&&l&&i.onValueChange(n)})})})});pe.displayName=he;var ge="TabsContent",je=o.forwardRef((s,t)=>{const{__scopeTabs:r,value:n,forceMount:x,children:f,...i}=s,b=X(ge,r),j=ve(b.baseId,n),h=Ne(b.baseId,n),c=n===b.value,l=o.useRef(c);return o.useEffect(()=>{const a=requestAnimationFrame(()=>l.current=!1);return()=>cancelAnimationFrame(a)},[]),e.jsx(Ke,{present:x||c,children:({present:a})=>e.jsx(A.div,{"data-state":c?"active":"inactive","data-orientation":b.orientation,role:"tabpanel","aria-labelledby":j,hidden:!a,id:h,tabIndex:0,...i,ref:t,style:{...s.style,animationDuration:l.current?"0s":void 0},children:a&&f})})});je.displayName=ge;function ve(s,t){return`${s}-trigger-${t}`}function Ne(s,t){return`${s}-content-${t}`}var hs=me,ye=be,we=pe,Te=je;const ps=hs,Ce=o.forwardRef(({className:s,...t},r)=>e.jsx(ye,{ref:r,className:g("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Ce.displayName=ye.displayName;const $=o.forwardRef(({className:s,...t},r)=>e.jsx(we,{ref:r,className:g("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...t}));$.displayName=we.displayName;const U=o.forwardRef(({className:s,...t},r)=>e.jsx(Te,{ref:r,className:g("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));U.displayName=Te.displayName;function ws(){const{user:s,isAuthenticated:t,isLoading:r}=Se(),{toast:n}=_e(),[x,f]=o.useState("orders");o.useEffect(()=>{!r&&(!t||!s?.isAdmin)&&(window.location.href="/")},[t,s,r]);const{data:i,isLoading:b}=H({queryKey:["/api/admin/orders"],enabled:!!s?.isAdmin}),{data:j,isLoading:h}=H({queryKey:["/api/admin/users"],enabled:!!s?.isAdmin}),c=se({mutationFn:async({id:a,status:N})=>(await Q("PATCH",`/api/admin/orders/${a}/status`,{status:N})).json(),onSuccess:()=>{Y.invalidateQueries({queryKey:["/api/admin/orders"]}),n({title:"Estado actualizado",description:"El pedido ha sido actualizado correctamente."})}}),l=se({mutationFn:async a=>{await Q("DELETE",`/api/admin/users/${a}`)},onSuccess:()=>{Y.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario eliminado",variant:"destructive"})}});return r||!s?.isAdmin?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Ve,{className:"w-8 h-8 animate-spin text-accent"})}):e.jsxs("div",{className:"min-h-screen bg-[#F7F7F5]",children:[e.jsx(Pe,{}),e.jsxs("main",{className:"pt-24 pb-16 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h1",{className:"text-4xl font-black text-primary  tracking-tighter",children:"Panel de Administración"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestión centralizada de pedidos, clientes y facturación."})]}),e.jsxs(ps,{defaultValue:"orders",onValueChange:f,className:"space-y-8",children:[e.jsxs(Ce,{className:"bg-white p-1 rounded-full border border-gray-100 shadow-sm",children:[e.jsxs($,{value:"orders",className:"rounded-full px-8 py-2 data-[state=active]:bg-accent data-[state=active]:text-primary font-black  text-xs",children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Pedidos"]}),e.jsxs($,{value:"users",className:"rounded-full px-8 py-2 data-[state=active]:bg-accent data-[state=active]:text-primary font-black  text-xs",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Usuarios"]}),e.jsxs($,{value:"messages",className:"rounded-full px-8 py-2 data-[state=active]:bg-accent data-[state=active]:text-primary font-black  text-xs",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"})," Mensajes"]})]}),e.jsxs(U,{value:"orders",className:"space-y-8 mt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"rounded-3xl border-0 shadow-sm",children:[e.jsx(S,{className:"pb-2",children:e.jsx(_,{className:"text-sm font-black  text-muted-foreground",children:"Ventas Totales"})}),e.jsx(F,{children:e.jsx("p",{className:"text-3xl font-black text-primary",children:i?.reduce((a,N)=>a+N.amount,0).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})})]}),e.jsxs(I,{className:"rounded-3xl border-0 shadow-sm",children:[e.jsx(S,{className:"pb-2",children:e.jsx(_,{className:"text-sm font-black  text-muted-foreground",children:"Pedidos Pendientes"})}),e.jsx(F,{children:e.jsx("p",{className:"text-3xl font-black text-yellow-600",children:i?.filter(a=>a.status==="pending").length})})]}),e.jsxs(I,{className:"rounded-3xl border-0 shadow-sm",children:[e.jsx(S,{className:"pb-2",children:e.jsx(_,{className:"text-sm font-black  text-muted-foreground",children:"Clientes Activos"})}),e.jsx(F,{children:e.jsx("p",{className:"text-3xl font-black text-accent",children:new Set(i?.map(a=>a.userId)).size})})]})]}),e.jsxs(I,{className:"rounded-3xl border-0 shadow-sm overflow-hidden",children:[e.jsx(S,{className:"bg-white border-b border-gray-100 p-6",children:e.jsx(_,{className:"text-xl font-black ",children:"Listado de Pedidos"})}),e.jsx(F,{className:"p-0",children:e.jsxs(G,{children:[e.jsx(K,{children:e.jsxs(k,{className:"hover:bg-transparent border-gray-100",children:[e.jsx(d,{className:"font-black  text-xs px-6",children:"ID / Fecha"}),e.jsx(d,{className:"font-black  text-xs",children:"Cliente"}),e.jsx(d,{className:"font-black  text-xs",children:"Servicio"}),e.jsx(d,{className:"font-black  text-xs",children:"Importe"}),e.jsx(d,{className:"font-black  text-xs",children:"Estado"}),e.jsx(d,{className:"font-black  text-xs text-right px-6",children:"Acciones"})]})}),e.jsx(V,{children:i?.map(a=>e.jsxs(k,{className:"border-gray-50 hover:bg-gray-50/50",children:[e.jsxs(u,{className:"px-6",children:[e.jsxs("p",{className:"font-black",children:["#",a.id]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs(u,{children:[e.jsxs("p",{className:"font-medium",children:[a.user?.firstName," ",a.user?.lastName]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.user?.email})]}),e.jsx(u,{children:e.jsx(M,{variant:"outline",className:"font-black  text-[10px] tracking-widest bg-gray-50",children:a.product?.name})}),e.jsxs(u,{className:"font-black",children:[(a.amount/100).toFixed(2),"€"]}),e.jsx(u,{children:e.jsx(M,{className:`font-black  text-[10px] tracking-tighter ${a.status==="paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:a.status})}),e.jsxs(u,{className:"text-right px-6 space-x-2",children:[e.jsxs(Ye,{value:a.status,onValueChange:N=>c.mutate({id:a.id,status:N}),children:[e.jsx(Je,{className:"w-[120px] h-8 rounded-full text-[10px] font-black ",children:e.jsx(We,{})}),e.jsxs(Xe,{children:[e.jsx(L,{value:"pending",children:"Pendiente"}),e.jsx(L,{value:"paid",children:"Pagado"}),e.jsx(L,{value:"cancelled",children:"Cancelado"}),e.jsx(L,{value:"filed",children:"Presentado"})]})]}),e.jsx(R,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",title:"Ver Factura",onClick:()=>window.open(`/api/admin/invoice/${a.id}`,"_blank"),children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx(R,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",title:"Ver Recibo",onClick:()=>window.open(`/api/orders/${a.id}/receipt`,"_blank"),children:e.jsx(qe,{className:"w-4 h-4"})})]})]},a.id))})]})})]})]}),e.jsxs(U,{value:"users",className:"space-y-8 mt-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-black  text-primary",children:"Gestión de Usuarios"}),e.jsx(R,{className:"bg-accent text-primary font-black rounded-full px-6",onClick:()=>n({title:"Próximamente",description:"La creación de usuarios estará disponible pronto."}),children:"Crear Usuario"})]}),e.jsx(I,{className:"rounded-3xl border-0 shadow-sm overflow-hidden",children:e.jsx(F,{className:"p-0",children:e.jsxs(G,{children:[e.jsx(K,{children:e.jsxs(k,{className:"hover:bg-transparent border-gray-100",children:[e.jsx(d,{className:"font-black  text-xs px-6",children:"ID / Nombre"}),e.jsx(d,{className:"font-black  text-xs",children:"Email"}),e.jsx(d,{className:"font-black  text-xs",children:"Teléfono"}),e.jsx(d,{className:"font-black  text-xs",children:"Rol"}),e.jsx(d,{className:"font-black  text-xs text-right px-6",children:"Acciones"})]})}),e.jsx(V,{children:j?.map(a=>e.jsxs(k,{className:"border-gray-50 hover:bg-gray-50/50",children:[e.jsxs(u,{className:"px-6",children:[e.jsxs("p",{className:"font-black",children:[a.firstName," ",a.lastName]}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-mono",children:a.id})]}),e.jsx(u,{className:"font-medium",children:a.email}),e.jsx(u,{className:"text-sm font-medium",children:a.phone||"N/A"}),e.jsx(u,{children:e.jsx(M,{className:`font-black  text-[10px] ${a.isAdmin?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:a.isAdmin?"Admin":"Cliente"})}),e.jsxs(u,{className:"text-right px-6 space-x-2",children:[e.jsx(R,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",title:"Cambiar Contraseña",onClick:()=>window.open("/api/login?prompt=login","_blank"),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(R,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 text-red-600",title:"Eliminar Usuario",onClick:()=>confirm("¿Seguro que quieres eliminar este usuario?")&&l.mutate(a.id),children:e.jsx(He,{className:"w-4 h-4"})})]})]},a.id))})]})})})]}),e.jsx(U,{value:"messages",className:"space-y-8 mt-0",children:e.jsxs(I,{className:"rounded-3xl border-0 shadow-sm overflow-hidden",children:[e.jsx(S,{className:"bg-white border-b border-gray-100 p-6",children:e.jsx(_,{className:"text-xl font-black",children:"Bandeja de Entrada"})}),e.jsx(F,{className:"p-0",children:e.jsxs(G,{children:[e.jsx(K,{children:e.jsxs(k,{className:"hover:bg-transparent border-gray-100",children:[e.jsx(d,{className:"font-black text-xs px-6",children:"Fecha / Cliente"}),e.jsx(d,{className:"font-black text-xs",children:"Asunto"}),e.jsx(d,{className:"font-black text-xs",children:"Mensaje"}),e.jsx(d,{className:"font-black text-xs",children:"Estado"}),e.jsx(d,{className:"font-black text-xs text-right px-6",children:"Acciones"})]})}),e.jsx(V,{children:H({queryKey:["/api/admin/messages"]}).data?.map(a=>e.jsxs(k,{className:"border-gray-50 hover:bg-gray-50/50",children:[e.jsxs(u,{className:"px-6",children:[e.jsx("p",{className:"font-black",children:a.name||"Cliente"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.createdAt).toLocaleString()})]}),e.jsx(u,{className:"font-medium text-sm",children:a.subject}),e.jsx(u,{className:"max-w-xs truncate text-xs text-muted-foreground",children:a.content}),e.jsx(u,{children:e.jsx(M,{className:`font-black text-[10px] ${a.status==="unread"?"bg-accent text-primary":"bg-gray-100"}`,children:a.status})}),e.jsx(u,{className:"text-right px-6",children:e.jsx(R,{size:"sm",variant:"ghost",onClick:()=>Q("PATCH",`/api/admin/messages/${a.id}/status`,{status:"read"}).then(()=>Y.invalidateQueries({queryKey:["/api/admin/messages"]})),children:e.jsx(Qe,{className:"w-4 h-4"})})})]},a.id))})]})})]})})]})]}),e.jsx(De,{})]})}export{ws as default};
