import{a as u,s as Zt,P as Hs,p as Ae,t as Oe,U as Ea,u as ed,j as e,X as _,v as sd,d as Ze,w as La,C as Ee,x as Te,F as be,W as ft,B as hs,f as ad,c as xs,y as td,z as jt,T as Nt,G as _s,J as vt,K as ka,N as dd,q as Ca,l as Y,O as rd,e as nd,Q as id,V as ld,Y as us,Z as ge,n as yt,i as od,_ as cd,$ as ps,a0 as Bs,a1 as Gs,a2 as es,a3 as ot,a4 as ct,a5 as Aa,D as Sa,a6 as md,L as xd,a7 as ja,m as Na,a8 as mt,a9 as ze,aa as xt,ab as ud,ac as hd,ad as pd,ae as ut,af as ht,ag as gd,ah as bd,ai as fd,aj as jd,ak as Nd,al as vd}from"./react-core-BwXmAyYw.js";import{q as S,a as k,L as Ne,u as yd,b as wd,N as va,F as ya,g as wa}from"./index-Cz-r3V-y.js";import{u as kd}from"./use-page-title-i_VaVI7i.js";import{a as z,b as P}from"./tanstack-Bcy__teF.js";import{q as h,B as n,u as gs,r as Da,s as Ws,t as Xs,v as Z,P as Cd,w as L,o as ve,S as Ad,f as Sd,x as Dd,y as c,I as y,N as U,p as x,z as wt,A as Td,D as kt}from"./ui-components-CnPFRHmO.js";import{u as Le}from"./i18n-DfkNketv.js";import{S as Ed}from"./social-login-xzkNDaZe.js";import"./react-dom-lwpWoMhj.js";import"./pdf-DU6qdRYg.js";import"./radix-ui-BLFq0uWR.js";import"./forms-CNlQlKiB.js";const ms=[{title:"¡Bienvenido a tu espacio personal!",description:"Nos alegra mucho tenerte aquí. Este es tu panel de control, diseñado para que gestiones tu LLC de forma sencilla y sin complicaciones. Todo lo que necesitas está a un clic de distancia.",icon:Zt},{target:'[data-tour="orders"]',title:"El corazón de tu LLC",description:"Aquí encontrarás todos tus trámites activos. Podrás ver el estado de tu formación, descargar documentos importantes como tu EIN y Articles of Organization, y seguir cada paso del proceso en tiempo real.",icon:Hs},{target:'[data-tour="calendar"]',title:"Nunca más olvides una fecha",description:"Sabemos que los plazos fiscales pueden ser confusos. Por eso te mostramos un calendario con todas las fechas importantes: declaraciones del IRS, informes anuales y renovaciones. Te avisamos con tiempo para que estés siempre al día.",icon:Ae},{target:'[data-tour="messages"]',title:"Tu equipo de soporte personal",description:"¿Tienes alguna duda o necesitas ayuda? Escríbenos directamente desde aquí. Nuestro equipo está listo para responderte de forma rápida y personalizada. No estás solo en este proceso.",icon:Oe},{target:'[data-tour="profile"]',title:"Mantén tus datos actualizados",description:"Aquí puedes modificar tu información personal, cambiar tu contraseña y configurar tus preferencias de contacto. Tener tus datos al día nos ayuda a darte un mejor servicio.",icon:Ea},{title:"¡Estás listo para comenzar!",description:"Ya conoces las funciones principales de tu panel. Si en algún momento necesitas ayuda, recuerda que estamos a solo un mensaje de distancia. ¡Mucho éxito con tu LLC!",icon:ed}];function Ld({onComplete:d}){const[r,C]=u.useState(!1),[j,a]=u.useState(0),[N,i]=u.useState(null),p=u.useCallback(()=>{const K=ms[j];if(K.target){const F=document.querySelector(K.target);if(F){i(F.getBoundingClientRect());return}}i(null)},[j]);u.useEffect(()=>{if(localStorage.getItem("dashboard-tour-v4"))return;const F=setTimeout(()=>{C(!0)},800);return()=>clearTimeout(F)},[]),u.useEffect(()=>{if(r)return p(),window.addEventListener("resize",p),window.addEventListener("scroll",p,!0),()=>{window.removeEventListener("resize",p),window.removeEventListener("scroll",p,!0)}},[r,p]);const D=()=>{j<ms.length-1?a(j+1):R()},O=()=>{j>0&&a(j-1)},R=()=>{C(!1),localStorage.setItem("dashboard-tour-v4","true"),d?.()};if(!r)return null;const l=ms[j],T=j===0,v=j===ms.length-1,E=!!l.target&&N,M=l.icon;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9998] transition-opacity duration-300",onClick:R}),E&&e.jsx("div",{className:"fixed z-[9999] rounded-xl ring-4 ring-accent ring-offset-4 ring-offset-background pointer-events-none transition-all duration-300",style:{top:N.top-6,left:N.left-6,width:N.width+12,height:N.height+12}}),e.jsxs(h,{className:`fixed z-[10000] w-[calc(100vw-2rem)] max-w-sm p-5 md:p-6 shadow-2xl border-0 bg-card transition-all duration-300 rounded-2xl ${E?"md:left-auto md:translate-x-0":"left-1/2 -translate-x-1/2 top-20 md:top-24"}`,style:E?{top:Math.min(Math.max(100,N.top),window.innerHeight-320),left:window.innerWidth>=768?Math.min(N.right+24,window.innerWidth-400):"50%",transform:window.innerWidth>=768?"none":"translateX(-50%)",maxHeight:"calc(100dvh - 160px)"}:{maxHeight:"calc(100dvh - 160px)"},children:[e.jsx("button",{onClick:R,className:"absolute top-3 right-3 p-1.5 rounded-full hover:bg-muted transition-colors","data-testid":"button-tour-close",children:e.jsx(_,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex items-start gap-4 mb-5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-accent/10 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{className:"min-w-0 pt-1",children:[e.jsx("h3",{className:"font-black text-foreground text-lg leading-tight",children:l.title}),e.jsx("p",{className:"text-muted-foreground text-sm mt-2 leading-relaxed",children:l.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex gap-1.5",children:ms.map((K,F)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${F===j?"bg-accent":"bg-muted"}`},F))}),e.jsxs("div",{className:"flex gap-2",children:[!T&&e.jsxs(n,{variant:"ghost",size:"sm",onClick:O,className:"h-10 font-semibold","data-testid":"button-tour-prev",children:[e.jsx(sd,{className:"w-4 h-4 mr-1"}),"Atrás"]}),e.jsxs(n,{size:"sm",onClick:D,className:"h-10 font-black bg-accent text-accent-foreground","data-testid":"button-tour-next",children:[v?"¡Empezar!":"Siguiente",!v&&e.jsx(Ze,{className:"w-4 h-4 ml-1"})]})]})]})]})]})}function Ta(d,r){return{pending:{label:r("consultations.status.pending"),className:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300"},confirmed:{label:r("consultations.status.confirmed"),className:"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300"},completed:{label:r("consultations.status.completed"),className:"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"},cancelled:{label:r("consultations.status.cancelled"),className:"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-400"},no_show:{label:r("consultations.status.noShow"),className:"bg-gray-100 dark:bg-muted text-gray-600 dark:text-gray-300"},rescheduled:{label:r("consultations.status.rescheduled"),className:"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"}}[d]||{label:d,className:"bg-gray-100 dark:bg-muted text-gray-600 dark:text-gray-300"}}function Ys(d,r){return{pending:{label:r("dashboard.orders.status.pending"),className:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300"},paid:{label:r("dashboard.orders.status.paid"),className:"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300"},processing:{label:r("dashboard.orders.status.processing"),className:"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"},documents_ready:{label:r("dashboard.orders.status.documents_ready"),className:"bg-cyan-100 dark:bg-cyan-900/50 text-cyan-800 dark:text-cyan-300"},completed:{label:r("dashboard.orders.status.completed"),className:"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"},cancelled:{label:r("dashboard.orders.status.cancelled"),className:"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-400 font-black"},filed:{label:r("dashboard.orders.status.filed"),className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300"},draft:{label:r("dashboard.orders.status.draft"),className:"bg-gray-100 dark:bg-muted text-gray-600 dark:text-gray-300"}}[d]||{label:d,className:"bg-gray-100 dark:bg-muted text-gray-600 dark:text-gray-300"}}function Pd(){const{toast:d}=gs(),{data:r,isLoading:C}=z({queryKey:["/api/newsletter/status"]}),j=P({mutationFn:async a=>{await k("POST",a?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",a?{email:void 0}:void 0)},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/newsletter/status"]}),d({title:"Preferencias actualizadas",description:"Gracias por quedarte con nosotros"})}});return C?e.jsx("div",{className:"w-10 h-6 bg-gray-100 dark:bg-muted animate-pulse rounded-full"}):e.jsx(Da,{checked:r?.isSubscribed,onCheckedChange:a=>j.mutate(a),disabled:j.isPending})}const $d=d=>[{id:"pending",label:d("progress.orderReceived"),icon:La,description:d("progress.orderRegistered")},{id:"paid",label:d("progress.paymentConfirmed"),icon:Ee,description:d("progress.paymentProcessed")},{id:"processing",label:d("progress.processing"),icon:Te,description:d("progress.preparingDocs")},{id:"filed",label:d("progress.filed"),icon:be,description:d("progress.docsSent")},{id:"completed",label:d("progress.llcActive"),icon:hs,description:d("progress.llcOperational")}],Id=d=>[{id:"pending",label:d("progress.requestReceived"),icon:La,description:d("progress.requestRegistered")},{id:"paid",label:d("progress.paymentConfirmed"),icon:Ee,description:d("progress.paymentProcessed")},{id:"processing",label:d("progress.inProcess"),icon:Te,description:d("progress.managingRenewal")},{id:"filed",label:d("progress.filed"),icon:be,description:d("progress.docsUpdated")},{id:"completed",label:d("progress.completed"),icon:ft,description:d("progress.maintenanceComplete")}],qd=["pending","paid","processing","filed","documents_ready","completed"];function Fd({status:d,serviceName:r,state:C,requestCode:j,isMaintenance:a=!1}){const{t:N}=Le(),i=a?Id(N):$d(N),p=qd.indexOf(d),D=p>=0?Math.min((p+1)/i.length*100,100):0,O=l=>d==="cancelled"?"cancelled":p<0?"pending":l<p||l===p&&d==="completed"?"completed":l===p?"current":"pending",R={new_mexico:"New Mexico",wyoming:"Wyoming",delaware:"Delaware","New Mexico":"New Mexico",Wyoming:"Wyoming",Delaware:"Delaware"};return d==="cancelled"?e.jsxs(h,{className:"border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900","data-testid":"widget-cancelled",children:[e.jsx(Ws,{className:"pb-2 p-3 md:p-4",children:e.jsxs(Xs,{className:"text-sm md:text-base flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(ad,{className:"h-4 w-4"}),N("progress.cancelled")]})}),e.jsx(Z,{className:"p-3 pt-0 md:p-4 md:pt-0",children:e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:N("progress.cancelledMessage")})})]}):e.jsxs(h,{className:"overflow-hidden max-w-sm sm:max-w-none mx-auto sm:mx-0","data-testid":`widget-progress-${a?"maintenance":"llc"}`,children:[e.jsxs(Ws,{className:"pb-2 md:pb-3 p-2.5 sm:p-3 md:p-4 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs(Xs,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[a?e.jsx(ft,{className:"h-4 w-4 md:h-5 md:w-5 text-accent"}):e.jsx(hs,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{className:"truncate max-w-[180px] md:max-w-none",children:r||N(a?"progress.maintenance":"progress.yourLLC")})]}),C&&e.jsx("span",{className:"text-[10px] md:text-xs bg-muted px-2 py-0.5 md:py-1 rounded-md font-medium shrink-0",children:R[C]||C})]}),j&&e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:[N("progress.reference"),": ",j]})]}),e.jsxs(Z,{className:"p-2.5 sm:p-3 md:p-4 space-y-2.5 sm:space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 md:space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] md:text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:N("progress.progressLabel")}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(D),"%"]})]}),e.jsx(Cd,{value:D,className:"h-1.5 md:h-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[9px] md:left-[11px] top-5 md:top-6 bottom-5 md:bottom-6 w-0.5 bg-border"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:i.map((l,T)=>{const v=O(T),E=l.icon;return e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 relative",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-5 h-5 md:w-6 md:h-6 rounded-full border-2 transition-colors shrink-0
                    ${v==="completed"?"bg-primary border-primary text-primary-foreground":v==="current"?"bg-primary/10 border-primary text-primary animate-pulse":"bg-background border-muted-foreground/30 text-muted-foreground"}
                  `,children:v==="completed"?e.jsx(Ee,{className:"h-2.5 w-2.5 md:h-3.5 md:w-3.5"}):e.jsx(E,{className:"h-2.5 w-2.5 md:h-3 md:w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0 pb-1 md:pb-2",children:[e.jsx("p",{className:`text-xs md:text-sm font-medium leading-tight ${v==="completed"?"text-foreground":v==="current"?"text-primary font-bold":"text-muted-foreground"}`,children:l.label}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5 leading-tight hidden sm:block",children:l.description})]})]},l.id)})})]})]})]})}function Qs(d){return d?new Date(d).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-"}function Md(d,r){switch(d){case"active":return e.jsxs(L,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-[9px]","data-testid":"badge-agent-active",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.agentActive")]});case"pending_renewal":return e.jsxs(L,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 text-[9px]","data-testid":"badge-agent-pending",children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.agentPendingRenewal")]});case"expired":return e.jsxs(L,{className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 text-[9px]","data-testid":"badge-agent-expired",children:[e.jsx(Nt,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.agentExpired")]});default:return e.jsx(L,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400 text-[9px]","data-testid":"badge-agent-unknown",children:r("dashboard.llcDetails.agentPending")})}}function Ud(d,r){switch(d){case"filed":return e.jsxs(L,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-[9px]","data-testid":"badge-boi-filed",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.boiFiled")]});case"update_required":return e.jsxs(L,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 text-[9px]","data-testid":"badge-boi-update",children:[e.jsx(Nt,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.boiUpdateRequired")]});case"exempt":return e.jsxs(L,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 text-[9px]","data-testid":"badge-boi-exempt",children:[e.jsx(_s,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.boiExempt")]});default:return e.jsxs(L,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400 text-[9px]","data-testid":"badge-boi-pending",children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),r("dashboard.llcDetails.boiPending")]})}}function Rd({orders:d,draftOrders:r,activeOrders:C}){const{t:j}=Le(),a=d?.filter(i=>i.status==="completed"&&i.application)||[],N=d?.filter(i=>i.status!=="completed"&&i.status!=="pending")||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:j("dashboard.services.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j("dashboard.services.subtitle")})]}),r.map(i=>{const p=i.application?.abandonedAt||i.maintenanceApplication?.abandonedAt,D=p?Math.max(0,Math.round(48-(Date.now()-new Date(p).getTime())/36e5)):null;return e.jsxs("div",{className:"rounded-2xl shadow-md bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 overflow-hidden flex","data-testid":`banner-pending-application-${i.id}`,children:[e.jsx("div",{className:"w-1 bg-yellow-500 flex-shrink-0"}),e.jsx("div",{className:"p-4 md:p-5 flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 dark:bg-yellow-900/50 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(xs,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-semibold text-foreground",children:j("dashboard.services.pendingApplication")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[i.maintenanceApplication?`${j("dashboard.services.maintenance")} ${i.maintenanceApplication.state||""}`:i.application?.companyName?`${i.application.companyName} LLC`:`${i.application?.state||j("dashboard.services.yourLLC")}`,D!==null&&e.jsxs("span",{className:"text-yellow-600 dark:text-yellow-400 font-semibold ml-2",children:["· ",j("dashboard.services.deletedIn",{hours:D})]})]})]})]}),e.jsx(Ne,{href:i.maintenanceApplication?"/llc/maintenance":"/llc/formation","data-testid":`link-continue-application-${i.id}`,children:e.jsxs(n,{className:"bg-accent text-primary font-bold rounded-full",size:"sm","data-testid":`button-continue-application-${i.id}`,children:[j("dashboard.services.continueApplication"),e.jsx(Ze,{className:"w-4 h-4 ml-1"})]})})]})})]},`draft-banner-${i.id}`)}),!d||d.length===0?e.jsx(h,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-card p-6 md:p-8 text-center","data-testid":"card-empty-services",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx(Hs,{className:"w-12 h-12 md:w-16 md:h-16 text-accent"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center","data-testid":"text-empty-title",children:j("dashboard.services.empty")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center","data-testid":"text-empty-description",children:j("dashboard.services.emptyDescription")})]}),e.jsx(Ne,{href:"/servicios#pricing","data-testid":"link-view-plans",children:e.jsx(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-view-packs",children:j("dashboard.services.viewPlans")})})]})}):e.jsxs(e.Fragment,{children:[a.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-foreground flex items-center gap-2",children:[e.jsx(hs,{className:"w-4 h-4 text-accent"}),j("dashboard.llcDetails.myLLCs")]}),a.map(i=>{const p=i.application;return e.jsxs(h,{className:"rounded-2xl border-0 shadow-md bg-white dark:bg-card overflow-hidden","data-testid":`card-completed-llc-${i.id}`,children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 border-b border-green-100 dark:border-green-900/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ee,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("h4",{className:"text-lg font-bold text-foreground","data-testid":`text-company-name-${i.id}`,children:[p.companyName," LLC"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-llc-info-${i.id}`,children:[e.jsx("span",{"data-testid":`text-state-${i.id}`,children:p.state})," · ",j("dashboard.llcDetails.orderCode"),": ",e.jsx("span",{"data-testid":`text-order-code-${i.id}`,children:p.requestCode})]})]}),e.jsx(L,{className:"bg-green-500 text-white font-bold text-xs self-start sm:self-auto","data-testid":`badge-completed-${i.id}`,children:j("dashboard.llcDetails.active")})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[p.ein&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50","data-testid":`llc-ein-${i.id}`,children:[e.jsx(be,{className:"w-4 h-4 text-accent mt-0.5 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase font-bold",children:j("dashboard.llcDetails.ein")}),e.jsx("p",{className:"text-sm font-bold text-foreground",children:p.ein})]})]}),p.registrationNumber&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50","data-testid":`llc-registration-${i.id}`,children:[e.jsx(be,{className:"w-4 h-4 text-accent mt-0.5 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase font-bold",children:j("dashboard.llcDetails.registrationNumber")}),e.jsx("p",{className:"text-sm font-bold text-foreground",children:p.registrationNumber})]})]}),p.llcAddress&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50 sm:col-span-2","data-testid":`llc-address-${i.id}`,children:[e.jsx(td,{className:"w-4 h-4 text-accent mt-0.5 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase font-bold",children:j("dashboard.llcDetails.address")}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:p.llcAddress})]})]}),p.ownerSharePercentage&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50","data-testid":`llc-shares-${i.id}`,children:[e.jsx(jt,{className:"w-4 h-4 text-accent mt-0.5 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase font-bold",children:j("dashboard.llcDetails.ownership")}),e.jsxs("p",{className:"text-sm font-bold text-foreground",children:[p.ownerSharePercentage,"%"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[j("dashboard.llcDetails.registeredAgent"),":"]}),Md(p.agentStatus,j)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[j("dashboard.llcDetails.boi"),":"]}),Ud(p.boiStatus,j)]})]}),(p.llcCreatedDate||p.agentRenewalDate||p.irs1120DueDate)&&e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("p",{className:"text-[10px] text-muted-foreground uppercase font-bold mb-2 flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),j("dashboard.llcDetails.importantDates")]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[p.llcCreatedDate&&e.jsxs("div",{"data-testid":`date-created-${i.id}`,children:[e.jsx("p",{className:"text-muted-foreground",children:j("dashboard.llcDetails.formed")}),e.jsx("p",{className:"font-semibold text-foreground",children:Qs(p.llcCreatedDate)})]}),p.agentRenewalDate&&e.jsxs("div",{"data-testid":`date-agent-${i.id}`,children:[e.jsx("p",{className:"text-muted-foreground",children:j("dashboard.llcDetails.agentRenewal")}),e.jsx("p",{className:"font-semibold text-foreground",children:Qs(p.agentRenewalDate)})]}),p.irs1120DueDate&&e.jsxs("div",{"data-testid":`date-irs1120-${i.id}`,children:[e.jsx("p",{className:"text-muted-foreground",children:"IRS 1120"}),e.jsx("p",{className:"font-semibold text-foreground",children:Qs(p.irs1120DueDate)})]}),p.annualReportDueDate&&e.jsxs("div",{"data-testid":`date-annual-${i.id}`,children:[e.jsx("p",{className:"text-muted-foreground",children:j("dashboard.llcDetails.annualReport")}),e.jsx("p",{className:"font-semibold text-foreground",children:Qs(p.annualReportDueDate)})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[e.jsx(Ne,{href:"/dashboard?tab=documents",children:e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs rounded-full","data-testid":`button-documents-${i.id}`,children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),j("dashboard.llcDetails.myDocuments")]})}),p.ein&&e.jsx(Ne,{href:"/tools/operating-agreement",children:e.jsx(n,{variant:"outline",size:"sm",className:"text-xs rounded-full","data-testid":`button-operating-${i.id}`,children:j("dashboard.llcDetails.generateAgreement")})})]})]})]},`completed-${i.id}`)})]}),N.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs md:text-sm font-bold text-muted-foreground",children:j("dashboard.services.inProgress")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:N.map(i=>e.jsx(Fd,{status:i.status,serviceName:i.maintenanceApplication?`${j("dashboard.services.maintenance")} ${i.maintenanceApplication.state||i.product?.name?.replace(" LLC","")||""}`:i.application?.companyName?`${i.application.companyName} LLC`:i.product?.name||j("dashboard.services.yourLLC"),state:i.application?.state||i.maintenanceApplication?.state,requestCode:i.application?.requestCode||i.maintenanceApplication?.requestCode||i.invoiceNumber,isMaintenance:!!i.maintenanceApplication},`progress-${i.id}`))})]}),d&&d.length>0&&e.jsxs("div",{className:"mt-4 md:mt-6",children:[e.jsx("h3",{className:"text-xs md:text-sm font-bold text-muted-foreground mb-2 md:mb-3",children:j("dashboard.services.allOrders")}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:d.map(i=>e.jsx(h,{className:"rounded-lg md:rounded-xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-card overflow-hidden","data-testid":`card-order-${i.id}`,children:e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5 flex-wrap",children:[e.jsx("p",{className:"text-[9px] md:text-[10px] font-bold text-accent uppercase tracking-wider",children:i.application?.requestCode||i.maintenanceApplication?.requestCode||i.invoiceNumber||`#${i.id}`}),e.jsx(L,{className:`${Ys(i.status,j).className} font-bold uppercase text-[8px] md:text-[9px] px-1.5 py-0`,"data-testid":`badge-order-status-${i.id}`,children:Ys(i.status,j).label}),i.status==="completed"&&i.application?.ein&&e.jsxs(L,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 text-[8px] px-1.5 py-0","data-testid":`badge-ein-${i.id}`,children:["EIN: ",i.application.ein]})]}),e.jsx("p",{className:"text-sm md:text-base font-bold text-primary truncate",children:i.maintenanceApplication?`${j("dashboard.services.maintenance")} ${i.maintenanceApplication.state||""}`:i.application?.companyName?`${i.application.companyName} LLC`:i.product?.name||j("dashboard.services.pendingLLC")}),e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:[i.application?.state||i.maintenanceApplication?.state||"",i.createdAt&&` · ${new Date(i.createdAt).toLocaleDateString("es-ES")}`]})]}),i.status==="pending"&&i.application&&e.jsx(n,{variant:"outline",size:"sm",className:"text-[9px] md:text-[10px] h-7 md:h-8 px-2 md:px-3 rounded-full font-bold shrink-0",onClick:()=>window.location.href=`/llc/formation?edit=${i.application.id}`,"data-testid":`button-modify-order-${i.id}`,children:j("dashboard.services.modify")})]})},i.id))})]})]})]},"services")}function zd({notifications:d,notificationsLoading:r,user:C,markNotificationRead:j,deleteNotification:a,setActiveTab:N}){const{t:i}=Le();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:i("dashboard.notifications.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i("dashboard.tracking.subtitle")})]}),r?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(p=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},p))}):d?.length===0?e.jsx(h,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-card p-6 md:p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx(vt,{className:"w-12 h-12 md:w-16 md:h-16 text-accent"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:i("dashboard.notifications.empty")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground text-center",children:i("dashboard.tracking.subtitle")})]})]})}):e.jsx("div",{className:"space-y-3",children:d?.map(p=>e.jsx(h,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${p.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(Z,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[p.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:[i("dashboard.orders.order"),": ",p.orderCode]}),p.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:i("dashboard.notifications.actionRequired")}),p.type==="update"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:i("dashboard.notifications.update")}),p.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-muted text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full font-black",children:i("dashboard.notifications.info")}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(p.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:p.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p.message}),p.type==="action_required"&&C?.accountStatus!=="deactivated"&&e.jsxs(n,{className:"mt-3 bg-accent text-accent-foreground font-semibold rounded-full text-xs px-4 gap-2",onClick:()=>{j.mutate(p.id),N("documents")},"data-testid":`button-upload-document-${p.id}`,children:[e.jsx(ka,{className:"w-3 h-3"}),i("dashboard.documents.upload")]})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"flex-shrink-0 h-8 w-8 text-muted-foreground hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full",onClick:()=>a.mutate(p.id),disabled:a.isPending,"data-testid":`button-delete-notification-${p.id}`,children:e.jsx(_,{className:"w-4 h-4"})})]})})},p.id))})]},"notifications")}function Od({messagesData:d,selectedMessage:r,setSelectedMessage:C,replyContent:j,setReplyContent:a,sendReplyMutation:N}){const{t:i}=Le();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:i("dashboard.support.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i("dashboard.support.subtitle")})]}),e.jsx("a",{href:"https://wa.me/34614916910?text=Hola!%20Soy%20cliente%20de%20Easy%20US%20LLC%20y%20tengo%20una%20consulta%20sobre%20mi%20cuenta.%20%C2%BFPodr%C3%ADais%20ayudarme%3F",target:"_blank",rel:"noopener noreferrer",children:e.jsx(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full text-xs",children:i("dashboard.support.newQuery")})})]})}),e.jsx("div",{className:"space-y-4",children:!d||d.length===0?e.jsx(h,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-card p-6 md:p-8 text-center","data-testid":"widget-support-empty",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx(dd,{className:"w-12 h-12 md:w-16 md:h-16 text-accent"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:i("dashboard.support.empty")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:i("dashboard.support.emptyDescription")})]}),e.jsx("a",{href:"https://wa.me/34614916910?text=Hola!%20Soy%20cliente%20de%20Easy%20US%20LLC%20y%20tengo%20una%20consulta%20sobre%20mi%20cuenta.%20%C2%BFPodr%C3%ADais%20ayudarme%3F",target:"_blank",rel:"noopener noreferrer",children:e.jsxs(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-support-whatsapp",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"})," ",i("dashboard.support.newQuery")]})})]})}):d.map(p=>e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-card hover:shadow-md transition-shadow cursor-pointer",onClick:()=>C(r?.id===p.id?null:p),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-semibold text-foreground",children:p.subject||i("dashboard.support.noSubject")})]}),e.jsxs(n,{variant:"ghost",size:"sm",className:"text-accent hover:text-accent/80 text-xs px-2 h-7",onClick:D=>{D.stopPropagation(),C(r?.id===p.id?null:p)},children:[e.jsx(Ca,{className:"w-3 h-3 mr-1"})," ",i("dashboard.support.view")]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:p.content}),r?.id===p.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-border space-y-4",onClick:D=>D.stopPropagation(),children:[p.replies&&p.replies.length>0&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:i("dashboard.support.replies")}),p.replies.map((D,O)=>e.jsxs("div",{className:`p-3 rounded-xl text-sm ${D.isFromAdmin?"bg-accent/10 border-l-2 border-accent":"bg-muted/50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-foreground",children:D.isFromAdmin?i("dashboard.support.teamEasyUS"):i("dashboard.support.you")}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(D.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-muted-foreground",children:D.content})]},O))]}),e.jsx(ve,{value:j,onChange:D=>a(D.target.value),placeholder:i("dashboard.support.replyPlaceholder"),className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-user-reply"}),e.jsxs(n,{onClick:()=>N.mutate(p.id),disabled:!j.trim()||N.isPending,className:"bg-accent text-accent-foreground font-semibold rounded-full px-6","data-testid":"button-user-send-reply",children:[N.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin mr-2"}):null,i("dashboard.support.sendReply")]})]})]},p.id))})]},"messages")}function Vd({user:d,canEdit:r,isEditing:C,setIsEditing:j,profileData:a,setProfileData:N,updateProfile:i,showPasswordForm:p,setShowPasswordForm:D,passwordStep:O,setPasswordStep:R,currentPassword:l,setCurrentPassword:T,newPassword:v,setNewPassword:E,confirmPassword:M,setConfirmPassword:K,passwordOtp:F,setPasswordOtp:te,requestPasswordOtpMutation:W,changePasswordMutation:ee,setShowEmailVerification:fe,setDeleteOwnAccountDialog:ce,profileOtpStep:de,setProfileOtpStep:re,profileOtp:ie,setProfileOtp:f,confirmProfileWithOtp:B}){const[g,I]=u.useState(!1),{t:m,i18n:je}=Le(),me=[{code:"es",label:"Español",Flag:Ad},{code:"en",label:"English",Flag:Sd},{code:"ca",label:"Català",Flag:Dd}],xe=je.language?.split("-")[0]||"es";me.find(A=>A.code===xe)||me[0];const ye=async A=>{je.changeLanguage(A),localStorage.setItem("i18nextLng",A);try{await i.mutateAsync({...a,preferredLanguage:A})}catch(o){console.error("Error saving language preference:",o)}},ss=()=>{const A=d?.clientId||d?.id?.slice(0,8).toUpperCase()||"";navigator.clipboard.writeText(A),I(!0),setTimeout(()=>I(!1),2e3)},le="rounded-full h-11 px-5 border-2 border-gray-200 dark:border-border focus:border-accent bg-white dark:bg-muted transition-colors font-medium text-foreground text-sm",ne="rounded-full h-11 px-5 border-2 border-gray-200 dark:border-border bg-white dark:bg-muted",H="p-2.5 bg-gray-50 dark:bg-muted rounded-lg text-sm";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-2 md:mb-4",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:m("profile.title","Mi Perfil")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:m("profile.subtitle","Tus datos personales y configuración de cuenta")})]}),de==="otp"&&e.jsxs(h,{className:"rounded-2xl border-accent/30 shadow-md p-5 md:p-6 bg-white dark:bg-card animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(rd,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-foreground",children:m("profile.otpRequired","Verificación requerida")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m("profile.otpRequiredDesc","Hemos enviado un código de 6 dígitos a tu email para confirmar los cambios.")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground mb-1 block",children:m("dashboard.profile.verificationCode","Código de verificación")}),e.jsx(y,{type:"text",value:ie,onChange:A=>f(A.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-lg tracking-[0.3em] font-mono",maxLength:6,inputMode:"numeric",placeholder:"------","data-testid":"input-profile-otp"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{re("idle"),f("")},"data-testid":"button-cancel-profile-otp",children:m("common.cancel","Cancelar")}),e.jsx(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full flex-1",onClick:()=>B.mutate(),disabled:ie.length!==6||B.isPending,"data-testid":"button-confirm-profile-otp",children:B.isPending?m("common.saving","Guardando..."):m("common.confirm","Confirmar")})]})]})]}),e.jsxs(h,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-5 md:p-6 bg-white dark:bg-card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground",children:m("profile.personalData","Datos Personales")}),r&&e.jsx(n,{variant:"ghost",size:"sm",className:"rounded-full",onClick:()=>{j(!C),C&&re("idle")},"data-testid":"button-toggle-edit",children:C?m("common.cancel","Cancelar"):m("common.edit","Editar")})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:m("profile.infoDescription","Esta información nos permite acompañarte mejor y cumplir con los requisitos legales cuando sea necesario.")}),!r&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${d?.accountStatus==="pending"?"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:e.jsx("p",{className:`text-sm ${d?.accountStatus==="pending"?"text-orange-700 dark:text-orange-400":"text-red-700 dark:text-red-400"}`,children:d?.accountStatus==="pending"?m("dashboard.accountStatus.pendingReview.message","Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada."):m("dashboard.accountStatus.deactivated.message","Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes.")})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-0.5",children:m("profile.clientId","ID Cliente")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base font-black font-mono",children:d?.clientId||d?.id?.slice(0,8).toUpperCase()}),e.jsx(n,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full",onClick:ss,"data-testid":"button-copy-client-id",title:m("common.copy","Copiar"),children:g?e.jsx(nd,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(id,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"p-3 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-0.5",children:m("profile.status","Estado")}),e.jsx("p",{className:`text-base font-black ${d?.accountStatus==="active"?"text-green-600":d?.accountStatus==="pending"?"text-orange-500":d?.accountStatus==="deactivated"?"text-red-600":d?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:d?.accountStatus==="active"?m("profile.statusValues.verified","Verificado"):d?.accountStatus==="pending"?m("profile.statusValues.pending","En revisión"):d?.accountStatus==="deactivated"?m("profile.statusValues.deactivated","Desactivada"):d?.accountStatus==="vip"?m("profile.statusValues.vip","VIP"):m("profile.statusValues.verified","Verificado")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.firstName","Nombre")}),C&&r?e.jsx(y,{value:a.firstName,onChange:A=>N({...a,firstName:A.target.value}),placeholder:m("profile.placeholders.firstName","Tu nombre real"),className:le,"data-testid":"input-firstname"}):e.jsx("div",{className:H,children:d?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.lastName","Apellidos")}),C&&r?e.jsx(y,{value:a.lastName,onChange:A=>N({...a,lastName:A.target.value}),placeholder:m("profile.placeholders.lastName","Tal y como aparecen en tu documento"),className:le,"data-testid":"input-lastname"}):e.jsx("div",{className:H,children:d?.lastName||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:"Email"}),e.jsxs("div",{className:"p-2.5 bg-gray-50 dark:bg-muted rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{className:"truncate",children:d?.email}),d?.emailVerified?e.jsx(Ee,{className:"w-4 h-4 text-green-500 shrink-0"}):e.jsx(n,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black shrink-0",onClick:()=>fe(!0),"data-testid":"button-verify-email",children:m("profile.verifyEmail","Verificar")})]}),!d?.emailVerified&&e.jsx("p",{className:"text-[10px] text-orange-600 dark:text-orange-400",children:m("dashboard.accountStatus.pendingReview.description","Tu cuenta está en revisión hasta que verifiques tu email.")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.phone","Teléfono")}),C&&r?e.jsx(y,{value:a.phone,onChange:A=>N({...a,phone:A.target.value}),placeholder:m("profile.placeholders.phone","Para contactarte si es necesario"),className:le,"data-testid":"input-phone"}):e.jsx("div",{className:H,children:d?.phone||m("profile.notProvided","No proporcionado")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.idType","Tipo de documento")}),C&&r?e.jsxs(U,{value:a.idType,onValueChange:A=>N({...a,idType:A}),placeholder:m("profile.placeholders.idType","DNI · NIE · Pasaporte"),className:ne,"data-testid":"select-idtype",children:[e.jsx(x,{value:"dni",children:"DNI"}),e.jsx(x,{value:"nie",children:"NIE"}),e.jsx(x,{value:"passport",children:m("profile.idTypes.passport","Pasaporte")})]}):e.jsx("div",{className:H,children:d?.idType==="dni"?"DNI":d?.idType==="nie"?"NIE":d?.idType==="passport"?m("profile.idTypes.passport","Pasaporte"):m("profile.notProvided","No proporcionado")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.idNumber","Número de documento")}),C&&r?e.jsx(y,{value:a.idNumber,onChange:A=>N({...a,idNumber:A.target.value}),placeholder:m("profile.placeholders.idNumber","Documento de identificación"),className:le,"data-testid":"input-idnumber"}):e.jsx("div",{className:H,children:d?.idNumber||m("profile.notProvided","No proporcionado")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.birthDate","Fecha de nacimiento")}),C&&r?e.jsx(y,{type:"date",value:a.birthDate,onChange:A=>N({...a,birthDate:A.target.value}),className:le,"data-testid":"input-birthdate"}):e.jsx("div",{className:H,children:d?.birthDate||m("profile.notProvided","No proporcionado")})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.businessActivity","Actividad profesional")}),C&&r?e.jsxs(U,{value:a.businessActivity,onValueChange:A=>N({...a,businessActivity:A}),placeholder:m("profile.placeholders.businessActivity","A qué te dedicas"),className:ne,"data-testid":"select-activity",children:[e.jsx(x,{value:"ecommerce",children:m("auth.register.businessActivities.ecommerce","E-commerce")}),e.jsx(x,{value:"dropshipping",children:m("auth.register.businessActivities.dropshipping","Dropshipping")}),e.jsx(x,{value:"consulting",children:m("auth.register.businessActivities.consulting","Consultoría")}),e.jsx(x,{value:"marketing",children:m("auth.register.businessActivities.marketing","Marketing Digital")}),e.jsx(x,{value:"software",children:m("auth.register.businessActivities.software","Desarrollo de Software")}),e.jsx(x,{value:"trading",children:m("auth.register.businessActivities.investments","Trading / Inversiones")}),e.jsx(x,{value:"freelance",children:m("auth.register.businessActivities.freelance","Freelance")}),e.jsx(x,{value:"other",children:m("auth.register.businessActivities.other","Otra")})]}):e.jsx("div",{className:H,children:d?.businessActivity||m("profile.notProvided","No proporcionado")})]})}),e.jsxs("div",{className:"pt-3 border-t border-border",children:[e.jsx("h4",{className:"font-bold text-sm mb-2",children:m("profile.sections.residenceAddress","Dirección de residencia")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.streetType","Tipo de vía")}),C&&r?e.jsxs(U,{value:a.streetType,onValueChange:A=>N({...a,streetType:A}),placeholder:m("profile.placeholders.streetType","Calle · Avenida · Paseo · Plaza"),className:ne,"data-testid":"select-street-type",children:[e.jsx(x,{value:"calle",children:m("profile.streetTypes.street","Calle")}),e.jsx(x,{value:"avenida",children:m("profile.streetTypes.avenue","Avenida")}),e.jsx(x,{value:"paseo",children:m("profile.streetTypes.promenade","Paseo")}),e.jsx(x,{value:"plaza",children:m("profile.streetTypes.square","Plaza")})]}):e.jsx("div",{className:H,children:d?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.address","Dirección")}),C&&r?e.jsx(y,{value:a.address,onChange:A=>N({...a,address:A.target.value}),placeholder:m("profile.placeholders.address","Calle y número"),className:le}):e.jsx("div",{className:H,children:d?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.city","Ciudad")}),C&&r?e.jsx(y,{value:a.city,onChange:A=>N({...a,city:A.target.value}),placeholder:m("profile.placeholders.city","Ciudad"),className:le}):e.jsx("div",{className:H,children:d?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.province","Provincia")}),C&&r?e.jsx(y,{value:a.province,onChange:A=>N({...a,province:A.target.value}),placeholder:m("profile.placeholders.province","Provincia"),className:le}):e.jsx("div",{className:H,children:d?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.postalCode","C.P.")}),C&&r?e.jsx(y,{value:a.postalCode,onChange:A=>N({...a,postalCode:A.target.value}),placeholder:m("profile.placeholders.postalCode","C.P."),className:le}):e.jsx("div",{className:H,children:d?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs font-bold text-muted-foreground",children:m("profile.fields.country","País")}),C&&r?e.jsx(y,{value:a.country,onChange:A=>N({...a,country:A.target.value}),placeholder:m("profile.placeholders.country","País"),className:le}):e.jsx("div",{className:H,children:d?.country||"-"})]})]})]}),C&&r&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(n,{onClick:()=>i.mutate(a),className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-11 transition-colors",disabled:i.isPending,"data-testid":"button-save-profile",children:i.isPending?m("common.saving","Guardando..."):m("profile.saveChanges","Guardar cambios")}),e.jsx("p",{className:"text-[10px] text-center text-muted-foreground",children:m("profile.reviewNote","Nuestro equipo revisará cualquier cambio antes de avanzar para asegurarnos de que todo esté correcto.")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-5 bg-white dark:bg-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-foreground",children:m("profile.newsletter.title","Suscripción Newsletter")}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:m("profile.newsletter.description","Recibe noticias y consejos para tu LLC.")})]}),e.jsx(Pd,{})]})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-5 bg-white dark:bg-card",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm text-foreground flex items-center gap-1.5",children:[e.jsx(ld,{className:"w-3.5 h-3.5"}),m("profile.language.title","Idioma preferido")]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:m("profile.language.description","Selecciona el idioma de la plataforma y documentos.")})]}),e.jsx("div",{className:"flex gap-1.5",children:me.map(A=>e.jsxs(n,{variant:xe===A.code?"default":"outline",size:"sm",className:`rounded-full h-9 px-3 flex items-center gap-1.5 transition-colors ${xe===A.code?"bg-accent text-primary shadow-md ring-2 ring-accent/50":"bg-white dark:bg-muted border border-border"}`,onClick:()=>ye(A.code),"data-testid":`button-language-${A.code}`,children:[e.jsx(A.Flag,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline text-xs font-medium",children:A.label})]},A.code))})]})})]}),e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-5 bg-white dark:bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-foreground",children:m("profile.changePassword.title","Cambiar Contraseña")}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:m("profile.changePassword.description","Actualiza tu contraseña de acceso.")})]}),!p&&e.jsx(n,{variant:"outline",size:"sm",className:"rounded-full",onClick:()=>D(!0),"data-testid":"button-show-password-form",children:m("common.change","Cambiar")})]}),p&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-muted rounded-xl",children:[O==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:m("profile.currentPassword","Contraseña actual")}),e.jsx(y,{type:"password",value:l,onChange:A=>T(A.target.value),className:"rounded-full","data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:m("profile.newPassword","Nueva contraseña")}),e.jsx(y,{type:"password",value:v,onChange:A=>E(A.target.value),className:"rounded-full","data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:m("profile.confirmNewPassword","Confirmar nueva contraseña")}),e.jsx(y,{type:"password",value:M,onChange:A=>K(A.target.value),className:"rounded-full","data-testid":"input-confirm-password"})]})]}),v&&M&&v!==M&&e.jsx("p",{className:"text-xs text-red-500",children:m("profile.passwordMismatch","Las contraseñas no coinciden")}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(n,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{D(!1),T(""),E(""),K("")},children:m("common.cancel","Cancelar")}),e.jsx(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full flex-1",onClick:()=>W.mutate(),disabled:!l||!v||v!==M||v.length<8||W.isPending,"data-testid":"button-request-otp",children:W.isPending?m("common.sending","Enviando..."):m("profile.sendCode","Enviar código")})]})]}),O==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(us,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m("profile.enterCode","Ingresa el código de 6 dígitos enviado a tu email")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:m("dashboard.profile.verificationCode","Código de verificación")}),e.jsx(y,{type:"text",value:F,onChange:A=>te(A.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-lg tracking-[0.3em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(n,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{R("form"),te("")},children:m("common.back","Volver")}),e.jsx(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full flex-1",onClick:()=>ee.mutate({currentPassword:l,newPassword:v,otp:F}),disabled:F.length!==6||ee.isPending,"data-testid":"button-save-password",children:ee.isPending?m("common.saving","Guardando..."):m("common.confirm","Confirmar")})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-5 bg-white dark:bg-card",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-foreground",children:m("profile.connectedAccounts.title","Cuentas Conectadas")}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:m("profile.connectedAccounts.description","Vincula tus cuentas sociales para iniciar sesión más rápido.")})]}),e.jsx(Ed,{mode:"connect",googleConnected:!!d?.googleId,onSuccess:()=>S.refetchQueries({queryKey:["/api/auth/user"]})})]}),r&&e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-5 bg-white dark:bg-card",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 dark:text-red-400 text-sm",children:m("dashboard.profile.deleteAccount","Eliminar Cuenta")}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:m("profile.deleteAccountDesc","Esta acción es irreversible. Se eliminarán todos tus datos.")})]}),e.jsxs(n,{variant:"outline",size:"sm",className:"border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 rounded-full shrink-0",onClick:()=>ce(!0),"data-testid":"button-delete-own-account",children:[e.jsx(ge,{className:"w-3.5 h-3.5 mr-1"})," ",e.jsx("span",{className:"hidden sm:inline",children:m("common.delete","Eliminar")})]})]})})]})]},"profile")}function Kd({setActiveTab:d}){const{t:r,i18n:C}=Le(),{toast:j}=gs(),[a,N]=u.useState(!1),[i,p]=u.useState(null),[D,O]=u.useState(""),[R,l]=u.useState(""),[T,v]=u.useState({hasLlc:"",llcState:"",estimatedRevenue:"",countryOfResidence:"",mainTopic:"",additionalNotes:""}),{data:E=[]}=z({queryKey:["/api/consultations/types"]}),{data:M=[]}=z({queryKey:["/api/consultations/my"]}),{data:K}=z({queryKey:["/api/consultations/availability",D],queryFn:async()=>(await k("GET",`/api/consultations/availability?date=${D}`)).json(),enabled:!!D}),F=P({mutationFn:async f=>await k("POST","/api/consultations/book",f),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/consultations/my"]}),j({title:r("consultations.bookingSuccess"),description:r("consultations.bookingSuccessDesc")}),N(!1),W()},onError:f=>{j({title:r("consultations.bookingError"),description:f.message,variant:"destructive"})}}),te=P({mutationFn:async f=>await k("PATCH",`/api/consultations/${f}/cancel`,{reason:"Cancelled by user"}),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/consultations/my"]}),j({title:r("consultations.cancelSuccess")})},onError:f=>{j({title:r("consultations.cancelError"),description:f.message,variant:"destructive"})}}),W=()=>{p(null),O(""),l(""),v({hasLlc:"",llcState:"",estimatedRevenue:"",countryOfResidence:"",mainTopic:"",additionalNotes:""})},ee=f=>{const B=C.language;return B==="es"?f.nameEs:B==="ca"?f.nameCa:f.nameEn},fe=()=>{if(!i||!D||!R){j({title:r("consultations.selectAll"),variant:"destructive"});return}F.mutate({consultationTypeId:i.id,scheduledDate:D,scheduledTime:R,...T})},ce=M.filter(f=>["pending","confirmed"].includes(f.booking.status)&&new Date(f.booking.scheduledDate)>=new Date),de=M.filter(f=>!["pending","confirmed"].includes(f.booking.status)||new Date(f.booking.scheduledDate)<new Date),re=f=>new Date(f).toLocaleDateString(C.language,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),ie=()=>{const f=new Date;return f.setDate(f.getDate()+1),f.toISOString().split("T")[0]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black tracking-tight",children:r("consultations.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r("consultations.subtitle")})]}),e.jsxs(n,{onClick:()=>N(!a),className:"bg-accent text-primary font-black rounded-full","data-testid":"button-book-consultation",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),r("consultations.bookNew"),a?e.jsx(yt,{className:"w-4 h-4 ml-2"}):e.jsx(od,{className:"w-4 h-4 ml-2"})]})]}),e.jsxs(wt,{open:a,onOpenChange:N,children:[e.jsx(Td,{asChild:!0,className:"sr-only",children:e.jsx("button",{"aria-label":r("consultations.bookNew")})}),e.jsx(kt,{children:e.jsxs(h,{className:"border-2 border-accent/20 bg-accent/5 dark:bg-accent/10",children:[e.jsxs(Ws,{className:"pb-2",children:[e.jsx(Xs,{className:"text-lg font-black",children:r("consultations.bookNew")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r("consultations.bookingDescription")})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"font-bold text-sm",children:r("consultations.selectType")}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:E.map(f=>e.jsx(n,{variant:i?.id===f.id?"default":"outline",className:`justify-start h-auto py-3 px-4 rounded-xl ${i?.id===f.id?"bg-accent text-primary border-accent":"bg-white dark:bg-card"}`,onClick:()=>p(f),"data-testid":`button-select-type-${f.id}`,children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:ee(f)}),e.jsxs("div",{className:"text-xs opacity-75",children:[f.duration," min"]})]})},f.id))})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"font-bold text-sm",children:r("consultations.selectDate")}),e.jsx(y,{type:"date",min:ie(),value:D,onChange:f=>{O(f.target.value),l("")},className:"bg-white dark:bg-card","data-testid":"input-consultation-date"})]}),D&&K&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"font-bold text-sm",children:r("consultations.selectTime")}),K.slots.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:K.slots.map(f=>e.jsx(n,{variant:R===f.startTime?"default":"outline",size:"sm",className:`rounded-lg ${R===f.startTime?"bg-accent text-primary":"bg-white dark:bg-card"}`,onClick:()=>l(f.startTime),"data-testid":`button-time-${f.startTime}`,children:f.startTime},f.startTime))}):e.jsx("p",{className:"text-sm text-muted-foreground py-2",children:r("consultations.noAvailability")})]})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-4",children:[e.jsx("h4",{className:"font-bold text-sm",children:r("consultations.questionnaire")}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-sm",children:r("consultations.form.hasLlc")}),e.jsxs(U,{value:T.hasLlc,onChange:f=>v({...T,hasLlc:f.target.value}),className:"bg-white dark:bg-card",children:[e.jsx(x,{value:"",children:r("consultations.form.select")}),e.jsx(x,{value:"yes",children:r("common.yes")}),e.jsx(x,{value:"no",children:r("common.no")})]})]}),T.hasLlc==="yes"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-sm",children:r("consultations.form.llcState")}),e.jsxs(U,{value:T.llcState,onChange:f=>v({...T,llcState:f.target.value}),className:"bg-white dark:bg-card",children:[e.jsx(x,{value:"",children:r("consultations.form.select")}),e.jsx(x,{value:"New Mexico",children:"New Mexico"}),e.jsx(x,{value:"Wyoming",children:"Wyoming"}),e.jsx(x,{value:"Delaware",children:"Delaware"}),e.jsx(x,{value:"Other",children:r("consultations.form.other")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-sm",children:r("consultations.form.estimatedRevenue")}),e.jsxs(U,{value:T.estimatedRevenue,onChange:f=>v({...T,estimatedRevenue:f.target.value}),className:"bg-white dark:bg-card",children:[e.jsx(x,{value:"",children:r("consultations.form.select")}),e.jsx(x,{value:"0-50k",children:"$0 - $50,000"}),e.jsx(x,{value:"50k-100k",children:"$50,000 - $100,000"}),e.jsx(x,{value:"100k-500k",children:"$100,000 - $500,000"}),e.jsx(x,{value:"500k+",children:"$500,000+"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-sm",children:r("consultations.form.countryOfResidence")}),e.jsx(y,{value:T.countryOfResidence,onChange:f=>v({...T,countryOfResidence:f.target.value}),placeholder:r("consultations.form.countryPlaceholder"),className:"bg-white dark:bg-card"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-sm",children:r("consultations.form.mainTopic")}),e.jsx(ve,{value:T.mainTopic,onChange:f=>v({...T,mainTopic:f.target.value}),placeholder:r("consultations.form.topicPlaceholder"),rows:2,className:"bg-white dark:bg-card"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-sm",children:r("consultations.form.additionalNotes")}),e.jsx(ve,{value:T.additionalNotes,onChange:f=>v({...T,additionalNotes:f.target.value}),placeholder:r("consultations.form.notesPlaceholder"),rows:2,className:"bg-white dark:bg-card"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(n,{variant:"outline",onClick:()=>{N(!1),W()},className:"rounded-full",children:r("common.cancel")}),e.jsx(n,{onClick:fe,disabled:!i||!D||!R||F.isPending,className:"bg-accent text-primary font-black rounded-full flex-1 sm:flex-none","data-testid":"button-confirm-booking",children:F.isPending?r("common.loading"):r("consultations.confirmBooking")})]})]})]})]})})]}),ce.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:r("consultations.upcoming")}),e.jsx("div",{className:"grid gap-4",children:ce.map(({booking:f,consultationType:B})=>{const g=Ta(f.status,r);return e.jsx(h,{className:"overflow-hidden","data-testid":`card-consultation-${f.id}`,children:e.jsx(Z,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("h4",{className:"font-bold text-base sm:text-lg",children:ee(B)}),e.jsx(L,{className:g.className,children:g.label})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:re(f.scheduledDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsxs("span",{children:[f.scheduledTime," (",f.duration," min)"]})]}),e.jsxs("div",{className:"text-xs mt-2",children:[r("consultations.code"),": ",e.jsx("span",{className:"font-mono font-bold",children:f.bookingCode})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[f.meetingLink&&e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full",onClick:()=>window.open(f.meetingLink,"_blank"),children:[e.jsx(cd,{className:"w-4 h-4 mr-1"}),r("consultations.joinMeeting")]}),e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full text-destructive border-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>te.mutate(f.id),disabled:te.isPending,children:[e.jsx(ps,{className:"w-4 h-4 mr-1"}),r("consultations.cancel")]})]})]})})},f.id)})})]}),de.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:r("consultations.past")}),e.jsx("div",{className:"grid gap-3",children:de.map(({booking:f,consultationType:B})=>{const g=Ta(f.status,r);return e.jsx(h,{className:"opacity-75",children:e.jsx(Z,{className:"p-4",children:e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-bold",children:ee(B)}),e.jsx(L,{className:g.className,variant:"secondary",children:g.label})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[re(f.scheduledDate)," - ",f.scheduledTime]})]})})})},f.id)})})]}),M.length===0&&!a&&e.jsx(h,{className:"py-12",children:e.jsxs(Z,{className:"flex flex-col items-center justify-center text-center",children:[e.jsx(Oe,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:r("consultations.noBookings")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:r("consultations.noBookingsDesc")}),e.jsx(n,{onClick:()=>N(!0),className:"bg-accent text-primary font-black rounded-full",children:r("consultations.bookFirst")})]})})]})}const pt=d=>[d("consultations.admin.days.sunday","Domingo"),d("consultations.admin.days.monday","Lunes"),d("consultations.admin.days.tuesday","Martes"),d("consultations.admin.days.wednesday","Miércoles"),d("consultations.admin.days.thursday","Jueves"),d("consultations.admin.days.friday","Viernes"),d("consultations.admin.days.saturday","Sábado")];function Qd(){const{t:d,i18n:r}=Le(),{toast:C}=gs(),[j,a]=u.useState("bookings"),[N,i]=u.useState(null),[p,D]=u.useState(!1),[O,R]=u.useState(!1),[l,T]=u.useState(null),[v,E]=u.useState(""),[M,K]=u.useState({name:"",nameEs:"",nameEn:"",nameCa:"",description:"",descriptionEs:"",descriptionEn:"",descriptionCa:"",duration:30,price:0,isActive:!0}),[F,te]=u.useState({dayOfWeek:1,startTime:"09:00",endTime:"10:00"}),[W,ee]=u.useState({date:"",reason:""}),{data:fe}=z({queryKey:["/api/admin/consultations/stats"]}),{data:ce=[]}=z({queryKey:["/api/admin/consultations/bookings"]}),{data:de=[]}=z({queryKey:["/api/admin/consultations/types"]}),{data:re=[]}=z({queryKey:["/api/admin/consultations/availability"]}),{data:ie=[]}=z({queryKey:["/api/admin/consultations/blocked-dates"]}),f=P({mutationFn:async o=>k("POST","/api/admin/consultations/types",o),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/types"]}),C({title:d("consultations.admin.toasts.typeCreated","Tipo creado correctamente")}),D(!1),ye()},onError:o=>C({title:d("common.error","Error"),description:o.message,variant:"destructive"})}),B=P({mutationFn:async({id:o,data:G})=>k("PATCH",`/api/admin/consultations/types/${o}`,G),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/types"]}),C({title:d("consultations.admin.toasts.typeUpdated","Tipo actualizado")}),D(!1),ye()}}),g=P({mutationFn:async o=>k("DELETE",`/api/admin/consultations/types/${o}`),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/types"]}),C({title:d("consultations.admin.toasts.typeDeleted","Tipo eliminado")})}}),I=P({mutationFn:async o=>k("POST","/api/admin/consultations/availability",o),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/availability"]}),C({title:d("consultations.admin.toasts.scheduleAdded","Horario añadido")}),R(!1)}}),m=P({mutationFn:async o=>k("DELETE",`/api/admin/consultations/availability/${o}`),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/availability"]}),C({title:d("consultations.admin.toasts.scheduleRemoved","Horario eliminado")})}}),je=P({mutationFn:async o=>k("POST","/api/admin/consultations/blocked-dates",o),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/blocked-dates"]}),C({title:d("consultations.admin.toasts.dateBlocked","Fecha bloqueada")}),ee({date:"",reason:""})}}),me=P({mutationFn:async o=>k("DELETE",`/api/admin/consultations/blocked-dates/${o}`),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/blocked-dates"]}),C({title:d("consultations.admin.toasts.dateUnblocked","Fecha desbloqueada")})}}),xe=P({mutationFn:async({id:o,data:G})=>k("PATCH",`/api/admin/consultations/bookings/${o}`,G),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/consultations/bookings"]}),S.invalidateQueries({queryKey:["/api/admin/consultations/stats"]}),C({title:d("consultations.admin.toasts.bookingUpdated","Reserva actualizada")}),T(null)}}),ye=()=>{i(null),K({name:"",nameEs:"",nameEn:"",nameCa:"",description:"",descriptionEs:"",descriptionEn:"",descriptionCa:"",duration:30,price:0,isActive:!0})},ss=o=>{i(o),K({name:o.name,nameEs:o.nameEs,nameEn:o.nameEn,nameCa:o.nameCa,description:o.description||"",descriptionEs:o.descriptionEs||"",descriptionEn:o.descriptionEn||"",descriptionCa:o.descriptionCa||"",duration:o.duration,price:o.price,isActive:o.isActive}),D(!0)},le=()=>{N?B.mutate({id:N.id,data:M}):f.mutate(M)},ne=o=>new Date(o).toLocaleDateString(r.language,{weekday:"short",year:"numeric",month:"short",day:"numeric"}),H=o=>{const G=r.language;return G==="es"?o.nameEs:G==="ca"?o.nameCa:o.nameEn},A=(o,G)=>{l===o?T(null):(T(o),E(G||""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:d("consultations.admin.stats.pending","Pendientes")}),e.jsx("div",{className:"text-2xl font-black text-yellow-600",children:fe?.pending||0})]}),e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:d("consultations.admin.stats.confirmed","Confirmadas")}),e.jsx("div",{className:"text-2xl font-black text-blue-600",children:fe?.confirmed||0})]}),e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:d("consultations.admin.stats.completed","Completadas")}),e.jsx("div",{className:"text-2xl font-black text-green-600",children:fe?.completed||0})]}),e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:d("consultations.admin.stats.total","Total")}),e.jsx("div",{className:"text-2xl font-black",children:fe?.total||0})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["bookings","types","availability","blocked"].map(o=>e.jsxs(n,{variant:j===o?"default":"outline",size:"sm",onClick:()=>a(o),className:j===o?"bg-accent text-primary rounded-full":"rounded-full",children:[o==="bookings"&&d("consultations.admin.tabs.bookings","Reservas"),o==="types"&&d("consultations.admin.tabs.types","Tipos"),o==="availability"&&d("consultations.admin.tabs.availability","Horarios"),o==="blocked"&&d("consultations.admin.tabs.blocked","Bloqueados")]},o))}),j==="bookings"&&e.jsx(h,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:ce.length===0?e.jsx("div",{className:"p-6 text-center text-muted-foreground",children:d("consultations.admin.noBookings","No hay reservas de consultas")}):ce.map(({booking:o,consultationType:G,user:ue})=>{const he=Ta(o.status,d),as=l===o.id;return e.jsxs("div",{className:"hover:bg-muted/50",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("span",{className:"font-bold",children:H(G)}),e.jsx(L,{className:he.className,children:he.label}),e.jsx("span",{className:"text-xs font-mono bg-muted px-2 py-0.5 rounded-full",children:o.bookingCode})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),ne(o.scheduledDate)," ",o.scheduledTime]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ea,{className:"w-3 h-3"}),ue.firstName," ",ue.lastName," (",ue.email,")"]})]}),o.mainTopic&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 truncate max-w-md",children:[d("consultations.admin.topic","Tema"),": ",o.mainTopic]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[o.status==="pending"&&e.jsxs(n,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 rounded-full",onClick:()=>xe.mutate({id:o.id,data:{status:"confirmed"}}),children:[e.jsx(Bs,{className:"w-4 h-4 mr-1"}),d("consultations.admin.confirm","Confirmar")]}),["pending","confirmed"].includes(o.status)&&e.jsxs(n,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 rounded-full",onClick:()=>xe.mutate({id:o.id,data:{status:"cancelled"}}),children:[e.jsx(ps,{className:"w-4 h-4 mr-1"}),d("consultations.cancel","Cancelar")]}),o.status==="confirmed"&&e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full",onClick:()=>xe.mutate({id:o.id,data:{status:"completed"}}),children:d("consultations.admin.complete","Completar")}),e.jsx(n,{size:"sm",variant:"ghost",className:"rounded-full",onClick:()=>A(o.id,o.meetingLink),children:as?e.jsx(yt,{className:"w-4 h-4"}):e.jsx(Gs,{className:"w-4 h-4"})})]})]})}),as&&e.jsx("div",{className:"px-4 pb-4 pt-0 border-t bg-muted/30",children:e.jsxs("div",{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-muted-foreground",children:d("consultations.admin.code","Código")}),e.jsx("div",{className:"font-mono font-bold",children:o.bookingCode})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-muted-foreground",children:d("consultations.admin.client","Cliente")}),e.jsxs("div",{children:[ue.firstName," ",ue.lastName]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-muted-foreground",children:d("common.email","Email")}),e.jsx("div",{children:ue.email})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-muted-foreground",children:d("consultations.admin.date","Fecha")}),e.jsxs("div",{children:[ne(o.scheduledDate)," ",o.scheduledTime]})]})]}),o.mainTopic&&e.jsxs("div",{children:[e.jsx(c,{className:"text-muted-foreground",children:d("consultations.admin.mainTopic","Tema principal")}),e.jsx("div",{className:"text-sm",children:o.mainTopic})]}),o.additionalNotes&&e.jsxs("div",{children:[e.jsx(c,{className:"text-muted-foreground",children:d("consultations.admin.clientNotes","Notas del cliente")}),e.jsx("div",{className:"text-sm",children:o.additionalNotes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.meetingLink","Link de reunión")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{placeholder:d("consultations.admin.meetingLinkPlaceholder","https://meet.google.com/..."),value:v,onChange:se=>E(se.target.value),className:"flex-1 rounded-full"}),e.jsx(n,{onClick:()=>xe.mutate({id:o.id,data:{meetingLink:v}}),className:"bg-accent text-primary font-bold rounded-full",children:d("consultations.admin.save","Guardar")})]})]})]})})]},o.id)})})}),j==="types"&&e.jsxs("div",{className:"space-y-4",children:[!p&&e.jsxs(n,{onClick:()=>{ye(),D(!0)},className:"bg-accent text-primary font-bold rounded-full",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),d("consultations.admin.newType","Nuevo Tipo")]}),p&&e.jsxs(h,{className:"p-4 border-2 border-accent/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-black text-lg",children:N?d("consultations.admin.editType","Editar Tipo"):d("consultations.admin.newConsultationType","Nuevo Tipo de Consulta")}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{D(!1),ye()},className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.nameEs","Nombre (ES)")}),e.jsx(y,{className:"rounded-full",value:M.nameEs,onChange:o=>K({...M,nameEs:o.target.value,name:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.nameEn","Nombre (EN)")}),e.jsx(y,{className:"rounded-full",value:M.nameEn,onChange:o=>K({...M,nameEn:o.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.nameCa","Nombre (CA)")}),e.jsx(y,{className:"rounded-full",value:M.nameCa,onChange:o=>K({...M,nameCa:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.descriptionEs","Descripción (ES)")}),e.jsx(ve,{className:"rounded-xl",value:M.descriptionEs,onChange:o=>K({...M,descriptionEs:o.target.value,description:o.target.value}),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.durationMin","Duración (min)")}),e.jsx(y,{type:"number",className:"rounded-full",value:M.duration,onChange:o=>K({...M,duration:parseInt(o.target.value)||30})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.priceCents","Precio (cents)")}),e.jsx(y,{type:"number",className:"rounded-full",value:M.price,onChange:o=>K({...M,price:parseInt(o.target.value)||0})})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(n,{variant:"outline",className:"rounded-full",onClick:()=>{D(!1),ye()},children:d("consultations.cancel","Cancelar")}),e.jsx(n,{onClick:le,className:"bg-accent text-primary font-black rounded-full",children:N?d("consultations.admin.save","Guardar"):d("consultations.admin.create","Crear")})]})]})]}),e.jsx("div",{className:"grid gap-3",children:de.map(o=>e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:o.nameEs}),e.jsx(L,{variant:o.isActive?"default":"secondary",children:o.isActive?d("consultations.admin.active","Activo"):d("consultations.admin.inactive","Inactivo")})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.duration," min • ",(o.price/100).toFixed(2),"€"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"ghost",className:"rounded-full",onClick:()=>ss(o),children:e.jsx(Gs,{className:"w-4 h-4"})}),e.jsx(n,{size:"sm",variant:"ghost",className:"text-red-600 rounded-full",onClick:()=>g.mutate(o.id),children:e.jsx(ge,{className:"w-4 h-4"})})]})]})},o.id))})]}),j==="availability"&&e.jsxs("div",{className:"space-y-4",children:[!O&&e.jsxs(n,{onClick:()=>R(!0),className:"bg-accent text-primary font-bold rounded-full",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),d("consultations.admin.addSchedule","Añadir Horario")]}),O&&e.jsxs(h,{className:"p-4 border-2 border-accent/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-black text-lg",children:d("consultations.admin.addSchedule","Añadir Horario")}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>R(!1),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.day","Día")}),e.jsx(U,{className:"rounded-full",value:F.dayOfWeek.toString(),onChange:o=>te({...F,dayOfWeek:parseInt(o.target.value)}),children:pt(d).map((o,G)=>e.jsx(x,{value:G.toString(),children:o},G))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.start","Inicio")}),e.jsx(y,{type:"time",className:"rounded-full",value:F.startTime,onChange:o=>te({...F,startTime:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:d("consultations.admin.end","Fin")}),e.jsx(y,{type:"time",className:"rounded-full",value:F.endTime,onChange:o=>te({...F,endTime:o.target.value})})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(n,{variant:"outline",className:"rounded-full",onClick:()=>R(!1),children:d("consultations.cancel","Cancelar")}),e.jsx(n,{onClick:()=>I.mutate(F),className:"bg-accent text-primary font-black rounded-full",children:d("consultations.admin.add","Añadir")})]})]})]}),e.jsx("div",{className:"grid gap-2",children:pt(d).map((o,G)=>{const ue=re.filter(he=>he.dayOfWeek===G);return ue.length===0?null:e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"font-bold text-sm mb-2",children:o}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ue.map(he=>e.jsxs(L,{variant:"outline",className:"flex items-center gap-1 rounded-full",children:[he.startTime," - ",he.endTime,e.jsx(n,{size:"icon",variant:"ghost",className:"h-4 w-4 ml-1 rounded-full",onClick:()=>m.mutate(he.id),children:e.jsx(ps,{className:"w-3 h-3 text-red-500"})})]},he.id))})]},G)})})]}),j==="blocked"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(y,{type:"date",value:W.date,onChange:o=>ee({...W,date:o.target.value}),className:"w-40 rounded-full"}),e.jsx(y,{placeholder:d("consultations.admin.reasonOptional","Motivo (opcional)"),value:W.reason,onChange:o=>ee({...W,reason:o.target.value}),className:"flex-1 rounded-full"}),e.jsx(n,{onClick:()=>je.mutate(W),disabled:!W.date,className:"bg-accent text-primary font-bold rounded-full",children:d("consultations.admin.block","Bloquear")})]})}),e.jsx("div",{className:"grid gap-2",children:ie.map(o=>e.jsxs(h,{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:ne(o.date)}),o.reason&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["- ",o.reason]})]}),e.jsx(n,{size:"sm",variant:"ghost",className:"text-red-600 rounded-full",onClick:()=>me.mutate(o.id),children:e.jsx(ge,{className:"w-4 h-4"})})]},o.id))})]})]})}const gt=["llc_formation","maintenance","consultation","other_income"],bt=["state_fees","registered_agent","bank_fees","marketing","software","other_expense"];function _d(){const{t:d}=Le(),{toast:r}=gs(),[C,j]=u.useState("month"),[a,N]=u.useState(""),[i,p]=u.useState(""),[D,O]=u.useState(!1),[R,l]=u.useState(null),[T,v]=u.useState({type:"income",category:"",amount:"",description:"",reference:"",transactionDate:new Date().toISOString().split("T")[0],notes:""}),{data:E=[],isLoading:M,refetch:K}=z({queryKey:["/api/admin/accounting/transactions",a,i],queryFn:async()=>{const g=new URLSearchParams;return a&&g.set("type",a),i&&g.set("category",i),(await k("GET",`/api/admin/accounting/transactions?${g.toString()}`)).json()}}),{data:F,isLoading:te}=z({queryKey:["/api/admin/accounting/summary",C],queryFn:async()=>(await k("GET",`/api/admin/accounting/summary?period=${C}`)).json()}),W=P({mutationFn:async g=>{const I=await k("POST","/api/admin/accounting/transactions",g);if(!I.ok)throw new Error("Transaction creation failed");return I.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/accounting/transactions"]}),S.invalidateQueries({queryKey:["/api/admin/accounting/summary"]}),r({title:d("dashboard.admin.transactionCreated")||"Transacción creada"}),O(!1),l(null),ce()},onError:()=>{r({title:d("common.error"),variant:"destructive"})}}),ee=P({mutationFn:async({id:g,data:I})=>{const m=await k("PATCH",`/api/admin/accounting/transactions/${g}`,I);if(!m.ok)throw new Error("Transaction update failed");return m.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/accounting/transactions"]}),S.invalidateQueries({queryKey:["/api/admin/accounting/summary"]}),r({title:d("dashboard.admin.transactionUpdated")||"Transacción actualizada"}),O(!1),l(null),ce()},onError:()=>{r({title:d("common.error"),variant:"destructive"})}}),fe=P({mutationFn:async g=>{if(!(await k("DELETE",`/api/admin/accounting/transactions/${g}`)).ok)throw new Error("Transaction deletion failed")},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/accounting/transactions"]}),S.invalidateQueries({queryKey:["/api/admin/accounting/summary"]}),r({title:d("dashboard.admin.transactionDeleted")||"Transacción eliminada"})},onError:()=>{r({title:d("common.error"),variant:"destructive"})}}),ce=()=>{v({type:"income",category:"",amount:"",description:"",reference:"",transactionDate:new Date().toISOString().split("T")[0],notes:""})},de=g=>{v({type:g.type,category:g.category,amount:(Math.abs(g.amount)/100).toString(),description:g.description||"",reference:g.reference||"",transactionDate:g.transactionDate?new Date(g.transactionDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],notes:g.notes||""}),l(g),O(!0)},re=()=>{if(!T.category||!T.amount){r({title:d("common.requiredFields"),variant:"destructive"});return}R?ee.mutate({id:R.id,data:T}):W.mutate(T)},ie=async()=>{try{const g=new URLSearchParams;a&&g.set("type",a),i&&g.set("category",i);const m=await(await k("GET",`/api/admin/accounting/export-csv?${g.toString()}`)).blob(),je=window.URL.createObjectURL(m),me=document.createElement("a");me.href=je,me.download=`transacciones_${new Date().toISOString().slice(0,10)}.csv`,me.click(),window.URL.revokeObjectURL(je),r({title:"CSV descargado"})}catch{r({title:d("common.error"),variant:"destructive"})}},f=g=>d(`dashboard.admin.categories.${g}`)||g,B=g=>(g/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(h,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(Z,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:e.jsx(ot,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:d("dashboard.admin.totalIncome")}),e.jsx("p",{className:"text-xl font-black text-green-600",children:te?"...":B(F?.totalIncome||0)})]})]})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(Z,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(ct,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:d("dashboard.admin.totalExpenses")}),e.jsx("p",{className:"text-xl font-black text-red-600",children:te?"...":B(F?.totalExpenses||0)})]})]})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(Z,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx(Aa,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:d("dashboard.admin.netBalance")}),e.jsx("p",{className:`text-xl font-black ${(F?.netBalance||0)>=0?"text-green-600":"text-red-600"}`,children:te?"...":B(F?.netBalance||0)})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:["month","year","all"].map(g=>e.jsx(n,{variant:C===g?"default":"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>j(g),children:d(g==="month"?"dashboard.admin.thisMonth":g==="year"?"dashboard.admin.thisYear":"dashboard.admin.allTime")},g))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:ie,children:[e.jsx(Sa,{className:"w-3 h-3 mr-1"})," ",d("dashboard.admin.exportCSV")]}),e.jsxs(n,{size:"sm",className:"rounded-full text-xs bg-accent text-accent-foreground",onClick:()=>{ce(),l(null),O(!0)},children:[e.jsx(es,{className:"w-3 h-3 mr-1"})," ",d("dashboard.admin.addTransaction")]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(U,{value:a,onValueChange:N,className:"rounded-xl h-9 text-xs w-32",children:[e.jsx(x,{value:"",children:d("common.all")}),e.jsx(x,{value:"income",children:d("dashboard.admin.income")}),e.jsx(x,{value:"expense",children:d("dashboard.admin.expenses")})]}),e.jsxs(U,{value:i,onValueChange:p,className:"rounded-xl h-9 text-xs w-40",children:[e.jsx(x,{value:"",children:d("dashboard.admin.allCategories")}),[...gt,...bt].map(g=>e.jsx(x,{value:g,children:f(g)},g))]})]}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsx("div",{className:"divide-y",children:M?e.jsx("div",{className:"p-8 text-center",children:e.jsx(Y,{className:"w-6 h-6 animate-spin mx-auto"})}):E.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(Aa,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:d("dashboard.admin.noTransactions")})]}):E.map(g=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${g.type==="income"?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:g.type==="income"?e.jsx(ot,{className:"w-4 h-4 text-green-600"}):e.jsx(ct,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:`font-black text-sm ${g.type==="income"?"text-green-600":"text-red-600"}`,children:[g.type==="income"?"+":"",B(g.amount)]}),e.jsx(L,{variant:"outline",className:"text-[9px]",children:f(g.category)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.description||"-"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[g.transactionDate&&new Date(g.transactionDate).toLocaleDateString("es-ES"),g.reference&&` | ${g.reference}`]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:()=>de(g),children:e.jsx(Gs,{className:"w-3 h-3"})}),e.jsx(n,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-red-600",onClick:()=>{confirm("¿Eliminar esta transacción?")&&fe.mutate(g.id)},children:e.jsx(ge,{className:"w-3 h-3"})})]})]},g.id))})}),e.jsx(wt,{open:D,onOpenChange:O,children:e.jsx(kt,{children:e.jsx(h,{className:"rounded-2xl border-0 shadow-sm mt-4",children:e.jsxs(Z,{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground",children:d(R?"dashboard.admin.editTransaction":"dashboard.admin.addTransaction")}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>{O(!1),l(null)},"aria-label":"Cerrar formulario",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:R?"Modifica los datos":"Añade un ingreso o gasto"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold mb-2 block",children:d("dashboard.admin.transactionType")}),e.jsxs(U,{value:T.type,onValueChange:g=>v(I=>({...I,type:g,category:""})),className:"w-full rounded-xl h-11",children:[e.jsx(x,{value:"income",children:d("dashboard.admin.income")}),e.jsx(x,{value:"expense",children:d("dashboard.admin.expenses")})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold mb-2 block",children:d("dashboard.admin.category")}),e.jsxs(U,{value:T.category,onValueChange:g=>v(I=>({...I,category:g})),className:"w-full rounded-xl h-11",children:[e.jsx(x,{value:"",children:d("dashboard.admin.selectCategory")||"Seleccionar..."}),(T.type==="income"?gt:bt).map(g=>e.jsx(x,{value:g,children:f(g)},g))]})]}),e.jsxs("div",{children:[e.jsxs(c,{className:"text-sm font-semibold mb-2 block",children:[d("dashboard.admin.amount")," (€)"]}),e.jsx(y,{type:"number",step:"0.01",value:T.amount,onChange:g=>v(I=>({...I,amount:g.target.value})),className:"rounded-xl h-11",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold mb-2 block",children:d("dashboard.admin.transactionDate")}),e.jsx(y,{type:"date",value:T.transactionDate,onChange:g=>v(I=>({...I,transactionDate:g.target.value})),className:"rounded-xl h-11"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(c,{className:"text-sm font-semibold mb-2 block",children:d("dashboard.admin.description")}),e.jsx(y,{value:T.description,onChange:g=>v(I=>({...I,description:g.target.value})),className:"rounded-xl h-11",placeholder:"Descripción breve..."})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold mb-2 block",children:"Referencia"}),e.jsx(y,{value:T.reference,onChange:g=>v(I=>({...I,reference:g.target.value})),className:"rounded-xl h-11",placeholder:"Nº factura, recibo, etc."})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold mb-2 block",children:"Notas"}),e.jsx(ve,{value:T.notes,onChange:g=>v(I=>({...I,notes:g.target.value})),className:"rounded-xl resize-none",rows:2})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:re,disabled:W.isPending||ee.isPending,className:"bg-accent text-accent-foreground font-semibold rounded-full px-6",children:W.isPending||ee.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Guardar"}),e.jsx(n,{variant:"outline",onClick:()=>{O(!1),l(null)},className:"rounded-full",children:d("common.cancel")})]})]})})})})]})}function ir(){const[,d]=yd(),{user:r,isAuthenticated:C,isLoading:j}=wd(),{t:a}=Le();kd();const[N,i]=u.useState("services"),[p,D]=u.useState(!1),[O,R]=u.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:l}=gs(),T=r?.accountStatus==="active"||r?.accountStatus==="vip",[v,E]=u.useState(null),[M,K]=u.useState({open:!1,user:null}),[F,te]=u.useState(""),[W,ee]=u.useState(""),[fe,ce]=u.useState(""),[de,re]=u.useState({open:!1,user:null}),[ie,f]=u.useState(""),[B,g]=u.useState(""),[I,m]=u.useState({open:!1,user:null}),[je,me]=u.useState(""),[xe,ye]=u.useState(""),[ss,le]=u.useState("info"),[ne,H]=u.useState({open:!1,user:null}),[A,o]=u.useState(""),[G,ue]=u.useState(""),[he,as]=u.useState("EUR"),[se,Ct]=u.useState("dashboard"),[we,At]=u.useState(""),[Js,bs]=u.useState(!1),[Pe,Ve]=u.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[Zs,fs]=u.useState(!1),[oe,ts]=u.useState({userId:"",productId:"1",amount:"",state:"New Mexico",orderType:"llc"}),[Ke,js]=u.useState({open:!1,user:null}),[St,ea]=u.useState(!1),[ds,sa]=u.useState({open:!1,file:null}),[rs,Pa]=u.useState("passport"),[Ns,$a]=u.useState(""),[Dt,Ia]=u.useState(!1),[Tt,aa]=u.useState("form"),[Et,qa]=u.useState(""),[Lt,Fa]=u.useState(""),[Pt,Ma]=u.useState(""),[$t,Ua]=u.useState(""),[Ra,ta]=u.useState("idle"),[da,za]=u.useState(""),[Oa,Va]=u.useState(null),[qe,ns]=u.useState({open:!1,code:null}),[Qe,vs]=u.useState({open:!1,user:null}),[ys,ws]=u.useState(""),[is,ks]=u.useState(""),[Ka,Cs]=u.useState(""),[Qa,_a]=u.useState(!1),[Ba,Ha]=u.useState(!1),[pe,ls]=u.useState({open:!1,order:null}),[Ga,As]=u.useState("articles_of_organization"),[_e,Be]=u.useState(null),[Wa,Xa]=u.useState(!1),[He,Ss]=u.useState({open:!1,user:null}),[Ds,Ts]=u.useState(""),[Ya,Ja]=u.useState(!1),[It,Es]=u.useState(!1),[ke,os]=u.useState(""),[Ls,Ps]=u.useState(!1),[$s,Is]=u.useState(!1),[Q,Ce]=u.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});u.useEffect(()=>{r&&R({firstName:r.firstName||"",lastName:r.lastName||"",phone:r.phone||"",businessActivity:r.businessActivity||"",address:r.address||"",streetType:r.streetType||"",city:r.city||"",province:r.province||"",postalCode:r.postalCode||"",country:r.country||"",idNumber:r.idNumber||"",idType:r.idType||"",birthDate:r.birthDate||""})},[r]);const qt=P({mutationFn:async s=>{if(!T)throw new Error(a("dashboard.toasts.cannotModifyAccountState"));if(s.birthDate){const w=new Date(s.birthDate),b=new Date;let V=b.getFullYear()-w.getFullYear();const X=b.getMonth()-w.getMonth();if((X<0||X===0&&b.getDate()<w.getDate())&&V--,V<18)throw new Error(a("validation.ageMinimum"))}const t=await k("PATCH","/api/user/profile",s);if(!t.ok){const w=await t.json().catch(()=>({}));if(w.code==="OTP_REQUIRED"){Va(s),(await k("POST","/api/user/profile/send-otp")).ok&&(ta("otp"),l({title:a("profile.otpSentTitle","Código enviado"),description:a("profile.otpSentDesc","Hemos enviado un código de verificación a tu email.")}));return}throw new Error(w.message||a("dashboard.toasts.couldNotSave"))}},onSuccess:()=>{Ra==="idle"&&(S.invalidateQueries({queryKey:["/api/auth/user"]}),D(!1),l({title:a("dashboard.toasts.changesSaved"),description:a("dashboard.toasts.changesSavedDesc")}))},onError:s=>{l({title:a("common.error"),description:s.message,variant:"destructive"})}}),Ft=P({mutationFn:async()=>{if(!Oa||!da)return;const s=await k("PATCH","/api/user/profile",{...Oa,otpCode:da});if(!s.ok){const t=await s.json().catch(()=>({}));throw new Error(t.message||a("dashboard.toasts.couldNotSave"))}},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/auth/user"]}),D(!1),ta("idle"),za(""),Va(null),l({title:a("dashboard.toasts.changesSaved"),description:a("dashboard.toasts.changesSavedDesc")})},onError:s=>{l({title:a("common.error"),description:s.message,variant:"destructive"})}});u.useEffect(()=>{!j&&!C&&d("/auth/login")},[C,j,d]);const{data:$,isLoading:Bd}=z({queryKey:["/api/orders"],enabled:C,refetchInterval:3e4,staleTime:1e4}),{data:Mt,isLoading:Hd}=z({queryKey:["/api/messages"],enabled:C,refetchInterval:6e4,staleTime:3e4}),[ra,na]=u.useState(null),[qs,ia]=u.useState(""),Za=$?.[0]?.id,{data:Fs}=z({queryKey:["/api/orders",Za,"events"],enabled:!!Za,refetchInterval:3e4,staleTime:1e4}),Ms=P({mutationFn:async s=>{const t=await k("POST",`/api/messages/${s}/reply`,{content:qs});if(!t.ok){const w=await t.json().catch(()=>({}));throw new Error(w.message||a("dashboard.toasts.couldNotSend"))}return t.json()},onSuccess:()=>{ia(""),na(null),S.invalidateQueries({queryKey:["/api/messages"]}),S.invalidateQueries({queryKey:["/api/admin/messages"]}),l({title:r?.isAdmin?a("dashboard.toasts.messageReplied"):a("dashboard.toasts.messageSent"),description:r?.isAdmin?a("dashboard.toasts.messageRepliedDesc"):a("dashboard.toasts.messageSentDesc")})},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotSend"),variant:"destructive"})}}),{data:$e,isLoading:et}=z({queryKey:["/api/user/notifications"],enabled:C,refetchInterval:6e4,staleTime:3e4}),st=P({mutationFn:async s=>{if(!(await k("PATCH",`/api/user/notifications/${s}/read`)).ok)throw new Error(a("dashboard.toasts.couldNotMarkNotification"))},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/user/notifications"]})},onError:()=>{}}),Ut=P({mutationFn:async s=>{if(!(await k("DELETE",`/api/user/notifications/${s}`)).ok)throw new Error(a("dashboard.toasts.couldNotDelete"))},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/user/notifications"]})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotDelete"),variant:"destructive"})}}),{data:Se}=z({queryKey:["/api/admin/orders"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:Ge}=z({queryKey:["/api/admin/incomplete-applications"],enabled:!!r?.isAdmin,refetchInterval:3e4}),at=P({mutationFn:async({type:s,id:t})=>{const w=await k("DELETE",`/api/admin/incomplete-applications/${s}/${t}`);if(!w.ok)throw new Error(a("dashboard.toasts.couldNotDelete"));return w.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/incomplete-applications"]}),l({title:a("dashboard.toasts.incompleteDeleted"),description:a("dashboard.toasts.incompleteDeletedDesc")})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotDelete"),variant:"destructive"})}}),{data:Fe}=z({queryKey:["/api/admin/users"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:Us,refetch:Rt}=z({queryKey:["/api/admin/newsletter"],enabled:!!r?.isAdmin}),{data:Rs}=z({queryKey:["/api/admin/documents"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:tt}=z({queryKey:["/api/admin/invoices"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:ae}=z({queryKey:["/api/admin/system-stats"],enabled:!!r?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:Me}=z({queryKey:["/api/admin/messages"],enabled:!!r?.isAdmin}),{data:la,refetch:oa}=z({queryKey:["/api/admin/discount-codes"],enabled:!!r?.isAdmin}),[Gd,zt]=u.useState(""),[Wd,Ot]=u.useState("");P({mutationFn:async({subject:s,message:t})=>{if(!(await k("POST","/api/admin/newsletter/broadcast",{subject:s,message:t})).ok)throw new Error(a("dashboard.toasts.couldNotSend"))},onSuccess:()=>{l({title:a("dashboard.toasts.emailsSent"),description:a("dashboard.toasts.emailsSentDesc")}),zt(""),Ot("")},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotSend"),variant:"destructive"})}});const{data:Vt}=z({queryKey:["/api/user/documents"],enabled:C});P({mutationFn:async s=>{const t=await k("POST","/api/admin/documents",s);if(!t.ok){const w=await t.json().catch(()=>({}));throw new Error(w.message||a("dashboard.toasts.couldNotUpload"))}return t.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/user/documents"]}),l({title:a("dashboard.toasts.documentUploaded"),description:a("dashboard.toasts.documentUploadedDesc")})},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotUpload"),variant:"destructive"})}});const Kt=P({mutationFn:async({id:s,status:t})=>{const w=await k("PATCH",`/api/admin/orders/${s}/status`,{status:t});if(!w.ok)throw new Error(a("dashboard.toasts.couldNotUpdate"));return w.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/orders"]}),l({title:a("dashboard.toasts.statusUpdated")})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotUpdate"),variant:"destructive"})}}),We=P({mutationFn:async({appId:s,field:t,value:w})=>{if(!(await k("PATCH",`/api/admin/llc/${s}/dates`,{field:t,value:w})).ok)throw new Error(a("dashboard.toasts.couldNotUpdate"))},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/orders"]}),S.invalidateQueries({queryKey:["/api/orders"]}),l({title:a("dashboard.toasts.dateUpdated")})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotUpdate"),variant:"destructive"})}}),Xe=P({mutationFn:async({userId:s,title:t,message:w,type:b})=>{const V=await k("POST","/api/admin/send-note",{userId:s,title:t,message:w,type:b});if(!V.ok){const X=await V.json().catch(()=>({}));throw new Error(X.message||a("dashboard.toasts.couldNotSend"))}return V.json()},onSuccess:()=>{l({title:a("dashboard.toasts.notesSent"),description:a("dashboard.toasts.notesSentDesc")}),m({open:!1,user:null}),me(""),ye("")},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotSend"),variant:"destructive"})}}),zs=P({mutationFn:async s=>{const{id:t,createdAt:w,...b}=s,V=["dni","nie","passport"],X=["active","pending","deactivated","vip"],q={};b.firstName!==void 0&&(q.firstName=b.firstName||void 0),b.lastName!==void 0&&(q.lastName=b.lastName||void 0),b.email!==void 0&&(q.email=b.email||void 0),b.phone!==void 0&&(q.phone=b.phone||null),b.address!==void 0&&(q.address=b.address||null),b.streetType!==void 0&&(q.streetType=b.streetType||null),b.city!==void 0&&(q.city=b.city||null),b.province!==void 0&&(q.province=b.province||null),b.postalCode!==void 0&&(q.postalCode=b.postalCode||null),b.country!==void 0&&(q.country=b.country||null),b.idNumber!==void 0&&(q.idNumber=b.idNumber||null),b.idType!==void 0&&(q.idType=V.includes(b.idType||"")?b.idType:null),b.birthDate!==void 0&&(q.birthDate=b.birthDate||null),b.businessActivity!==void 0&&(q.businessActivity=b.businessActivity||null),b.isActive!==void 0&&(q.isActive=b.isActive),b.isAdmin!==void 0&&(q.isAdmin=b.isAdmin),b.accountStatus!==void 0&&X.includes(b.accountStatus)&&(q.accountStatus=b.accountStatus),b.internalNotes!==void 0&&(q.internalNotes=b.internalNotes||null);const Ie=Object.fromEntries(Object.entries(q).filter(([J,cs])=>cs!==void 0)),Re=await k("PATCH",`/api/admin/users/${t}`,Ie);if(!Re.ok){const J=await Re.json().catch(()=>({}));throw new Error(J.message||a("dashboard.toasts.couldNotUpdate"))}},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/users"]}),l({title:a("dashboard.toasts.userUpdated")}),E(null)},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotUpdate"),variant:"destructive"})}}),ca=P({mutationFn:async s=>{if(!(await k("DELETE",`/api/admin/users/${s}`)).ok)throw new Error(a("dashboard.toasts.couldNotDelete"))},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/users"]}),l({title:a("dashboard.toasts.userDeleted")}),js({open:!1,user:null})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotDelete"),variant:"destructive"})}}),[De,Os]=u.useState({open:!1,order:null}),[Ue,Vs]=u.useState({open:!1,order:null}),[Ye,ma]=u.useState(""),[xa,dt]=u.useState("EUR"),ua=P({mutationFn:async s=>{if(!(await k("DELETE",`/api/admin/orders/${s}`)).ok)throw new Error(a("dashboard.toasts.couldNotDelete"))},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/orders"]}),S.invalidateQueries({queryKey:["/api/orders"]}),S.invalidateQueries({queryKey:["/api/notifications"]}),S.invalidateQueries({queryKey:["/api/user/documents"]}),l({title:a("dashboard.toasts.orderDeleted"),description:a("dashboard.toasts.orderDeletedDesc")}),Os({open:!1,order:null})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotDelete"),variant:"destructive"})}}),ha=P({mutationFn:async({userId:s,concept:t,amount:w,currency:b})=>{if(!w||isNaN(w)||w<1)throw new Error(a("dashboard.toasts.invalidAmount"));const V=await k("POST","/api/admin/invoices/create",{userId:s,concept:t,amount:w,currency:b});if(!V.ok){const X=await V.json().catch(()=>({}));throw new Error(X.message||a("dashboard.toasts.couldNotCreate"))}return V.json()},onSuccess:s=>{l({title:a("dashboard.toasts.invoiceCreated"),description:a("dashboard.toasts.invoiceCreatedDesc",{number:s?.invoiceNumber||""})}),H({open:!1,user:null}),o(""),ue(""),as("EUR"),S.invalidateQueries({queryKey:["/api/admin/documents"]})},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotCreate"),variant:"destructive"})}}),pa=P({mutationFn:async s=>(await k("POST","/api/admin/users/create",s)).json(),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/users"]}),l({title:a("dashboard.toasts.userCreated"),description:a("dashboard.toasts.userCreatedDesc")}),bs(!1),Ve({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotCreate"),variant:"destructive"})}}),ga=P({mutationFn:async s=>{const{userId:t,state:w,amount:b,orderType:V}=s;if(!t||!w||!b)throw new Error(a("dashboard.toasts.missingRequiredData"));const q=await k("POST",V==="maintenance"?"/api/admin/orders/create-maintenance":"/api/admin/orders/create",{userId:t,state:w,amount:b});if(!q.ok){const Ie=await q.json().catch(()=>({}));throw new Error(Ie.message||a("dashboard.toasts.couldNotCreate"))}return q.json()},onSuccess:s=>{S.invalidateQueries({queryKey:["/api/admin/orders"]}),l({title:a("dashboard.toasts.orderCreated"),description:a("dashboard.toasts.orderCreatedDesc",{number:s?.invoiceNumber||""})}),fs(!1),ts({userId:"",productId:"1",amount:"",state:"New Mexico",orderType:"llc"})},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotCreate"),variant:"destructive"})}}),rt=P({mutationFn:async s=>{if(!(await k("DELETE",`/api/user/documents/${s}`)).ok)throw new Error(a("dashboard.toasts.couldNotDelete"))},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/user/documents"]}),l({title:a("dashboard.toasts.documentDeleted")})},onError:s=>{l({title:a("common.error"),description:s?.message||a("dashboard.toasts.couldNotDelete"),variant:"destructive"})}}),ba=P({mutationFn:async()=>{if(!(await k("DELETE","/api/user/account")).ok)throw new Error(a("dashboard.toasts.couldNotDelete"))},onSuccess:()=>{l({title:a("dashboard.toasts.accountDeleted"),description:a("dashboard.toasts.accountDeletedDesc")}),window.location.href="/"},onError:()=>{l({title:a("common.error"),description:a("dashboard.toasts.couldNotDelete"),variant:"destructive"})}}),Qt=P({mutationFn:async()=>{if(!(await k("POST","/api/user/request-password-otp")).ok)throw new Error(a("dashboard.toasts.couldNotSend"))},onSuccess:()=>{l({title:a("dashboard.toasts.codeSent"),description:a("dashboard.toasts.codeSentDesc")}),aa("otp")},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotSend"),variant:"destructive"})}}),_t=P({mutationFn:async s=>{const t=await k("POST","/api/user/change-password",s);if(!t.ok){const w=await t.json().catch(()=>({}));throw new Error(w.message||a("dashboard.toasts.couldNotUpdate"))}},onSuccess:()=>{l({title:a("dashboard.toasts.passwordUpdated"),description:a("dashboard.toasts.passwordUpdatedDesc")}),Ia(!1),aa("form"),qa(""),Fa(""),Ma(""),Ua("")},onError:s=>{l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotUpdate"),variant:"destructive"})}});if(j||!C)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(r?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-background font-sans flex flex-col",children:[e.jsx(va,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-8 sm:py-12",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(h,{className:"rounded-2xl sm:rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-card",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(Z,{className:"p-6 sm:p-8 md:p-12 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mx-auto mb-4 sm:mb-6",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(md,{className:"w-10 h-10 text-red-500"})})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight mb-3 sm:mb-4",children:a("dashboard.accountDeactivated.title")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground font-medium leading-relaxed mb-6 sm:mb-8",children:a("dashboard.accountDeactivated.message")}),e.jsxs(n,{variant:"destructive",className:"w-full sm:w-auto px-8 font-black h-11 sm:h-12 rounded-full shadow-lg hover:shadow-xl transition-all",onClick:()=>k("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-logout",children:[e.jsx(xd,{className:"w-4 h-4 mr-2"}),a("nav.logout")]})]})]})})}),e.jsx(ya,{})]});if(r?.accountStatus==="pending")return e.jsxs("div",{className:"min-h-screen bg-background font-sans flex flex-col overflow-y-auto",children:[e.jsx(va,{}),e.jsxs("main",{className:"flex-1 pt-16 sm:pt-20 pb-20 px-4 md:px-8 max-w-4xl mx-auto w-full overflow-y-auto",children:[e.jsxs("header",{className:"mb-6 md:mb-8",children:[e.jsx("p",{className:"text-accent font-bold tracking-wide text-xs md:text-sm mb-1 uppercase",children:a("dashboard.clientArea")}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground tracking-tight leading-tight",children:a("dashboard.pendingAccount.hello",{name:(r?.firstName||"Cliente").charAt(0).toUpperCase()+(r?.firstName||"Cliente").slice(1).toLowerCase()})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{className:"rounded-2xl border-0 shadow-xl overflow-hidden bg-white dark:bg-card",children:[e.jsx("div",{className:`h-1.5 w-full ${r?.emailVerified?"bg-amber-500":"bg-orange-500"}`}),e.jsxs(Z,{className:"p-5 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 pb-4 border-b border-zinc-900/10 dark:border-accent/30",children:[e.jsx("div",{className:"flex items-center justify-center shrink-0",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:e.jsx(Te,{className:"w-8 h-8 text-amber-500"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-black text-lg text-foreground",children:r?.emailVerified?a("dashboard.pendingAccount.adminReviewTitle"):a("dashboard.pendingAccount.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?.emailVerified?a("dashboard.pendingAccount.adminReviewSubtitle"):a("dashboard.pendingAccount.subtitle")})]})]}),r?.emailVerified?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_s,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"font-bold text-sm text-amber-800 dark:text-amber-300",children:a("dashboard.pendingAccount.adminReviewTitle")})]}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-400 leading-relaxed",children:a("dashboard.pendingAccount.adminReviewMessage")})]})}):e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(us,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-bold text-sm text-orange-800 dark:text-orange-300",children:a("dashboard.pendingAccount.verifyEmailStep")})]}),e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 mb-3",children:[a("dashboard.pendingAccount.codeSentTo")," ",e.jsx("strong",{children:r?.email})]}),e.jsx(y,{value:ke,onChange:s=>os(s.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-xl font-black border-orange-200 focus:border-accent tracking-[0.4em] h-12 mb-3",maxLength:6,inputMode:"numeric",placeholder:"------","data-testid":"input-pending-verification-code"}),e.jsx(n,{onClick:async()=>{if(!ke||ke.length<6){l({title:a("dashboard.pendingAccount.enter6DigitCode"),variant:"destructive"});return}Ps(!0);try{(await(await k("POST","/api/auth/verify-email",{code:ke})).json()).success&&(await S.refetchQueries({queryKey:["/api/auth/user"]}),l({title:a("dashboard.pendingAccount.emailVerified")}),os(""))}catch{l({title:a("llc.messages.incorrectCode"),variant:"destructive"})}finally{Ps(!1)}},disabled:Ls||ke.length<6,className:"w-full bg-accent text-accent-foreground font-black rounded-full h-11","data-testid":"button-pending-verify",children:Ls?e.jsx(Y,{className:"animate-spin"}):a("dashboard.pendingAccount.verifyButton")}),e.jsx(n,{variant:"link",onClick:async()=>{Is(!0);try{await k("POST","/api/auth/resend-verification"),l({title:a("llc.messages.codeSent")})}catch{l({title:a("common.error"),variant:"destructive"})}finally{Is(!1)}},disabled:$s,className:"text-accent p-0 h-auto text-xs mt-2","data-testid":"button-pending-resend",children:a($s?"common.sending":"dashboard.pendingAccount.resendCode")})]})]})]}),e.jsxs(h,{className:"rounded-2xl border-0 shadow-xl overflow-hidden bg-white dark:bg-card",children:[e.jsx("div",{className:"bg-accent h-1.5 w-full"}),e.jsxs(Z,{className:"p-5 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-4 border-b border-zinc-900/10 dark:border-accent/30",children:[e.jsx(ja,{className:"w-5 h-5 text-accent"}),e.jsx("h2",{className:"font-black text-lg text-foreground",children:a("dashboard.notifications.title")})]}),et?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Y,{className:"w-6 h-6 animate-spin text-accent"})}):$e&&$e.length>0?e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:$e.slice(0,5).map(s=>e.jsx("div",{className:`p-3 rounded-xl border ${s.isRead?"bg-muted/50 border-border":"bg-accent/5 border-accent/20"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${s.isRead?"bg-muted":"bg-accent/10"}`,children:e.jsx(ja,{className:`w-4 h-4 ${s.isRead?"text-muted-foreground":"text-accent"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm text-foreground",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.message}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:new Date(s.createdAt).toLocaleDateString("es-ES",{day:"numeric",month:"short"})})]}),!s.isRead&&e.jsx(n,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>st.mutate(s.id),children:a("dashboard.notifications.read")})]})},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(vt,{className:"w-10 h-10 mx-auto mb-2 opacity-30 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("dashboard.notifications.empty")})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(n,{variant:"ghost",className:"text-sm text-muted-foreground",onClick:()=>k("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-pending-logout",children:a("dashboard.pendingAccount.logout")})})]}),e.jsx(ya,{})]});const Bt=u.useMemo(()=>$?.filter(s=>s.status==="draft"||s.application?.status==="draft"||s.maintenanceApplication?.status==="draft")||[],[$]),Ht=u.useMemo(()=>$?.filter(s=>s.status!=="cancelled"&&s.status!=="completed").slice(0,4)||[],[$]),nt=u.useMemo(()=>[{id:"services",label:a("dashboard.tabs.services"),icon:Hs,mobileLabel:a("dashboard.tabs.servicesMobile"),tour:"orders"},{id:"consultations",label:a("dashboard.tabs.consultations"),icon:Oe,mobileLabel:a("dashboard.tabs.consultationsMobile")},{id:"notifications",label:a("dashboard.tabs.notifications"),icon:ja,mobileLabel:a("dashboard.tabs.notificationsMobile")},{id:"messages",label:a("dashboard.tabs.messages"),icon:us,mobileLabel:a("dashboard.tabs.messagesMobile"),tour:"messages"},{id:"documents",label:a("dashboard.tabs.documents"),icon:be,mobileLabel:a("dashboard.tabs.documentsMobile")},{id:"payments",label:a("dashboard.tabs.payments"),icon:La,mobileLabel:a("dashboard.tabs.paymentsMobile")},{id:"calendar",label:a("dashboard.tabs.calendar"),icon:Ae,mobileLabel:a("dashboard.tabs.calendarMobile"),tour:"calendar"},{id:"tools",label:a("dashboard.tabs.tools"),icon:Na,mobileLabel:a("dashboard.tabs.toolsMobile")},{id:"profile",label:a("dashboard.tabs.profile"),icon:Ea,mobileLabel:a("dashboard.tabs.profileMobile"),tour:"profile"}],[a]),Gt=u.useMemo(()=>{if(!we.trim()||!Se)return Se;const s=we.toLowerCase().trim();return Se.filter(t=>{const b=((t.application||t.maintenanceApplication)?.requestCode||t.invoiceNumber||"").toLowerCase(),V=t.userId?.toString()||"",X=t.id?.toString()||"",q=((t.user?.firstName||"")+" "+(t.user?.lastName||"")).toLowerCase(),Ie=(t.user?.email||"").toLowerCase();return b.includes(s)||V.includes(s)||X.includes(s)||q.includes(s)||Ie.includes(s)})},[Se,we]),Wt=u.useMemo(()=>{if(!we.trim()||!Fe)return Fe;const s=we.toLowerCase().trim();return Fe.filter(t=>{const w=((t.firstName||"")+" "+(t.lastName||"")).toLowerCase(),b=(t.email||"").toLowerCase(),V=(t.clientId||"").toLowerCase(),X=t.id?.toString()||"";return w.includes(s)||b.includes(s)||V.includes(s)||X.includes(s)})},[Fe,we]);u.useMemo(()=>{if(!we.trim()||!Me)return Me;const s=we.toLowerCase().trim();return Me.filter(t=>{const w=(t.messageId||"").toLowerCase(),b=(t.email||"").toLowerCase(),V=(t.name||"").toLowerCase();return w.includes(s)||b.includes(s)||V.includes(s)})},[Me,we]);const it=r?.isAdmin;return e.jsxs("div",{className:"min-h-screen bg-background font-sans animate-page-in",children:[e.jsx(va,{}),e.jsx(Ld,{}),e.jsxs("main",{className:"pt-16 sm:pt-20 pb-20 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsxs("header",{className:"mb-6 md:mb-10 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-bold tracking-wide text-xs md:text-sm mb-1 md:mb-2 uppercase",children:a("dashboard.clientArea")}),e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground tracking-tight leading-tight",children:a("dashboard.welcome",{name:(r?.firstName||"Cliente").charAt(0).toUpperCase()+(r?.firstName||"Cliente").slice(1).toLowerCase()})}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base mt-1 md:mt-2",children:a("dashboard.subtitle")})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsx(Ne,{href:"/llc/formation",children:e.jsxs(n,{className:"w-full md:w-auto bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-full px-6 h-11 transition-all flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(mt,{className:"w-5 h-5"})," ",a("dashboard.newLLC")]})})})]}),!r?.emailVerified&&e.jsx(h,{className:"mt-4 p-4 rounded-2xl border-2 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/40 flex items-center justify-center shrink-0",children:e.jsx(us,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm text-orange-800 dark:text-orange-300",children:a("dashboard.emailVerification.title")}),e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400",children:a("dashboard.emailVerification.description")})]}),e.jsx(n,{size:"sm",onClick:()=>Es(!0),className:"shrink-0 bg-orange-600 hover:bg-orange-700 text-white font-black rounded-full h-9 px-4","data-testid":"button-verify-email-header",children:a("dashboard.emailVerification.button")})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2 mb-6 lg:hidden",children:[e.jsx("div",{className:"flex overflow-x-auto pb-3 gap-2 no-scrollbar -mx-4 px-4",style:{WebkitOverflowScrolling:"touch"},children:nt.map(s=>e.jsxs(n,{variant:N===s.id?"default":"ghost",onClick:()=>i(s.id),size:"sm",className:`flex items-center gap-1.5 rounded-full font-semibold text-[11px] sm:text-xs tracking-normal whitespace-nowrap shrink-0 h-10 px-4 transition-colors ${N===s.id?"bg-accent text-accent-foreground shadow-md":"bg-card text-muted-foreground hover:text-foreground hover:bg-secondary"}`,"data-testid":`button-tab-${s.id}`,..."tour"in s&&s.tour?{"data-tour":s.tour}:{},children:[e.jsx(s.icon,{className:"w-4 h-4"}),e.jsx("span",{children:s.mobileLabel})]},s.id))}),it&&e.jsx("div",{className:"flex -mx-4 px-4",children:e.jsxs(n,{variant:N==="admin"?"default":"ghost",onClick:()=>i("admin"),size:"sm",className:`flex items-center gap-1.5 rounded-full font-semibold text-[11px] sm:text-xs tracking-normal whitespace-nowrap shrink-0 h-10 px-4 transition-colors ${N==="admin"?"bg-accent text-accent-foreground shadow-md":"bg-accent/10 dark:bg-accent/20 text-accent hover:bg-accent/20 dark:hover:bg-accent/30"}`,"data-testid":"button-tab-admin-mobile",children:[e.jsx(_s,{className:"w-4 h-4"}),e.jsx("span",{children:a("dashboard.menu.admin")})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx("aside",{className:"hidden lg:block w-56 shrink-0",children:e.jsxs("nav",{className:"sticky top-24 space-y-1",children:[e.jsx("div",{className:"bg-card border border-border/50 rounded-2xl p-3 space-y-1 shadow-sm",children:nt.map(s=>e.jsxs("button",{onClick:()=>i(s.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-colors ${N===s.id?"bg-accent text-accent-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-secondary/50"}`,"data-testid":`button-sidebar-${s.id}`,..."tour"in s&&s.tour?{"data-tour":s.tour}:{},children:[e.jsx(s.icon,{className:`w-5 h-5 ${N===s.id?"text-accent-foreground":"text-accent"}`}),e.jsx("span",{children:s.label}),N===s.id&&e.jsx("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-accent-foreground"})]},s.id))}),it&&e.jsx("div",{className:"bg-accent/5 dark:bg-accent/10 border border-accent/20 rounded-2xl p-3 mt-3",children:e.jsxs("button",{onClick:()=>i("admin"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-colors ${N==="admin"?"bg-accent text-accent-foreground shadow-sm":"text-accent hover:bg-accent/10"}`,"data-testid":"button-sidebar-admin",children:[e.jsx(_s,{className:`w-5 h-5 ${N==="admin"?"text-accent-foreground":"text-accent"}`}),e.jsx("span",{children:a("dashboard.menu.admin")}),N==="admin"&&e.jsx("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-accent-foreground"})]})})]})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 lg:gap-8",children:[e.jsxs("div",{className:"xl:col-span-2 space-y-6 order-1",children:[N==="services"&&e.jsx(Rd,{orders:$,draftOrders:Bt,activeOrders:Ht}),N==="notifications"&&e.jsx(zd,{notifications:$e,notificationsLoading:et,user:r,markNotificationRead:st,deleteNotification:Ut,setActiveTab:i}),N==="consultations"&&e.jsx(Kd,{setActiveTab:i}),N==="messages"&&e.jsx(Od,{messagesData:Mt,selectedMessage:ra,setSelectedMessage:na,replyContent:qs,setReplyContent:ia,sendReplyMutation:Ms}),N==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-foreground tracking-tight",children:a("dashboard.documents.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a("dashboard.documents.subtitle")})]}),$e?.some(s=>s.type==="action_required")&&r?.accountStatus!=="deactivated"&&e.jsx(h,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ze,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 text-sm",children:a("dashboard.documents.requestedDocuments")}),e.jsx("div",{className:"mt-2 space-y-1",children:$e?.filter(s=>s.type==="action_required").map(s=>e.jsx("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:s.message},s.id))}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async s=>{const t=s.target.files?.[0];if(!t)return;const w=new FormData;w.append("file",t);try{const b=await wa();(await fetch("/api/user/documents/upload",{method:"POST",headers:{"X-CSRF-Token":b},body:w,credentials:"include"})).ok?(l({title:a("dashboard.toasts.documentUploadedClient"),description:a("dashboard.toasts.documentUploadedClientDesc")}),S.invalidateQueries({queryKey:["/api/user/documents"]}),S.invalidateQueries({queryKey:["/api/user/notifications"]})):l({title:a("common.error"),description:a("dashboard.toasts.couldNotUpload"),variant:"destructive"})}catch{l({title:a("common.error"),description:a("dashboard.toasts.connectionError"),variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(n,{variant:"outline",className:"rounded-full text-xs border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300",asChild:!0,children:e.jsxs("span",{children:[e.jsx(ze,{className:"w-3 h-3 mr-1"})," ",a("dashboard.documents.uploadDocument")]})})]})})]})]})}),e.jsx(h,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:ds.file?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-[#1A1A1A] rounded-xl",children:[e.jsx(ze,{className:"w-8 h-8 text-accent shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate text-foreground",children:ds.file.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(ds.file.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>sa({open:!1,file:null}),className:"shrink-0 text-muted-foreground hover:text-red-500","data-testid":"button-clear-file",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-2 block",children:a("dashboard.documents.documentType")}),e.jsxs(U,{value:rs,onValueChange:Pa,className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"select-upload-doc-type-inline",children:[e.jsx(x,{value:"passport",children:a("dashboard.documents.passport")}),e.jsx(x,{value:"address_proof",children:a("dashboard.documents.addressProof")}),e.jsx(x,{value:"tax_id",children:a("dashboard.documents.taxId")}),e.jsx(x,{value:"other",children:a("dashboard.documents.otherDocument")})]})]}),rs==="other"&&e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-2 block",children:a("dashboard.documents.description")}),e.jsx(ve,{value:Ns,onChange:s=>$a(s.target.value),placeholder:"Describe el documento...",className:"min-h-[70px] rounded-xl border-border bg-background dark:bg-[#1A1A1A] text-base",style:{fontSize:"16px"},"data-testid":"input-upload-notes-inline"})]}),e.jsxs(n,{onClick:async()=>{if(!ds.file)return;const s=new FormData;s.append("file",ds.file),s.append("documentType",rs),rs==="other"&&Ns&&s.append("notes",Ns);try{const t=await wa(),w=await fetch("/api/user/documents/upload",{method:"POST",headers:{"X-CSRF-Token":t},body:s,credentials:"include"});if(w.ok)l({title:a("dashboard.toasts.documentUploadedClient"),description:a("dashboard.toasts.documentUploadedClientDesc")}),S.invalidateQueries({queryKey:["/api/user/documents"]}),sa({open:!1,file:null});else{const b=await w.json();l({title:a("common.error"),description:b.message||a("dashboard.toasts.couldNotUpload"),variant:"destructive"})}}catch{l({title:a("common.error"),description:a("dashboard.toasts.connectionError"),variant:"destructive"})}},disabled:rs==="other"&&!Ns.trim(),className:"w-full bg-accent text-accent-foreground font-bold rounded-full h-12","data-testid":"button-send-document",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"})," Enviar Documento"]})]}):e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:s=>{const t=s.target.files?.[0];t&&(sa({open:!1,file:t}),Pa("passport"),$a(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(ka,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground text-base md:text-lg",children:a("dashboard.documents.uploadDocument")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:a("dashboard.documents.maxSize")})]}),e.jsx(n,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",asChild:!0,children:e.jsxs("span",{children:[e.jsx(ze,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Subir"})]})})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Vt?.map(s=>e.jsxs(h,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-card",children:[e.jsx(ze,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:s.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:new Date(s.createdAt||s.uploadedAt).toLocaleDateString()}),s.uploader&&e.jsxs("p",{className:"text-[9px] text-accent mb-1",children:["Subido por: ",s.uploader.firstName," ",s.uploader.lastName]}),e.jsxs("div",{className:"flex gap-2 w-full mt-3",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(s.fileUrl,"_blank"),"data-testid":`button-download-doc-${s.id}`,children:[e.jsx(Sa,{className:"w-3 h-3 mr-1"})," Descargar"]}),T&&e.jsx(n,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>rt.mutate(s.id),disabled:rt.isPending,"data-testid":`button-delete-doc-${s.id}`,children:e.jsx(ge,{className:"w-3 h-3"})})]})]},s.id))})]},"documents"),N==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-foreground tracking-tight",children:a("dashboard.payments.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a("dashboard.payments.subtitle")})]}),e.jsx("div",{className:"space-y-4",children:!$||$.length===0?e.jsx(h,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-card p-6 md:p-8 text-center","data-testid":"widget-payments-empty",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx(ud,{className:"w-12 h-12 md:w-16 md:h-16 text-accent"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:a("dashboard.payments.empty")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:a("dashboard.payments.emptyDesc")})]}),e.jsx(Ne,{href:"/servicios#pricing",children:e.jsxs(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-view-services",children:[e.jsx(mt,{className:"w-4 h-4 mr-2"})," ",a("dashboard.payments.viewServices")]})})]})}):$.map(s=>e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-card",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",s.application?.requestCode||s.maintenanceApplication?.requestCode||s.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(n,{variant:"outline",size:"sm",className:"rounded-full",onClick:()=>window.open(`/api/orders/${s.id}/invoice`,"_blank"),children:a("dashboard.payments.invoice")})})]},s.id))})]},"payments"),N==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-foreground tracking-tight",children:a("dashboard.calendar.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a("dashboard.calendar.subtitle")})]})}),$&&$.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:$.map(s=>{const t=s.application;if(!t)return null;const w=s.status==="cancelled",b=["pending","paid","processing"].includes(s.status),V=["Wyoming","Delaware","WY","DE"].includes(t.state),X=[{label:a("dashboard.calendar.creation"),fullLabel:a("dashboard.calendar.creationFull"),date:t.llcCreatedDate,icon:hs,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:a("dashboard.calendar.agent"),fullLabel:a("dashboard.calendar.agentFull"),date:t.agentRenewalDate,icon:hd,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:a("dashboard.calendar.irs1120"),date:t.irs1120DueDate,icon:be,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:a("dashboard.calendar.irs5472"),date:t.irs5472DueDate,icon:be,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...V?[{label:a("dashboard.calendar.annual"),fullLabel:`${a("dashboard.calendar.annualFull")} ${t.state}`,date:t.annualReportDueDate,icon:pd,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],q=X.some(J=>J.date),Ie=X.filter(J=>J.date).sort((J,cs)=>new Date(J.date).getTime()-new Date(cs.date).getTime()),Re=Ie.find(J=>new Date(J.date)>new Date);return e.jsxs(h,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-card overflow-hidden ${w?"opacity-50":""}`,children:[e.jsx(Ws,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(Xs,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(hs,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:t.companyName||a("dashboard.llcStatus.inProcess")}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:t.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[w&&e.jsx(L,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:a("dashboard.calendar.cancelled")}),b&&e.jsx(L,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:a("dashboard.calendar.inReview")}),!w&&!b&&Re&&e.jsxs(L,{className:`text-[9px] md:text-[10px] ${Re.bgColor} ${Re.textColor}`,children:[a("dashboard.calendar.next"),": ",Re.label]})]})]})}),e.jsx(Z,{className:"p-3 md:p-4",children:w?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(ps,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:a("dashboard.llcStatus.cancelled")})]}):b?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Te,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:a("dashboard.llcStatus.inProcess")}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:a("dashboard.llcStatus.datesWillAppear")})]}):q?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:Ie.map((J,cs)=>{const Ks=new Date(J.date),lt=new Date,Je=Math.ceil((Ks.getTime()-lt.getTime())/(1e3*60*60*24)),fa=Ks<lt,Xt=!fa&&Je<=30,Yt=!fa&&Je<=60&&Je>30,Jt=J.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${J.borderColor} ${J.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${J.textColor}`,children:[e.jsx(Jt,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:J.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:Ks.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:Ks.getFullYear()}),fa?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Bs,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:a("dashboard.calendar.completed")})]}):Xt?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(xs,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[Je," ",a("dashboard.calendar.days")]})]}):Yt?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Te,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[Je," ",a("dashboard.calendar.days")]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[Je," ",a("dashboard.calendar.days")]})})]},cs)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ae,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto opacity-30 mb-2 md:mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:a("dashboard.calendar.pendingDates")})]})})]},s.id)})}):e.jsx(h,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-card p-6 md:p-8 text-center","data-testid":"widget-calendar-empty",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx(Ae,{className:"w-10 h-10 md:w-12 md:h-12 text-accent"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:a("dashboard.calendar.title")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:a("dashboard.calendar.emptyDescription")})]}),e.jsx(Ne,{href:"/servicios#pricing",children:e.jsx(n,{className:"bg-accent text-accent-foreground font-semibold rounded-full px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-start-llc-calendar",children:a("dashboard.calendar.createLlc")})})]})})]},"calendar"),N==="tools"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-foreground tracking-tight",children:a("dashboard.tools.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a("dashboard.tools.subtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ut,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"font-bold text-foreground",children:a("dashboard.clientTools.invoiceGenerator")})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:a("dashboard.clientTools.invoiceDescription")}),e.jsx(Ne,{href:"/tools/invoice",children:e.jsxs(n,{className:"bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-full",size:"sm","data-testid":"button-invoice-generator",children:[a("dashboard.clientTools.createInvoice")," ",e.jsx(Ze,{className:"w-4 h-4 ml-1"})]})})]})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Na,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"font-bold text-foreground",children:a("dashboard.clientTools.priceCalculator")})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:a("dashboard.clientTools.calculatorDescription")}),e.jsx(Ne,{href:"/tools/price-calculator",children:e.jsxs(n,{className:"bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-full",size:"sm","data-testid":"button-price-calculator",children:[a("dashboard.clientTools.calculate")," ",e.jsx(Ze,{className:"w-4 h-4 ml-1"})]})})]})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ht,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"font-bold text-foreground",children:a("dashboard.clientTools.operatingAgreement")})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:a("dashboard.clientTools.operatingDescription")}),e.jsx(Ne,{href:"/tools/operating-agreement",children:e.jsxs(n,{className:"bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-full",size:"sm","data-testid":"button-operating-agreement",children:[a("dashboard.clientTools.generateDocument")," ",e.jsx(Ze,{className:"w-4 h-4 ml-1"})]})})]})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(be,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"font-bold text-foreground",children:a("tools.csvGenerator.toolTitle")})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:a("tools.csvGenerator.toolDescription")}),e.jsx(Ne,{href:"/tools/csv-generator",children:e.jsxs(n,{className:"bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-full",size:"sm","data-testid":"button-csv-generator",children:[a("tools.csvGenerator.openTool")," ",e.jsx(Ze,{className:"w-4 h-4 ml-1"})]})})]})})]})]},"tools"),N==="profile"&&e.jsxs(e.Fragment,{children:[e.jsx(Vd,{user:r??null,canEdit:T,isEditing:p,setIsEditing:D,profileData:O,setProfileData:R,updateProfile:qt,showPasswordForm:Dt,setShowPasswordForm:Ia,passwordStep:Tt,setPasswordStep:aa,currentPassword:Et,setCurrentPassword:qa,newPassword:Lt,setNewPassword:Fa,confirmPassword:Pt,setConfirmPassword:Ma,passwordOtp:$t,setPasswordOtp:Ua,requestPasswordOtpMutation:Qt,changePasswordMutation:_t,setShowEmailVerification:Es,setDeleteOwnAccountDialog:ea,profileOtpStep:Ra,setProfileOtpStep:ta,profileOtp:da,setProfileOtp:za,confirmProfileWithOtp:Ft}),It&&e.jsx(h,{className:"mt-6 rounded-2xl border-accent/30 shadow-lg animate-in slide-in-from-top-2 duration-300",children:e.jsxs(Z,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-foreground",children:a("dashboard.profile.verifyEmail")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("dashboard.profile.verifyEmailDesc")})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{Es(!1),os("")},className:"rounded-full","data-testid":"button-close-email-verification",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:a("dashboard.profile.verificationCode")}),e.jsx(y,{value:ke,onChange:s=>os(s.target.value.replace(/\D/g,"")),className:"rounded-xl text-center text-2xl font-black border-border bg-background dark:bg-[#1A1A1A] h-14 tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code",placeholder:"000000","data-testid":"input-email-verification-code"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(n,{onClick:async()=>{if(!ke||ke.length<6){l({title:a("dashboard.toasts.enter6DigitCode"),variant:"destructive"});return}Ps(!0);try{(await(await k("POST","/api/auth/verify-email",{code:ke})).json()).success&&(await S.refetchQueries({queryKey:["/api/auth/user"]}),l({title:a("dashboard.toasts.emailVerified")}),Es(!1),os(""))}catch(s){l({title:a("dashboard.toasts.incorrectCode"),description:s.message||a("dashboard.toasts.incorrectCodeDesc"),variant:"destructive"})}finally{Ps(!1)}},disabled:Ls||ke.length<6,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-verify-email-code",children:Ls?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):a("dashboard.profile.verifyEmail")}),e.jsx(n,{variant:"outline",onClick:async()=>{Is(!0);try{await k("POST","/api/auth/resend-verification"),l({title:a("dashboard.toasts.codeSent"),description:a("dashboard.toasts.codeSentDesc")})}catch{l({title:a("common.error"),description:a("dashboard.toasts.couldNotSend"),variant:"destructive"})}finally{Is(!1)}},disabled:$s,className:"rounded-full","data-testid":"button-resend-verification-code",children:$s?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):a("dashboard.profile.resendCode")})]})]})]})}),St&&e.jsx(h,{className:"mt-6 rounded-2xl border-red-500/30 shadow-lg animate-in slide-in-from-top-2 duration-300",children:e.jsxs(Z,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-red-600",children:a("dashboard.profile.deleteAccount")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("dashboard.profile.deleteAccountWarning")})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>ea(!1),className:"rounded-full","data-testid":"button-close-delete-account",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl mb-4",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:a("dashboard.profile.deleteAccountConfirm")})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(n,{variant:"destructive",onClick:()=>ba.mutate(),disabled:ba.isPending,className:"flex-1 rounded-full font-black","data-testid":"button-confirm-delete-account",children:ba.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):a("dashboard.profile.deleteAccount")}),e.jsx(n,{variant:"outline",onClick:()=>ea(!1),className:"rounded-full",children:a("common.cancel")})]})]})})]}),N==="admin"&&r?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 mb-4 md:mb-6",children:[{id:"dashboard",label:"Métricas",mobileLabel:"Métricas",icon:gd},{id:"orders",label:"Pedidos",mobileLabel:"Pedidos",icon:Hs},{id:"consultations",label:"Consultas",mobileLabel:"Consult.",icon:Oe},{id:"incomplete",label:"Incompletas",mobileLabel:"Incompl.",icon:xs},{id:"users",label:"Clientes",mobileLabel:"Clientes",icon:jt},{id:"facturas",label:"Facturas",mobileLabel:"Facturas",icon:ut},{id:"accounting",label:"Contabilidad",mobileLabel:"Contab.",icon:Na},{id:"calendar",label:a("dashboard.calendar.dates"),mobileLabel:a("dashboard.calendar.dates"),icon:Ae},{id:"docs",label:"Docs",mobileLabel:"Docs",icon:be},{id:"newsletter",label:"News",mobileLabel:"News",icon:us},{id:"inbox",label:"Inbox",mobileLabel:"Inbox",icon:Oe},{id:"descuentos",label:"Descuentos",mobileLabel:"Desc",icon:bd}].map(s=>e.jsxs(n,{variant:se===s.id?"default":"outline",onClick:()=>Ct(s.id),size:"sm",className:`flex items-center justify-center gap-1.5 rounded-full font-bold text-[10px] sm:text-xs h-9 px-3 ${se===s.id?"bg-accent text-primary shadow-md":"bg-white dark:bg-card text-muted-foreground border border-border hover:border-accent/50"}`,"data-testid":`button-admin-tab-${s.id}`,children:[e.jsx(s.icon,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"truncate",children:s.mobileLabel})]},s.id))}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 mb-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{variant:"ghost",size:"sm",className:`rounded-full text-xs font-semibold shadow-sm ${Js?"bg-accent text-accent-foreground":"bg-white dark:bg-[#1A1A1A]"}`,onClick:()=>bs(!Js),"data-testid":"button-create-user",children:[e.jsx(es,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:a("dashboard.admin.newClient")}),e.jsx("span",{className:"sm:hidden",children:a("dashboard.admin.newClient")})]}),e.jsxs(n,{variant:"ghost",size:"sm",className:`rounded-full text-xs font-semibold shadow-sm ${Zs?"bg-accent text-accent-foreground":"bg-white dark:bg-[#1A1A1A]"}`,onClick:()=>fs(!Zs),"data-testid":"button-create-order",children:[e.jsx(es,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),e.jsxs("div",{className:"relative flex-1 max-w-xs min-w-48",children:[e.jsx(fd,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(y,{placeholder:a("dashboard.admin.searchPlaceholder"),value:we,onChange:s=>At(s.target.value),className:"pl-9 rounded-full text-xs bg-white dark:bg-[#1A1A1A] border-border","data-testid":"input-admin-search"})]})]}),Js&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a("dashboard.admin.newClient")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("dashboard.admin.configureOrder")})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>bs(!1),className:"rounded-full","data-testid":"button-close-create-user",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Nombre"}),e.jsx(y,{value:Pe.firstName,onChange:s=>Ve(t=>({...t,firstName:s.target.value})),placeholder:"Nombre",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Apellidos"}),e.jsx(y,{value:Pe.lastName,onChange:s=>Ve(t=>({...t,lastName:s.target.value})),placeholder:"Apellidos",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Email"}),e.jsx(y,{type:"email",value:Pe.email,onChange:s=>Ve(t=>({...t,email:s.target.value})),placeholder:"email@ejemplo.com",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Teléfono"}),e.jsx(y,{value:Pe.phone,onChange:s=>Ve(t=>({...t,phone:s.target.value})),placeholder:"+34 600 000 000",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Contraseña"}),e.jsx(y,{type:"password",value:Pe.password,onChange:s=>Ve(t=>({...t,password:s.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-create-user-password"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:()=>pa.mutate(Pe),disabled:pa.isPending||!Pe.email||!Pe.password,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-confirm-create-user",children:pa.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):a("dashboard.admin.createClient")}),e.jsx(n,{variant:"outline",onClick:()=>bs(!1),className:"flex-1 rounded-full","data-testid":"button-cancel-create-user",children:a("common.cancel")})]})]}),Zs&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a("dashboard.admin.createOrder")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("dashboard.admin.configureOrder")})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>fs(!1),className:"rounded-full","data-testid":"button-close-create-order",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:a("dashboard.admin.orderType")}),e.jsxs(U,{value:oe.orderType,onValueChange:s=>{const t=s,w=t==="maintenance"?oe.state==="Wyoming"?"699":oe.state==="Delaware"?"999":"539":oe.state==="Wyoming"?"899":oe.state==="Delaware"?"1399":"739";ts(b=>({...b,orderType:t,amount:w}))},placeholder:a("dashboard.admin.selectOrderType"),className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"select-order-type",children:[e.jsx(x,{value:"llc",children:a("dashboard.admin.llcCreation")}),e.jsx(x,{value:"maintenance",children:a("dashboard.admin.maintenanceService")})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:a("dashboard.admin.client")}),e.jsx(U,{value:oe.userId,onValueChange:s=>ts(t=>({...t,userId:s})),placeholder:a("dashboard.admin.selectClient"),className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"select-order-user",children:Fe?.map(s=>e.jsxs(x,{value:s.id,children:[s.firstName," ",s.lastName," (",s.email,")"]},s.id))})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:a("dashboard.admin.state")}),e.jsx(U,{value:oe.state,onValueChange:s=>{const t=oe.orderType==="maintenance"?{"New Mexico":"539",Wyoming:"699",Delaware:"999"}:{"New Mexico":"739",Wyoming:"899",Delaware:"1399"};ts(w=>({...w,state:s,amount:t[s]||w.amount}))},placeholder:a("dashboard.admin.selectState"),className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"select-order-state",children:oe.orderType==="maintenance"?e.jsxs(e.Fragment,{children:[e.jsx(x,{value:"New Mexico",children:"New Mexico - 539€"}),e.jsx(x,{value:"Wyoming",children:"Wyoming - 699€"}),e.jsx(x,{value:"Delaware",children:"Delaware - 999€"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(x,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(x,{value:"Delaware",children:"Delaware - 1399€"})]})})]}),e.jsxs("div",{children:[e.jsxs(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:[a("dashboard.admin.amount")," (€)"]}),e.jsx(y,{type:"number",value:oe.amount,onChange:s=>ts(t=>({...t,amount:s.target.value})),placeholder:"739",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-order-amount"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:()=>ga.mutate(oe),disabled:ga.isPending||!oe.userId||!oe.amount,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-confirm-create-order",children:ga.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):a("dashboard.admin.createOrderBtn")}),e.jsx(n,{variant:"outline",onClick:()=>fs(!1),className:"flex-1 rounded-full","data-testid":"button-cancel-create-order",children:a("common.cancel")})]})]}),I.open&&I.user&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Enviar Mensaje al Cliente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>m({open:!1,user:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Título"}),e.jsx(y,{value:je,onChange:s=>me(s.target.value),placeholder:"Título del mensaje",className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Mensaje"}),e.jsx(ve,{value:xe,onChange:s=>ye(s.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-border bg-background dark:bg-[#1A1A1A]","data-testid":"input-note-message"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:()=>I.user?.id&&Xe.mutate({userId:I.user.id,title:je,message:xe,type:ss}),disabled:!je||!xe||Xe.isPending,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-send-note",children:Xe.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"}),e.jsx(n,{variant:"outline",onClick:()=>m({open:!1,user:null}),className:"flex-1 rounded-full",children:"Cancelar"})]})]}),v&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Editar Usuario"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>E(null),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Nombre"}),e.jsx(y,{value:v.firstName||"",onChange:s=>E({...v,firstName:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Apellidos"}),e.jsx(y,{value:v.lastName||"",onChange:s=>E({...v,lastName:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Email"}),e.jsx(y,{value:v.email||"",onChange:s=>E({...v,email:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Teléfono"}),e.jsx(y,{value:v.phone||"",onChange:s=>E({...v,phone:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Tipo ID"}),e.jsxs(U,{value:v.idType||"",onValueChange:s=>E({...v,idType:s}),placeholder:"Seleccionar",className:"w-full rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]",children:[e.jsx(x,{value:"dni",children:"DNI"}),e.jsx(x,{value:"nie",children:"NIE"}),e.jsx(x,{value:"passport",children:"Pasaporte"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Número ID"}),e.jsx(y,{value:v.idNumber||"",onChange:s=>E({...v,idNumber:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Fecha Nacimiento"}),e.jsx(y,{type:"date",value:v.birthDate||"",onChange:s=>E({...v,birthDate:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Actividad de Negocio"}),e.jsxs(U,{value:v.businessActivity||"",onValueChange:s=>E({...v,businessActivity:s}),placeholder:a("common.select"),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"select-edit-activity",children:[e.jsx(x,{value:"ecommerce",children:a("auth.register.businessActivities.ecommerce")}),e.jsx(x,{value:"dropshipping",children:a("auth.register.businessActivities.dropshipping")}),e.jsx(x,{value:"consulting",children:a("auth.register.businessActivities.consulting")}),e.jsx(x,{value:"marketing",children:a("auth.register.businessActivities.marketing")}),e.jsx(x,{value:"software",children:a("auth.register.businessActivities.software")}),e.jsx(x,{value:"saas",children:a("auth.register.businessActivities.saas")}),e.jsx(x,{value:"apps",children:a("auth.register.businessActivities.apps")}),e.jsx(x,{value:"ai",children:a("auth.register.businessActivities.ai")}),e.jsx(x,{value:"investments",children:a("auth.register.businessActivities.investments")}),e.jsx(x,{value:"tradingEducation",children:a("auth.register.businessActivities.tradingEducation")}),e.jsx(x,{value:"financial",children:a("auth.register.businessActivities.financial")}),e.jsx(x,{value:"crypto",children:a("auth.register.businessActivities.crypto")}),e.jsx(x,{value:"realestate",children:a("auth.register.businessActivities.realestate")}),e.jsx(x,{value:"import",children:a("auth.register.businessActivities.import")}),e.jsx(x,{value:"coaching",children:a("auth.register.businessActivities.coaching")}),e.jsx(x,{value:"content",children:a("auth.register.businessActivities.content")}),e.jsx(x,{value:"affiliate",children:a("auth.register.businessActivities.affiliate")}),e.jsx(x,{value:"freelance",children:a("auth.register.businessActivities.freelance")}),e.jsx(x,{value:"gaming",children:a("auth.register.businessActivities.gaming")}),e.jsx(x,{value:"digitalProducts",children:a("auth.register.businessActivities.digitalProducts")}),e.jsx(x,{value:"other",children:a("auth.register.businessActivities.other")})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Dirección"}),e.jsx(y,{value:v.address||"",onChange:s=>E({...v,address:s.target.value}),placeholder:"Calle y número",className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Ciudad"}),e.jsx(y,{value:v.city||"",onChange:s=>E({...v,city:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"CP"}),e.jsx(y,{value:v.postalCode||"",onChange:s=>E({...v,postalCode:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Provincia"}),e.jsx(y,{value:v.province||"",onChange:s=>E({...v,province:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"País"}),e.jsx(y,{value:v.country||"",onChange:s=>E({...v,country:s.target.value}),className:"rounded-xl h-10 px-3 border border-gray-200 dark:border-border text-sm bg-white dark:bg-[#1A1A1A]","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-foreground mb-1.5 block",children:"Notas Internas"}),e.jsx(ve,{value:v.internalNotes||"",onChange:s=>E({...v,internalNotes:s.target.value}),rows:2,className:"rounded-xl border-border bg-background dark:bg-[#1A1A1A] text-sm","data-testid":"input-edit-notes"})]}),r?.email==="afortuny07@gmail.com"&&e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-black text-purple-700 dark:text-purple-300",children:"Permisos de Administrador"}),e.jsx("p",{className:"text-[10px] text-purple-600 dark:text-purple-400",children:"Solo tú puedes cambiar esto"})]}),e.jsx(Da,{checked:v.isAdmin||!1,onCheckedChange:s=>E({...v,isAdmin:s}),"data-testid":"switch-admin-toggle"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-4 border-t mt-4",children:[e.jsx(n,{type:"button",onClick:s=>{s.preventDefault(),v.id&&zs.mutate({id:v.id,...v})},disabled:zs.isPending,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-save-user",children:zs.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"}),e.jsx(n,{type:"button",variant:"outline",onClick:s=>{s.preventDefault(),E(null)},className:"flex-1 rounded-full",children:"Cancelar"})]})]}),Ke.open&&Ke.user&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-red-300 dark:border-red-800 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-black text-red-600",children:"Eliminar Usuario"}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>js({open:!1,user:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[Ke.user?.firstName," ",Ke.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(n,{variant:"destructive",onClick:()=>Ke.user?.id&&ca.mutate(Ke.user.id),disabled:ca.isPending,className:"flex-1 rounded-full font-black","data-testid":"button-confirm-delete",children:ca.isPending?"Eliminando...":"Eliminar"}),e.jsx(n,{variant:"outline",onClick:()=>js({open:!1,user:null}),className:"flex-1 rounded-full",children:"Cancelar"})]})]}),De.open&&De.order&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-red-300 dark:border-red-800 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-black text-red-600",children:"Eliminar Pedido"}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>Os({open:!1,order:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:De.order?.application?.requestCode||De.order?.maintenanceApplication?.requestCode||De.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",De.order?.user?.firstName," ",De.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(n,{variant:"destructive",onClick:()=>De.order?.id&&ua.mutate(De.order.id),disabled:ua.isPending,className:"flex-1 rounded-full font-black","data-testid":"button-confirm-delete-order",children:ua.isPending?"Eliminando...":"Eliminar Pedido"}),e.jsx(n,{variant:"outline",onClick:()=>Os({open:!1,order:null}),className:"flex-1 rounded-full",children:"Cancelar"})]})]}),Ue.open&&Ue.order&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Generar Factura"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",Ue.order?.application?.requestCode||Ue.order?.maintenanceApplication?.requestCode||Ue.order?.invoiceNumber]})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>Vs({open:!1,order:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Importe"}),e.jsx(y,{type:"number",step:"0.01",value:Ye,onChange:s=>ma(s.target.value),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Divisa"}),e.jsxs(U,{value:xa,onValueChange:dt,className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]",children:[e.jsx(x,{value:"EUR",children:"EUR (€)"}),e.jsx(x,{value:"USD",children:"USD ($)"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full",disabled:!Ye||isNaN(parseFloat(Ye))||parseFloat(Ye)<=0||Ba,onClick:async()=>{Ha(!0);try{const s=Math.round(parseFloat(Ye)*100);if(s<=0){l({title:a("common.error"),description:a("dashboard.toasts.amountMustBeGreater"),variant:"destructive"});return}const t=await k("POST",`/api/admin/orders/${Ue.order?.id}/generate-invoice`,{amount:s,currency:xa});if(!t.ok){const w=await t.json().catch(()=>({}));throw new Error(w.message||a("dashboard.toasts.couldNotGenerate"))}l({title:a("dashboard.toasts.invoiceGenerated"),description:a("dashboard.toasts.invoiceGeneratedDesc",{amount:Ye,currency:xa})}),S.invalidateQueries({queryKey:["/api/admin/orders"]}),S.invalidateQueries({queryKey:["/api/user/documents"]}),window.open(`/api/orders/${Ue.order?.id}/invoice`,"_blank"),Vs({open:!1,order:null}),ma("")}catch(s){l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotGenerate"),variant:"destructive"})}finally{Ha(!1)}},"data-testid":"button-confirm-generate-invoice",children:Ba?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Generar Factura"}),e.jsx(n,{variant:"outline",onClick:()=>Vs({open:!1,order:null}),className:"flex-1 rounded-full",children:"Cancelar"})]})]}),de.open&&de.user&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Solicitar Documentos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>re({open:!1,user:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Tipo de documento"}),e.jsxs(U,{value:ie,onValueChange:f,placeholder:"Seleccionar tipo...",className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]",children:[e.jsx(x,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(x,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(x,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(x,{value:"other",children:"Otro Documento"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Mensaje"}),e.jsx(ve,{value:B,onChange:s=>g(s.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-border bg-background dark:bg-[#1A1A1A]","data-testid":"input-doc-message"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:()=>{if(de.user?.id&&de.user?.email){const t={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[ie]||ie;Xe.mutate({userId:de.user.id,title:`Solicitud de Documento: ${t}`,message:B||`Por favor, sube tu ${t} a tu panel de cliente.`,type:"action_required"}),re({open:!1,user:null}),f(""),g("")}},disabled:!ie||Xe.isPending,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-request-doc",children:Xe.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"}),e.jsx(n,{variant:"outline",onClick:()=>re({open:!1,user:null}),className:"flex-1 rounded-full",children:"Cancelar"})]})]}),ne.open&&ne.user&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Crear Factura"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",ne.user?.firstName," ",ne.user?.lastName]})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>H({open:!1,user:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Concepto"}),e.jsx(y,{value:A,onChange:s=>o(s.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Importe"}),e.jsx(y,{type:"number",value:G,onChange:s=>ue(s.target.value),placeholder:"739",className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Moneda"}),e.jsxs(U,{value:he,onValueChange:as,className:"w-full rounded-xl h-11 px-3 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"select-invoice-currency",children:[e.jsx(x,{value:"EUR",children:"EUR"}),e.jsx(x,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:()=>ne.user?.id&&ha.mutate({userId:ne.user.id,concept:A,amount:Math.round(parseFloat(G)*100),currency:he}),disabled:!A||!G||ha.isPending,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-create-invoice",children:ha.isPending?"Creando...":"Crear Factura"}),e.jsx(n,{variant:"outline",onClick:()=>H({open:!1,user:null}),className:"flex-1 rounded-full",children:"Cancelar"})]})]}),qe.open&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:qe.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:qe.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>ns({open:!1,code:null}),className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Código"}),e.jsx(y,{value:Q.code,onChange:s=>Ce(t=>({...t,code:s.target.value.toUpperCase()})),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border uppercase bg-white dark:bg-[#1A1A1A]",disabled:!!qe.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Tipo"}),e.jsxs(U,{value:Q.discountType,onValueChange:s=>Ce(t=>({...t,discountType:s})),className:"w-full rounded-xl h-11 px-3 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"select-discount-type",children:[e.jsx(x,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(x,{value:"fixed",children:"Fijo (centimos)"})]})]}),e.jsxs("div",{children:[e.jsxs(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:["Valor ",Q.discountType==="percentage"?"(%)":"(cts)"]}),e.jsx(y,{type:"number",value:Q.discountValue,onChange:s=>Ce(t=>({...t,discountValue:s.target.value})),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Min. (EUR)"}),e.jsx(y,{type:"number",value:Q.minOrderAmount,onChange:s=>Ce(t=>({...t,minOrderAmount:s.target.value})),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Usos max."}),e.jsx(y,{type:"number",value:Q.maxUses,onChange:s=>Ce(t=>({...t,maxUses:s.target.value})),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Desde"}),e.jsx(y,{type:"date",value:Q.validFrom,onChange:s=>Ce(t=>({...t,validFrom:s.target.value})),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Hasta"}),e.jsx(y,{type:"date",value:Q.validUntil,onChange:s=>Ce(t=>({...t,validUntil:s.target.value})),className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Da,{checked:Q.isActive,onCheckedChange:s=>Ce(t=>({...t,isActive:s})),"data-testid":"switch-discount-active"}),e.jsx(c,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 border-t mt-4",children:[e.jsx(n,{onClick:async()=>{try{const s={code:Q.code,discountType:Q.discountType,discountValue:parseInt(Q.discountValue),minOrderAmount:Q.minOrderAmount?parseInt(Q.minOrderAmount)*100:null,maxUses:Q.maxUses?parseInt(Q.maxUses):null,validFrom:Q.validFrom||null,validUntil:Q.validUntil||null,isActive:Q.isActive};qe.code?(await k("PATCH",`/api/admin/discount-codes/${qe.code.id}`,s),l({title:a("dashboard.toasts.discountCodeUpdated")})):(await k("POST","/api/admin/discount-codes",s),l({title:a("dashboard.toasts.discountCodeCreated")})),oa(),ns({open:!1,code:null})}catch(s){l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotSave"),variant:"destructive"})}},disabled:!Q.code||!Q.discountValue,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-save-discount",children:qe.code?"Guardar Cambios":"Crear Código"}),e.jsx(n,{variant:"outline",onClick:()=>ns({open:!1,code:null}),className:"flex-1 rounded-full","data-testid":"button-cancel-discount",children:"Cancelar"})]})]}),Qe.open&&Qe.user&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-foreground",children:"Enviar Link de Pago"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Envía un enlace de pago a ",Qe.user?.firstName," ",Qe.user?.lastName]})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{vs({open:!1,user:null}),ws(""),ks(""),Cs("")},className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:"Link de pago (URL)"}),e.jsx(y,{value:ys,onChange:s=>ws(s.target.value),placeholder:"https://...",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:"Importe"}),e.jsx(y,{value:is,onChange:s=>ks(s.target.value),placeholder:"Ej: 739€",className:"rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:"Mensaje (opcional)"}),e.jsx(ve,{value:Ka,onChange:s=>Cs(s.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-border bg-background dark:bg-[#1A1A1A]",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{onClick:async()=>{if(!ys||!is){l({title:a("form.validation.requiredFields"),variant:"destructive"});return}_a(!0);try{await k("POST","/api/admin/send-payment-link",{userId:Qe.user?.id,paymentLink:ys,amount:is,message:Ka||`Por favor, completa el pago de ${is} a través del siguiente enlace.`}),l({title:a("dashboard.toasts.paymentLinkSent"),description:a("dashboard.toasts.paymentLinkSentDesc",{email:Qe.user?.email})}),vs({open:!1,user:null}),ws(""),ks(""),Cs("")}catch(s){l({title:a("common.error"),description:s.message||a("dashboard.toasts.couldNotSendLink"),variant:"destructive"})}finally{_a(!1)}},disabled:Qa||!ys||!is,className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-send-payment-link",children:Qa?e.jsx(Y,{className:"animate-spin"}):"Enviar Link de Pago"}),e.jsx(n,{variant:"outline",onClick:()=>{vs({open:!1,user:null}),ws(""),ks(""),Cs("")},className:"flex-1 rounded-full",children:"Cancelar"})]})]}),pe.open&&pe.order&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Subir Documento para Cliente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:pe.order?.userId?`Usuario: ${pe.order?.user?.firstName} ${pe.order?.user?.lastName}`:`Pedido: ${pe.order?.application?.requestCode||pe.order?.maintenanceApplication?.requestCode||pe.order?.invoiceNumber}`})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{ls({open:!1,order:null}),Be(null),As("articles_of_organization")},className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:"Tipo de Documento"}),e.jsxs(U,{value:Ga,onValueChange:As,className:"w-full rounded-xl h-11 px-4 border border-gray-200 dark:border-border bg-white dark:bg-[#1A1A1A]",children:[e.jsx(x,{value:"articles_of_organization",children:"Artículos de Organización"}),e.jsx(x,{value:"certificate_of_formation",children:"Certificado de Formación"}),e.jsx(x,{value:"boir",children:"BOIR"}),e.jsx(x,{value:"ein_document",children:"Documento EIN"}),e.jsx(x,{value:"operating_agreement",children:"Acuerdo Operativo"}),e.jsx(x,{value:"invoice",children:"Factura"}),e.jsx(x,{value:"other",children:"Otro Documento"})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:"Archivo"}),e.jsxs("label",{className:"cursor-pointer block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:s=>{const t=s.target.files?.[0];t&&Be(t)}}),e.jsx("div",{className:`p-4 border-2 border-dashed rounded-xl text-center ${_e?"border-accent bg-accent/5":"border-gray-200 dark:border-border"}`,children:_e?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px]",children:_e.name})]}):e.jsxs("div",{className:"text-muted-foreground text-sm",children:[e.jsx(ka,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),"Haz clic para seleccionar archivo"]})})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{disabled:!_e||Wa,onClick:async()=>{if(!(!_e||!pe.order)){Xa(!0);try{const s=new FormData;s.append("file",_e),s.append("documentType",Ga),pe.order.userId?s.append("userId",pe.order.userId):s.append("orderId",pe.order.id);const t=await wa(),w=await fetch("/api/admin/documents/upload",{method:"POST",headers:{"X-CSRF-Token":t},body:s,credentials:"include"});if(w.ok)l({title:a("dashboard.toasts.adminDocUploaded"),description:a("dashboard.toasts.adminDocUploadedDesc")}),S.invalidateQueries({queryKey:["/api/admin/documents"]}),S.invalidateQueries({queryKey:["/api/user/documents"]}),ls({open:!1,order:null}),Be(null);else{const b=await w.json();l({title:a("common.error"),description:b.message||a("dashboard.toasts.couldNotUpload"),variant:"destructive"})}}catch{l({title:a("common.error"),description:a("dashboard.toasts.connectionError"),variant:"destructive"})}finally{Xa(!1)}}},className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-admin-upload-doc",children:Wa?e.jsx(Y,{className:"animate-spin"}):"Subir Documento"}),e.jsx(n,{variant:"outline",onClick:()=>{ls({open:!1,order:null}),Be(null)},className:"flex-1 rounded-full",children:"Cancelar"})]})]}),He.open&&He.user&&e.jsxs(h,{className:"mb-4 p-4 md:p-6 rounded-2xl border border-accent/30 bg-white dark:bg-card shadow-lg animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-foreground",children:"Restablecer Contraseña"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nueva contraseña para ",He.user?.firstName," ",He.user?.lastName]})]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{Ss({open:!1,user:null}),Ts("")},className:"rounded-full",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-semibold text-foreground block mb-2",children:"Nueva Contraseña"}),e.jsx(y,{type:"password",value:Ds,onChange:s=>Ts(s.target.value),placeholder:"Mínimo 8 caracteres",className:"rounded-xl h-12 border-border bg-background dark:bg-[#1A1A1A]","data-testid":"input-admin-new-password"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t",children:[e.jsx(n,{disabled:Ds.length<8||Ya,onClick:async()=>{if(!(!He.user?.id||Ds.length<8)){Ja(!0);try{await k("POST",`/api/admin/users/${He.user.id}/reset-password`,{newPassword:Ds}),l({title:a("dashboard.toasts.adminPasswordUpdated"),description:a("dashboard.toasts.adminPasswordUpdatedDesc")}),Ss({open:!1,user:null}),Ts("")}catch{l({title:a("common.error"),description:a("dashboard.toasts.couldNotUpdatePassword"),variant:"destructive"})}finally{Ja(!1)}}},className:"flex-1 bg-accent text-accent-foreground font-semibold rounded-full","data-testid":"button-confirm-reset-password",children:Ya?e.jsx(Y,{className:"animate-spin"}):"Restablecer Contraseña"}),e.jsx(n,{variant:"outline",onClick:()=>{Ss({open:!1,user:null}),Ts("")},className:"flex-1 rounded-full",children:"Cancelar"})]})]}),se==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((ae?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((ae?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:ae?.orderCount||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[ae?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:ae?.pendingOrders||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:ae?.processingOrders||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:ae?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:ae?.userCount||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:ae?.activeAccounts||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:ae?.vipAccounts||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:ae?.pendingAccounts||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:ae?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:ae?.subscriberCount||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:ae?.totalMessages||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:ae?.pendingMessages||0})]}),e.jsxs(h,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:ae?.pendingDocs||0})]})]})]})]}),se==="orders"&&e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:Gt?.map(s=>{const t=s.application||s.maintenanceApplication,w=!!s.maintenanceApplication&&!s.application,b=t?.requestCode||s.invoiceNumber,X=t?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"flex justify-between items-start gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:b}),e.jsxs(U,{value:s.status,onValueChange:q=>Kt.mutate({id:s.id,status:q}),className:"w-28 h-7 rounded-lg text-xs bg-white dark:bg-card border px-2",children:[e.jsx(x,{value:"pending",children:"Pendiente"}),e.jsx(x,{value:"paid",children:"Pagado"}),e.jsx(x,{value:"filed",children:"Presentado"}),e.jsx(x,{value:"cancelled",children:"Cancelado"})]}),e.jsx(L,{className:`text-[9px] ${w?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:w?"MANTENIMIENTO":"LLC"}),!X&&e.jsx(L,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:t?.ownerFullName||`${s.user?.firstName||""} ${s.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?.ownerEmail||s.user?.email}),t?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",t?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",t?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",s.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(s.amount/100).toFixed(2),"€",s.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",s.discountCode," -",(s.discountAmount/100).toFixed(2),"€)"]})]}),t?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",t.businessCategory]}),w&&t?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",t.ein]})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t?.id&&e.jsxs(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>{const q=w?`/llc/maintenance?edit=${t.id}`:`/llc/formation?edit=${t.id}`;window.location.href=q},"data-testid":`btn-modify-order-${s.id}`,children:[e.jsx(jd,{className:"w-3 h-3 mr-1"})," Modificar"]}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>window.open(`/api/admin/invoice/${s.id}`,"_blank"),"data-testid":`btn-view-invoice-${s.id}`,children:"Ver Factura"}),e.jsx(n,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>{ma(((s.amount||0)/100).toFixed(2)),dt("EUR"),Vs({open:!0,order:s})},"data-testid":`btn-generate-invoice-${s.id}`,children:"Generar Factura"}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Os({open:!0,order:s}),"data-testid":`btn-delete-order-${s.id}`,children:"Eliminar"})]})]},s.id)})})}),se==="consultations"&&e.jsx(Qd,{}),se==="incomplete"&&e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20",children:[e.jsxs("h3",{className:"font-black text-sm flex items-center gap-2",children:[e.jsx(xs,{className:"w-4 h-4 text-yellow-600"}),"Solicitudes Incompletas (",(Ge?.llc?.length||0)+(Ge?.maintenance?.length||0),")"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Formularios no completados - se eliminan automáticamente tras 48h de inactividad"})]}),e.jsxs("div",{className:"divide-y",children:[[...Ge?.llc||[],...Ge?.maintenance||[]].map(s=>{const t=s.abandonedAt?Math.max(0,Math.round(48-(Date.now()-new Date(s.abandonedAt).getTime())/36e5)):null;return e.jsx("div",{className:"p-4 space-y-2","data-testid":`incomplete-app-${s.type}-${s.id}`,children:e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx(L,{className:`text-[9px] ${s.type==="maintenance"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:s.type==="maintenance"?"MANTENIMIENTO":"LLC"}),e.jsx(L,{className:"text-[9px] bg-orange-100 text-orange-700",children:"INCOMPLETA"}),t!==null&&e.jsx(L,{className:"text-[9px] bg-red-100 text-red-700",children:t>0?`Se elimina en ${t}h`:"Eliminación pendiente"})]}),s.ownerFullName&&e.jsx("p",{className:"text-sm font-bold",children:s.ownerFullName}),s.ownerEmail&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ownerEmail}),s.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ownerPhone}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 space-y-0.5",children:[s.companyName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Empresa:"})," ",s.companyName]}),s.state&&e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",s.state]}),s.remindersSent>0&&e.jsxs("p",{children:[e.jsx("strong",{children:"Recordatorios:"})," ",s.remindersSent,"/3 enviados"]}),s.lastUpdated&&e.jsxs("p",{children:[e.jsx("strong",{children:"Última actividad:"})," ",new Date(s.lastUpdated).toLocaleString("es-ES")]})]})]}),e.jsxs(n,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>at.mutate({type:s.type,id:s.id}),disabled:at.isPending,"data-testid":`btn-delete-incomplete-${s.type}-${s.id}`,children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Eliminar"]})]})},`${s.type}-${s.id}`)}),!Ge?.llc?.length&&!Ge?.maintenance?.length&&e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(Bs,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-sm font-medium",children:"No hay solicitudes incompletas"})]})]})]}),se==="users"&&e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:Wt?.map(s=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[s.firstName," ",s.lastName]}),e.jsx(L,{variant:s.accountStatus==="active"||s.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${s.accountStatus==="deactivated"?"bg-red-100 text-red-700":s.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":s.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:s.accountStatus==="active"?"VERIFICADO":s.accountStatus==="pending"?"EN REVISIÓN":s.accountStatus==="deactivated"?"DESACTIVADA":s.accountStatus==="vip"?"VIP":"VERIFICADO"}),s.isAdmin&&e.jsx(L,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[s.phone&&e.jsx("span",{className:"mr-2",children:s.phone}),s.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",s.businessActivity]}),s.city&&e.jsxs("span",{children:["• ",s.city]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[10px] text-muted-foreground",children:[s.lastLoginIp&&e.jsxs("span",{className:"flex items-center gap-1 bg-muted/50 px-2 py-0.5 rounded-full",children:[e.jsx("span",{className:"font-medium",children:"IP:"})," ",s.lastLoginIp]}),typeof s.loginCount=="number"&&e.jsxs("span",{className:"flex items-center gap-1 bg-muted/50 px-2 py-0.5 rounded-full",children:[e.jsx("span",{className:"font-medium",children:"Logins:"})," ",s.loginCount]}),s.securityOtpRequired&&e.jsx("span",{className:"flex items-center gap-1 bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full",children:"OTP Requerido"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(c,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(U,{value:s.accountStatus||"active",onValueChange:t=>s.id&&zs.mutate({id:s.id,accountStatus:t}),className:"w-full h-9 rounded-full text-xs bg-white dark:bg-card border shadow-sm px-3",children:[e.jsx(x,{value:"active",children:"Verificado"}),e.jsx(x,{value:"pending",children:"En revisión"}),e.jsx(x,{value:"deactivated",children:"Desactivada"}),e.jsx(x,{value:"vip",children:"VIP"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>E(s),"data-testid":`button-edit-user-${s.id}`,children:"Editar"}),e.jsxs(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>Ss({open:!0,user:s}),"data-testid":`button-reset-pwd-${s.id}`,children:[e.jsx(Nd,{className:"w-3 h-3 mr-1"}),"Contraseña"]}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>m({open:!0,user:s}),"data-testid":`button-note-user-${s.id}`,children:"Mensaje"}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>re({open:!0,user:s}),"data-testid":`button-doc-user-${s.id}`,children:"Docs"}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>H({open:!0,user:s}),"data-testid":`button-invoice-user-${s.id}`,children:"Factura"}),e.jsx(n,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>vs({open:!0,user:s}),"data-testid":`button-payment-link-${s.id}`,children:"Pago"}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>js({open:!0,user:s}),"data-testid":`button-delete-user-${s.id}`,children:"Eliminar"})]})]},s.id))})}),se==="calendar"&&e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsx("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6",children:"Gestión de Fechas Fiscales"}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[Se?.map(s=>{const t=s.application;if(!t)return null;const w=t?.requestCode||s.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50 dark:bg-[#1A1A1A]/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:t.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[s.user?.firstName," ",s.user?.lastName," • ",t.state]})]}),e.jsx(L,{variant:"outline",className:"text-xs w-fit",children:w})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-card p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(c,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(y,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.llcCreatedDate?new Date(t.llcCreatedDate).toISOString().split("T")[0]:"",onChange:b=>We.mutate({appId:t.id,field:"llcCreatedDate",value:b.target.value}),"data-testid":`input-llc-created-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-card p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(c,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(y,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.agentRenewalDate?new Date(t.agentRenewalDate).toISOString().split("T")[0]:"",onChange:b=>We.mutate({appId:t.id,field:"agentRenewalDate",value:b.target.value}),"data-testid":`input-agent-renewal-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-card p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(c,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(y,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.irs1120DueDate?new Date(t.irs1120DueDate).toISOString().split("T")[0]:"",onChange:b=>We.mutate({appId:t.id,field:"irs1120DueDate",value:b.target.value}),"data-testid":`input-irs1120-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-card p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(c,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(y,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.irs5472DueDate?new Date(t.irs5472DueDate).toISOString().split("T")[0]:"",onChange:b=>We.mutate({appId:t.id,field:"irs5472DueDate",value:b.target.value}),"data-testid":`input-irs5472-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-card p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(c,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(y,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.annualReportDueDate?new Date(t.annualReportDueDate).toISOString().split("T")[0]:"",onChange:b=>We.mutate({appId:t.id,field:"annualReportDueDate",value:b.target.value}),"data-testid":`input-annual-report-${t.id}`})]})]}),e.jsx("div",{className:"mt-3 md:mt-4 pt-3 md:pt-4 border-t",children:e.jsxs("div",{className:"bg-white dark:bg-card p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(c,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block",children:"EIN (Employer Identification Number)"}),e.jsx(y,{type:"text",placeholder:"XX-XXXXXXX",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3 font-mono",defaultValue:t.ein||"",onChange:b=>We.mutate({appId:t.id,field:"ein",value:b.target.value}),"data-testid":`input-ein-${t.id}`})]})}),e.jsxs("div",{className:"mt-3 md:mt-4 pt-3 md:pt-4 border-t flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs md:text-sm font-bold text-foreground",children:a("dashboard.calendar.taxExtension.label")}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:t.hasTaxExtension?a("dashboard.calendar.taxExtension.datesOctober"):a("dashboard.calendar.taxExtension.datesApril")})]}),e.jsx(n,{size:"sm",variant:t.hasTaxExtension?"default":"outline",className:`rounded-full text-xs ${t.hasTaxExtension?"bg-accent text-primary":""}`,onClick:async()=>{try{(await k("PATCH",`/api/admin/llc/${t.id}/tax-extension`,{hasTaxExtension:!t.hasTaxExtension})).ok&&(S.invalidateQueries({queryKey:["/api/admin/orders"]}),l({title:t.hasTaxExtension?a("dashboard.calendar.taxExtension.deactivated"):a("dashboard.calendar.taxExtension.activated"),description:t.hasTaxExtension?a("dashboard.calendar.taxExtension.movedToApril"):a("dashboard.calendar.taxExtension.movedToOctober")}))}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`button-tax-extension-${t.id}`,children:t.hasTaxExtension?a("dashboard.calendar.taxExtension.active"):a("dashboard.calendar.taxExtension.inactive")})]}),e.jsxs("div",{className:"mt-3 md:mt-4 pt-3 md:pt-4 border-t flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs md:text-sm font-bold text-foreground text-red-600",children:a("dashboard.calendar.clearCalendar")}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:a("dashboard.calendar.clearCalendarDesc")})]}),e.jsxs(n,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200 hover:bg-red-50",onClick:async()=>{if(confirm(a("dashboard.calendar.clearCalendarConfirm")))try{await Promise.all([k("PATCH",`/api/admin/llc/${t.id}/dates`,{field:"llcCreatedDate",value:null}),k("PATCH",`/api/admin/llc/${t.id}/dates`,{field:"agentRenewalDate",value:null}),k("PATCH",`/api/admin/llc/${t.id}/dates`,{field:"irs1120DueDate",value:null}),k("PATCH",`/api/admin/llc/${t.id}/dates`,{field:"irs5472DueDate",value:null}),k("PATCH",`/api/admin/llc/${t.id}/dates`,{field:"annualReportDueDate",value:null})]),S.invalidateQueries({queryKey:["/api/admin/orders"]}),l({title:a("dashboard.toasts.calendarCleared"),description:a("dashboard.toasts.calendarClearedDesc")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`button-clear-calendar-${t.id}`,children:[e.jsx(ge,{className:"w-3 h-3 mr-1"})," ",a("dashboard.calendar.clear")]})]})]},s.id)}),(!Se||Se.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),se==="docs"&&e.jsxs(h,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-black text-lg",children:"Documentos"}),e.jsx(L,{className:"bg-accent/20 text-accent",children:Rs?.length||0})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(U,{value:"",onValueChange:s=>{if(s){const t=Se?.find(w=>w.id===Number(s));t&&(ls({open:!0,order:t}),As("articles_of_organization"),Be(null))}},className:"h-9 text-xs rounded-full px-3 bg-accent text-primary font-bold min-w-[120px]",children:[e.jsx("option",{value:"",children:"Por pedido..."}),Se?.map(s=>e.jsxs("option",{value:s.id,children:[s.application?.requestCode||s.maintenanceApplication?.requestCode||s.invoiceNumber," - ",s.user?.firstName]},s.id))]}),e.jsxs(U,{value:"",onValueChange:s=>{if(s){const t=Fe?.find(w=>w.id===s);t&&(ls({open:!0,order:{userId:t.id,user:t}}),As("other"),Be(null))}},className:"h-9 text-xs rounded-full px-3 bg-primary text-white font-bold min-w-[120px]",children:[e.jsx("option",{value:"",children:"Por usuario..."}),Fe?.map(s=>e.jsxs("option",{value:s.id,children:[s.firstName," ",s.lastName]},s.id))]})]})]}),e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[Rs?.map(s=>e.jsxs("div",{className:"py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(be,{className:"w-4 h-4 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"font-bold text-xs md:text-sm truncate",children:s.fileName}),e.jsx(L,{variant:"outline",className:`text-[8px] md:text-[9px] shrink-0 ${s.reviewStatus==="approved"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":s.reviewStatus==="rejected"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:s.reviewStatus==="approved"?"Aprobado":s.reviewStatus==="rejected"?"Rechazado":"Pendiente"})]}),e.jsxs("p",{className:"text-[10px] text-accent font-medium mt-0.5",children:[s.user?.firstName," ",s.user?.lastName]}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground truncate",children:s.user?.email}),e.jsxs("p",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[s.application?.companyName&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:"LLC:"})," ",s.application.companyName," • "]}),s.uploadedAt?new Date(s.uploadedAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short"}):"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-10",children:[e.jsxs(U,{value:s.reviewStatus||"pending",onValueChange:async t=>{try{await k("PATCH",`/api/admin/documents/${s.id}/review`,{reviewStatus:t}),S.invalidateQueries({queryKey:["/api/admin/documents"]}),l({title:a("dashboard.toasts.statusUpdated")})}catch{l({title:a("common.error"),variant:"destructive"})}},className:"h-7 text-[10px] rounded-full px-2 flex-1 max-w-[120px]",children:[e.jsx(x,{value:"pending",children:"Pendiente"}),e.jsx(x,{value:"approved",children:"Aprobar"}),e.jsx(x,{value:"rejected",children:"Rechazar"})]}),s.fileUrl&&e.jsx(n,{size:"icon",variant:"outline",className:"h-7 w-7 rounded-full",onClick:()=>window.open(s.fileUrl,"_blank"),"data-testid":`btn-view-doc-${s.id}`,children:e.jsx(Ca,{className:"w-3 h-3"})}),e.jsx(n,{size:"icon",variant:"outline",className:"h-7 w-7 rounded-full text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:async()=>{if(confirm("¿Eliminar este documento permanentemente?"))try{await k("DELETE",`/api/admin/documents/${s.id}`),S.invalidateQueries({queryKey:["/api/admin/documents"]}),l({title:a("dashboard.toasts.documentDeleted")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`btn-delete-doc-${s.id}`,children:e.jsx(ge,{className:"w-3 h-3"})})]})]},s.id)),(!Rs||Rs.length===0)&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/30"}),"No hay documentos subidos por clientes"]})]})]}),se==="newsletter"&&e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Lista de Suscriptores (",Us?.length||0,")"]}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[Us?.map(s=>e.jsxs("div",{className:"py-2 flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-sm truncate flex-1",children:s.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:s.subscribedAt?new Date(s.subscribedAt).toLocaleDateString("es-ES"):""}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-7 w-7 text-red-500 hover:text-red-600 hover:bg-red-50 shrink-0",onClick:async()=>{if(confirm(`¿Eliminar suscriptor ${s.email}?`))try{await k("DELETE",`/api/admin/newsletter/${s.id}`),Rt(),l({title:a("dashboard.toasts.subscriberDeleted")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`button-delete-subscriber-${s.id}`,children:e.jsx(ge,{className:"w-3 h-3"})})]},s.id)),(!Us||Us.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})}),se==="inbox"&&e.jsx(h,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[Me?.map(s=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>na(ra?.id===s.id?null:s),"data-testid":`inbox-message-${s.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground truncate",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(L,{variant:"outline",className:"text-[8px] md:text-[10px] hidden md:inline-flex",children:s.messageId||s.id}),e.jsx(L,{variant:s.status==="archived"?"secondary":"default",className:"text-[8px] md:text-[10px]",children:s.status==="archived"?"archivado":s.status||"pendiente"}),s.status!=="archived"&&e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6 md:h-7 md:w-7 text-muted-foreground hover:text-foreground",onClick:async t=>{t.stopPropagation();try{await k("PATCH",`/api/admin/messages/${s.id}/archive`),S.invalidateQueries({queryKey:["/api/admin/messages"]}),l({title:a("dashboard.toasts.messageArchived")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`btn-archive-msg-${s.id}`,title:"Archivar",children:e.jsx(vd,{className:"w-3 h-3 md:w-3.5 md:h-3.5"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6 md:h-7 md:w-7 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:async t=>{if(t.stopPropagation(),confirm("¿Eliminar este mensaje y todas sus respuestas?"))try{await k("DELETE",`/api/admin/messages/${s.id}`),S.invalidateQueries({queryKey:["/api/admin/messages"]}),l({title:a("dashboard.toasts.messageDeleted")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`btn-delete-msg-${s.id}`,children:e.jsx(ge,{className:"w-3 h-3 md:w-3.5 md:h-3.5"})})]})]}),e.jsx("p",{className:"text-xs font-medium",children:s.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.message}),s.replies&&s.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:s.replies.map(t=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${t.isAdmin?"text-accent":"text-muted-foreground"}`,children:[t.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:t.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:t.createdAt&&new Date(t.createdAt).toLocaleString("es-ES")})]},t.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s.createdAt?new Date(s.createdAt).toLocaleString("es-ES"):""}),ra?.id===s.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:t=>t.stopPropagation(),children:[e.jsx(ve,{value:qs,onChange:t=>ia(t.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(n,{onClick:()=>Ms.mutate(s.id),disabled:!qs.trim()||Ms.isPending,className:"bg-accent text-accent-foreground font-semibold rounded-full px-6","data-testid":"button-send-admin-reply",children:[Ms.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},s.id)),(!Me||Me.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),se==="facturas"&&e.jsxs("div",{className:"space-y-4","data-testid":"admin-facturas-section",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{className:"text-sm font-bold",children:"Facturas para Contabilidad"})}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[tt?.length===0&&e.jsx("p",{className:"p-4 text-sm text-muted-foreground text-center",children:"No hay facturas generadas"}),tt?.map(s=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`invoice-row-${s.id}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:s.fileName||`Factura ${s.order?.invoiceNumber}`}),e.jsx(L,{variant:s.order?.status==="paid"||s.order?.status==="completed"?"default":"secondary",className:"text-[10px]",children:s.order?.status==="paid"?"Pagada":s.order?.status==="completed"?"Completada":s.order?.status==="pending"?"Pendiente":s.order?.status||"N/A"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.user?.firstName," ",s.user?.lastName," (",s.user?.email,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Importe: ",s.order?.amount?(s.order.amount/100).toFixed(2)+(s.order.currency==="USD"?" $":" €"):"N/A"," | Fecha: ",s.createdAt?new Date(s.createdAt).toLocaleDateString("es-ES"):"N/A"]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(U,{value:s.order?.status||"pending",onValueChange:async t=>{try{await k("PATCH",`/api/admin/invoices/${s.id}/status`,{status:t}),S.invalidateQueries({queryKey:["/api/admin/invoices"]}),l({title:a("dashboard.toasts.statusUpdated")})}catch{l({title:a("common.error"),variant:"destructive"})}},className:"h-8 text-[10px] rounded-full px-2 min-w-[90px]",children:[e.jsx("option",{value:"pending",children:"Pendiente"}),e.jsx("option",{value:"paid",children:"Pagada"}),e.jsx("option",{value:"completed",children:"Completada"}),e.jsx("option",{value:"cancelled",children:"Cancelada"}),e.jsx("option",{value:"refunded",children:"Reembolsada"})]}),e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>window.open(s.fileUrl||`/api/orders/${s.orderId}/invoice`,"_blank"),"data-testid":`button-view-invoice-${s.id}`,children:[e.jsx(Ca,{className:"w-3 h-3 mr-1"})," Ver"]}),e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{const t=document.createElement("a");t.href=s.fileUrl||`/api/orders/${s.orderId}/invoice`,t.download=`Factura-${s.order?.invoiceNumber||s.id}.pdf`,t.click()},"data-testid":`button-download-invoice-${s.id}`,children:[e.jsx(Sa,{className:"w-3 h-3 mr-1"})," Descargar"]}),e.jsx(n,{variant:"outline",size:"sm",className:"rounded-full text-xs text-red-600 border-red-200 hover:bg-red-50",onClick:async()=>{if(confirm("¿Eliminar esta factura?"))try{await k("DELETE",`/api/admin/invoices/${s.id}`),S.invalidateQueries({queryKey:["/api/admin/invoices"]}),l({title:a("dashboard.toasts.invoiceDeleted")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`button-delete-invoice-${s.id}`,children:e.jsx(ge,{className:"w-3 h-3"})})]})]},s.id))]})})]}),se==="accounting"&&e.jsx(_d,{}),se==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(n,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{Ce({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),ns({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx(es,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(h,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[la?.map(s=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${s.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:s.code}),e.jsx(L,{variant:s.isActive?"default":"secondary",className:"text-[10px]",children:s.isActive?"Activo":"Inactivo"}),e.jsx(L,{variant:"outline",className:"text-[10px]",children:s.discountType==="percentage"?`${s.discountValue}%`:`${(s.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",s.usedCount,s.maxUses?`/${s.maxUses}`:""," veces",s.minOrderAmount&&` | Min: ${(s.minOrderAmount/100).toFixed(2)}€`]}),(s.validFrom||s.validUntil)&&e.jsxs("p",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[s.validFrom&&new Date(s.validFrom).toLocaleDateString("es-ES"),s.validFrom&&s.validUntil&&" → ",s.validUntil&&new Date(s.validUntil).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",className:"rounded-lg text-xs h-8 w-8 p-0",onClick:()=>{Ce({code:s.code,discountType:s.discountType,discountValue:s.discountValue.toString(),minOrderAmount:s.minOrderAmount?(s.minOrderAmount/100).toString():"",maxUses:s.maxUses?.toString()||"",validFrom:s.validFrom?s.validFrom.split("T")[0]:"",validUntil:s.validUntil?s.validUntil.split("T")[0]:"",isActive:s.isActive}),ns({open:!0,code:s})},"data-testid":`button-edit-discount-${s.code}`,children:e.jsx(Gs,{className:"w-3 h-3"})}),e.jsx(n,{variant:"outline",size:"sm",className:`rounded-lg text-xs h-8 w-8 p-0 ${s.isActive?"text-orange-600":"text-green-600"}`,onClick:async()=>{try{await k("PATCH",`/api/admin/discount-codes/${s.id}`,{isActive:!s.isActive}),oa(),l({title:s.isActive?a("dashboard.toasts.discountCodeDeactivated"):a("dashboard.toasts.discountCodeActivated")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`button-toggle-discount-${s.code}`,children:s.isActive?e.jsx(ps,{className:"w-3 h-3"}):e.jsx(Bs,{className:"w-3 h-3"})}),e.jsx(n,{variant:"outline",size:"sm",className:"rounded-lg text-xs h-8 w-8 p-0 text-red-600 border-red-200 hover:bg-red-50",onClick:async()=>{if(confirm(`¿Eliminar el código ${s.code}?`))try{await k("DELETE",`/api/admin/discount-codes/${s.id}`),oa(),l({title:a("dashboard.toasts.discountCodeDeleted")})}catch{l({title:a("common.error"),variant:"destructive"})}},"data-testid":`button-delete-discount-${s.code}`,children:e.jsx(ge,{className:"w-3 h-3"})})]})]},s.id)),(!la||la.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[!r?.isAdmin&&($e?.some(s=>s.type==="action_required")||$?.some(s=>s.application?.fiscalYearEnd&&new Date(s.application.fiscalYearEnd)<=new Date(Date.now()+720*60*60*1e3))||$?.some(s=>s.status==="pending_payment"||s.status==="payment_failed"))&&e.jsxs("section",{className:"bg-orange-50 dark:bg-orange-900/20 p-5 rounded-[2rem] border-2 border-orange-200 dark:border-orange-800 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/40 flex items-center justify-center",children:e.jsx(xs,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-orange-800 dark:text-orange-300",children:a("dashboard.actionRequired.title")}),e.jsx("p",{className:"text-[10px] text-orange-600 dark:text-orange-400",children:a("dashboard.actionRequired.subtitle")})]})]}),e.jsxs("div",{className:"space-y-2",children:[$e?.filter(s=>s.type==="action_required").map(s=>e.jsxs("div",{className:"flex items-start gap-2 bg-white/60 dark:bg-black/20 rounded-xl p-3","data-testid":`action-item-document-${s.id}`,children:[e.jsx(ze,{className:"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 dark:text-orange-300",children:a("dashboard.actionRequired.documentRequest")}),e.jsx("p",{className:"text-[10px] text-orange-600 dark:text-orange-400 truncate",children:s.message})]}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300",onClick:()=>i("documents"),"data-testid":`button-action-document-${s.id}`,children:a("dashboard.actionRequired.viewDocuments")})]},s.id)),$?.filter(s=>s.status==="pending_payment"||s.status==="payment_failed").map(s=>e.jsxs("div",{className:"flex items-start gap-2 bg-white/60 dark:bg-black/20 rounded-xl p-3","data-testid":`action-item-payment-${s.id}`,children:[e.jsx(Aa,{className:"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 dark:text-orange-300",children:a("dashboard.actionRequired.paymentPending")}),e.jsx("p",{className:"text-[10px] text-orange-600 dark:text-orange-400 truncate",children:s.application?.companyName||s.maintenanceApplication?.requestCode||s.invoiceNumber})]}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300",onClick:()=>i("payments"),"data-testid":`button-action-payment-${s.id}`,children:a("dashboard.actionRequired.payNow")})]},s.id)),$?.filter(s=>s.application?.fiscalYearEnd&&new Date(s.application.fiscalYearEnd)<=new Date(Date.now()+720*60*60*1e3)).map(s=>e.jsxs("div",{className:"flex items-start gap-2 bg-white/60 dark:bg-black/20 rounded-xl p-3","data-testid":`action-item-fiscal-${s.id}`,children:[e.jsx(Ae,{className:"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 dark:text-orange-300",children:a("dashboard.actionRequired.fiscalDeadline")}),e.jsxs("p",{className:"text-[10px] text-orange-600 dark:text-orange-400",children:[s.application?.companyName," - ",new Date(s.application.fiscalYearEnd).toLocaleDateString()]})]}),e.jsx(n,{size:"sm",variant:"outline",className:"rounded-full text-xs border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300",onClick:()=>i("calendar"),"data-testid":`button-action-fiscal-${s.id}`,children:a("dashboard.actionRequired.viewCalendar")})]},`fiscal-${s.id}`))]})]}),e.jsxs("section",{className:"bg-white dark:bg-card p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-accent"})," ",a("dashboard.tracking.title")]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("dashboard.tracking.subtitle")})]}),e.jsx("div",{className:"space-y-5",children:$&&$.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#1A1A1A] rounded-xl p-3 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] font-bold text-accent uppercase tracking-wider mb-0.5",children:["Pedido: ",$[0]?.application?.requestCode||$[0]?.maintenanceApplication?.requestCode||$[0]?.invoiceNumber||$[0]?.id]}),e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:$[0]?.maintenanceApplication?`Mantenimiento ${$[0]?.maintenanceApplication?.state||""}`:$[0]?.application?.companyName?`${$[0]?.application?.companyName} LLC`:$[0]?.product?.name||"LLC"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:$[0]?.application?.state||$[0]?.maintenanceApplication?.state||""})]}),e.jsx(L,{className:`${Ys($[0]?.status||"",a).className} font-bold text-[9px] shrink-0`,children:Ys($[0]?.status||"",a).label})]}),e.jsxs("p",{className:"text-[9px] text-muted-foreground mt-2",children:["Creado: ",$[0]?.createdAt?new Date($[0].createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-"]})]}),Fs&&Fs.length>0?Fs.map((s,t)=>e.jsxs("div",{className:"flex gap-4 relative",children:[t<Fs.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx(Ee,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-semibold text-foreground truncate",children:s.eventType}),s.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(s.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s.description})]})]},s.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx(Ee,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:a("dashboard.tracking.orderReceived")})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:a("dashboard.tracking.dataVerification")})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ht,{className:"w-8 h-8 mx-auto mb-2 opacity-30 text-muted-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("dashboard.tracking.empty")}),e.jsx("p",{className:"text-[10px] text-muted-foreground/70 mt-1",children:a("dashboard.tracking.emptyDescription")})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20 mt-8 mb-16 md:mb-12",children:[e.jsx("h3",{className:"text-base font-semibold text-foreground mb-2",children:a("dashboard.support.haveQuestion")}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:a("dashboard.support.hereToHelp")}),e.jsx("a",{href:"https://wa.me/34614916910?text=Hola!%20Soy%20cliente%20de%20Easy%20US%20LLC%20y%20tengo%20una%20duda%20sobre%20el%20estado%20de%20mi%20LLC%20o%20documentaci%C3%B3n.%20%C2%BFPodr%C3%ADais%20ayudarme%3F",target:"_blank",rel:"noopener noreferrer",children:e.jsx(n,{className:"w-full bg-accent text-accent-foreground font-semibold rounded-full py-5",children:a("dashboard.support.talkToSupport")})})]})]})]})})]})]}),e.jsx(ya,{})]})}export{ir as default};
