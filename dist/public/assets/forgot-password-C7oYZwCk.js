import{a as d,j as e,l as w,am as P,E as B,s as G}from"./react-core-BsxKXXxv.js";import{a as v,t as y}from"./forms-hx6-QXJD.js";import{N,L as k,F as S,a as g}from"./index-w-thGWs0.js";import{u as H,B as u,h as T,I as V,E as W}from"./ui-components--YO36qUH.js";import{F as j}from"./form-input-DgPfXwZA.js";import{u as q}from"./i18n-DUhTI5rQ.js";import{o as C,s as b}from"./validation-D376FIhw.js";import"./react-dom-B7Vds6pN.js";import"./pdf-DQEQIQLq.js";import"./tanstack-C2WJu90S.js";import"./radix-ui-Hz6lMY8R.js";const $=t=>C({email:b().email(t("validation.email"))}),z=t=>C({password:b().min(8,t("validation.passwordMin")),confirmPassword:b()}).refine(s=>s.password===s.confirmPassword,{message:t("validation.passwordMatch"),path:["confirmPassword"]});function ae(){const{t}=q(),[s,l]=d.useState(!1),[i,c]=d.useState("email"),[p,L]=d.useState(""),[m,E]=d.useState(""),[x,O]=d.useState(!1),{toast:a}=H(),F=$(t),R=z(t),f=v({resolver:y(F),defaultValues:{email:""}}),n=v({resolver:y(R),defaultValues:{password:"",confirmPassword:""}}),A=async r=>{l(!0);try{const o=await g("POST","/api/password-reset/send-otp",r);if(o.ok)L(r.email),c("otp"),a({title:t("auth.forgotPassword.codeSentTitle"),description:t("auth.forgotPassword.codeSentDesc")});else{const h=await o.json();a({title:t("auth.forgotPassword.errorTitle"),description:h.message||t("auth.forgotPassword.errorSendCode"),variant:"destructive"})}}catch{a({title:t("auth.forgotPassword.errorTitle"),description:t("auth.forgotPassword.errorSendCode"),variant:"destructive"})}finally{l(!1)}},I=async()=>{if(m.length!==6){a({title:t("auth.forgotPassword.errorTitle"),description:t("auth.forgotPassword.errorEnterCode"),variant:"destructive"});return}c("password")},M=async r=>{l(!0);try{const o=await g("POST","/api/password-reset/confirm",{email:p,otp:m,newPassword:r.password}),h=await o.json();o.ok&&h.success?c("success"):a({title:t("auth.forgotPassword.errorTitle"),description:h.message||t("auth.forgotPassword.errorInvalidCode"),variant:"destructive"})}catch(o){a({title:t("auth.forgotPassword.errorTitle"),description:o.message||t("auth.forgotPassword.errorResetPassword"),variant:"destructive"})}finally{l(!1)}},D=async()=>{l(!0);try{(await g("POST","/api/password-reset/send-otp",{email:p})).ok?a({title:t("auth.forgotPassword.codeResentTitle"),description:t("auth.forgotPassword.codeResentDesc")}):a({title:t("auth.forgotPassword.errorTitle"),description:t("auth.forgotPassword.errorSendCode"),variant:"destructive"})}catch{a({title:t("auth.forgotPassword.errorTitle"),description:t("auth.forgotPassword.errorSendCode"),variant:"destructive"})}finally{l(!1)}};return i==="success"?e.jsxs("div",{className:"min-h-screen bg-background font-sans flex flex-col",children:[e.jsx(N,{}),e.jsx("main",{className:"flex-1 flex flex-col items-center justify-center px-5 sm:px-6",children:e.jsxs("div",{className:"w-full max-w-md text-center",children:[e.jsx("div",{className:"flex items-center justify-center mx-auto mb-6",children:e.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("radialGradient",{id:"successGlow",cx:"50%",cy:"50%",r:"60%",children:[e.jsx("stop",{offset:"0%",stopColor:"#22c55e",stopOpacity:"0.35"}),e.jsx("stop",{offset:"100%",stopColor:"#22c55e",stopOpacity:"0"})]})}),e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"url(#successGlow)"}),e.jsx("circle",{cx:"60",cy:"60",r:"34",fill:"#1A1F26",stroke:"#22c55e",strokeWidth:"3"}),e.jsx("path",{d:"M45 62 L55 72 L78 48",stroke:"#22c55e",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-black text-primary tracking-tight mb-4",children:[t("auth.forgotPassword.successTitle")," ",e.jsx("span",{className:"text-accent",children:t("auth.forgotPassword.successTitleHighlight")})]}),e.jsx("p",{className:"text-muted-foreground mb-8",children:t("auth.forgotPassword.successDescription")}),e.jsx(k,{href:"/auth/login",children:e.jsx(u,{className:"rounded-full px-8 font-black bg-accent text-primary","data-testid":"button-go-to-login",children:t("auth.forgotPassword.goToLogin")})})]})}),e.jsx(S,{})]}):e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(N,{}),e.jsx("main",{className:"pt-12 md:pt-16 pb-12 md:pb-16 px-4 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"w-full max-w-sm md:max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 mx-auto",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-black text-primary tracking-tight text-center",children:[t("auth.forgotPassword.title")," ",e.jsx("span",{className:"text-accent",children:t("auth.forgotPassword.titleHighlight")})]}),e.jsxs("p",{className:"text-muted-foreground mt-3 text-sm md:text-base text-center max-w-sm mx-auto",children:[i==="email"&&t("auth.forgotPassword.descriptionEmail"),i==="otp"&&t("auth.forgotPassword.descriptionOtp"),i==="password"&&t("auth.forgotPassword.descriptionPassword")]})]}),e.jsxs("div",{className:"bg-card p-6 md:p-8 rounded-3xl border border-border shadow-sm",children:[i==="email"&&e.jsx(T,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(A),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{control:f.control,name:"email",label:t("auth.forgotPassword.emailLabel"),type:"email",inputMode:"email",placeholder:t("auth.forgotPassword.emailPlaceholder")}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground px-1",children:t("auth.forgotPassword.emailHelp")})]}),e.jsx(u,{type:"submit",disabled:s,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-send-otp",children:s?e.jsx(w,{className:"animate-spin w-4 h-4"}):t("auth.forgotPassword.sendCode")})]})}),i==="otp"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:[t("auth.forgotPassword.codeSentTo")," ",e.jsx("strong",{className:"text-foreground",children:p})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-bold text-foreground mb-2 block text-center",children:t("auth.forgotPassword.enterCode")}),e.jsx(V,{maxLength:6,value:m,onChange:r=>E(r.target.value.replace(/\D/g,"")),className:"h-14 text-center text-2xl md:text-3xl tracking-[0.5em] font-black rounded-full border-2 border-gray-200 dark:border-border focus:border-accent bg-white dark:bg-[#1A1A1A]",inputMode:"numeric",autoComplete:"one-time-code",placeholder:"000000","data-testid":"input-otp"})]})]}),e.jsx(u,{onClick:I,disabled:s||m.length!==6,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-verify-otp",children:s?e.jsx(w,{className:"animate-spin w-4 h-4"}):t("auth.forgotPassword.verify")}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:D,disabled:s,className:"text-sm text-accent font-semibold hover:underline transition-colors","data-testid":"button-resend-otp",children:t("auth.forgotPassword.noCodeReceived")})}),e.jsxs("button",{type:"button",onClick:()=>c("email"),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors mx-auto",children:[e.jsx(P,{className:"w-4 h-4"})," ",t("auth.forgotPassword.changeEmail")]})]}),i==="password"&&e.jsx(T,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(M),className:"space-y-5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(j,{control:n.control,name:"password",label:t("auth.forgotPassword.newPassword"),type:x?"text":"password"}),e.jsx("button",{type:"button",onClick:()=>O(!x),className:"absolute right-4 top-[42px] text-muted-foreground hover:text-primary transition-colors","data-testid":"button-toggle-password-visibility",children:x?e.jsx(B,{className:"w-5 h-5"}):e.jsx(G,{className:"w-5 h-5"})}),e.jsx(W,{password:n.watch("password"),className:"mt-2"})]}),e.jsx(j,{control:n.control,name:"confirmPassword",label:t("auth.forgotPassword.confirmPassword"),type:x?"text":"password"}),e.jsx(u,{type:"submit",disabled:s,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-reset-password",children:s?e.jsx(w,{className:"animate-spin w-4 h-4"}):t("auth.forgotPassword.resetPassword")})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(k,{href:"/auth/login",children:e.jsxs("span",{className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"})," ",t("auth.forgotPassword.backToLogin")]})})})]})}),e.jsx(S,{})]})}export{ae as default};
