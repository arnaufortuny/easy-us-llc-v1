import{m as xt,n as je,o as $e,F as X,W as Vs,B as ut,j as e,d as ma,a as i,X as Ks,p as xa,q as ua,C as _s,P as Wt,s as $s,t as Yt,u as Le,U as pa,v as ha,w as Fs,x as Te,y as Jt,z as ct,i as Q,A as be,k as qs,T as se,G as ga,N as ba,I as Ms,J as Xt,K as fa,O as ja,Q as Na,V as va,Y as Zt,l as Os,Z as wa,_ as ya}from"./react-core-DkWXFmuS.js";import{u as ka,a as Ca,N as Us,b as g,F as Rs,L as fe,q as b}from"./index-CWx0gCjU.js";import{b as C,a as M}from"./tanstack-wXeEfay9.js";import{l as x,m as es,n as ts,o as Fe,P as Sa,B as a,u as Qs,p as S,j as ae,q as d,I as m,N as D,k as o,D as I,r as $,s as F,t as q,v as H,w as O,x as Gs}from"./ui-components-DKKU6jgR.js";import{S as Ea}from"./social-login-CZd12qR4.js";import{u as Da}from"./i18n-Czt3Ol_y.js";import"./react-dom-BybFfvUU.js";import"./radix-ui-kO3FXNWk.js";import"./forms-DPfMMjh0.js";const za=p=>[{id:"pending",label:p("progress.orderReceived"),icon:xt,description:p("progress.orderRegistered")},{id:"paid",label:p("progress.paymentConfirmed"),icon:je,description:p("progress.paymentProcessed")},{id:"processing",label:p("progress.processing"),icon:$e,description:p("progress.preparingDocs")},{id:"filed",label:p("progress.filed"),icon:X,description:p("progress.docsSent")},{id:"completed",label:p("progress.llcActive"),icon:ut,description:p("progress.llcOperational")}],Aa=p=>[{id:"pending",label:p("progress.requestReceived"),icon:xt,description:p("progress.requestRegistered")},{id:"paid",label:p("progress.paymentConfirmed"),icon:je,description:p("progress.paymentProcessed")},{id:"processing",label:p("progress.inProcess"),icon:$e,description:p("progress.managingRenewal")},{id:"filed",label:p("progress.filed"),icon:X,description:p("progress.docsUpdated")},{id:"completed",label:p("progress.completed"),icon:Vs,description:p("progress.maintenanceComplete")}],Pa=["pending","paid","processing","filed","documents_ready","completed"];function La({status:p,serviceName:r,state:z,requestCode:R,isMaintenance:N=!1}){const{t:T}=Da(),v=N?Aa(T):za(T),U=Pa.indexOf(p),h=U>=0?Math.min((U+1)/v.length*100,100):0,E=f=>p==="cancelled"?"cancelled":U<0?"pending":f<U||f===U&&p==="completed"?"completed":f===U?"current":"pending",n={new_mexico:"New Mexico",wyoming:"Wyoming",delaware:"Delaware","New Mexico":"New Mexico",Wyoming:"Wyoming",Delaware:"Delaware"};return p==="cancelled"?e.jsxs(x,{className:"border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900","data-testid":"widget-cancelled",children:[e.jsx(es,{className:"pb-2 p-3 md:p-4",children:e.jsxs(ts,{className:"text-sm md:text-base flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(ma,{className:"h-4 w-4"}),T("progress.cancelled")]})}),e.jsx(Fe,{className:"p-3 pt-0 md:p-4 md:pt-0",children:e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:T("progress.cancelledMessage")})})]}):e.jsxs(x,{className:"overflow-hidden max-w-sm sm:max-w-none mx-auto sm:mx-0","data-testid":`widget-progress-${N?"maintenance":"llc"}`,children:[e.jsxs(es,{className:"pb-2 md:pb-3 p-2.5 sm:p-3 md:p-4 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs(ts,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[N?e.jsx(Vs,{className:"h-4 w-4 md:h-5 md:w-5 text-accent"}):e.jsx(ut,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{className:"truncate max-w-[180px] md:max-w-none",children:r||T(N?"progress.maintenance":"progress.yourLLC")})]}),z&&e.jsx("span",{className:"text-[10px] md:text-xs bg-muted px-2 py-0.5 md:py-1 rounded-md font-medium shrink-0",children:n[z]||z})]}),R&&e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:[T("progress.reference"),": ",R]})]}),e.jsxs(Fe,{className:"p-2.5 sm:p-3 md:p-4 space-y-2.5 sm:space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 md:space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] md:text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:T("progress.progressLabel")}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(h),"%"]})]}),e.jsx(Sa,{value:h,className:"h-1.5 md:h-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[9px] md:left-[11px] top-5 md:top-6 bottom-5 md:bottom-6 w-0.5 bg-border"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:v.map((f,u)=>{const w=E(u),Ne=f.icon;return e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 relative",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-5 h-5 md:w-6 md:h-6 rounded-full border-2 transition-colors shrink-0
                    ${w==="completed"?"bg-primary border-primary text-primary-foreground":w==="current"?"bg-primary/10 border-primary text-primary animate-pulse":"bg-background border-muted-foreground/30 text-muted-foreground"}
                  `,children:w==="completed"?e.jsx(je,{className:"h-2.5 w-2.5 md:h-3.5 md:w-3.5"}):e.jsx(Ne,{className:"h-2.5 w-2.5 md:h-3 md:w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0 pb-1 md:pb-2",children:[e.jsx("p",{className:`text-xs md:text-sm font-medium leading-tight ${w==="completed"?"text-foreground":w==="current"?"text-primary font-bold":"text-muted-foreground"}`,children:f.label}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5 leading-tight hidden sm:block",children:f.description})]})]},f.id)})})]})]})]})}const Ie=[{title:"Bienvenido a tu Area de Cliente",description:"Te mostramos las funciones principales de tu panel para que puedas gestionar tu LLC facilmente."},{target:'[data-tour="orders"]',title:"Tus Pedidos",description:"Consulta el estado de tus pedidos, documentos y progreso de tu LLC."},{target:'[data-tour="calendar"]',title:"Calendario Fiscal",description:"Fechas importantes: formularios IRS, informes anuales y renovaciones."},{target:'[data-tour="messages"]',title:"Mensajes",description:"Comunicacion directa con nuestro equipo para resolver tus dudas."},{target:'[data-tour="profile"]',title:"Tu Perfil",description:"Gestiona tus datos personales y preferencias de cuenta."},{title:"Listo para empezar",description:"Ya conoces tu area de cliente. Si tienes dudas, usa la seccion de Mensajes."}];function Ta({isNewUser:p,onComplete:r}){const[z,R]=i.useState(!1),[N,T]=i.useState(0),[v,U]=i.useState(null),h=i.useCallback(()=>{const ve=Ie[N];if(ve.target){const W=document.querySelector(ve.target);if(W){U(W.getBoundingClientRect());return}}U(null)},[N]);i.useEffect(()=>{if(!p||localStorage.getItem("dashboard-tour-v2"))return;const W=setTimeout(()=>{R(!0)},600);return()=>clearTimeout(W)},[p]),i.useEffect(()=>{if(z)return h(),window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),()=>{window.removeEventListener("resize",h),window.removeEventListener("scroll",h,!0)}},[z,h]);const E=()=>{N<Ie.length-1?T(N+1):f()},n=()=>{N>0&&T(N-1)},f=()=>{R(!1),localStorage.setItem("dashboard-tour-v2","true"),r?.()};if(!z)return null;const u=Ie[N],w=N===0,Ne=N===Ie.length-1,qe=!!u.target&&v;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[9998] transition-opacity duration-300",onClick:f}),qe&&e.jsx("div",{className:"fixed z-[9999] rounded-lg ring-4 ring-accent ring-offset-2 ring-offset-background pointer-events-none transition-all duration-300",style:{top:v.top-4,left:v.left-4,width:v.width+8,height:v.height+8}}),e.jsxs(x,{className:`fixed z-[10000] w-[calc(100vw-2rem)] max-w-sm p-4 md:p-5 shadow-2xl border-0 bg-card transition-all duration-300 ${qe?"left-1/2 -translate-x-1/2":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"}`,style:qe?{top:Math.min(v.bottom+16,window.innerHeight-200)}:void 0,children:[e.jsx("button",{onClick:f,className:"absolute top-3 right-3 p-1 rounded-full hover:bg-muted transition-colors","data-testid":"button-tour-close",children:e.jsx(Ks,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center flex-shrink-0",children:e.jsx(xa,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-bold text-foreground text-base md:text-lg leading-tight",children:u.title}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1 leading-relaxed",children:u.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex gap-1",children:Ie.map((ve,W)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${W===N?"bg-accent":"bg-muted"}`},W))}),e.jsxs("div",{className:"flex gap-2",children:[!w&&e.jsxs(a,{variant:"ghost",size:"sm",onClick:n,className:"h-9","data-testid":"button-tour-prev",children:[e.jsx(ua,{className:"w-4 h-4 mr-1"}),"Anterior"]}),e.jsxs(a,{size:"sm",onClick:E,className:"h-9","data-testid":"button-tour-next",children:[Ne?"Empezar":"Siguiente",!Ne&&e.jsx(_s,{className:"w-4 h-4 ml-1"})]})]})]})]})]})}function mt(p){return{pending:{label:"Pendiente",className:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300"},paid:{label:"Pagado",className:"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300"},processing:{label:"En Proceso",className:"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"},documents_ready:{label:"Docs. Listos",className:"bg-cyan-100 dark:bg-cyan-900/50 text-cyan-800 dark:text-cyan-300"},completed:{label:"Completado",className:"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"},cancelled:{label:"Cancelada",className:"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-400 font-black"},filed:{label:"Presentado",className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300"},draft:{label:"Borrador",className:"bg-gray-100 dark:bg-zinc-700 text-gray-600 dark:text-gray-300"}}[p]||{label:p,className:"bg-gray-100 dark:bg-zinc-700 text-gray-600 dark:text-gray-300"}}function Ia(){const{toast:p}=Qs(),{data:r,isLoading:z}=M({queryKey:["/api/newsletter/status"]}),R=C({mutationFn:async N=>{await g("POST",N?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",N?{email:void 0}:void 0)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/newsletter/status"]}),p({title:"Preferencias actualizadas",description:"Gracias por quedarte con nosotros"})}});return z?e.jsx("div",{className:"w-10 h-6 bg-gray-100 dark:bg-zinc-700 animate-pulse rounded-full"}):e.jsx(Gs,{checked:r?.isSubscribed,onCheckedChange:N=>R.mutate(N),disabled:R.isPending})}function Za(){const[,p]=ka(),{user:r,isAuthenticated:z,isLoading:R}=Ca(),[N,T]=i.useState("services"),[v,U]=i.useState(!1),[h,E]=i.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:n}=Qs(),f=r?.accountStatus==="active"||r?.accountStatus==="vip",[u,w]=i.useState(null),[Ne,qe]=i.useState({open:!1,user:null}),[ve,W]=i.useState(""),[$a,Fa]=i.useState(""),[qa,Ma]=i.useState(""),[we,Me]=i.useState({open:!1,user:null}),[Oe,ss]=i.useState(""),[as,rs]=i.useState(""),[Ue,Re]=i.useState({open:!1,user:null}),[pt,ns]=i.useState(""),[ht,ds]=i.useState(""),[Hs,Oa]=i.useState("info"),[re,Ve]=i.useState({open:!1,user:null}),[gt,is]=i.useState(""),[bt,ls]=i.useState(""),[os,cs]=i.useState("EUR"),[V,Bs]=i.useState("dashboard"),[Ws,Ke]=i.useState(!1),[Y,ne]=i.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[Ys,_e]=i.useState(!1),[de,Qe]=i.useState({userId:"",productId:"1",amount:"",state:"New Mexico"}),[ie,Ge]=i.useState({open:!1,user:null}),[Js,ft]=i.useState(!1),[le,He]=i.useState({open:!1,file:null}),[ye,ms]=i.useState("passport"),[Be,xs]=i.useState(""),[us,jt]=i.useState(!1),[ps,Nt]=i.useState("form"),[vt,wt]=i.useState(""),[Z,yt]=i.useState(""),[We,kt]=i.useState(""),[Ct,St]=i.useState(""),[J,ke]=i.useState({open:!1,code:null}),[oe,Ye]=i.useState({open:!1,user:null}),[Je,Et]=i.useState(""),[Ce,Dt]=i.useState(""),[hs,zt]=i.useState(""),[gs,bs]=i.useState(!1),[fs,js]=i.useState(!1),[K,Se]=i.useState({open:!1,order:null}),[Ns,Xe]=i.useState("articles_of_organization"),[ce,Ee]=i.useState(null),[vs,ws]=i.useState(!1),[Xs,At]=i.useState(!1),[De,Pt]=i.useState(""),[ys,ks]=i.useState(!1),[Cs,Ss]=i.useState(!1),[k,G]=i.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});i.useEffect(()=>{r&&E({firstName:r.firstName||"",lastName:r.lastName||"",phone:r.phone||"",businessActivity:r.businessActivity||"",address:r.address||"",streetType:r.streetType||"",city:r.city||"",province:r.province||"",postalCode:r.postalCode||"",country:r.country||"",idNumber:r.idNumber||"",idType:r.idType||"",birthDate:r.birthDate||""})},[r]);const Es=C({mutationFn:async t=>{if(!f)throw new Error("No puedes modificar tus datos en el estado actual de tu cuenta.");const s=await g("PATCH","/api/user/profile",t);if(!s.ok){const c=await s.json().catch(()=>({}));throw new Error(c.message||"Error al guardar")}},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/auth/user"]}),U(!1),n({title:"Cambios guardados",description:"Tu información se ha actualizado correctamente"})},onError:t=>{n({title:"Error",description:t.message,variant:"destructive"})}});i.useEffect(()=>{!R&&!z&&p("/auth/login")},[z,R,p]);const{data:j,isLoading:Ua}=M({queryKey:["/api/orders"],enabled:z,refetchInterval:3e4,staleTime:1e4}),{data:Lt,isLoading:Ra}=M({queryKey:["/api/messages"],enabled:z,refetchInterval:6e4,staleTime:3e4}),[Ze,Tt]=i.useState(null),[ze,It]=i.useState(""),Ds=j?.[0]?.id,{data:et}=M({queryKey:["/api/orders",Ds,"events"],enabled:!!Ds,refetchInterval:3e4,staleTime:1e4}),me=C({mutationFn:async t=>{const s=await g("POST",`/api/messages/${t}/reply`,{content:ze});if(!s.ok){const c=await s.json().catch(()=>({}));throw new Error(c.message||"Error al enviar")}return s.json()},onSuccess:()=>{It(""),Tt(null),b.invalidateQueries({queryKey:["/api/messages"]}),b.invalidateQueries({queryKey:["/api/admin/messages"]}),n({title:r?.isAdmin?"Respuesta enviada":"Mensaje enviado",description:r?.isAdmin?"El cliente recibirá un email con la información":"Te responderemos personalmente lo antes posible"})},onError:t=>{n({title:"Error",description:t.message||"No se pudo enviar la respuesta",variant:"destructive"})}}),{data:tt,isLoading:Zs}=M({queryKey:["/api/user/notifications"],enabled:z,refetchInterval:6e4,staleTime:3e4}),ea=C({mutationFn:async t=>{if(!(await g("PATCH",`/api/user/notifications/${t}/read`)).ok)throw new Error("Error al marcar notificación")},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/notifications"]})},onError:()=>{}}),zs=C({mutationFn:async t=>{if(!(await g("DELETE",`/api/user/notifications/${t}`)).ok)throw new Error("Error al eliminar")},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/notifications"]})},onError:()=>{n({title:"Error",description:"No se pudo eliminar",variant:"destructive"})}}),{data:xe}=M({queryKey:["/api/admin/orders"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:ue}=M({queryKey:["/api/admin/incomplete-applications"],enabled:!!r?.isAdmin,refetchInterval:3e4}),As=C({mutationFn:async({type:t,id:s})=>{const c=await g("DELETE",`/api/admin/incomplete-applications/${t}/${s}`);if(!c.ok)throw new Error("Error al eliminar");return c.json()},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/incomplete-applications"]}),n({title:"Eliminada",description:"Solicitud incompleta eliminada correctamente"})},onError:()=>{n({title:"Error",description:"No se pudo eliminar la solicitud",variant:"destructive"})}}),{data:st}=M({queryKey:["/api/admin/users"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:at,refetch:ta}=M({queryKey:["/api/admin/newsletter"],enabled:!!r?.isAdmin}),{data:rt}=M({queryKey:["/api/admin/documents"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:Ps}=M({queryKey:["/api/admin/invoices"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:P}=M({queryKey:["/api/admin/system-stats"],enabled:!!r?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:$t}=M({queryKey:["/api/admin/messages"],enabled:!!r?.isAdmin}),{data:Ft,refetch:qt}=M({queryKey:["/api/admin/discount-codes"],enabled:!!r?.isAdmin}),[Va,sa]=i.useState(""),[Ka,aa]=i.useState("");C({mutationFn:async({subject:t,message:s})=>{if(!(await g("POST","/api/admin/newsletter/broadcast",{subject:t,message:s})).ok)throw new Error("Error al enviar")},onSuccess:()=>{n({title:"Emails enviados",description:"Se ha enviado a todos los suscriptores del newsletter"}),sa(""),aa("")},onError:()=>{n({title:"Error",description:"No se pudieron enviar los emails",variant:"destructive"})}});const{data:ra}=M({queryKey:["/api/user/documents"],enabled:z});C({mutationFn:async t=>{const s=await g("POST","/api/admin/documents",t);if(!s.ok){const c=await s.json().catch(()=>({}));throw new Error(c.message||"Error al subir documento")}return s.json()},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/documents"]}),n({title:"Documento subido",description:"El cliente ya puede verlo en su panel."})},onError:t=>{n({title:"Error",description:t.message||"No se pudo subir el documento",variant:"destructive"})}});const na=C({mutationFn:async({id:t,status:s})=>{const c=await g("PATCH",`/api/admin/orders/${t}/status`,{status:s});if(!c.ok)throw new Error("Error al actualizar estado");return c.json()},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),n({title:"Estado actualizado"})},onError:()=>{n({title:"Error",description:"No se pudo actualizar el estado",variant:"destructive"})}}),Ae=C({mutationFn:async({appId:t,field:s,value:c})=>{if(!(await g("PATCH",`/api/admin/llc/${t}/dates`,{field:s,value:c})).ok)throw new Error("Error al actualizar fecha")},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/orders"]}),n({title:"Fecha actualizada"})},onError:()=>{n({title:"Error",description:"No se pudo actualizar la fecha",variant:"destructive"})}}),pe=C({mutationFn:async({userId:t,title:s,message:c,type:l})=>{const L=await g("POST","/api/admin/send-note",{userId:t,title:s,message:c,type:l});if(!L.ok){const _=await L.json().catch(()=>({}));throw new Error(_.message||"Error al enviar")}return L.json()},onSuccess:()=>{n({title:"Nota enviada",description:"El cliente recibirá notificación y email"}),Re({open:!1,user:null}),ns(""),ds("")},onError:t=>{n({title:"Error",description:t.message||"No se pudo enviar la nota",variant:"destructive"})}}),nt=C({mutationFn:async t=>{const{id:s,createdAt:c,...l}=t,L=["dni","nie","passport"],_=["active","pending","deactivated","vip"],y={};l.firstName!==void 0&&(y.firstName=l.firstName||void 0),l.lastName!==void 0&&(y.lastName=l.lastName||void 0),l.email!==void 0&&(y.email=l.email||void 0),l.phone!==void 0&&(y.phone=l.phone||null),l.address!==void 0&&(y.address=l.address||null),l.streetType!==void 0&&(y.streetType=l.streetType||null),l.city!==void 0&&(y.city=l.city||null),l.province!==void 0&&(y.province=l.province||null),l.postalCode!==void 0&&(y.postalCode=l.postalCode||null),l.country!==void 0&&(y.country=l.country||null),l.idNumber!==void 0&&(y.idNumber=l.idNumber||null),l.idType!==void 0&&(y.idType=L.includes(l.idType||"")?l.idType:null),l.birthDate!==void 0&&(y.birthDate=l.birthDate||null),l.businessActivity!==void 0&&(y.businessActivity=l.businessActivity||null),l.isActive!==void 0&&(y.isActive=l.isActive),l.isAdmin!==void 0&&(y.isAdmin=l.isAdmin),l.accountStatus!==void 0&&_.includes(l.accountStatus)&&(y.accountStatus=l.accountStatus),l.internalNotes!==void 0&&(y.internalNotes=l.internalNotes||null);const lt=Object.fromEntries(Object.entries(y).filter(([A,Pe])=>Pe!==void 0)),te=await g("PATCH",`/api/admin/users/${s}`,lt);if(!te.ok){const A=await te.json().catch(()=>({}));throw new Error(A.message||"Error al actualizar")}},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario actualizado"}),w(null)},onError:t=>{n({title:"Error",description:t.message||"No se pudo actualizar",variant:"destructive"})}}),Mt=C({mutationFn:async t=>{if(!(await g("DELETE",`/api/admin/users/${t}`)).ok)throw new Error("Error al eliminar")},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario eliminado"}),Ge({open:!1,user:null})},onError:()=>{n({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),[B,dt]=i.useState({open:!1,order:null}),[ee,it]=i.useState({open:!1,order:null}),[he,Ot]=i.useState(""),[Ut,Ls]=i.useState("EUR"),Rt=C({mutationFn:async t=>{if(!(await g("DELETE",`/api/admin/orders/${t}`)).ok)throw new Error("Error al eliminar")},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/orders"]}),b.invalidateQueries({queryKey:["/api/notifications"]}),b.invalidateQueries({queryKey:["/api/user/documents"]}),n({title:"Pedido eliminado",description:"El pedido y sus datos asociados han sido eliminados."}),dt({open:!1,order:null})},onError:()=>{n({title:"Error",description:"No se pudo eliminar el pedido",variant:"destructive"})}}),Vt=C({mutationFn:async({userId:t,concept:s,amount:c,currency:l})=>{if(!c||isNaN(c)||c<1)throw new Error("Importe inválido (mínimo 1 céntimo)");const L=await g("POST","/api/admin/invoices/create",{userId:t,concept:s,amount:c,currency:l});if(!L.ok){const _=await L.json().catch(()=>({}));throw new Error(_.message||"Error al crear factura")}return L.json()},onSuccess:t=>{n({title:"Factura creada",description:`Factura ${t?.invoiceNumber||""} añadida al cliente`}),Ve({open:!1,user:null}),is(""),ls(""),cs("EUR"),b.invalidateQueries({queryKey:["/api/admin/documents"]})},onError:t=>{n({title:"Error",description:t.message||"No se pudo crear la factura",variant:"destructive"})}}),Kt=C({mutationFn:async t=>(await g("POST","/api/admin/users/create",t)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario creado",description:"El usuario ha sido registrado correctamente"}),Ke(!1),ne({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{n({title:"Error",description:"No se pudo crear el usuario",variant:"destructive"})}}),_t=C({mutationFn:async t=>{const{userId:s,state:c,amount:l}=t;if(!s||!c||!l)throw new Error("Faltan datos requeridos");const L=await g("POST","/api/admin/orders/create",{userId:s,state:c,amount:l});if(!L.ok){const _=await L.json().catch(()=>({}));throw new Error(_.message||"Error al crear pedido")}return L.json()},onSuccess:t=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),n({title:"Pedido creado",description:`Pedido ${t?.invoiceNumber||""} registrado correctamente`}),_e(!1),Qe({userId:"",productId:"1",amount:"",state:"New Mexico"})},onError:t=>{n({title:"Error",description:t.message||"No se pudo crear el pedido",variant:"destructive"})}}),Ts=C({mutationFn:async t=>{if(!(await g("DELETE",`/api/user/documents/${t}`)).ok)throw new Error("Error al eliminar")},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/documents"]}),n({title:"Documento eliminado"})},onError:t=>{n({title:"Error",description:t?.message||"No se pudo eliminar el documento",variant:"destructive"})}}),Qt=C({mutationFn:async()=>{if(!(await g("DELETE","/api/user/account")).ok)throw new Error("Error al eliminar")},onSuccess:()=>{n({title:"Cuenta eliminada",description:"Tu cuenta ha sido eliminada correctamente."}),window.location.href="/"},onError:()=>{n({title:"Error",description:"No se pudo eliminar la cuenta",variant:"destructive"})}}),Gt=C({mutationFn:async()=>{if(!(await g("POST","/api/user/request-password-otp")).ok)throw new Error("Error al solicitar código")},onSuccess:()=>{n({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación."}),Nt("otp")},onError:t=>{n({title:"Error",description:t.message||"No se pudo enviar el código",variant:"destructive"})}}),Ht=C({mutationFn:async t=>{const s=await g("POST","/api/user/change-password",t);if(!s.ok){const c=await s.json().catch(()=>({}));throw new Error(c.message||"Error al cambiar contraseña")}},onSuccess:()=>{n({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente."}),jt(!1),Nt("form"),wt(""),yt(""),kt(""),St("")},onError:t=>{n({title:"Error",description:t.message||"No se pudo cambiar la contraseña",variant:"destructive"})}});if(R||!z)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(r?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-muted font-sans flex flex-col",children:[e.jsx(Us,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-8 sm:py-12",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(x,{className:"rounded-2xl sm:rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-zinc-900",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(Fe,{className:"p-6 sm:p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-50 dark:bg-red-950/30 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-black text-red-500",children:"!"})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight mb-3 sm:mb-4",children:"Tu cuenta ha sido desactivada"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground font-medium leading-relaxed mb-6 sm:mb-8",children:"Revisa tu email, deberías haber recibido una nota de nuestro equipo con más información."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-950/30 p-3 rounded-xl",children:"No puedes realizar acciones ni contactar hasta que se resuelva tu situación."}),e.jsx(a,{variant:"outline",className:"w-full font-black text-foreground h-12 rounded-full border-2",onClick:()=>g("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-logout",children:"Cerrar Sesión"})]})]})]})})}),e.jsx(Rs,{})]});const da=[{id:"services",label:"Mis trámites",icon:Wt,mobileLabel:"Trámites",tour:"orders"},{id:"notifications",label:"Seguimiento",icon:$s,mobileLabel:"Seguim."},{id:"messages",label:"Soporte",icon:Yt,mobileLabel:"Soporte",tour:"messages"},{id:"documents",label:"Documentos",icon:X,mobileLabel:"Docs"},{id:"payments",label:"Pagos",icon:xt,mobileLabel:"Pagos"},{id:"calendar",label:"Calendario",icon:Le,mobileLabel:"Fechas",tour:"calendar"},{id:"profile",label:"Mi Perfil",icon:pa,mobileLabel:"Perfil",tour:"profile"},...r?.isAdmin?[{id:"admin",label:"Admin",icon:ha,mobileLabel:"Admin"}]:[]],ia=r&&(!j||j.length===0);return e.jsxs("div",{className:"min-h-screen bg-muted bg-green-gradient font-sans",children:[e.jsx(Us,{}),e.jsx(Ta,{isNewUser:!!ia}),e.jsxs("main",{className:"pt-16 sm:pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsx("header",{className:"mb-6 md:mb-10",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-bold tracking-wide text-xs md:text-sm mb-1 md:mb-2 uppercase",children:"Área de Clientes"}),e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground tracking-tight leading-tight",children:["Bienvenido, ",(r?.firstName||"Cliente").charAt(0).toUpperCase()+(r?.firstName||"Cliente").slice(1).toLowerCase()]}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base mt-1 md:mt-2",children:"Gestiona tu LLC de forma simple y clara."})]}),e.jsx(fe,{href:"/servicios#pricing",children:e.jsxs(a,{className:"w-full md:w-auto bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-lg px-6 h-11 transition-all flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(Fs,{className:"w-5 h-5"})," Nueva LLC"]})})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-3 mb-6 gap-2 no-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:gap-3 md:pb-4 md:mb-8",children:da.map(t=>e.jsxs(a,{variant:N===t.id?"default":"ghost",onClick:()=>T(t.id),size:"sm",className:`flex items-center gap-1.5 sm:gap-2 rounded-lg font-semibold text-[11px] sm:text-xs md:text-sm tracking-normal whitespace-nowrap shrink-0 h-10 px-3 md:px-4 transition-all duration-200 ${N===t.id?"bg-accent text-accent-foreground shadow-md":"bg-card text-muted-foreground hover:text-foreground hover:bg-secondary"}`,"data-testid":`button-tab-${t.id}`,..."tour"in t&&t.tour?{"data-tour":t.tour}:{},children:[e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:t.label}),e.jsx("span",{className:"md:hidden",children:t.mobileLabel})]},t.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 order-1",children:[N==="services"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Mis trámites"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gestiona tus trámites activos"})]}),j?.filter(t=>t.status==="draft"||t.application?.status==="draft"||t.maintenanceApplication?.status==="draft").map(t=>{const s=t.application?.abandonedAt||t.maintenanceApplication?.abandonedAt,c=s?Math.max(0,Math.round(48-(Date.now()-new Date(s).getTime())/36e5)):null;return e.jsxs("div",{className:"rounded-2xl shadow-md bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 overflow-hidden flex","data-testid":`banner-pending-application-${t.id}`,children:[e.jsx("div",{className:"w-1 bg-yellow-500 flex-shrink-0"}),e.jsx("div",{className:"p-4 md:p-5 flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 dark:bg-yellow-900/50 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Te,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-semibold text-foreground",children:"Solicitud pendiente de completar"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[t.maintenanceApplication?`Mantenimiento ${t.maintenanceApplication.state||""}`:t.application?.companyName?`${t.application.companyName} LLC`:`${t.application?.state||"Tu LLC"}`,c!==null&&e.jsxs("span",{className:"text-yellow-600 dark:text-yellow-400 font-semibold ml-2",children:["· Se eliminará en ",c,"h"]})]})]})]}),e.jsx(fe,{href:t.maintenanceApplication?"/llc/maintenance":"/llc/formation","data-testid":`link-continue-application-${t.id}`,children:e.jsxs(a,{className:"bg-accent text-primary font-bold rounded-full",size:"sm","data-testid":`button-continue-application-${t.id}`,children:["Continuar solicitud",e.jsx(_s,{className:"w-4 h-4 ml-1"})]})})]})})]},`draft-banner-${t.id}`)}),!j||j.length===0?e.jsx(x,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-6 md:p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(Wt,{className:"w-6 h-6 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:"Aún no tienes servicios activos"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:"Empieza hoy y constituye tu LLC en EE. UU. en pocos pasos."})]}),e.jsx(fe,{href:"/servicios#pricing",children:e.jsx(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-view-packs",children:"Ver planes disponibles"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:j.filter(t=>t.status!=="cancelled"&&t.status!=="completed").slice(0,4).map(t=>e.jsx(La,{status:t.status,serviceName:t.maintenanceApplication?`Mant. ${t.maintenanceApplication.state||t.product?.name?.replace(" LLC","")||""}`:t.application?.companyName?`${t.application.companyName} LLC`:t.product?.name||"Tu LLC",state:t.application?.state||t.maintenanceApplication?.state,requestCode:t.application?.requestCode||t.maintenanceApplication?.requestCode||t.invoiceNumber,isMaintenance:!!t.maintenanceApplication},`progress-${t.id}`))}),j.length>0&&e.jsxs("div",{className:"mt-4 md:mt-6",children:[e.jsx("h3",{className:"text-xs md:text-sm font-bold text-muted-foreground mb-2 md:mb-3",children:"Todos los Pedidos"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:j.map(t=>e.jsx(x,{className:"rounded-lg md:rounded-xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-zinc-900 overflow-hidden","data-testid":`card-order-${t.id}`,children:e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("p",{className:"text-[9px] md:text-[10px] font-bold text-accent uppercase tracking-wider",children:t.application?.requestCode||t.maintenanceApplication?.requestCode||t.invoiceNumber||`#${t.id}`}),e.jsx(S,{className:`${mt(t.status).className} font-bold uppercase text-[8px] md:text-[9px] px-1.5 py-0`,"data-testid":`badge-order-status-${t.id}`,children:mt(t.status).label})]}),e.jsx("p",{className:"text-sm md:text-base font-bold text-primary truncate",children:t.maintenanceApplication?`Mantenimiento ${t.maintenanceApplication.state||""}`:t.application?.companyName?`${t.application.companyName} LLC`:t.product?.name||"LLC pendiente"}),e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:[t.application?.state||t.maintenanceApplication?.state||"",t.createdAt&&` · ${new Date(t.createdAt).toLocaleDateString("es-ES")}`]})]}),t.status==="pending"&&t.application&&e.jsx(a,{variant:"outline",size:"sm",className:"text-[9px] md:text-[10px] h-7 md:h-8 px-2 md:px-3 rounded-full font-bold shrink-0",onClick:()=>window.location.href=`/llc/formation?edit=${t.application.id}`,"data-testid":`button-modify-order-${t.id}`,children:"Modificar"})]})},t.id))})]})]})]},"services"),N==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Seguimiento"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Notificaciones y actualizaciones de tus trámites"})]}),Zs?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},t))}):tt?.length===0?e.jsx(x,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-6 md:p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx($s,{className:"w-6 h-6 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:"Sin notificaciones"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground text-center",children:"Las actualizaciones de tus trámites aparecerán aquí."})]})]})}):e.jsx("div",{className:"space-y-3",children:tt?.map(t=>e.jsx(x,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${t.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(Fe,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[t.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:["Pedido: ",t.orderCode]}),t.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:"ACCIÓN REQUERIDA"}),t.type==="update"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:"ACTUALIZACIÓN"}),t.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-zinc-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full font-black",children:"INFORMACIÓN"}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.message}),t.type==="action_required"&&r?.accountStatus!=="deactivated"&&e.jsxs(a,{className:"mt-3 bg-accent text-accent-foreground font-semibold rounded-lg text-xs px-4 gap-2",onClick:()=>{ea.mutate(t.id),T("documents")},"data-testid":`button-upload-document-${t.id}`,children:[e.jsx(Jt,{className:"w-3 h-3"}),"Subir Documento"]})]}),e.jsx(a,{variant:"ghost",size:"icon",className:"flex-shrink-0 h-8 w-8 text-muted-foreground hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full",onClick:()=>zs.mutate(t.id),disabled:zs.isPending,"data-testid":`button-delete-notification-${t.id}`,children:e.jsx(Ks,{className:"w-4 h-4"})})]})})},t.id))})]},"notifications"),N==="messages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Mis Consultas"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Tu historial de mensajes con nuestro equipo"})]}),e.jsx(fe,{href:"/contacto",children:e.jsx(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg text-xs",children:"Nueva Consulta"})})]})}),e.jsx("div",{className:"space-y-4",children:!Lt||Lt.length===0?e.jsx(x,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-6 md:p-8 text-center","data-testid":"widget-support-empty",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(ct,{className:"w-6 h-6 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:"Sin consultas activas"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:"Te responderá una persona, no un bot."})]}),e.jsx("a",{href:"https://wa.me/34614916910?text=Hola%2C%20me%20interesa%20crear%20una%20LLC%20en%20Estados%20Unidos",target:"_blank",rel:"noopener noreferrer",children:e.jsxs(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-support-whatsapp",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"})," Hablar con soporte"]})})]})}):Lt.map(t=>e.jsxs(x,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-zinc-900 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>Tt(Ze?.id===t.id?null:t),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-semibold text-foreground",children:t.subject||"Sin asunto"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:t.messageId||t.id})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:t.content}),Ze?.id===t.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-4",onClick:s=>s.stopPropagation(),children:[e.jsx(ae,{value:ze,onChange:s=>It(s.target.value),placeholder:"Escribe tu respuesta...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-user-reply"}),e.jsxs(a,{onClick:()=>me.mutate(t.id),disabled:!ze.trim()||me.isPending,className:"bg-accent text-accent-foreground font-semibold rounded-lg px-6","data-testid":"button-user-send-reply",children:[me.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin mr-2"}):null,"Enviar Respuesta"]})]})]},t.id))})]},"messages"),N==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Centro de Documentación"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gestiona tus documentos y archivos"})]}),tt?.some(t=>t.type==="action_required"&&!t.isRead)&&r?.accountStatus!=="deactivated"&&e.jsx(x,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(be,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-300 text-sm",children:"Documentos Solicitados"}),e.jsx("div",{className:"mt-2 space-y-1",children:tt?.filter(t=>t.type==="action_required"&&!t.isRead).map(t=>e.jsx("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:t.message},t.id))}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async t=>{const s=t.target.files?.[0];if(!s)return;const c=new FormData;c.append("file",s);try{(await fetch("/api/user/documents/upload",{method:"POST",body:c,credentials:"include"})).ok?(n({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),b.invalidateQueries({queryKey:["/api/user/documents"]}),b.invalidateQueries({queryKey:["/api/user/notifications"]})):n({title:"Error",description:"No se pudo subir el documento",variant:"destructive"})}catch{n({title:"Error",description:"Error de conexión",variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(a,{variant:"outline",className:"rounded-full text-xs border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300",asChild:!0,children:e.jsxs("span",{children:[e.jsx(be,{className:"w-3 h-3 mr-1"})," Subir Documento"]})})]})})]})]})}),e.jsx(x,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:t=>{const s=t.target.files?.[0];s&&(He({open:!0,file:s}),ms("passport"),xs(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(Jt,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground text-base md:text-lg",children:"Subir Documento"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"PDF, JPG o PNG (máx. 10MB)"})]}),e.jsxs(a,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",children:[e.jsx(be,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Subir"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ra?.map(t=>e.jsxs(x,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-zinc-900",children:[e.jsx(be,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:t.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground mb-3",children:new Date(t.createdAt||t.uploadedAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(a,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(t.fileUrl,"_blank"),"data-testid":`button-download-doc-${t.id}`,children:[e.jsx(qs,{className:"w-3 h-3 mr-1"})," Descargar"]}),f&&e.jsx(a,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>Ts.mutate(t.id),disabled:Ts.isPending,"data-testid":`button-delete-doc-${t.id}`,children:e.jsx(se,{className:"w-3 h-3"})})]})]},t.id))})]},"documents"),N==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Historial de Pagos"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Tus facturas y recibos"})]}),e.jsx("div",{className:"space-y-4",children:!j||j.length===0?e.jsx(x,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-6 md:p-8 text-center","data-testid":"widget-payments-empty",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(xt,{className:"w-6 h-6 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:"Sin pagos registrados"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:"Tus facturas y recibos aparecerán aquí."})]}),e.jsx(fe,{href:"/servicios#pricing",children:e.jsxs(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-view-services",children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"})," Ver servicios"]})})]})}):j.map(t=>e.jsxs(x,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-zinc-900",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",t.application?.requestCode||t.maintenanceApplication?.requestCode||t.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${t.id}/invoice`,"_blank"),children:"Factura"}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${t.id}/receipt`,"_blank"),children:"Recibo"})]})]},t.id))})]},"payments"),N==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Mi Calendario Fiscal"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium",children:"Fechas importantes y vencimientos de tu LLC"})]})}),j&&j.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:j.map(t=>{const s=t.application;if(!s)return null;const c=t.status==="cancelled",l=["pending","paid","processing"].includes(t.status),L=["Wyoming","Delaware","WY","DE"].includes(s.state),_=[{label:"Creación",fullLabel:"Creación de LLC",date:s.llcCreatedDate,icon:ut,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:"Agente",fullLabel:"Renovación Agente Registrado",date:s.agentRenewalDate,icon:ga,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:"Formulario IRS 1120",date:s.irs1120DueDate,icon:X,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:"Formulario IRS 5472",date:s.irs5472DueDate,icon:X,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...L?[{label:"Anual",fullLabel:`Reporte Anual ${s.state}`,date:s.annualReportDueDate,icon:ba,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],y=_.some(A=>A.date),lt=_.filter(A=>A.date).sort((A,Pe)=>new Date(A.date).getTime()-new Date(Pe.date).getTime()),te=lt.find(A=>new Date(A.date)>new Date);return e.jsxs(x,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-zinc-900 overflow-hidden ${c?"opacity-50":""}`,children:[e.jsx(es,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(ts,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(ut,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:s.companyName||"LLC en proceso"}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:s.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[c&&e.jsx(S,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:"Cancelada"}),l&&e.jsx(S,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"En revisión"}),!c&&!l&&te&&e.jsxs(S,{className:`text-[9px] md:text-[10px] ${te.bgColor} ${te.textColor}`,children:["Próximo: ",te.label]})]})]})}),e.jsx(Fe,{className:"p-3 md:p-4",children:c?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ms,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Esta LLC fue cancelada"})]}):l?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx($e,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Tu LLC está en proceso"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:"Las fechas aparecerán cuando esté activa"})]}):y?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:lt.map((A,Pe)=>{const ot=new Date(A.date),Is=new Date,ge=Math.ceil((ot.getTime()-Is.getTime())/(1e3*60*60*24)),Bt=ot<Is,la=!Bt&&ge<=30,oa=!Bt&&ge<=60&&ge>30,ca=A.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${A.borderColor} ${A.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${A.textColor}`,children:[e.jsx(ca,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:A.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:ot.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:ot.getFullYear()}),Bt?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Xt,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:"Completado"})]}):la?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Te,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[ge," días"]})]}):oa?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[ge," días"]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[ge," días"]})})]},Pe)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Le,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Fechas pendientes de configuración"})]})})]},t.id)})}):e.jsx(x,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-6 md:p-8 text-center","data-testid":"widget-calendar-empty",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground mb-1 md:mb-2 text-center",children:"Mi Calendario Fiscal"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4 md:mb-6 text-center",children:"Tus vencimientos fiscales aparecerán aquí una vez constituyas tu LLC."})]}),e.jsx(fe,{href:"/servicios#pricing",children:e.jsx(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base","data-testid":"button-start-llc-calendar",children:"Constituir mi LLC"})})]})})]},"calendar"),N==="profile"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground tracking-tight",children:"Mi Perfil"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Tus datos personales y configuración de cuenta"})]}),e.jsxs(x,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-foreground",children:"Datos Personales"}),f&&e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>U(!v),"data-testid":"button-toggle-edit",children:v?"Cancelar":"Editar"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Esta información nos permite acompañarte mejor y cumplir con los requisitos legales cuando sea necesario."}),!f&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${r?.accountStatus==="pending"?"bg-orange-50 border border-orange-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${r?.accountStatus==="pending"?"text-orange-700":"text-red-700"}`,children:r?.accountStatus==="pending"?"Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada.":"Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"ID Cliente"}),e.jsx("p",{className:"text-lg font-black font-mono",children:r?.clientId||r?.id?.slice(0,8).toUpperCase()})]}),e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"Estado"}),e.jsx("p",{className:`text-lg font-black ${r?.accountStatus==="active"?"text-green-600":r?.accountStatus==="pending"?"text-orange-500":r?.accountStatus==="deactivated"?"text-red-600":r?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:r?.accountStatus==="active"?"Verificado":r?.accountStatus==="pending"?"En revisión":r?.accountStatus==="deactivated"?"Desactivada":r?.accountStatus==="vip"?"VIP":"Verificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Nombre"}),v&&f?e.jsx(m,{value:h.firstName,onChange:t=>E({...h,firstName:t.target.value}),placeholder:"Tu nombre real",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-firstname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Apellidos"}),v&&f?e.jsx(m,{value:h.lastName,onChange:t=>E({...h,lastName:t.target.value}),placeholder:"Tal y como aparecen en tu documento",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-lastname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.lastName||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{children:"Email"}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{children:r?.email}),r?.emailVerified?e.jsx(je,{className:"w-4 h-4 text-green-500"}):e.jsx(a,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black",onClick:()=>At(!0),"data-testid":"button-verify-email",children:"Verificar email"})]}),!r?.emailVerified&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Tu cuenta está en revisión hasta que verifiques tu email."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Teléfono"}),v&&f?e.jsx(m,{value:h.phone,onChange:t=>E({...h,phone:t.target.value}),placeholder:"Para contactarte si es necesario",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-phone"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.phone||"No proporcionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de documento"}),v&&f?e.jsxs(D,{value:h.idType,onValueChange:t=>E({...h,idType:t}),placeholder:"DNI · NIE · Pasaporte",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-idtype",children:[e.jsx(o,{value:"dni",children:"DNI"}),e.jsx(o,{value:"nie",children:"NIE"}),e.jsx(o,{value:"passport",children:"Pasaporte"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.idType==="dni"?"DNI":r?.idType==="nie"?"NIE":r?.idType==="passport"?"Pasaporte":"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Número de documento"}),v&&f?e.jsx(m,{value:h.idNumber,onChange:t=>E({...h,idNumber:t.target.value}),placeholder:"Documento de identificación",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-idnumber"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.idNumber||"No proporcionado"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Fecha de nacimiento"}),v&&f?e.jsx(m,{type:"date",value:h.birthDate,onChange:t=>E({...h,birthDate:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-birthdate"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.birthDate||"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Actividad profesional"}),v&&f?e.jsxs(D,{value:h.businessActivity,onValueChange:t=>E({...h,businessActivity:t}),placeholder:"A qué te dedicas",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-activity",children:[e.jsx(o,{value:"ecommerce",children:"E-commerce"}),e.jsx(o,{value:"dropshipping",children:"Dropshipping"}),e.jsx(o,{value:"consulting",children:"Consultoría"}),e.jsx(o,{value:"marketing",children:"Marketing Digital"}),e.jsx(o,{value:"software",children:"Desarrollo de Software"}),e.jsx(o,{value:"trading",children:"Trading / Inversiones"}),e.jsx(o,{value:"freelance",children:"Freelance"}),e.jsx(o,{value:"other",children:"Otra"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.businessActivity||"No proporcionado"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-bold text-sm mb-3",children:"Dirección de residencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de vía"}),v&&f?e.jsxs(D,{value:h.streetType,onValueChange:t=>E({...h,streetType:t}),placeholder:"Calle · Avenida · Paseo · Plaza",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-street-type",children:[e.jsx(o,{value:"calle",children:"Calle"}),e.jsx(o,{value:"avenida",children:"Avenida"}),e.jsx(o,{value:"paseo",children:"Paseo"}),e.jsx(o,{value:"plaza",children:"Plaza"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Dirección"}),v&&f?e.jsx(m,{value:h.address,onChange:t=>E({...h,address:t.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Ciudad"}),v&&f?e.jsx(m,{value:h.city,onChange:t=>E({...h,city:t.target.value}),placeholder:"Ciudad de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Provincia"}),v&&f?e.jsx(m,{value:h.province,onChange:t=>E({...h,province:t.target.value}),placeholder:"Provincia o región",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"C.P."}),v&&f?e.jsx(m,{value:h.postalCode,onChange:t=>E({...h,postalCode:t.target.value}),placeholder:"Código postal",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"País"}),v&&f?e.jsx(m,{value:h.country,onChange:t=>E({...h,country:t.target.value}),placeholder:"País de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.country||"-"})]})]})]}),v&&f&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(a,{onClick:()=>{Es.mutate(h),U(!1)},className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",disabled:Es.isPending,"data-testid":"button-save-profile",children:"Guardar cambios"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Nuestro equipo revisará cualquier cambio antes de avanzar para asegurarnos de que todo esté correcto."})]})]}),e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Suscripción Newsletter"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recibe noticias y consejos para tu LLC."})]}),e.jsx(Ia,{})]})}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contraseña de acceso."})]}),!us&&e.jsx(a,{variant:"outline",className:"rounded-full",onClick:()=>jt(!0),"data-testid":"button-show-password-form",children:"Cambiar"})]}),us&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-zinc-800 rounded-xl",children:[ps==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Contraseña actual"}),e.jsx(m,{type:"password",value:vt,onChange:t=>wt(t.target.value),"data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Nueva contraseña"}),e.jsx(m,{type:"password",value:Z,onChange:t=>yt(t.target.value),"data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Confirmar nueva contraseña"}),e.jsx(m,{type:"password",value:We,onChange:t=>kt(t.target.value),"data-testid":"input-confirm-password"})]}),Z&&We&&Z!==We&&e.jsx("p",{className:"text-xs text-red-500",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(a,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{jt(!1),wt(""),yt(""),kt("")},children:"Cancelar"}),e.jsx(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg flex-1",onClick:()=>Gt.mutate(),disabled:!vt||!Z||Z!==We||Z.length<8||Gt.isPending,"data-testid":"button-request-otp",children:Gt.isPending?"Enviando...":"Enviar código"})]})]}),ps==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(Yt,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ingresa el código de 6 dígitos enviado a tu email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Código de verificación"}),e.jsx(m,{type:"text",value:Ct,onChange:t=>St(t.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(a,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{Nt("form"),St("")},children:"Volver"}),e.jsx(a,{className:"bg-accent text-accent-foreground font-semibold rounded-lg flex-1",onClick:()=>Ht.mutate({currentPassword:vt,newPassword:Z,otp:Ct}),disabled:Ct.length!==6||Ht.isPending,"data-testid":"button-save-password",children:Ht.isPending?"Guardando...":"Confirmar"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Cuentas Conectadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vincula tus cuentas sociales para iniciar sesion mas rapido."})]})}),e.jsx(Ea,{mode:"connect",googleConnected:!!r?.googleId,onSuccess:()=>b.refetchQueries({queryKey:["/api/auth/user"]})})]}),f&&e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 text-sm",children:"Eliminar Cuenta"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Esta acción es irreversible. Se eliminarán todos tus datos."})]}),e.jsxs(a,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 rounded-full shrink-0",onClick:()=>ft(!0),"data-testid":"button-delete-own-account",children:[e.jsx(se,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})})]})]},"profile"),N==="admin"&&r?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 mb-4 md:mb-6",children:[{id:"dashboard",label:"Métricas",mobileLabel:"Métricas",icon:fa},{id:"orders",label:"Pedidos",mobileLabel:"Pedidos",icon:Wt},{id:"incomplete",label:"Incompletas",mobileLabel:"Incompl.",icon:Te},{id:"users",label:"Clientes",mobileLabel:"Clientes",icon:ja},{id:"facturas",label:"Facturas",mobileLabel:"Facturas",icon:Na},{id:"calendar",label:"Fechas",mobileLabel:"Fechas",icon:Le},{id:"docs",label:"Docs",mobileLabel:"Docs",icon:X},{id:"newsletter",label:"News",mobileLabel:"News",icon:Yt},{id:"inbox",label:"Inbox",mobileLabel:"Inbox",icon:ct},{id:"descuentos",label:"Descuentos",mobileLabel:"Desc",icon:va}].map(t=>e.jsxs(a,{variant:V===t.id?"default":"outline",onClick:()=>Bs(t.id),size:"sm",className:`flex items-center justify-center gap-1.5 rounded-full font-bold text-[10px] sm:text-xs h-9 px-3 ${V===t.id?"bg-accent text-primary shadow-md":"bg-white dark:bg-zinc-900 text-muted-foreground border border-border hover:border-accent/50"}`,"data-testid":`button-admin-tab-${t.id}`,children:[e.jsx(t.icon,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"truncate",children:t.mobileLabel})]},t.id))}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(a,{variant:"ghost",size:"sm",className:"rounded-full text-xs font-semibold bg-white dark:bg-zinc-800 shadow-sm",onClick:()=>Ke(!0),"data-testid":"button-create-user",children:[e.jsx(Zt,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Cliente"}),e.jsx("span",{className:"sm:hidden",children:"Cliente"})]}),e.jsxs(a,{variant:"ghost",size:"sm",className:"rounded-full text-xs font-semibold bg-white dark:bg-zinc-800 shadow-sm",onClick:()=>_e(!0),"data-testid":"button-create-order",children:[e.jsx(Zt,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),V==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((P?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((P?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:P?.orderCount||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[P?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:P?.pendingOrders||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:P?.processingOrders||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:P?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:P?.userCount||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:P?.activeAccounts||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:P?.vipAccounts||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:P?.pendingAccounts||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:P?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:P?.subscriberCount||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:P?.totalMessages||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:P?.pendingMessages||0})]}),e.jsxs(x,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:P?.pendingDocs||0})]})]})]})]}),V==="orders"&&e.jsx(x,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:xe?.map(t=>{const s=t.application||t.maintenanceApplication,c=!!t.maintenanceApplication&&!t.application,l=s?.requestCode||t.invoiceNumber,_=s?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:l}),e.jsx(S,{className:`text-[9px] ${c?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:c?"MANTENIMIENTO":"LLC"}),!_&&e.jsx(S,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:s?.ownerFullName||`${t.user?.firstName||""} ${t.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?.ownerEmail||t.user?.email}),s?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",s?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",s?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",t.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(t.amount/100).toFixed(2),"€",t.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",t.discountCode," -",(t.discountAmount/100).toFixed(2),"€)"]})]}),s?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",s.businessCategory]}),c&&s?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",s.ein]})]}),e.jsxs(D,{value:t.status,onValueChange:y=>na.mutate({id:t.id,status:y}),className:"w-28 h-9 rounded-lg text-xs bg-white dark:bg-zinc-900 border px-3 relative z-0",children:[e.jsx(o,{value:"pending",children:"Pendiente"}),e.jsx(o,{value:"paid",children:"Pagado"}),e.jsx(o,{value:"filed",children:"Presentado"}),e.jsx(o,{value:"cancelled",children:"Cancelado"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>window.open(`/api/admin/invoice/${t.id}`,"_blank"),"data-testid":`btn-view-invoice-${t.id}`,children:"Ver Factura"}),e.jsx(a,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>{Ot(((t.amount||0)/100).toFixed(2)),Ls("EUR"),it({open:!0,order:t})},"data-testid":`btn-generate-invoice-${t.id}`,children:"Generar Factura"}),e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>dt({open:!0,order:t}),"data-testid":`btn-delete-order-${t.id}`,children:"Eliminar"})]})]},t.id)})})}),V==="incomplete"&&e.jsxs(x,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20",children:[e.jsxs("h3",{className:"font-black text-sm flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-yellow-600"}),"Solicitudes Incompletas (",(ue?.llc?.length||0)+(ue?.maintenance?.length||0),")"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Formularios no completados - se eliminan automáticamente tras 48h de inactividad"})]}),e.jsxs("div",{className:"divide-y",children:[[...ue?.llc||[],...ue?.maintenance||[]].map(t=>{const s=t.abandonedAt?Math.max(0,Math.round(48-(Date.now()-new Date(t.abandonedAt).getTime())/36e5)):null;return e.jsx("div",{className:"p-4 space-y-2","data-testid":`incomplete-app-${t.type}-${t.id}`,children:e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx(S,{className:`text-[9px] ${t.type==="maintenance"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:t.type==="maintenance"?"MANTENIMIENTO":"LLC"}),e.jsx(S,{className:"text-[9px] bg-orange-100 text-orange-700",children:"INCOMPLETA"}),s!==null&&e.jsx(S,{className:"text-[9px] bg-red-100 text-red-700",children:s>0?`Se elimina en ${s}h`:"Eliminación pendiente"})]}),t.ownerFullName&&e.jsx("p",{className:"text-sm font-bold",children:t.ownerFullName}),t.ownerEmail&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.ownerEmail}),t.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.ownerPhone}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 space-y-0.5",children:[t.companyName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Empresa:"})," ",t.companyName]}),t.state&&e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",t.state]}),t.remindersSent>0&&e.jsxs("p",{children:[e.jsx("strong",{children:"Recordatorios:"})," ",t.remindersSent,"/3 enviados"]}),t.lastUpdated&&e.jsxs("p",{children:[e.jsx("strong",{children:"Última actividad:"})," ",new Date(t.lastUpdated).toLocaleString("es-ES")]})]})]}),e.jsxs(a,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>As.mutate({type:t.type,id:t.id}),disabled:As.isPending,"data-testid":`btn-delete-incomplete-${t.type}-${t.id}`,children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Eliminar"]})]})},`${t.type}-${t.id}`)}),!ue?.llc?.length&&!ue?.maintenance?.length&&e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(Xt,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-sm font-medium",children:"No hay solicitudes incompletas"})]})]})]}),V==="users"&&e.jsx(x,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:st?.map(t=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[t.firstName," ",t.lastName]}),e.jsx(S,{variant:t.accountStatus==="active"||t.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${t.accountStatus==="deactivated"?"bg-red-100 text-red-700":t.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":t.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:t.accountStatus==="active"?"VERIFICADO":t.accountStatus==="pending"?"EN REVISIÓN":t.accountStatus==="deactivated"?"DESACTIVADA":t.accountStatus==="vip"?"VIP":"VERIFICADO"}),t.isAdmin&&e.jsx(S,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[t.phone&&e.jsx("span",{className:"mr-2",children:t.phone}),t.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",t.businessActivity]}),t.city&&e.jsxs("span",{children:["• ",t.city]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[10px] text-muted-foreground",children:[t.lastLoginIp&&e.jsxs("span",{className:"flex items-center gap-1 bg-muted/50 px-2 py-0.5 rounded-full",children:[e.jsx("span",{className:"font-medium",children:"IP:"})," ",t.lastLoginIp]}),typeof t.loginCount=="number"&&e.jsxs("span",{className:"flex items-center gap-1 bg-muted/50 px-2 py-0.5 rounded-full",children:[e.jsx("span",{className:"font-medium",children:"Logins:"})," ",t.loginCount]}),t.securityOtpRequired&&e.jsx("span",{className:"flex items-center gap-1 bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full",children:"OTP Requerido"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(d,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(D,{value:t.accountStatus||"active",onValueChange:s=>t.id&&nt.mutate({id:t.id,accountStatus:s}),className:"w-full h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border shadow-sm px-3",children:[e.jsx(o,{value:"active",children:"Verificado"}),e.jsx(o,{value:"pending",children:"En revisión"}),e.jsx(o,{value:"deactivated",children:"Desactivada"}),e.jsx(o,{value:"vip",children:"VIP"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>w(t),"data-testid":`button-edit-user-${t.id}`,children:"Editar"}),e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>Re({open:!0,user:t}),"data-testid":`button-note-user-${t.id}`,children:"Mensaje"}),e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>Me({open:!0,user:t}),"data-testid":`button-doc-user-${t.id}`,children:"Docs"}),e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>Ve({open:!0,user:t}),"data-testid":`button-invoice-user-${t.id}`,children:"Factura"}),e.jsx(a,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>Ye({open:!0,user:t}),"data-testid":`button-payment-link-${t.id}`,children:"Pago"}),e.jsx(a,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Ge({open:!0,user:t}),"data-testid":`button-delete-user-${t.id}`,children:"Eliminar"})]})]},t.id))})}),V==="calendar"&&e.jsxs(x,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsxs("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 md:w-8 md:h-8 rounded-xl bg-accent/20 flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 md:w-4 md:h-4 text-accent"})}),e.jsx("span",{children:"Gestión de Fechas Fiscales"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[xe?.map(t=>{const s=t.application;if(!s)return null;const c=s?.requestCode||t.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:s.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[t.user?.firstName," ",t.user?.lastName," • ",s.state]})]}),e.jsx(S,{variant:"outline",className:"text-xs w-fit",children:c})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(m,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.llcCreatedDate?new Date(s.llcCreatedDate).toISOString().split("T")[0]:"",onChange:l=>Ae.mutate({appId:s.id,field:"llcCreatedDate",value:l.target.value}),"data-testid":`input-llc-created-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(m,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.agentRenewalDate?new Date(s.agentRenewalDate).toISOString().split("T")[0]:"",onChange:l=>Ae.mutate({appId:s.id,field:"agentRenewalDate",value:l.target.value}),"data-testid":`input-agent-renewal-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(m,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.irs1120DueDate?new Date(s.irs1120DueDate).toISOString().split("T")[0]:"",onChange:l=>Ae.mutate({appId:s.id,field:"irs1120DueDate",value:l.target.value}),"data-testid":`input-irs1120-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(m,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.irs5472DueDate?new Date(s.irs5472DueDate).toISOString().split("T")[0]:"",onChange:l=>Ae.mutate({appId:s.id,field:"irs5472DueDate",value:l.target.value}),"data-testid":`input-irs5472-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(m,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.annualReportDueDate?new Date(s.annualReportDueDate).toISOString().split("T")[0]:"",onChange:l=>Ae.mutate({appId:s.id,field:"annualReportDueDate",value:l.target.value}),"data-testid":`input-annual-report-${s.id}`})]})]})]},t.id)}),(!xe||xe.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),V==="docs"&&e.jsxs(x,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-black text-lg",children:"Documentos"}),e.jsx(S,{className:"bg-accent/20 text-accent",children:rt?.length||0})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(D,{value:"",onValueChange:t=>{if(t){const s=xe?.find(c=>c.id===Number(t));s&&(Se({open:!0,order:s}),Xe("articles_of_organization"),Ee(null))}},className:"h-9 text-xs rounded-full px-3 bg-accent text-primary font-bold min-w-[120px]",children:[e.jsx("option",{value:"",children:"Por pedido..."}),xe?.map(t=>e.jsxs("option",{value:t.id,children:[t.application?.requestCode||t.maintenanceApplication?.requestCode||t.invoiceNumber," - ",t.user?.firstName]},t.id))]}),e.jsxs(D,{value:"",onValueChange:t=>{if(t){const s=st?.find(c=>c.id===t);s&&(Se({open:!0,order:{userId:s.id,user:s}}),Xe("other"),Ee(null))}},className:"h-9 text-xs rounded-full px-3 bg-primary text-white font-bold min-w-[120px]",children:[e.jsx("option",{value:"",children:"Por usuario..."}),st?.map(t=>e.jsxs("option",{value:t.id,children:[t.firstName," ",t.lastName]},t.id))]})]})]}),e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[rt?.map(t=>e.jsxs("div",{className:"py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(X,{className:"w-4 h-4 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"font-bold text-xs md:text-sm truncate",children:t.fileName}),e.jsx(S,{variant:"outline",className:`text-[8px] md:text-[9px] shrink-0 ${t.reviewStatus==="approved"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.reviewStatus==="rejected"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:t.reviewStatus==="approved"?"Aprobado":t.reviewStatus==="rejected"?"Rechazado":"Pendiente"})]}),e.jsxs("p",{className:"text-[10px] text-accent font-medium mt-0.5",children:[t.user?.firstName," ",t.user?.lastName]}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground truncate",children:t.user?.email}),e.jsxs("p",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[t.application?.companyName&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:"LLC:"})," ",t.application.companyName," • "]}),t.uploadedAt?new Date(t.uploadedAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short"}):"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-10",children:[e.jsxs(D,{value:t.reviewStatus||"pending",onValueChange:async s=>{try{await g("PATCH",`/api/admin/documents/${t.id}/review`,{reviewStatus:s}),b.invalidateQueries({queryKey:["/api/admin/documents"]}),n({title:"Estado actualizado"})}catch{n({title:"Error",variant:"destructive"})}},className:"h-7 text-[10px] rounded-full px-2 flex-1 max-w-[120px]",children:[e.jsx(o,{value:"pending",children:"Pendiente"}),e.jsx(o,{value:"approved",children:"Aprobar"}),e.jsx(o,{value:"rejected",children:"Rechazar"})]}),t.fileUrl&&e.jsx(a,{size:"icon",variant:"outline",className:"h-7 w-7 rounded-full",onClick:()=>window.open(t.fileUrl,"_blank"),"data-testid":`btn-view-doc-${t.id}`,children:e.jsx(Os,{className:"w-3 h-3"})}),e.jsx(a,{size:"icon",variant:"outline",className:"h-7 w-7 rounded-full text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:async()=>{if(confirm("¿Eliminar este documento permanentemente?"))try{await g("DELETE",`/api/admin/documents/${t.id}`),b.invalidateQueries({queryKey:["/api/admin/documents"]}),n({title:"Documento eliminado"})}catch{n({title:"Error al eliminar",variant:"destructive"})}},"data-testid":`btn-delete-doc-${t.id}`,children:e.jsx(se,{className:"w-3 h-3"})})]})]},t.id)),(!rt||rt.length===0)&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/30"}),"No hay documentos subidos por clientes"]})]})]}),V==="newsletter"&&e.jsx(x,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Lista de Suscriptores (",at?.length||0,")"]}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[at?.map(t=>e.jsxs("div",{className:"py-2 flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-sm truncate flex-1",children:t.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:t.subscribedAt?new Date(t.subscribedAt).toLocaleDateString("es-ES"):""}),e.jsx(a,{size:"icon",variant:"ghost",className:"h-7 w-7 text-red-500 hover:text-red-600 hover:bg-red-50 shrink-0",onClick:async()=>{if(confirm(`¿Eliminar suscriptor ${t.email}?`))try{await g("DELETE",`/api/admin/newsletter/${t.id}`),ta(),n({title:"Suscriptor eliminado"})}catch{n({title:"Error al eliminar",variant:"destructive"})}},"data-testid":`button-delete-subscriber-${t.id}`,children:e.jsx(se,{className:"w-3 h-3"})})]},t.id)),(!at||at.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})}),V==="inbox"&&e.jsx(x,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[$t?.map(t=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>Tt(Ze?.id===t.id?null:t),"data-testid":`inbox-message-${t.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:[t.firstName," ",t.lastName]}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground truncate",children:t.email})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(S,{variant:"outline",className:"text-[8px] md:text-[10px] hidden md:inline-flex",children:t.messageId||t.id}),e.jsx(S,{variant:"secondary",className:"text-[8px] md:text-[10px]",children:t.status||"pendiente"}),e.jsx(a,{size:"icon",variant:"ghost",className:"h-6 w-6 md:h-7 md:w-7 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:async s=>{if(s.stopPropagation(),confirm("¿Eliminar este mensaje y todas sus respuestas?"))try{await g("DELETE",`/api/admin/messages/${t.id}`),b.invalidateQueries({queryKey:["/api/admin/messages"]}),n({title:"Mensaje eliminado"})}catch{n({title:"Error al eliminar",variant:"destructive"})}},"data-testid":`btn-delete-msg-${t.id}`,children:e.jsx(se,{className:"w-3 h-3 md:w-3.5 md:h-3.5"})})]})]}),e.jsx("p",{className:"text-xs font-medium",children:t.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.message}),t.replies&&t.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:t.replies.map(s=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${s.isAdmin?"text-accent":"text-muted-foreground"}`,children:[s.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:s.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:s.createdAt&&new Date(s.createdAt).toLocaleString("es-ES")})]},s.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:t.createdAt?new Date(t.createdAt).toLocaleString("es-ES"):""}),Ze?.id===t.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ae,{value:ze,onChange:s=>It(s.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(a,{onClick:()=>me.mutate(t.id),disabled:!ze.trim()||me.isPending,className:"bg-accent text-accent-foreground font-semibold rounded-lg px-6","data-testid":"button-send-admin-reply",children:[me.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):e.jsx(wa,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},t.id)),(!$t||$t.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),V==="facturas"&&e.jsxs("div",{className:"space-y-4","data-testid":"admin-facturas-section",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{className:"text-sm font-bold",children:"Facturas para Contabilidad"})}),e.jsx(x,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[Ps?.length===0&&e.jsx("p",{className:"p-4 text-sm text-muted-foreground text-center",children:"No hay facturas generadas"}),Ps?.map(t=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`invoice-row-${t.id}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:t.fileName||`Factura ${t.order?.invoiceNumber}`}),e.jsx(S,{variant:t.order?.status==="paid"||t.order?.status==="completed"?"default":"secondary",className:"text-[10px]",children:t.order?.status==="paid"?"Pagada":t.order?.status==="completed"?"Completada":t.order?.status==="pending"?"Pendiente":t.order?.status||"N/A"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.user?.firstName," ",t.user?.lastName," (",t.user?.email,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Importe: ",t.order?.amount?(t.order.amount/100).toFixed(2)+(t.order.currency==="USD"?" $":" €"):"N/A"," | Fecha: ",t.createdAt?new Date(t.createdAt).toLocaleDateString("es-ES"):"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>window.open(t.fileUrl||`/api/orders/${t.orderId}/invoice`,"_blank"),"data-testid":`button-view-invoice-${t.id}`,children:[e.jsx(Os,{className:"w-3 h-3 mr-1"})," Ver"]}),e.jsxs(a,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{const s=document.createElement("a");s.href=t.fileUrl||`/api/orders/${t.orderId}/invoice`,s.download=`Factura-${t.order?.invoiceNumber||t.id}.pdf`,s.click()},"data-testid":`button-download-invoice-${t.id}`,children:[e.jsx(qs,{className:"w-3 h-3 mr-1"})," Descargar"]})]})]},t.id))]})})]}),V==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(a,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{G({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),ke({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx(Zt,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(x,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[Ft?.map(t=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${t.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:t.code}),e.jsx(S,{variant:t.isActive?"default":"secondary",className:"text-[10px]",children:t.isActive?"Activo":"Inactivo"}),e.jsx(S,{variant:"outline",className:"text-[10px]",children:t.discountType==="percentage"?`${t.discountValue}%`:`${(t.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",t.usedCount,t.maxUses?`/${t.maxUses}`:""," veces",t.minOrderAmount&&` | Min: ${(t.minOrderAmount/100).toFixed(2)}€`]}),(t.validFrom||t.validUntil)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[t.validFrom&&`Desde: ${new Date(t.validFrom).toLocaleDateString("es-ES")}`,t.validFrom&&t.validUntil&&" - ",t.validUntil&&`Hasta: ${new Date(t.validUntil).toLocaleDateString("es-ES")}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",size:"sm",className:"rounded-lg text-xs h-8 w-8 p-0",onClick:()=>{G({code:t.code,discountType:t.discountType,discountValue:t.discountValue.toString(),minOrderAmount:t.minOrderAmount?(t.minOrderAmount/100).toString():"",maxUses:t.maxUses?.toString()||"",validFrom:t.validFrom?t.validFrom.split("T")[0]:"",validUntil:t.validUntil?t.validUntil.split("T")[0]:"",isActive:t.isActive}),ke({open:!0,code:t})},"data-testid":`button-edit-discount-${t.code}`,children:e.jsx(ya,{className:"w-3 h-3"})}),e.jsx(a,{variant:"outline",size:"sm",className:`rounded-lg text-xs h-8 w-8 p-0 ${t.isActive?"text-orange-600":"text-green-600"}`,onClick:async()=>{try{await g("PATCH",`/api/admin/discount-codes/${t.id}`,{isActive:!t.isActive}),qt(),n({title:t.isActive?"Código desactivado":"Código activado"})}catch{n({title:"Error",variant:"destructive"})}},"data-testid":`button-toggle-discount-${t.code}`,children:t.isActive?e.jsx(Ms,{className:"w-3 h-3"}):e.jsx(Xt,{className:"w-3 h-3"})}),e.jsx(a,{variant:"outline",size:"sm",className:"rounded-lg text-xs h-8 w-8 p-0 text-red-600 border-red-200 hover:bg-red-50",onClick:async()=>{if(confirm(`¿Eliminar el código ${t.code}?`))try{await g("DELETE",`/api/admin/discount-codes/${t.id}`),qt(),n({title:"Código eliminado"})}catch{n({title:"Error al eliminar",variant:"destructive"})}},"data-testid":`button-delete-discount-${t.code}`,children:e.jsx(se,{className:"w-3 h-3"})})]})]},t.id)),(!Ft||Ft.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[e.jsxs("section",{className:"bg-white dark:bg-zinc-900 p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-accent"})," Seguimiento"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"El progreso de tu LLC, paso a paso"})]}),e.jsx("div",{className:"space-y-5",children:j&&j.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-zinc-800 rounded-xl p-3 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] font-bold text-accent uppercase tracking-wider mb-0.5",children:["Pedido: ",j[0]?.application?.requestCode||j[0]?.maintenanceApplication?.requestCode||j[0]?.invoiceNumber||j[0]?.id]}),e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:j[0]?.maintenanceApplication?`Mantenimiento ${j[0]?.maintenanceApplication?.state||""}`:j[0]?.application?.companyName?`${j[0]?.application?.companyName} LLC`:j[0]?.product?.name||"LLC"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:j[0]?.application?.state||j[0]?.maintenanceApplication?.state||""})]}),e.jsx(S,{className:`${mt(j[0]?.status).className} font-bold text-[9px] shrink-0`,children:mt(j[0]?.status).label})]}),e.jsxs("p",{className:"text-[9px] text-muted-foreground mt-2",children:["Creado: ",j[0]?.createdAt?new Date(j[0].createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-"]})]}),et&&et.length>0?et.map((t,s)=>e.jsxs("div",{className:"flex gap-4 relative",children:[s<et.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx(je,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-semibold text-foreground truncate",children:t.eventType}),t.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(t.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:t.description})]})]},t.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx(je,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:"Pedido Recibido"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Verificación de Datos"})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Te,{className:"w-8 h-8 text-gray-200 dark:text-zinc-600 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No hay trámites en curso"}),e.jsx("p",{className:"text-[10px] text-muted-foreground/70 mt-1",children:"Cuando contrates un servicio, aquí podrás seguir todo el proceso."})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20",children:[e.jsx("h3",{className:"text-base font-semibold text-foreground mb-2",children:"¿Tienes alguna duda?"}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:"Estamos aquí para ayudarte, escríbenos y te responderemos lo antes posible!"}),e.jsx("a",{href:"https://wa.me/34614916910?text=Hola%2C%20me%20interesa%20crear%20una%20LLC%20en%20Estados%20Unidos",target:"_blank",rel:"noopener noreferrer",children:e.jsx(a,{className:"w-full bg-accent text-accent-foreground font-semibold rounded-lg py-5",children:"Hablar con un asesor"})})]})]})]})]}),r?.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(I,{open:Ue.open,onOpenChange:t=>Re({open:t,user:t?Ue.user:null}),children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Enviar Mensaje al Cliente"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Título"}),e.jsx(m,{value:pt,onChange:t=>ns(t.target.value),placeholder:"Título del mensaje",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Mensaje"}),e.jsx(ae,{value:ht,onChange:t=>ds(t.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-note-message"})]})]}),e.jsxs(O,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>Re({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{onClick:()=>Ue.user?.id&&pe.mutate({userId:Ue.user.id,title:pt,message:ht,type:Hs}),disabled:!pt||!ht||pe.isPending,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-send-note",children:pe.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"})]})]})}),e.jsx(I,{open:!!u,onOpenChange:t=>!t&&w(null),children:e.jsxs($,{className:"w-full sm:max-w-lg bg-white dark:bg-zinc-900",children:[e.jsxs(F,{className:"flex-shrink-0",children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Editar Usuario"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),u&&e.jsxs("div",{className:"space-y-3 pt-2 overflow-y-auto flex-1 pr-1",style:{maxHeight:"calc(85vh - 180px)"},children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Nombre"}),e.jsx(m,{value:u.firstName||"",onChange:t=>w({...u,firstName:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Apellidos"}),e.jsx(m,{value:u.lastName||"",onChange:t=>w({...u,lastName:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Email"}),e.jsx(m,{value:u.email||"",onChange:t=>w({...u,email:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Teléfono"}),e.jsx(m,{value:u.phone||"",onChange:t=>w({...u,phone:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Tipo ID"}),e.jsxs(D,{value:u.idType||"",onValueChange:t=>w({...u,idType:t}),placeholder:"Seleccionar",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(o,{value:"dni",children:"DNI"}),e.jsx(o,{value:"nie",children:"NIE"}),e.jsx(o,{value:"passport",children:"Pasaporte"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Número ID"}),e.jsx(m,{value:u.idNumber||"",onChange:t=>w({...u,idNumber:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Fecha Nacimiento"}),e.jsx(m,{type:"date",value:u.birthDate||"",onChange:t=>w({...u,birthDate:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Actividad de Negocio"}),e.jsxs(D,{value:u.businessActivity||"",onValueChange:t=>w({...u,businessActivity:t}),placeholder:"Seleccionar actividad",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-edit-activity",children:[e.jsx(o,{value:"ecommerce",children:"E-commerce"}),e.jsx(o,{value:"dropshipping",children:"Dropshipping"}),e.jsx(o,{value:"consulting",children:"Consultoría"}),e.jsx(o,{value:"marketing",children:"Marketing Digital"}),e.jsx(o,{value:"software",children:"Desarrollo de Software"}),e.jsx(o,{value:"trading",children:"Trading / Inversiones"}),e.jsx(o,{value:"freelance",children:"Freelance"}),e.jsx(o,{value:"other",children:"Otra"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Dirección"}),e.jsx(m,{value:u.address||"",onChange:t=>w({...u,address:t.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Ciudad"}),e.jsx(m,{value:u.city||"",onChange:t=>w({...u,city:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Código Postal"}),e.jsx(m,{value:u.postalCode||"",onChange:t=>w({...u,postalCode:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Provincia"}),e.jsx(m,{value:u.province||"",onChange:t=>w({...u,province:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"País"}),e.jsx(m,{value:u.country||"",onChange:t=>w({...u,country:t.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Notas Internas (solo admin)"}),e.jsx(ae,{value:u.internalNotes||"",onChange:t=>w({...u,internalNotes:t.target.value}),rows:2,className:"rounded-xl border-gray-200 focus:border-accent","data-testid":"input-edit-notes"})]})]}),u&&e.jsxs(O,{className:"flex-col sm:flex-row gap-3 pt-4 border-t border-border flex-shrink-0",children:[e.jsx(a,{variant:"outline",onClick:()=>w(null),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{onClick:()=>u.id&&nt.mutate({id:u.id,...u}),disabled:nt.isPending,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-save-user",children:nt.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"})]})]})}),e.jsx(I,{open:ie.open,onOpenChange:t=>Ge({open:t,user:t?ie.user:null}),children:e.jsxs($,{className:"w-full sm:max-w-sm bg-white dark:bg-zinc-900",children:[e.jsx(F,{children:e.jsx(q,{className:"text-xl font-black text-red-600",children:"Eliminar Usuario"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[ie.user?.firstName," ",ie.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>Ge({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{variant:"destructive",onClick:()=>ie.user?.id&&Mt.mutate(ie.user.id),disabled:Mt.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete",children:Mt.isPending?"Eliminando...":"Eliminar"})]})]})}),e.jsx(I,{open:B.open,onOpenChange:t=>dt({open:t,order:t?B.order:null}),children:e.jsxs($,{className:"w-full sm:max-w-sm bg-white dark:bg-zinc-900",children:[e.jsx(F,{children:e.jsx(q,{className:"text-xl font-black text-red-600",children:"Eliminar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:B.order?.application?.requestCode||B.order?.maintenanceApplication?.requestCode||B.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",B.order?.user?.firstName," ",B.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>dt({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{variant:"destructive",onClick:()=>B.order?.id&&Rt.mutate(B.order.id),disabled:Rt.isPending,className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-confirm-delete-order",children:Rt.isPending?"Eliminando...":"Eliminar Pedido"})]})]})}),e.jsx(I,{open:ee.open,onOpenChange:t=>it({open:t,order:t?ee.order:null}),children:e.jsxs($,{className:"w-full sm:max-w-sm bg-white dark:bg-zinc-900",children:[e.jsx(F,{children:e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Generar Factura"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",e.jsx("strong",{children:ee.order?.application?.requestCode||ee.order?.maintenanceApplication?.requestCode||ee.order?.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Importe"}),e.jsx(m,{type:"number",step:"0.01",value:he,onChange:t=>Ot(t.target.value),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Divisa"}),e.jsxs(D,{value:Ut,onValueChange:Ls,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(o,{value:"EUR",children:"EUR (€)"}),e.jsx(o,{value:"USD",children:"USD ($)"})]})]})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(a,{variant:"outline",onClick:()=>it({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg",disabled:!he||isNaN(parseFloat(he))||parseFloat(he)<=0||fs,onClick:async()=>{js(!0);try{const t=Math.round(parseFloat(he)*100);if(t<=0){n({title:"Error",description:"El importe debe ser mayor que 0",variant:"destructive"});return}const s=await g("POST",`/api/admin/orders/${ee.order?.id}/generate-invoice`,{amount:t,currency:Ut});if(!s.ok){const c=await s.json().catch(()=>({}));throw new Error(c.message||"Error al generar factura")}n({title:"Factura generada",description:`Factura creada por ${he} ${Ut}`}),b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/user/documents"]}),window.open(`/api/orders/${ee.order?.id}/invoice`,"_blank"),it({open:!1,order:null}),Ot("")}catch(t){n({title:"Error",description:t.message||"No se pudo generar la factura",variant:"destructive"})}finally{js(!1)}},"data-testid":"button-confirm-generate-invoice",children:fs?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Generar Factura"})]})]})}),e.jsx(I,{open:we.open,onOpenChange:t=>Me({open:t,user:t?we.user:null}),children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Solicitar Documentos"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Tipo de documento"}),e.jsxs(D,{value:Oe,onValueChange:ss,placeholder:"Seleccionar tipo...",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(o,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(o,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(o,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(o,{value:"other",children:"Otro Documento"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Mensaje"}),e.jsx(ae,{value:as,onChange:t=>rs(t.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-doc-message"})]})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(a,{variant:"outline",onClick:()=>Me({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{onClick:()=>{if(we.user?.id&&we.user?.email){const s={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[Oe]||Oe;pe.mutate({userId:we.user.id,title:`Solicitud de Documento: ${s}`,message:as||`Por favor, sube tu ${s} a tu panel de cliente.`,type:"action_required"}),Me({open:!1,user:null}),ss(""),rs("")}},disabled:!Oe||pe.isPending,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-request-doc",children:pe.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"})]})]})}),e.jsx(I,{open:re.open,onOpenChange:t=>Ve({open:t,user:t?re.user:null}),children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Crear Factura"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:"Genera una factura para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl",children:["Cliente: ",e.jsxs("strong",{children:[re.user?.firstName," ",re.user?.lastName]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Concepto"}),e.jsx(m,{value:gt,onChange:t=>is(t.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Importe"}),e.jsx(m,{type:"number",value:bt,onChange:t=>ls(t.target.value),placeholder:"739",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Moneda"}),e.jsxs(D,{value:os,onValueChange:cs,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-invoice-currency",children:[e.jsx(o,{value:"EUR",children:"EUR"}),e.jsx(o,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(a,{variant:"outline",onClick:()=>Ve({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{onClick:()=>re.user?.id&&Vt.mutate({userId:re.user.id,concept:gt,amount:Math.round(parseFloat(bt)*100),currency:os}),disabled:!gt||!bt||Vt.isPending,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-create-invoice",children:Vt.isPending?"Creando...":"Crear Factura"})]})]})})]}),e.jsx(I,{open:Js,onOpenChange:ft,children:e.jsxs($,{className:"w-full sm:max-w-sm bg-white dark:bg-zinc-900",children:[e.jsx(F,{children:e.jsx(q,{className:"text-xl font-black text-red-600",children:"Eliminar Mi Cuenta"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"¿Estás seguro de que deseas eliminar tu cuenta permanentemente?"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer. Todos tus datos serán eliminados."})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>ft(!1),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{variant:"destructive",onClick:()=>Qt.mutate(),disabled:Qt.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete-account",children:Qt.isPending?"Eliminando...":"Eliminar Mi Cuenta"})]})]})}),e.jsx(I,{open:le.open,onOpenChange:t=>{t||He({open:!1,file:null})},children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsx(F,{children:e.jsx(q,{className:"text-lg sm:text-xl font-semibold text-foreground",children:"Subir Documento"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[le.file&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex items-center gap-3",children:[e.jsx(be,{className:"w-7 h-7 sm:w-8 sm:h-8 text-accent shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm truncate",children:le.file.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:[(le.file.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs sm:text-sm font-semibold text-foreground mb-2 block",children:"Tipo de documento"}),e.jsxs(D,{value:ye,onValueChange:ms,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-upload-doc-type",children:[e.jsx(o,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(o,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(o,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(o,{value:"other",children:"Otro Documento"})]})]}),ye==="other"&&e.jsxs("div",{children:[e.jsx(d,{className:"text-xs sm:text-sm font-semibold text-foreground mb-2 block",children:"Descripción del documento"}),e.jsx(ae,{value:Be,onChange:t=>xs(t.target.value),placeholder:"Describe el tipo de documento que estás subiendo...",className:"min-h-[80px] rounded-xl border-gray-200 focus:border-accent text-base",style:{fontSize:"16px"},"data-testid":"input-upload-notes"})]})]}),e.jsxs(O,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>He({open:!1,file:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{onClick:async()=>{if(!le.file)return;const t=new FormData;t.append("file",le.file),t.append("documentType",ye),ye==="other"&&Be&&t.append("notes",Be);try{const s=await fetch("/api/user/documents/upload",{method:"POST",body:t,credentials:"include"});if(s.ok)n({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),b.invalidateQueries({queryKey:["/api/user/documents"]}),He({open:!1,file:null});else{const c=await s.json();n({title:"Error",description:c.message||"No se pudo subir el documento",variant:"destructive"})}}catch{n({title:"Error",description:"Error de conexión",variant:"destructive"})}},disabled:ye==="other"&&!Be.trim(),className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-confirm-upload",children:"Subir Documento"})]})]})}),e.jsx(I,{open:Ws,onOpenChange:Ke,children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Crear Nuevo Cliente"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:"Completa los datos del nuevo cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Nombre"}),e.jsx(m,{value:Y.firstName,onChange:t=>ne(s=>({...s,firstName:t.target.value})),placeholder:"Nombre",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Apellidos"}),e.jsx(m,{value:Y.lastName,onChange:t=>ne(s=>({...s,lastName:t.target.value})),placeholder:"Apellidos",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Email"}),e.jsx(m,{type:"email",value:Y.email,onChange:t=>ne(s=>({...s,email:t.target.value})),placeholder:"email@ejemplo.com",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Teléfono"}),e.jsx(m,{value:Y.phone,onChange:t=>ne(s=>({...s,phone:t.target.value})),placeholder:"+34 600 000 000",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Contraseña"}),e.jsx(m,{type:"password",value:Y.password,onChange:t=>ne(s=>({...s,password:t.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-password"})]})]}),e.jsxs(O,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>Ke(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-user",children:"Cancelar"}),e.jsx(a,{onClick:()=>Kt.mutate(Y),disabled:Kt.isPending||!Y.email||!Y.password,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-confirm-create-user",children:Kt.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Crear Cliente"})]})]})}),e.jsx(I,{open:Ys,onOpenChange:_e,children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Crear Nuevo Pedido"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:"Configura el pedido para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Cliente"}),e.jsx(D,{value:de.userId,onValueChange:t=>Qe(s=>({...s,userId:t})),placeholder:"Seleccionar cliente...",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-user",children:st?.map(t=>e.jsxs(o,{value:t.id,children:[t.firstName," ",t.lastName," (",t.email,")"]},t.id))})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Estado (LLC)"}),e.jsxs(D,{value:de.state,onValueChange:t=>Qe(s=>({...s,state:t})),placeholder:"Seleccionar estado",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-state",children:[e.jsx(o,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(o,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(o,{value:"Delaware",children:"Delaware - 1399€"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Importe (€)"}),e.jsx(m,{type:"number",value:de.amount,onChange:t=>Qe(s=>({...s,amount:t.target.value})),placeholder:"739",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-order-amount"})]})]}),e.jsxs(O,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>_e(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-order",children:"Cancelar"}),e.jsx(a,{onClick:()=>_t.mutate(de),disabled:_t.isPending||!de.userId||!de.amount,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-confirm-create-order",children:_t.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Crear Pedido"})]})]})}),e.jsx(I,{open:J.open,onOpenChange:t=>ke({open:t,code:t?J.code:null}),children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:J.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx(H,{className:"text-sm text-muted-foreground",children:J.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Código"}),e.jsx(m,{value:k.code,onChange:t=>G(s=>({...s,code:t.target.value.toUpperCase()})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base uppercase",disabled:!!J.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Tipo"}),e.jsxs(D,{value:k.discountType,onValueChange:t=>G(s=>({...s,discountType:t})),className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-discount-type",children:[e.jsx(o,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(o,{value:"fixed",children:"Fijo (centimos)"})]})]}),e.jsxs("div",{children:[e.jsxs(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:["Valor ",k.discountType==="percentage"?"(%)":"(centimos)"]}),e.jsx(m,{type:"number",value:k.discountValue,onChange:t=>G(s=>({...s,discountValue:t.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Pedido min. (EUR)"}),e.jsx(m,{type:"number",value:k.minOrderAmount,onChange:t=>G(s=>({...s,minOrderAmount:t.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Usos max."}),e.jsx(m,{type:"number",value:k.maxUses,onChange:t=>G(s=>({...s,maxUses:t.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Válido desde"}),e.jsx(m,{type:"date",value:k.validFrom,onChange:t=>G(s=>({...s,validFrom:t.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground mb-2 block",children:"Válido hasta"}),e.jsx(m,{type:"date",value:k.validUntil,onChange:t=>G(s=>({...s,validUntil:t.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Gs,{checked:k.isActive,onCheckedChange:t=>G(s=>({...s,isActive:t})),"data-testid":"switch-discount-active"}),e.jsx(d,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs(O,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>ke({open:!1,code:null}),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-discount",children:"Cancelar"}),e.jsx(a,{onClick:async()=>{try{const t={code:k.code,discountType:k.discountType,discountValue:parseInt(k.discountValue),minOrderAmount:k.minOrderAmount?parseInt(k.minOrderAmount)*100:null,maxUses:k.maxUses?parseInt(k.maxUses):null,validFrom:k.validFrom||null,validUntil:k.validUntil||null,isActive:k.isActive};J.code?(await g("PATCH",`/api/admin/discount-codes/${J.code.id}`,t),n({title:"Código actualizado"})):(await g("POST","/api/admin/discount-codes",t),n({title:"Código creado"})),qt(),ke({open:!1,code:null})}catch(t){n({title:"Error",description:t.message||"No se pudo guardar el código",variant:"destructive"})}},disabled:!k.code||!k.discountValue,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-save-discount",children:J.code?"Guardar Cambios":"Crear Código"})]})]})}),e.jsx(I,{open:Xs,onOpenChange:t=>{At(t),t||Pt("")},children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-black",children:"Verifica tu correo electrónico"}),e.jsx(H,{children:"Te hemos enviado un código de verificación para confirmar tu email"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground block mb-2",children:"Código de verificación"}),e.jsx(m,{value:De,onChange:t=>Pt(t.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-2xl font-black border-gray-200 focus:border-accent tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code","data-testid":"input-email-verification-code"})]}),e.jsx(a,{onClick:async()=>{if(!De||De.length<6){n({title:"Introduce el código de 6 dígitos",variant:"destructive"});return}ks(!0);try{(await(await g("POST","/api/auth/verify-email",{code:De})).json()).success&&(await b.refetchQueries({queryKey:["/api/auth/user"]}),n({title:"Email verificado correctamente"}),At(!1),Pt(""))}catch(t){n({title:"Código incorrecto",description:t.message||"Inténtalo de nuevo o solicita un nuevo código",variant:"destructive"})}finally{ks(!1)}},disabled:ys||De.length<6,size:"lg",className:"w-full bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-verify-email-code",children:ys?e.jsx(Q,{className:"animate-spin"}):"Verificar mi email"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"¿No has recibido el código?"}),e.jsx(a,{variant:"link",onClick:async()=>{Ss(!0);try{await g("POST","/api/auth/resend-verification"),n({title:"Código enviado",description:"Revisa tu email"})}catch{n({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{Ss(!1)}},disabled:Cs,className:"text-accent p-0 h-auto","data-testid":"button-resend-verification-code",children:Cs?"Enviando...":"Reenviar código"})]})]})]})}),e.jsx(I,{open:oe.open,onOpenChange:t=>{Ye({open:t,user:t?oe.user:null}),t||(Et(""),Dt(""),zt(""))},children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-black",children:"Enviar Link de Pago"}),e.jsxs(H,{children:["Envía un enlace de pago a ",oe.user?.firstName," ",oe.user?.lastName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground block mb-2",children:"Link de pago (URL)"}),e.jsx(m,{value:Je,onChange:t=>Et(t.target.value),placeholder:"https://...",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground block mb-2",children:"Importe"}),e.jsx(m,{value:Ce,onChange:t=>Dt(t.target.value),placeholder:"Ej: 739€",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground block mb-2",children:"Mensaje (opcional)"}),e.jsx(ae,{value:hs,onChange:t=>zt(t.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-gray-200 focus:border-accent resize-none",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>Ye({open:!1,user:null}),className:"w-full sm:w-auto rounded-full",children:"Cancelar"}),e.jsx(a,{onClick:async()=>{if(!Je||!Ce){n({title:"Completa todos los campos requeridos",variant:"destructive"});return}bs(!0);try{await g("POST","/api/admin/send-payment-link",{userId:oe.user?.id,paymentLink:Je,amount:Ce,message:hs||`Por favor, completa el pago de ${Ce} a través del siguiente enlace.`}),n({title:"Link de pago enviado",description:`Se ha enviado el link a ${oe.user?.email}`}),Ye({open:!1,user:null}),Et(""),Dt(""),zt("")}catch(t){n({title:"Error",description:t.message||"No se pudo enviar el link",variant:"destructive"})}finally{bs(!1)}},disabled:gs||!Je||!Ce,className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-send-payment-link",children:gs?e.jsx(Q,{className:"animate-spin"}):"Enviar Link de Pago"})]})]})}),e.jsx(I,{open:K.open,onOpenChange:t=>{Se({open:t,order:t?K.order:null}),t||(Ee(null),Xe("articles_of_organization"))},children:e.jsxs($,{className:"w-full sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsxs(F,{children:[e.jsx(q,{className:"text-xl font-semibold text-foreground",children:"Subir Documento para Cliente"}),e.jsx(H,{children:K.order?.userId?`Usuario: ${K.order?.user?.firstName} ${K.order?.user?.lastName}`:`Pedido: ${K.order?.application?.requestCode||K.order?.maintenanceApplication?.requestCode||K.order?.invoiceNumber}`})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground block mb-2",children:"Tipo de Documento"}),e.jsxs(D,{value:Ns,onValueChange:Xe,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(o,{value:"articles_of_organization",children:"Artículos de Organización"}),e.jsx(o,{value:"certificate_of_formation",children:"Certificado de Formación"}),e.jsx(o,{value:"boir",children:"BOIR"}),e.jsx(o,{value:"ein_document",children:"Documento EIN"}),e.jsx(o,{value:"operating_agreement",children:"Acuerdo Operativo"}),e.jsx(o,{value:"invoice",children:"Factura"}),e.jsx(o,{value:"other",children:"Otro Documento"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-foreground block mb-2",children:"Archivo"}),e.jsxs("label",{className:"cursor-pointer block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:t=>{const s=t.target.files?.[0];s&&Ee(s)}}),e.jsx("div",{className:`p-4 border-2 border-dashed rounded-xl text-center ${ce?"border-accent bg-accent/5":"border-gray-200 dark:border-zinc-700"}`,children:ce?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px]",children:ce.name})]}):e.jsxs("div",{className:"text-muted-foreground text-sm",children:[e.jsx(Jt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),"Haz clic para seleccionar archivo"]})})]})]})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(a,{variant:"outline",onClick:()=>Se({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(a,{disabled:!ce||vs,onClick:async()=>{if(!(!ce||!K.order)){ws(!0);try{const t=new FormData;t.append("file",ce),t.append("documentType",Ns),K.order.userId?t.append("userId",K.order.userId):t.append("orderId",K.order.id);const s=await fetch("/api/admin/documents/upload",{method:"POST",body:t,credentials:"include"});if(s.ok)n({title:"Documento subido",description:"El documento ha sido añadido al expediente del cliente."}),b.invalidateQueries({queryKey:["/api/admin/documents"]}),b.invalidateQueries({queryKey:["/api/user/documents"]}),Se({open:!1,order:null}),Ee(null);else{const c=await s.json();n({title:"Error",description:c.message||"No se pudo subir el documento",variant:"destructive"})}}catch{n({title:"Error",description:"Error de conexión",variant:"destructive"})}finally{ws(!1)}}},className:"w-full sm:w-auto bg-accent text-accent-foreground font-semibold rounded-lg","data-testid":"button-admin-upload-doc",children:vs?e.jsx(Q,{className:"animate-spin"}):"Subir Documento"})]})]})}),e.jsx(Rs,{})]})}export{Za as default};
