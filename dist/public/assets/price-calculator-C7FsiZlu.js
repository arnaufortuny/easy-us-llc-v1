import{a as d,j as e,am as W,a2 as Z,Z as J}from"./react-core-BwXmAyYw.js";import{B as j,q as g,v as N,y as h,I as u,N as A}from"./ui-components-CnPFRHmO.js";import{u as K,b as O,N as V,L as X,F as Y}from"./index-Cz-r3V-y.js";import{u as _}from"./i18n-DfkNketv.js";import"./radix-ui-BLFq0uWR.js";import"./react-dom-lwpWoMhj.js";import"./forms-CNlQlKiB.js";import"./pdf-DU6qdRYg.js";import"./tanstack-Bcy__teF.js";function ee(){return Math.random().toString(36).substr(2,9)}function de(){const[,L]=K(),{t:s}=_(),{user:D,isAuthenticated:F,isLoading:E}=O(),[$,M]=d.useState(""),[b,q]=d.useState(0),[r,B]=d.useState(1),[p,S]=d.useState(30),[f,R]=d.useState(0),[v,z]=d.useState("USD"),[i,C]=d.useState([]);if(E)return e.jsx("div",{className:"min-h-screen bg-background"});if(!F||!D)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:s("tools.priceCalculator.loginRequired")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s("tools.priceCalculator.loginDescription")}),e.jsx(j,{onClick:()=>L("/auth/login"),className:"bg-accent text-accent-foreground rounded-full px-6",children:s("auth.login.submit")})]})});const I=()=>{C([...i,{id:ee(),name:"",cost:0,type:"fixed"}])},H=t=>{C(i.filter(n=>n.id!==t))},y=(t,n,c)=>{C(i.map(m=>m.id===t?{...m,[n]:c}:m))},a=v==="EUR"?"€":v==="USD"?"$":"£",l=d.useMemo(()=>{const t=b*r,n=i.filter(x=>x.type==="fixed").reduce((x,P)=>x+P.cost,0),c=i.filter(x=>x.type==="variable").reduce((x,P)=>x+P.cost*r,0),m=t+n+c,w=m*(p/100),k=m+w,U=k*(f/100),T=k+U,G=r>0?T/r:0,Q=r>0?w/r:0;return{baseTotal:t,fixedCosts:n,variableCosts:c,totalCosts:m,marginAmount:w,subtotalWithMargin:k,taxAmount:U,finalPrice:T,pricePerUnit:G,profitPerUnit:Q}},[b,r,i,p,f]),o=t=>t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(V,{}),e.jsxs("main",{className:"flex-1 w-full max-w-5xl mx-auto px-4 py-4 md:py-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(X,{href:"/dashboard?tab=tools",children:e.jsxs(j,{variant:"ghost",size:"sm",className:"rounded-full text-muted-foreground hover:text-foreground mb-2 -ml-2","data-testid":"button-back-tools",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),s("tools.backToTools")]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-black text-foreground tracking-tight",children:s("tools.priceCalculator.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("tools.priceCalculator.subtitle")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(g,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(N,{className:"p-5 md:p-6",children:[e.jsx("h2",{className:"font-bold text-foreground mb-5",children:s("tools.priceCalculator.productSection")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{className:"text-sm font-medium text-foreground mb-1.5 block",children:s("tools.priceCalculator.productName")}),e.jsx(u,{value:$,onChange:t=>M(t.target.value),placeholder:s("tools.priceCalculator.productPlaceholder"),className:"h-11 rounded-full","data-testid":"input-product-name"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-medium text-foreground mb-1.5 block",children:s("tools.priceCalculator.baseCost")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:a}),e.jsx(u,{type:"number",min:"0",step:"0.01",value:b||"",onChange:t=>q(parseFloat(t.target.value)||0),className:"h-11 rounded-full pl-8",placeholder:"0.00","data-testid":"input-base-cost"})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-medium text-foreground mb-1.5 block",children:s("tools.priceCalculator.quantity")}),e.jsx(u,{type:"number",min:"1",value:r,onChange:t=>B(parseInt(t.target.value)||1),className:"h-11 rounded-full","data-testid":"input-quantity"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-medium text-foreground mb-1.5 block",children:s("tools.priceCalculator.currency")}),e.jsxs(A,{value:v,onChange:t=>z(t.target.value),className:"h-11 rounded-full","data-testid":"select-currency",children:[e.jsx("option",{value:"USD",children:"USD - Dollar"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"}),e.jsx("option",{value:"GBP",children:"GBP - Pound"})]})]})]})]})}),e.jsx(g,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(N,{className:"p-5 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"font-bold text-foreground",children:s("tools.priceCalculator.additionalCosts")}),e.jsxs(j,{variant:"outline",size:"sm",onClick:I,className:"rounded-full text-xs","data-testid":"button-add-cost",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"})," ",s("tools.priceCalculator.addCost")]})]}),i.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx("p",{children:s("tools.priceCalculator.noCosts")}),e.jsx("p",{className:"text-xs mt-1",children:s("tools.priceCalculator.noCostsHint")})]}):e.jsx("div",{className:"space-y-3",children:i.map((t,n)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx(u,{value:t.name,onChange:c=>y(t.id,"name",c.target.value),placeholder:s("tools.priceCalculator.costName"),className:"h-9 rounded-full text-sm","data-testid":`input-cost-name-${n}`}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:a}),e.jsx(u,{type:"number",min:"0",step:"0.01",value:t.cost||"",onChange:c=>y(t.id,"cost",parseFloat(c.target.value)||0),className:"h-9 rounded-full pl-6 text-sm",placeholder:"0.00","data-testid":`input-cost-amount-${n}`})]}),e.jsxs(A,{value:t.type,onChange:c=>y(t.id,"type",c.target.value),className:"h-9 rounded-full text-sm","data-testid":`select-cost-type-${n}`,children:[e.jsx("option",{value:"fixed",children:s("tools.priceCalculator.fixed")}),e.jsx("option",{value:"variable",children:s("tools.priceCalculator.perUnit")})]})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>H(t.id),className:"h-9 w-9 text-muted-foreground hover:text-red-500 shrink-0","data-testid":`button-remove-cost-${n}`,children:e.jsx(J,{className:"w-4 h-4"})})]},t.id))})]})}),e.jsx(g,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(N,{className:"p-5 md:p-6",children:[e.jsx("h2",{className:"font-bold text-foreground mb-5",children:s("tools.priceCalculator.marginTax")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-medium text-foreground mb-1.5 block",children:s("tools.priceCalculator.profitMargin")}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:"number",min:"0",max:"500",value:p,onChange:t=>S(parseFloat(t.target.value)||0),className:"h-11 rounded-full pr-8","data-testid":"input-margin"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"%"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("tools.priceCalculator.marginHint")})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-medium text-foreground mb-1.5 block",children:s("tools.priceCalculator.taxes")}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:"number",min:"0",max:"100",value:f,onChange:t=>R(parseFloat(t.target.value)||0),className:"h-11 rounded-full pr-8","data-testid":"input-tax"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"%"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("tools.priceCalculator.taxHint")})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-accent/10 rounded-xl",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsx("span",{className:"text-foreground font-medium",children:s("tools.priceCalculator.commonMargins")})}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:[15,25,30,40,50,100].map(t=>e.jsxs(j,{variant:p===t?"default":"outline",size:"sm",onClick:()=>S(t),className:`rounded-full text-xs h-7 ${p===t?"bg-accent text-accent-foreground":""}`,"data-testid":`button-preset-margin-${t}`,children:[t,"%"]},t))})]})]})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-4 space-y-4",children:[e.jsx(g,{className:"rounded-2xl border-0 shadow-lg bg-gradient-to-br from-accent to-green-600 text-white overflow-hidden",children:e.jsxs(N,{className:"p-5 md:p-6",children:[e.jsx("h2",{className:"font-bold mb-4",children:s("tools.priceCalculator.recommendedPrice")}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-white/70 text-sm mb-1",children:s("tools.priceCalculator.finalPrice")}),e.jsxs("p",{className:"text-4xl md:text-5xl font-bold",children:[a,o(l.finalPrice)]}),r>1&&e.jsxs("p",{className:"text-white/80 text-sm mt-2",children:[a,o(l.pricePerUnit)," ",s("tools.priceCalculator.perUnitLabel")]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-white/70",children:[s("tools.priceCalculator.margin"),":"]}),e.jsxs("span",{className:"font-bold",children:[a,o(l.marginAmount)]})]}),r>1&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-white/70",children:[s("tools.priceCalculator.profitPerUnit"),":"]}),e.jsxs("span",{className:"font-bold",children:[a,o(l.profitPerUnit)]})]})]})]})}),e.jsx(g,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(N,{className:"p-5 md:p-6",children:[e.jsx("h2",{className:"font-bold text-foreground text-sm mb-4",children:s("tools.priceCalculator.breakdown")}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("tools.priceCalculator.baseCostTotal")," (",r,")"]}),e.jsxs("span",{className:"font-medium",children:[a,o(l.baseTotal)]})]}),l.fixedCosts>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("tools.priceCalculator.fixedCostsTotal")}),e.jsxs("span",{className:"font-medium",children:[a,o(l.fixedCosts)]})]}),l.variableCosts>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("tools.priceCalculator.variableCostsTotal")}),e.jsxs("span",{className:"font-medium",children:[a,o(l.variableCosts)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-foreground font-medium",children:s("tools.priceCalculator.totalCosts")}),e.jsxs("span",{className:"font-bold",children:[a,o(l.totalCosts)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["+ ",s("tools.priceCalculator.margin")," (",p,"%)"]}),e.jsxs("span",{className:"font-medium",children:[a,o(l.marginAmount)]})]}),f>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["+ ",s("tools.priceCalculator.taxAmount")," (",f,"%)"]}),e.jsxs("span",{className:"font-medium",children:[a,o(l.taxAmount)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-accent/30 bg-accent/5 -mx-5 px-5 py-2 rounded-xl mt-2",children:[e.jsx("span",{className:"font-bold text-foreground",children:s("tools.priceCalculator.finalPrice")}),e.jsxs("span",{className:"font-bold text-accent",children:[a,o(l.finalPrice)]})]})]})]})})]})})]})]}),e.jsx(Y,{})]})}export{de as default};
