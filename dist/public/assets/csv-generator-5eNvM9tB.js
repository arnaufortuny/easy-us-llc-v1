import{a as N,j as e,am as P,a2 as O,Z as U,l as B,an as R}from"./react-core-BwXmAyYw.js";import{B as x,q as u,v as z,w as k,y as c,I as g,N as h,p as i,o as _}from"./ui-components-CnPFRHmO.js";import{u as q,b as H,N as V,L as X,F as W}from"./index-Cz-r3V-y.js";import{u as Y}from"./i18n-DfkNketv.js";import"./radix-ui-BLFq0uWR.js";import"./react-dom-lwpWoMhj.js";import"./forms-CNlQlKiB.js";import"./pdf-DU6qdRYg.js";import"./tanstack-Bcy__teF.js";const y=["Sales","Services","Consulting","Affiliate income","Digital products","Other income"],C=["Software / SaaS","Advertising / Marketing","Contractors / Freelancers","Banking fees","Office expenses","Travel","Professional services","Education","Hosting / Domains","Equipment","Other"],Z=["USD","EUR","GBP","CAD","AUD","MXN"],J=["Bank Transfer","Credit Card","Debit Card","PayPal","Stripe","Wise","Mercury","Cash","Check","Crypto","Other"];function K(){return Math.random().toString(36).substr(2,9)}function G(){return{id:K(),date:new Date().toISOString().split("T")[0],description:"",amount:"",currency:"USD",type:"income",category:"Sales",paymentMethod:"Bank Transfer",bankAccount:"",invoiceNumber:"",notes:""}}function de(){const[,w]=q(),{t:r}=Y(),[n,p]=N.useState([G()]),[v,j]=N.useState(!1),{user:S,isAuthenticated:T,isLoading:A}=H();if(A)return e.jsx("div",{className:"min-h-screen bg-background"});if(!T||!S)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:r("tools.csvGenerator.loginRequired")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:r("tools.csvGenerator.loginDescription")}),e.jsx(x,{onClick:()=>w("/auth/login"),className:"bg-accent text-accent-foreground rounded-full px-6",children:r("auth.login.submit")})]})});const $=()=>{p([...n,G()])},E=t=>{n.length>1&&p(n.filter(a=>a.id!==t))},d=(t,a,s)=>{p(n.map(m=>{if(m.id===t){const l={...m,[a]:s};return a==="type"&&(s==="income"?l.category=y[0]:s==="expense"?l.category=C[0]:l.category="Transfer"),l}return m}))},D=t=>t==="income"?y:t==="expense"?C:["Transfer"],F=()=>{j(!0),setTimeout(()=>{const t=["Date","Description","Amount","Currency","Type","Category","Payment Method","Bank Account","Invoice Number","Notes"],a=n.map(o=>[o.date,`"${o.description.replace(/"/g,'""')}"`,o.amount,o.currency,o.type.charAt(0).toUpperCase()+o.type.slice(1),o.category,o.paymentMethod,`"${o.bankAccount.replace(/"/g,'""')}"`,`"${o.invoiceNumber.replace(/"/g,'""')}"`,`"${o.notes.replace(/"/g,'""')}"`]),s=[t.join(","),...a.map(o=>o.join(","))].join(`
`),m=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),L=URL.createObjectURL(m),M=new Date().toISOString().split("T")[0];l.setAttribute("href",L),l.setAttribute("download",`transactions_${M}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),j(!1)},500)},I=n.some(t=>t.date&&t.description.trim()&&t.amount&&parseFloat(t.amount)>0),b=n.filter(t=>t.type==="income"&&t.amount).reduce((t,a)=>t+parseFloat(a.amount||"0"),0),f=n.filter(t=>t.type==="expense"&&t.amount).reduce((t,a)=>t+parseFloat(a.amount||"0"),0);return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(V,{}),e.jsxs("main",{className:"flex-1 w-full max-w-5xl mx-auto px-4 py-6 md:py-10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(X,{href:"/dashboard?tab=tools",children:e.jsxs(x,{variant:"ghost",size:"sm",className:"rounded-full text-muted-foreground hover:text-foreground mb-4 -ml-2","data-testid":"button-back-tools",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),r("tools.backToTools")]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-black text-foreground tracking-tight",children:r("tools.csvGenerator.title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r("tools.csvGenerator.subtitle")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsxs(u,{className:"p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:r("tools.csvGenerator.totalIncome")}),e.jsxs("p",{className:"text-lg md:text-xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-income",children:["$",b.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs(u,{className:"p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-red-50 to-white dark:from-red-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:r("tools.csvGenerator.totalExpenses")}),e.jsxs("p",{className:"text-lg md:text-xl font-black text-red-600 dark:text-red-500","data-testid":"stat-total-expenses",children:["$",f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs(u,{className:"p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:r("tools.csvGenerator.netBalance")}),e.jsxs("p",{className:`text-lg md:text-xl font-black ${b-f>=0?"text-blue-600 dark:text-blue-500":"text-red-600 dark:text-red-500"}`,"data-testid":"stat-net-balance",children:["$",(b-f).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs(u,{className:"p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-purple-50 to-white dark:from-purple-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:r("tools.csvGenerator.transactions")}),e.jsx("p",{className:"text-lg md:text-xl font-black text-purple-600 dark:text-purple-500","data-testid":"stat-transactions-count",children:n.length})]})]}),e.jsx(u,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-card overflow-hidden",children:e.jsxs(z,{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:[e.jsx("h2",{className:"font-bold text-foreground",children:r("tools.csvGenerator.transactionsTitle")}),e.jsxs(x,{onClick:$,size:"sm",variant:"outline",className:"rounded-full font-semibold","data-testid":"button-add-transaction",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),r("tools.csvGenerator.addTransaction")]})]}),e.jsx("div",{className:"space-y-4",children:n.map((t,a)=>e.jsxs("div",{className:"p-4 rounded-xl border border-border bg-muted/30 dark:bg-[#1A1A1A]/10","data-testid":`transaction-row-${a}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",className:"text-[10px]",children:["#",a+1]}),e.jsx(k,{className:`text-[10px] ${t.type==="income"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.type==="expense"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:t.type==="income"?r("tools.csvGenerator.income"):t.type==="expense"?r("tools.csvGenerator.expense"):r("tools.csvGenerator.transfer")})]}),n.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full",onClick:()=>E(t.id),"data-testid":`button-remove-transaction-${a}`,children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.date")}),e.jsx(g,{type:"date",value:t.date,onChange:s=>d(t.id,"date",s.target.value),className:"rounded-full text-sm","data-testid":`input-date-${a}`})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-3",children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.description")}),e.jsx(g,{value:t.description,onChange:s=>d(t.id,"description",s.target.value),placeholder:r("tools.csvGenerator.descriptionPlaceholder"),className:"rounded-full text-sm","data-testid":`input-description-${a}`})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.amount")}),e.jsx(g,{type:"number",step:"0.01",min:"0",value:t.amount,onChange:s=>d(t.id,"amount",s.target.value),placeholder:"0.00",className:"rounded-full text-sm","data-testid":`input-amount-${a}`})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.currency")}),e.jsx(h,{value:t.currency,onChange:s=>d(t.id,"currency",s.target.value),className:"rounded-full text-sm","data-testid":`select-currency-${a}`,children:Z.map(s=>e.jsx(i,{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.type")}),e.jsxs(h,{value:t.type,onChange:s=>d(t.id,"type",s.target.value),className:"rounded-full text-sm","data-testid":`select-type-${a}`,children:[e.jsx(i,{value:"income",children:r("tools.csvGenerator.income")}),e.jsx(i,{value:"expense",children:r("tools.csvGenerator.expense")}),e.jsx(i,{value:"transfer",children:r("tools.csvGenerator.transfer")})]})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.category")}),e.jsx(h,{value:t.category,onChange:s=>d(t.id,"category",s.target.value),className:"rounded-full text-sm","data-testid":`select-category-${a}`,children:D(t.type).map(s=>e.jsx(i,{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.paymentMethod")}),e.jsx(h,{value:t.paymentMethod,onChange:s=>d(t.id,"paymentMethod",s.target.value),className:"rounded-full text-sm","data-testid":`select-payment-method-${a}`,children:J.map(s=>e.jsx(i,{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.bankAccount")}),e.jsx(g,{value:t.bankAccount,onChange:s=>d(t.id,"bankAccount",s.target.value),placeholder:r("tools.csvGenerator.bankAccountPlaceholder"),className:"rounded-full text-sm","data-testid":`input-bank-account-${a}`})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.invoiceNumber")}),e.jsx(g,{value:t.invoiceNumber,onChange:s=>d(t.id,"invoiceNumber",s.target.value),placeholder:r("tools.csvGenerator.invoiceNumberPlaceholder"),className:"rounded-full text-sm","data-testid":`input-invoice-number-${a}`})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(c,{className:"text-xs font-semibold text-muted-foreground mb-1 block",children:r("tools.csvGenerator.notes")}),e.jsx(_,{value:t.notes,onChange:s=>d(t.id,"notes",s.target.value),placeholder:r("tools.csvGenerator.notesPlaceholder"),className:"rounded-lg text-sm resize-none",rows:2,"data-testid":`input-notes-${a}`})]})]})]},t.id))}),e.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("div",{className:"flex items-start gap-2 text-xs text-muted-foreground",children:e.jsx("p",{children:r("tools.csvGenerator.disclaimer")})}),e.jsx(x,{onClick:F,disabled:!I||v,className:"bg-accent hover:bg-accent/90 text-accent-foreground font-semibold rounded-full px-6","data-testid":"button-download-csv",children:v?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),r("tools.csvGenerator.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),r("tools.csvGenerator.downloadCsv")]})})]})})]})})]}),e.jsx(W,{})]})}export{de as default};
